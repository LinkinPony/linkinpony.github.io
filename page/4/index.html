<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"linkinpony.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="I always love dashie">
<meta property="og:url" content="http://linkinpony.github.io/page/4/index.html">
<meta property="og:site_name" content="I always love dashie">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="LinkinPony">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://linkinpony.github.io/page/4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>I always love dashie</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">I always love dashie</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">LinkinPony</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">41</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/LinkinPony" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;LinkinPony" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://codeforces.com/profile/LinkinPony" title="CodeForces → https:&#x2F;&#x2F;codeforces.com&#x2F;profile&#x2F;LinkinPony" rel="noopener" target="_blank"><i class="code fa-fw"></i>CodeForces</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://acker.fun/" title="https:&#x2F;&#x2F;acker.fun&#x2F;" rel="noopener" target="_blank">Acker</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://kmguan-528.github.io/" title="https:&#x2F;&#x2F;kmguan-528.github.io&#x2F;" rel="noopener" target="_blank">KMGuan</a>
        </li>
    </ul>
  </div>

          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2020/06/08/solution-Uva11107/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/08/solution-Uva11107/" class="post-title-link" itemprop="url">[题解]UVA11107 Life Forms</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2020-06-08 20:07:49 / Modified: 20:38:52" itemprop="dateCreated datePublished" datetime="2020-06-08T20:07:49+08:00">2020-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="题面">题面:</h4>
<p>https://vjudge.net/problem/UVA-11107</p>
<h4 id="思路">思路</h4>
<p>​ 这里给出一种字符串Hash+二分的做法.</p>
<p>​ 对每个字符串分别进行Hash,再二分最长子串的长度<span class="math inline">\(L\)</span>.在判断<span class="math inline">\(L\)</span>是否合法时,只需求出每个字符串中长度为<span class="math inline">\(L\)</span>的<strong>不重复</strong>子串,再统计全部字符串中所有子串的个数.如果有子串出现次数大于等于<span class="math inline">\(\frac{n}{2}+1\)</span>,那么<span class="math inline">\(L\)</span>合法.</p>
<p>​ 实现上,使用map进行统计(<span class="math inline">\(cnt\)</span>)和判重(<span class="math inline">\(vis\)</span>).对每个字符串<span class="math inline">\(s\)</span>,计算以<span class="math inline">\([1...|s| - L+1]\)</span>为起点,长度为<span class="math inline">\(L\)</span>的子串的hash值<span class="math inline">\(h_i\)</span>,去重后添加到<span class="math inline">\(cnt\)</span>里.在添加过程中如果有<span class="math inline">\(cnt[h_i] \geq \frac{n}{2}+1\)</span>那么<span class="math inline">\(L\)</span>合法,同时将该段子串添加到答案中.输出时对答案去重输出即可,同时注意UVA的毒瘤格式要求=-=</p>
<p>​ 这个做法时间效率很低(在不作优化的情况下跑了3.72s),但是比较好想和好写</p>
<h4 id="代码">代码</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UVA11107</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e3</span>+<span class="number">10</span>,maxs = <span class="number">105</span>;</span><br><span class="line"><span class="keyword">const</span> ull x = <span class="number">13331</span>;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line">ull xp[maxn],H[maxn][maxs];</span><br><span class="line">string raw[maxs];</span><br><span class="line">vector&lt;string&gt;ans;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> L)</span></span>&#123;</span><br><span class="line">	<span class="keyword">bool</span> ok = <span class="number">0</span>;</span><br><span class="line">	map&lt;ull,<span class="keyword">int</span>&gt;cnt;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">1</span>;k &lt;= n;k++)&#123;</span><br><span class="line">		map&lt;ull,<span class="keyword">bool</span>&gt;vis;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i+L<span class="number">-1</span> &lt;= raw[k].<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">			ull u = H[i+L<span class="number">-1</span>][k] - H[i<span class="number">-1</span>][k]*xp[L];</span><br><span class="line">			<span class="keyword">if</span>(!vis[u])&#123;</span><br><span class="line">				vis[u] = <span class="number">1</span>;</span><br><span class="line">				cnt[u]++;</span><br><span class="line">				<span class="keyword">if</span>(cnt[u] &gt;= n/<span class="number">2</span>+<span class="number">1</span>)ok = <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ok;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> L)</span></span>&#123;</span><br><span class="line">	map&lt;ull,<span class="keyword">int</span>&gt;cnt;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">1</span>;k &lt;= n;k++)&#123;</span><br><span class="line">		map&lt;ull,<span class="keyword">bool</span>&gt;vis;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i+L<span class="number">-1</span> &lt;= raw[k].<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">			ull u = H[i+L<span class="number">-1</span>][k] - H[i<span class="number">-1</span>][k]*xp[L];</span><br><span class="line">			<span class="keyword">if</span>(!vis[u])&#123;</span><br><span class="line">				vis[u] = <span class="number">1</span>;</span><br><span class="line">				cnt[u]++;</span><br><span class="line">				<span class="keyword">if</span>(cnt[u] &gt;= n/<span class="number">2</span>+<span class="number">1</span>)&#123;</span><br><span class="line">					string yay = <span class="string">&quot;&quot;</span>;</span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> j = i;j &lt;= i+L<span class="number">-1</span>;j++)yay += raw[k][j<span class="number">-1</span>];</span><br><span class="line">					ans.<span class="built_in">push_back</span>(yay);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	xp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; maxn;i++)xp[i] = xp[i<span class="number">-1</span>]*x;</span><br><span class="line">	<span class="keyword">bool</span> wtf = <span class="number">0</span>; </span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n) == <span class="number">1</span> <span class="keyword">and</span> n)&#123;</span><br><span class="line">		<span class="keyword">if</span>(wtf)cout &lt;&lt; endl;</span><br><span class="line">		wtf = <span class="number">1</span>;</span><br><span class="line">		ans.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">			string u;</span><br><span class="line">			cin &gt;&gt; u;</span><br><span class="line">			raw[i] = u;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= u.<span class="built_in">size</span>();j++)H[j][i] = H[j<span class="number">-1</span>][i]*x + u[j<span class="number">-1</span>] - <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> L = <span class="number">1</span>,R = maxn,M,len = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(L &lt;= R)&#123;</span><br><span class="line">			M = (L+R)/<span class="number">2</span>;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">check</span>(M))&#123;</span><br><span class="line">				len = M;</span><br><span class="line">				L = M+<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> R = M<span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">solve</span>(len);</span><br><span class="line">		<span class="built_in">sort</span>(ans.<span class="built_in">begin</span>(),ans.<span class="built_in">end</span>());</span><br><span class="line">		<span class="keyword">if</span>(ans.<span class="built_in">size</span>() <span class="keyword">and</span> len)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; ans.<span class="built_in">size</span>();i++)<span class="keyword">if</span>(!i <span class="keyword">or</span> ans[i] != ans[i<span class="number">-1</span>])cout &lt;&lt; ans[i] &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;?\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2020/05/16/solution-CF1355C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/16/solution-CF1355C/" class="post-title-link" itemprop="url">[题解]CF1355C-Count Triangles</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2020-05-16 23:10:54 / Modified: 23:19:20" itemprop="dateCreated datePublished" datetime="2020-05-16T23:10:54+08:00">2020-05-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>写这个不是因为这题多难或者有意思,纯粹是纪念一下自己有多傻逼=-=</p>
<h1 id="题意">题意</h1>
<p>给出<span class="math inline">\(A,B,C,D\)</span>求满足<span class="math inline">\(A \leq x \leq B \leq y \leq C \leq z \leq D\)</span>,的<span class="math inline">\(x,y,z\)</span>能组成的三角形个数</p>
<p><span class="math inline">\(1 \leq A \leq B \leq C \leq D \leq 5e5\)</span></p>
<h1 id="思路">思路</h1>
<p>很显然只要满足<span class="math inline">\(z &lt; x+y\)</span>且<span class="math inline">\(C \leq z \leq D\)</span>就行=-=</p>
<p>那么枚举<span class="math inline">\(x\)</span>,把<span class="math inline">\([x+B,x+C]\)</span>加1(用前缀和维护一下就行),再枚举<span class="math inline">\(z\)</span>统计满足<span class="math inline">\(z &lt; x+y\)</span>的个数就行=-=</p>
<p>复杂度<span class="math inline">\(O(C)\)</span></p>
<p><strong>就这玩意都做不出来,我是傻逼</strong></p>
<h1 id="代码">代码</h1>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//C </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">int</span> pre[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ll a,b,c,d,ans = <span class="number">0</span>;</span><br><span class="line">	cin &gt;&gt; a &gt;&gt; b &gt;&gt; c &gt;&gt; d;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = a;i &lt;= b;i++)pre[i+b]++,pre[i+c+<span class="number">1</span>]--;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; maxn;i++)pre[i] += pre[i<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; maxn;i++)ans += pre[i]*<span class="built_in">max</span>(<span class="number">0ll</span>,<span class="built_in">min</span>(d,(ll)(i<span class="number">-1</span>)) - c + <span class="number">1</span>); </span><br><span class="line">	cout &lt;&lt; ans;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2020/05/15/solution-CF1325E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/15/solution-CF1325E/" class="post-title-link" itemprop="url">[题解]CF1325E-Ehab's REAL Number Theory Problem</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-15 15:43:15" itemprop="dateCreated datePublished" datetime="2020-05-15T15:43:15+08:00">2020-05-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-05-21 22:13:24" itemprop="dateModified" datetime="2020-05-21T22:13:24+08:00">2020-05-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>一道有意思的<del>毒瘤</del>题</p>
<h1 id="题意">题意</h1>
<p>​ 给出数列<span class="math inline">\(\{a_1,a_2,...,a_n\}\)</span>,其中每个<span class="math inline">\(a_i\)</span>最多只有7个因子.求乘积为完全平方数的最短子序列</p>
<p>​ <span class="math inline">\(1 \leq n \leq 1e5\)</span>,<span class="math inline">\(1 \leq a_i \leq 1e6\)</span></p>
<h1 id="思路">思路</h1>
<p>​ 首先条件里"最多只有7个因子"是很有意思的一个提示,它实际上是指每个数<strong>最多只有2个素因子</strong></p>
<p>证明:</p>
<p>​ 我们考虑因子个数定理:</p>
<p>​ 以<span class="math inline">\(d(N)\)</span>表示<span class="math inline">\(N\)</span>的因子个数,且<span class="math inline">\(N = Σ_{i=1}^{n}p_{i}^{k_i}\)</span></p>
<p>​ 则有<span class="math inline">\(d(N) = \prod_{i = 1}^{n}(k_i+1)\)</span></p>
<p>​ 容易看出当<span class="math inline">\(N\)</span>有3个素因子时,<span class="math inline">\(d(N) \geq 8\)</span>.故N最多只有两个素因子.</p>
<p>​ 如此可以分解每个<span class="math inline">\(a_i\)</span>为<span class="math inline">\(a_i = p^{k_1}q^{k_2}\)</span>的形式.因为我们需要求完全平方数,<span class="math inline">\(k_1,k_2\)</span>可以直接模2.之后有如下三种情况:</p>
<ol type="1">
<li><span class="math inline">\(a_i = 1\)</span></li>
<li><span class="math inline">\(a_i = 1*p_i\)</span></li>
<li><span class="math inline">\(a_i = p_i*q_i\)</span> 我们要做的就是保证子序列里每个<span class="math inline">\(p_i,q_i\)</span>的指数为偶数,同时使这个序列最短.</li>
</ol>
<hr />
<p>​ 如何高效求解这个问题?上面的因子分解得到了<span class="math inline">\(p,q\)</span>两个因子,让人联想到图的连边.不妨如此建模:将因子作为点,向<span class="math inline">\(a_i\)</span>的两个因子<span class="math inline">\(p_i,q_i\)</span>连一条无向无权边,则问题转化为求这个图里的最小环.(因为一个简单环里每个点的度数都为2,满足每个因子的指数都为偶数这一要求).</p>
<p>​ 对于无向无权图图求最小环我们可以简单地对每个点做BFS.对于一条未访问的边<span class="math inline">\(u,v\)</span> ,如果<span class="math inline">\(v\)</span>已访问过,那么该图存在一个长度为<span class="math inline">\(dis[u]+dis[v]+1\)</span>的环(请自己画图验证).但是这样复杂度为<span class="math inline">\(O(n^2)\)</span></p>
<p>​ 考虑这个图的特殊性质:任意正整数<span class="math inline">\(N\)</span>最多只有一个大于<span class="math inline">\(\sqrt{N}\)</span>的素因子,换句话说这个图里每条边都至少有一个点标号小于<span class="math inline">\(\sqrt{max\{a_i\}}\)</span>.只需枚举这些点即可.</p>
<p>​ 总复杂度:<span class="math inline">\(O(\sqrt{max{a_i}}n)\)</span></p>
<h1 id="代码">代码</h1>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CF1325E</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = <span class="number">1e7</span>+<span class="number">10</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> f,t,next;</span><br><span class="line">	<span class="built_in">Edge</span>(<span class="keyword">int</span> f = <span class="number">0</span>,<span class="keyword">int</span> t = <span class="number">0</span>,<span class="keyword">int</span> next = <span class="number">0</span>):<span class="built_in">f</span>(f),<span class="built_in">t</span>(t),<span class="built_in">next</span>(next)&#123;&#125;</span><br><span class="line">&#125;edge[maxn];</span><br><span class="line"><span class="keyword">int</span> cnt,head[maxn],dis[maxn],ans = <span class="number">1e9</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	edge[cnt] = <span class="built_in">Edge</span>(f,t,head[f]);</span><br><span class="line">	head[f] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	<span class="built_in">addedge</span>(f,t);</span><br><span class="line">	<span class="built_in">addedge</span>(t,f);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">bool</span> visp[maxn],vis[maxn];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;P,d[maxn];</span><br><span class="line"><span class="keyword">int</span> n,raw[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	visp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; maxn;i++)<span class="keyword">if</span>(!visp[i])&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = i*<span class="number">2</span>;j &lt; maxn;j+=i)visp[j] = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; maxn;i++)<span class="keyword">if</span>(!visp[i])&#123;</span><br><span class="line">		P.<span class="built_in">push_back</span>(i);</span><br><span class="line">	&#125;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		cin &gt;&gt; raw[i];</span><br><span class="line">		<span class="keyword">int</span> cur = raw[i];</span><br><span class="line">		<span class="keyword">if</span>(!visp[cur])&#123;</span><br><span class="line">			d[i].<span class="built_in">push_back</span>(cur);</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">2</span>;j*j &lt;= raw[i];j++)&#123;</span><br><span class="line">			<span class="keyword">int</span> cnt2 = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span>(cur%j == <span class="number">0</span>)&#123;</span><br><span class="line">				cur /= j;cnt2++;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(cnt2%<span class="number">2</span>)d[i].<span class="built_in">push_back</span>(j);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(cur &gt; <span class="number">1</span>)d[i].<span class="built_in">push_back</span>(cur);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!d[i].<span class="built_in">size</span>())&#123;</span><br><span class="line">			cout &lt;&lt; <span class="number">1</span>;</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(d[i].<span class="built_in">size</span>() == <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="built_in">add</span>(<span class="number">1</span>,d[i][<span class="number">0</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">add</span>(d[i][<span class="number">0</span>],d[i][<span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(dis,<span class="number">-1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(dis));</span><br><span class="line">	dis[s] = <span class="number">0</span>;</span><br><span class="line">	queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; &gt;q;</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(s,<span class="number">0</span>));</span><br><span class="line">	<span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">		<span class="keyword">auto</span> now = q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">int</span> u = now.first,fa = now.second;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">			<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">			<span class="keyword">if</span>(v == fa)<span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span>(dis[v] == <span class="number">-1</span>)&#123;</span><br><span class="line">				dis[v] = dis[u]+<span class="number">1</span>;</span><br><span class="line">				q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(v,u));</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				ans = <span class="built_in">min</span>(ans,dis[v]+dis[u]+<span class="number">1</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(head));</span><br><span class="line">	<span class="built_in">init</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">1010</span>;i++)<span class="built_in">BFS</span>(i);</span><br><span class="line">	<span class="keyword">if</span>(ans == <span class="number">1e9</span>)ans = <span class="number">-1</span>;</span><br><span class="line">	cout &lt;&lt; ans;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><span class="math inline">\(2^{2n-1}+2^{2n-2}-2^n\)</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2020/05/13/Mobius-Transformation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/13/Mobius-Transformation/" class="post-title-link" itemprop="url">Mobius-Transformation</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-13 19:06:38" itemprop="dateCreated datePublished" datetime="2020-05-13T19:06:38+08:00">2020-05-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-03 14:39:47" itemprop="dateModified" datetime="2021-05-03T14:39:47+08:00">2021-05-03</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>这个菜鸡现在还什么都不会&gt;_&gt;慢慢更新吧</p>
<h1 id="前置知识">前置知识</h1>
<h2 id="整除分块">整除分块</h2>
<p>设<span class="math inline">\(f(x) = \lfloor \frac{k}{x} \rfloor\)</span></p>
<p><span class="math inline">\(f(x)\)</span>分布呈块状,对于任意一个<span class="math inline">\(i\)</span>,有最大的<span class="math inline">\(j = \lfloor \frac{k}{\lfloor \frac{k}{i} \rfloor} \rfloor\)</span>,使得<span class="math inline">\(f(i) == f(i+1) == ... = f(j)\)</span></p>
<p>对于类似<span class="math inline">\(\sum_{i = 1}^{n}\lfloor \frac{k}{i} \rfloor\)</span>的式子,可分块在<span class="math inline">\(O(\sqrt{n})\)</span>时间内计算完毕</p>
<p>代码:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> l = <span class="number">1</span>;l &lt;= n;l = r+<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(k/l)r = <span class="built_in">min</span>(n,k/(k/l));</span><br><span class="line">		<span class="keyword">else</span> r = n;</span><br><span class="line">		ans += (r-l+<span class="number">1</span>)*(k/l);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="狄利克雷dirichlet卷积">狄利克雷(Dirichlet)卷积</h2>
<h3 id="定义">定义</h3>
<p>设<span class="math inline">\(f,g\)</span>为两个数论函数,其狄利克雷卷积<span class="math inline">\(f*g\)</span>为: <span class="math display">\[
f \ast g(n) = \sum_{d|n}f(d)g(\frac{n}{d})
\]</span></p>
<h3 id="常用式子">常用式子</h3>
$$
<span class="math display">\[\begin{aligned}

\varepsilon=\mu \ast 1&amp;\iff\varepsilon(n)=\sum_{d\mid n}\mu(d)\\
d=1 \ast 1&amp;\iff d(n)=\sum_{d\mid n}1\\
\sigma=\text{id} \ast 1&amp;\iff\sigma(n)=\sum_{d\mid n}d\\
\varphi=\mu \ast \text{id}&amp;\iff\varphi(n)=\sum_{d\mid n}d\cdot\mu(\frac{n}{d}) \\


\end{aligned}\]</span>
<p>$$</p>
<h2 id="常用结论">常用结论</h2>
<p><span class="math display">\[
\sum_{d|n}^n\varphi(d) = n
\]</span></p>
<p><span class="math display">\[
[\gcd(i,j) == 1] = \epsilon(\gcd(i,j) = \sum_{d|\gcd(i,j)}\mu(d)
\]</span></p>
<h1 id="套路题">套路题</h1>
<h2 id="sum_i1ngcdin"><span class="math inline">\(\sum_{i=1}^ngcd(i,n)\)</span></h2>
<p><span class="math display">\[
\begin{align}
&amp;\sum_{i=1}^n\gcd(i,n)\\
&amp;=\sum_{d|n}d\sum_{i=1}^n[\gcd(i,n)==d]\\
&amp;=\sum_{d|n}d\sum_{i=1}^{\frac{n}{d}}[\gcd(i,n)==1]\\
&amp;=\sum_{d|n}d\cdotφ(\frac{n}{d})
\end{align}
\]</span></p>
<h2 id="sum_i-1nsum_j1ngcdij"><span class="math inline">\(\sum_{i = 1}^n\sum_{j=1}^n\gcd(i,j)\)</span></h2>
<p><span class="math display">\[
\begin{align}
&amp;\sum_{i = 1}^n\sum_{j=1}^n\gcd(i,j)\\
&amp;= \sum_{d=1}^nd\sum_{i=1}^n\sum_{j=1}^n[gcd(i,j) == d]\\
&amp;=\sum_{d=1}^nd\sum_{i=1}^{\frac{n}{d}}\sum_{j=1}^{\frac{n}{d}}[gcd(i,j)==1]\\
&amp;=\sum_{d=1}^nd(2\cdot\sum_{i=1}^{\frac{n}{d}}\varphi(i) - 1)
\end{align}
\]</span></p>
<p>关于最后一步,我们设<span class="math inline">\(f(x) = \sum_{i=1}^{n}\sum_{j=1}^{n}[gcd(i,j)==1]\)</span></p>
<p>手画一下,容易看出<span class="math inline">\(f(x) = 2\cdot\sum_{i=1}^n\varphi(i) - 1\)</span></p>
<p>另一种做法:</p>
<p>我们知道<span class="math inline">\(\varphi\)</span>有这么一个性质,<span class="math inline">\(\sum_{d|n}^{n}\varphi(d) = n\)</span></p>
<p>也就是<span class="math inline">\(\sum_{d|\gcd(i,j)}^{n}\varphi(d) = \gcd(i,j)\)</span></p>
<p>那么: <span class="math display">\[
\begin{align}
&amp;\sum_{i = 1}^n\sum_{j = 1}^n\gcd(i,j)\\
&amp;=\sum_{i=1}^n\sum_{j=1}^n\sum_{d|\gcd(i,j)}\varphi(d)\\
&amp;=\sum_{d = 1}^n\varphi(d)\sum_{i=1}^n[d|i]\sum_{j=1}^n[d|j]\\
&amp;=\sum_{d = 1}^n\varphi(d)\cdot\lfloor\frac{n}{d}\rfloor\lfloor\frac{m}{d}\rfloor
\end{align}
\]</span> 少处理个前缀和=-=而且我感觉这个做法更好理解</p>
<p>例题:洛谷P2398</p>
<h2 id="sum_i-1nsum_ji1ngcdij"><span class="math inline">\(\sum_{i = 1}^{n}\sum_{j=i+1}^{n}\gcd(i,j)\)</span></h2>
<p>和上面那个基本一样 <span class="math display">\[
\begin{align}
&amp;\sum_{i = 1}^n\sum_{j=i+1}^n\gcd(i,j)\\
&amp;= \sum_{d=1}^nd\sum_{i=1}^n\sum_{j=i+1}^n[gcd(i,j) == d]\\
&amp;=\sum_{d=1}^nd\sum_{i=1}^{\frac{n}{d}}\sum_{j=i+1}^{\frac{n}{d}}[gcd(i,j)==1]\\
&amp;=\sum_{d=1}^nd(\sum_{i=1}^{\frac{n}{d}}\varphi(i) - 1)
\end{align}
\]</span> (最后一步的化简和上一题大同小异,手画一下就有了)</p>
<h2 id="sum_i1nsum_i1mgcdij-1"><span class="math inline">\(\sum_{i=1}^{n}\sum_{i=1}^{m}[\gcd(i,j) == 1]\)</span></h2>
<p>前置知识: <span class="math display">\[
\epsilon(n)=\sum_{d|n}\mu(d)= \begin{cases} 1&amp;n=1\\ 
0&amp;otherwise 
\end{cases}
\]</span></p>
<p>开始愉快地推式子: <span class="math display">\[
\begin{align}
&amp;\sum_{i=1}^{n}\sum_{i=1}^{m}[\gcd(i,j) == 1] \\
&amp;=\sum_{i=1}^{n}\sum_{i=1}^{m}\epsilon(\gcd(i,j))\\
&amp;=\sum_{i=1}^{n}\sum_{i=1}^{m}\sum_{d|gcd(i,j)}\mu(d)\\
&amp;=\sum_{d = 1}^{\min(n,m)}\mu(d)\sum_{i = 1}^n[d|i]\sum_{j = 1}^{m}[d|j]\\
&amp;=\sum_{d=1}^{\min(n,m)}\mu(d)\lfloor \frac{n}{d}\rfloor \lfloor \frac{m}{d} \rfloor
\end{align}
\]</span> 同理,我们有: <span class="math display">\[
\sum_{i = 1}^n\sum_{j = 1}^n\sum_{k = 1}^n [\gcd(i,j,k) == 1] = \sum_{d = 1}^n \mu(d)(\lfloor \frac{n}{d}\rfloor)^3
\]</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2020/05/13/solution-CF906D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/13/solution-CF906D/" class="post-title-link" itemprop="url">[题解] CF906D-Power Tower</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-13 09:55:17" itemprop="dateCreated datePublished" datetime="2020-05-13T09:55:17+08:00">2020-05-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-03-09 21:27:34" itemprop="dateModified" datetime="2021-03-09T21:27:34+08:00">2021-03-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="题意">题意</h1>
<p>给定序列<span class="math inline">\(w_1,w_2,...,w_n\)</span>和<span class="math inline">\(q\)</span>组询问,对于每组询问,求<img src="../images/CF906D_1.png" alt="img1" /></p>
<p>当然,需要对这个值膜<span class="math inline">\(m\)</span></p>
<p>(hexo渲染多重幂有问题,只好放原题图片了)</p>
<p><span class="math inline">\(1 \leq n \leq 1e5\)</span>, <span class="math inline">\(1 \leq m \leq 1e9\)</span>, <span class="math inline">\(1 \leq q \leq 1e5\)</span></p>
<h1 id="思路">思路</h1>
<p>考虑扩展欧拉定理:</p>
<p><span class="math display">\[
a^b = \left\{
\begin{array}{lcl}
a^b &amp;&amp; {b &lt; φ(p)} \\
a^{b \bmod φ(p) + φ(p) } &amp;&amp; {b \geq φ(p)}\\
\end{array}
\right.
\]</span></p>
<p>由于<span class="math inline">\(p \geq 2\)</span>时<span class="math inline">\(φ(p)\)</span>为偶数,故<span class="math inline">\(p = φ(p)\)</span>的下降速度是log级别的,换句话说经过最多<span class="math inline">\(log(p)\)</span>次迭代之后<span class="math inline">\(p\)</span>便会变为1.由于<span class="math inline">\(x \bmod 1 == 0\)</span>,我们在<span class="math inline">\(l == r\)</span>或者<span class="math inline">\(p == 1\)</span>时便可跳出递归,单组询问的复杂度为<span class="math inline">\(O(logp)\)</span>,可以接受</p>
<p>在具体实现时,应预处理出<span class="math inline">\(p,φ(p),φ(φ(p)),...,1\)</span>来减少时间开销,同时修改快速幂来适应扩欧定理(upd函数),细节见代码</p>
<h1 id="代码">代码</h1>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CF906D </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line">ll raw[maxn],n,mod;</span><br><span class="line">map&lt;ll,ll&gt;vis;</span><br><span class="line"><span class="function">ll <span class="title">phi</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> m = (ll)<span class="built_in">sqrt</span>(x+<span class="number">0.5</span>);</span><br><span class="line">	ll tans = x;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= m;i++)<span class="keyword">if</span>(!(x%i))&#123;</span><br><span class="line">		tans = tans/i*(i<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">while</span>(!(x%i))x /= i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(x &gt; <span class="number">1</span>)tans = tans / x * (x<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">upd</span><span class="params">(ll x,ll p)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x&lt;p?x:x%p+p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Pow</span><span class="params">(ll x,ll d,ll p)</span></span>&#123;</span><br><span class="line">	ll tans = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(d == <span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	ll a = <span class="built_in">Pow</span>(x,d/<span class="number">2</span>,p);</span><br><span class="line">	tans = <span class="built_in">upd</span>(a*a,p);</span><br><span class="line">	<span class="keyword">if</span>(d%<span class="number">2</span>)tans = <span class="built_in">upd</span>(tans*x,p); </span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">upd</span>(tans,p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">cal</span><span class="params">(ll l,ll r,ll p)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l == r <span class="keyword">or</span> p == <span class="number">1</span>)<span class="keyword">return</span> <span class="built_in">upd</span>(raw[l],p);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">Pow</span>(raw[l],<span class="built_in">cal</span>(l+<span class="number">1</span>,r,vis[p]),p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; mod;</span><br><span class="line">	ll qwq = mod;</span><br><span class="line">	<span class="keyword">while</span>(qwq != <span class="number">1</span>)&#123;</span><br><span class="line">		vis[qwq] = <span class="built_in">phi</span>(qwq);</span><br><span class="line">		qwq = vis[qwq];</span><br><span class="line">	&#125;</span><br><span class="line">	vis[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)cin &gt;&gt; raw[i];</span><br><span class="line">	<span class="keyword">int</span> q;</span><br><span class="line">	cin &gt;&gt; q;</span><br><span class="line">	<span class="keyword">while</span>(q--)&#123;</span><br><span class="line">		<span class="keyword">int</span> l,r;</span><br><span class="line">		cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">		cout &lt;&lt; <span class="built_in">cal</span>(l,r,mod)%mod &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
f(n) = O(g(n)) 
\\ \Rightarrow f(n) \leq c_f \cdot g(n) \\ 
\Rightarrow \frac{1}{f(n)} \geq \frac{1}{c_f\cdot g(n)}\\
\Rightarrow \frac{1}{g(n)} \leq c_f\cdot \frac{1}{f(n)} 对于n &gt;= n_f\\
故有 \frac{1}{g(n)} = O(\frac{1}{f(n)})
\]</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2020/05/13/solution-CF1350C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/13/solution-CF1350C/" class="post-title-link" itemprop="url">[题解]CF1350C-Orac and LCM</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2020-05-13 08:54:47 / Modified: 09:50:07" itemprop="dateCreated datePublished" datetime="2020-05-13T08:54:47+08:00">2020-05-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="题目大意">题目大意</h1>
<p>​ 给定集合<span class="math inline">\(\{a_1,a_2,...,a_n\}\)</span>,求<span class="math inline">\(gcd(\{lcm(\{a_i,a_j\})|i&lt;j\})\)</span></p>
<p>​ $2 n 1e5 $ , <span class="math inline">\(1 \leq a_i \leq 2e5\)</span></p>
<h1 id="思路">思路</h1>
<p>​ 考虑唯一分解定理:</p>
<p>​ <span class="math inline">\(a = \prod^{n}_{1}p_i^{k_i}\)</span></p>
<p>​ <span class="math inline">\(b = \prod^{n}_{1}p_i^{g_i}\)</span></p>
<p>​ 对于 <span class="math inline">\(gcd\)</span> 和 <span class="math inline">\(lcm\)</span> ,我们有:</p>
<p>​ <span class="math inline">\(gcd(a,b) = \prod^{n}_{1}p_i^{min(k_i,g_i)}\)</span></p>
<p>​ <span class="math inline">\(lcm(a,b) = \prod^{n}_{1}p_i^{max(k_i,g_i)}\)</span></p>
<p>​ 观察易得,对于答案中的每个质因子<span class="math inline">\(p_i\)</span>,它的指数<span class="math inline">\(k_i\)</span>为<span class="math inline">\(\{a_1,...,a_n\}\)</span>中 <span class="math inline">\(p_i\)</span> <strong>第二小</strong> 的指数<span class="math inline">\(k\)</span></p>
<p>​ 我们预处理出<span class="math inline">\(i\)</span>的所有质因数<span class="math inline">\(p[i]\)</span>,将<span class="math inline">\(a_i\)</span>分解,用<span class="math inline">\(d[i][j]\)</span>表示<span class="math inline">\(a_j\)</span>的质因子<span class="math inline">\(i\)</span>的指数,排序后扫一遍<span class="math inline">\(d[i]\)</span>即可得到答案</p>
<p>​ 具体来说 <span class="math display">\[
ans *= \left\{
\begin{array}{lcl}
i^{d[i][0]}&amp;&amp; {d[i].size() == n-1} \\
i^{d[i][1]} &amp;&amp; {d[i].size()  \geq n-1 }\\
1 &amp;&amp; otherwise
\end{array}
\right.
\]</span></p>
<h1 id="代码">代码</h1>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//C</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> raw[maxn];</span><br><span class="line"><span class="keyword">int</span> vis[maxn];</span><br><span class="line"><span class="function">ll <span class="title">Pow</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">	ll tans = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(d == <span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	ll a = <span class="built_in">Pow</span>(x,d/<span class="number">2</span>);</span><br><span class="line">	tans = a*a;</span><br><span class="line">	<span class="keyword">if</span>(d%<span class="number">2</span>)tans = tans*x; </span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">bool</span> n_prime[maxn];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;p[maxn],d[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">prime</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;maxn;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!n_prime[i])&#123;</span><br><span class="line">			p[i].<span class="built_in">push_back</span>(i); </span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = i*<span class="number">2</span>;j &lt; maxn;j += i)&#123;</span><br><span class="line">				n_prime[j] = <span class="number">1</span>;</span><br><span class="line">				p[j].<span class="built_in">push_back</span>(i);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	n_prime[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">prime</span>();</span><br><span class="line">	<span class="keyword">int</span> n;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)cin &gt;&gt; raw[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> u = raw[i];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x:p[u])&#123;</span><br><span class="line">			<span class="keyword">int</span> yay = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span>(u%x == <span class="number">0</span>)&#123;</span><br><span class="line">				yay++;</span><br><span class="line">				u /= x;</span><br><span class="line">			&#125;</span><br><span class="line">			d[x].<span class="built_in">push_back</span>(yay);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	ll ans = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; maxn;i++)&#123;</span><br><span class="line">		<span class="built_in">sort</span>(d[i].<span class="built_in">begin</span>(),d[i].<span class="built_in">end</span>());</span><br><span class="line">		<span class="keyword">if</span>(d[i].<span class="built_in">size</span>() == n<span class="number">-1</span>)&#123;</span><br><span class="line">			ans *= <span class="built_in">Pow</span>(i,d[i][<span class="number">0</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(d[i].<span class="built_in">size</span>() &gt; n<span class="number">-1</span>)ans *= <span class="built_in">Pow</span>(i,d[i][<span class="number">1</span>]); </span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; ans;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2020/05/11/math-misc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/11/math-misc/" class="post-title-link" itemprop="url">math-misc</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-11 20:07:57" itemprop="dateCreated datePublished" datetime="2020-05-11T20:07:57+08:00">2020-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-05-12 10:14:07" itemprop="dateModified" datetime="2020-05-12T10:14:07+08:00">2020-05-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">数学</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>本篇仅记录一些杂乱的知识点留作日后整理,更多是作Markdown和<span class="math inline">\(L_{A}T^{E}X\)</span>的练习用</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2020/05/09/template-geometry/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/09/template-geometry/" class="post-title-link" itemprop="url">[模板]计算几何</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-09 15:27:10" itemprop="dateCreated datePublished" datetime="2020-05-09T15:27:10+08:00">2020-05-09</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-11-19 21:59:02" itemprop="dateModified" datetime="2021-11-19T21:59:02+08:00">2021-11-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A8%A1%E6%9D%BF/" itemprop="url" rel="index"><span itemprop="name">模板</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>[TOC]</p>
<h1 id="二维">二维</h1>
<h2 id="起手式待补充">起手式(待补充):</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">double</span> ld;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI = <span class="number">3.14159265358979</span>; </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span>&#123;</span></span><br><span class="line">	ld x,y;</span><br><span class="line">	<span class="built_in">Point</span>(ld x = <span class="number">0</span>,ld y = <span class="number">0</span>):<span class="built_in">x</span>(x),<span class="built_in">y</span>(y)&#123;&#125;</span><br><span class="line">	Point <span class="keyword">operator</span> + (Point B)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(x+B.x,y+B.y);&#125;</span><br><span class="line">	Point <span class="keyword">operator</span> - (Point B)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(x-B.x,y-B.y);&#125;</span><br><span class="line">	Point <span class="keyword">operator</span> * (ld w)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(x*w,y*w);&#125;</span><br><span class="line">	Point <span class="keyword">operator</span> / (ld w)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(x/w,y/w);&#125;</span><br><span class="line">	<span class="function">Point <span class="title">Rotate_90_clock</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(y,-x);&#125;<span class="comment">//顺时针旋转90°</span></span><br><span class="line">	<span class="function">ld <span class="title">len2</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> x*x + y*y;&#125;<span class="comment">//长度的平方</span></span><br><span class="line">	<span class="function">ld <span class="title">len</span><span class="params">()</span></span>&#123;<span class="keyword">return</span>(<span class="built_in">sqrt</span>(x*x + y*y));&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Point &amp; A) <span class="keyword">const</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x == A.x?y &lt; A.y:x &lt; A.x);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;point[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Circle</span>&#123;</span></span><br><span class="line">	Point O;</span><br><span class="line">	ld R;</span><br><span class="line">	<span class="built_in">Circle</span>(Point O = <span class="built_in">Point</span>(<span class="number">0</span>,<span class="number">0</span>),ld R = <span class="number">0</span>):<span class="built_in">O</span>(O),<span class="built_in">R</span>(R)&#123;&#125;</span><br><span class="line">	<span class="function">ld <span class="title">R2</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> R*R;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> Point Vector;</span><br><span class="line"><span class="function">ld <span class="title">Dot</span><span class="params">(Vector A,Vector B)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> A.x*B.x + A.y*B.y;</span><br><span class="line">&#125;<span class="comment">//点积</span></span><br><span class="line"><span class="function">ld <span class="title">Cross</span><span class="params">(Vector A,Vector B)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> A.x*B.y - A.y*B.x;</span><br><span class="line">&#125;<span class="comment">//二维叉积</span></span><br><span class="line"><span class="function">Point <span class="title">Line_inter</span><span class="params">(Point P0,Point V0,Point P1,Point V1)</span></span>&#123;</span><br><span class="line">	ld t = <span class="built_in">Cross</span>(P1 - P0,V1)/<span class="built_in">Cross</span>(V0,V1);</span><br><span class="line">	<span class="keyword">return</span> P0 + V0 * t;</span><br><span class="line">&#125;<span class="comment">//返回两向量交点.P和V分别为向量起点终点*</span></span><br><span class="line"><span class="function">Circle <span class="title">p2circle</span><span class="params">(Point A,Point B)</span></span>&#123;</span><br><span class="line">	Circle tans = <span class="built_in">Circle</span>((A+B)/<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">	tans.R = (tans.O - A).<span class="built_in">len</span>();</span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;<span class="comment">//两点的外接圆</span></span><br><span class="line"><span class="function">Circle <span class="title">p2circle</span><span class="params">(Point A,Point B,Point C)</span></span>&#123;</span><br><span class="line">	Circle tans = <span class="built_in">Circle</span>(<span class="built_in">Line_inter</span>((A+B)/<span class="number">2</span>,(B - A).<span class="built_in">Rotate_90_clock</span>(),(A+C)/<span class="number">2</span>,(C - A).<span class="built_in">Rotate_90_clock</span>()),<span class="number">0</span>);</span><br><span class="line">	tans.R = (tans.O - A).<span class="built_in">len</span>();</span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;<span class="comment">//三点共圆</span></span><br><span class="line"><span class="keyword">typedef</span> Point Vector;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">to_rad</span><span class="params">(<span class="keyword">double</span> deg)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> deg*(PI/<span class="number">180</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Vector <span class="title">Rotate</span><span class="params">(Vector A,<span class="keyword">double</span> rad)</span></span>&#123;<span class="comment">//逆时针 </span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Vector</span>(A.x*<span class="built_in">cos</span>(rad) - A.y*<span class="built_in">sin</span>(rad),A.x*<span class="built_in">sin</span>(rad) + A.y*<span class="built_in">cos</span>(rad));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="按角度旋转点">按角度旋转点</h2>
<p>设点<span class="math inline">\(A(x,y)\)</span>绕点<span class="math inline">\(R(x_{r},y_{r})\)</span>逆时针旋转<span class="math inline">\(\theta\)</span>弧度后得到点<span class="math inline">\(A’(x&#39;,y&#39;)\)</span>, 则有: <span class="math display">\[
x&#39; = (x - x_r)\cdot\cos(\theta) - (y - y_r)\cdot\sin(\theta) + x_r\\
y&#39; = (x - x_r)\cdot\sin(\theta) + (y - y_r)\cdot\cos(\theta) + y_r
\]</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(ld &amp; x,ld &amp; y,ld theta,ld rx,ld ry)</span></span>&#123;</span><br><span class="line">    ld nx = (x - rx)*<span class="built_in">cos</span>(theta) - (y - ry)*<span class="built_in">sin</span>(theta) + rx;</span><br><span class="line">    ld ny = (x - rx)*<span class="built_in">sin</span>(theta) + (y - ry)*<span class="built_in">cos</span>(theta) + ry;</span><br><span class="line">    x = nx,y = ny;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="凸包">凸包</h2>
<p>输入顶点, 返回凸包. raw为原顶点数组,hull为凸包顶点数组</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;Point&gt; <span class="title">ConvexHull</span><span class="params">(vector&lt;Point&gt;raw)</span></span>&#123;</span><br><span class="line">	<span class="built_in">sort</span>(raw.<span class="built_in">begin</span>(),raw.<span class="built_in">end</span>());</span><br><span class="line">	<span class="keyword">int</span> n = raw.<span class="built_in">size</span>(),idx = <span class="number">0</span>;</span><br><span class="line">	vector&lt;Point&gt;<span class="built_in">hull</span>(<span class="number">2</span>*n+<span class="number">10</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">while</span>(idx &gt; <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">Cross</span>(hull[idx<span class="number">-1</span>] - hull[idx<span class="number">-2</span>],raw[i] - hull[idx<span class="number">-2</span>]) &lt;= <span class="number">0</span>)idx--;</span><br><span class="line">		hull[idx++] = raw[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> k = idx;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = n<span class="number">-2</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line">		<span class="keyword">while</span>(idx &gt; k <span class="keyword">and</span> <span class="built_in">Cross</span>(hull[idx<span class="number">-1</span>] - hull[idx<span class="number">-2</span>],raw[i] - hull[idx<span class="number">-2</span>]) &lt;= <span class="number">0</span>)idx--;</span><br><span class="line">		hull[idx++] = raw[i];</span><br><span class="line">	&#125;</span><br><span class="line">	hull.<span class="built_in">resize</span>(idx<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">return</span> hull;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="闵可夫斯基和">闵可夫斯基和</h2>
<p>点集<span class="math inline">\(A,B\)</span>的闵可夫斯基和为<span class="math inline">\(C = \{a+b|a\in A,b \in B\}\)</span></p>
<p><img src="https://images.cnblogs.com/cnblogs_com/xzyxzy/1374475/o_%E9%97%B5%E5%8F%AF%E5%A4%AB%E6%96%AF%E5%9F%BA%E5%92%8C1.png" alt="img" style="zoom:33%;" /></p>
<p>复杂度<span class="math inline">\(O(n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;Point&gt; <span class="title">minkowski</span><span class="params">(vector&lt;Point&gt; &amp; C1,vector&lt;Point&gt; &amp; C2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = (<span class="keyword">int</span>)C1.<span class="built_in">size</span>(),m = (<span class="keyword">int</span>)C2.<span class="built_in">size</span>();</span><br><span class="line">	vector&lt;Point&gt;<span class="built_in">s1</span>(n),<span class="built_in">s2</span>(m),<span class="built_in">A</span>(n+m+<span class="number">10</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n<span class="number">-1</span>;i++)s1[i] = C1[i+<span class="number">1</span>] - C1[i];</span><br><span class="line">	s1[n<span class="number">-1</span>] = C1[<span class="number">0</span>] - C1[n<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; m<span class="number">-1</span>;i++)s2[i] = C2[i+<span class="number">1</span>] - C2[i];</span><br><span class="line">	s2[m<span class="number">-1</span>] = C2[<span class="number">0</span>] - C2[m<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">int</span> tot = <span class="number">0</span>;</span><br><span class="line">	A[tot] = C1[<span class="number">0</span>] + C2[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">int</span> p1 = <span class="number">0</span>,p2 = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(p1 &lt; n <span class="keyword">and</span> p2 &lt; m)&#123;</span><br><span class="line">		tot++;</span><br><span class="line">		A[tot] = A[tot<span class="number">-1</span>] + (<span class="built_in">Cross</span>(s1[p1],s2[p2]) &gt;= eps?s1[p1++]:s2[p2++]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(p1 &lt; n)&#123;</span><br><span class="line">		++tot;</span><br><span class="line">		A[tot] = A[tot<span class="number">-1</span>] + s1[p1++];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(p2 &lt;= m)&#123;</span><br><span class="line">		++tot;</span><br><span class="line">		A[tot] = A[tot<span class="number">-1</span>] + s2[p2++];</span><br><span class="line">	&#125;</span><br><span class="line">	A.<span class="built_in">resize</span>(tot+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="多边形面积">多边形面积</h2>
<p>_Point为多边形点集,n为顶点数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">PolyArea</span><span class="params">(Point * _Point,<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">double</span> area = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; n;i++)&#123;</span><br><span class="line">		area += <span class="built_in">Cross</span>(_Point[i] - _Point[<span class="number">1</span>],_Point[i+<span class="number">1</span>] - _Point[<span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> area/<span class="number">2</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最小圆覆盖">最小圆覆盖</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">double</span> ld;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span>&#123;</span></span><br><span class="line">	ld x,y;</span><br><span class="line">	<span class="built_in">Point</span>(ld x = <span class="number">0</span>,ld y = <span class="number">0</span>):<span class="built_in">x</span>(x),<span class="built_in">y</span>(y)&#123;&#125;</span><br><span class="line">	Point <span class="keyword">operator</span> + (Point B)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(x+B.x,y+B.y);&#125;</span><br><span class="line">	Point <span class="keyword">operator</span> - (Point B)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(x-B.x,y-B.y);&#125;</span><br><span class="line">	Point <span class="keyword">operator</span> * (ld w)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(x*w,y*w);&#125;</span><br><span class="line">	Point <span class="keyword">operator</span> / (ld w)&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(x/w,y/w);&#125;</span><br><span class="line">	<span class="function">Point <span class="title">Rotate_90_clock</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="built_in">Point</span>(y,-x);&#125;<span class="comment">//顺时针旋转90°</span></span><br><span class="line">	<span class="function">ld <span class="title">len2</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> x*x + y*y;&#125;<span class="comment">//长度的平方</span></span><br><span class="line">	<span class="function">ld <span class="title">len</span><span class="params">()</span></span>&#123;<span class="keyword">return</span>(<span class="built_in">sqrt</span>(x*x + y*y));&#125;</span><br><span class="line">&#125;point[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Circle</span>&#123;</span></span><br><span class="line">	Point O;</span><br><span class="line">	ld R;</span><br><span class="line">	<span class="built_in">Circle</span>(Point O = <span class="built_in">Point</span>(<span class="number">0</span>,<span class="number">0</span>),ld R = <span class="number">0</span>):<span class="built_in">O</span>(O),<span class="built_in">R</span>(R)&#123;&#125;</span><br><span class="line">	<span class="function">ld <span class="title">R2</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> R*R;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> Point Vector;</span><br><span class="line"><span class="function">ld <span class="title">Dot</span><span class="params">(Vector A,Vector B)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> A.x*B.x + A.y*B.y;</span><br><span class="line">&#125;<span class="comment">//点积</span></span><br><span class="line"><span class="function">ld <span class="title">Cross</span><span class="params">(Vector A,Vector B)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> A.x*B.y - A.y*B.x;</span><br><span class="line">&#125;<span class="comment">//二维叉积</span></span><br><span class="line"><span class="function">Point <span class="title">Line_inter</span><span class="params">(Point P0,Point V0,Point P1,Point V1)</span></span>&#123;</span><br><span class="line">	ld t = <span class="built_in">Cross</span>(P1 - P0,V1)/<span class="built_in">Cross</span>(V0,V1);</span><br><span class="line">	<span class="keyword">return</span> P0 + V0 * t;</span><br><span class="line">&#125;<span class="comment">//返回两向量交点.P和V分别为向量起点终点*</span></span><br><span class="line"><span class="function">Circle <span class="title">p2circle</span><span class="params">(Point A,Point B)</span></span>&#123;</span><br><span class="line">	Circle tans = <span class="built_in">Circle</span>((A+B)/<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">	tans.R = (tans.O - A).<span class="built_in">len</span>();</span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;<span class="comment">//两点的外接圆</span></span><br><span class="line"><span class="function">Circle <span class="title">p2circle</span><span class="params">(Point A,Point B,Point C)</span></span>&#123;</span><br><span class="line">	Circle tans = <span class="built_in">Circle</span>(<span class="built_in">Line_inter</span>((A+B)/<span class="number">2</span>,(B - A).<span class="built_in">Rotate_90_clock</span>(),(A+C)/<span class="number">2</span>,(C - A).<span class="built_in">Rotate_90_clock</span>()),<span class="number">0</span>);</span><br><span class="line">	tans.R = (tans.O - A).<span class="built_in">len</span>();</span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;<span class="comment">//三点共圆</span></span><br><span class="line"><span class="function">Circle <span class="title">Min_Cir_Cover</span><span class="params">(Point * point,<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="built_in">random_shuffle</span>(point+<span class="number">1</span>,point+n+<span class="number">1</span>);</span><br><span class="line">	Circle res;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>((point[i] - res.O).<span class="built_in">len2</span>() &gt; res.<span class="built_in">R2</span>())&#123;</span><br><span class="line">			res = <span class="built_in">Circle</span>(point[i],<span class="number">0</span>);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt; i;j++)&#123;</span><br><span class="line">				<span class="keyword">if</span>((point[j] - res.O).<span class="built_in">len2</span>() &gt; res.<span class="built_in">R2</span>())&#123;</span><br><span class="line">					res = <span class="built_in">p2circle</span>(point[i],point[j]);</span><br><span class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">1</span>;k &lt; j;k++)&#123;</span><br><span class="line">						<span class="keyword">if</span>((point[k] - res.O).<span class="built_in">len2</span>() &gt; res.<span class="built_in">R2</span>())&#123;</span><br><span class="line">							res = <span class="built_in">p2circle</span>(point[i],point[j],point[k]);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;<span class="comment">//最小圆覆盖,输入点集数组和点的数量,返回一个圆</span></span><br></pre></td></tr></table></figure>
<h2 id="判断点在凸包内部及边界">判断点在凸包内部及边界</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Left</span><span class="params">(Point P,Point A,Point B)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Cross</span>(B - A,P - A) &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Right</span><span class="params">(Point P,Point A,Point B)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Cross</span>(P - A,B - A) &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Point_in_Convex</span><span class="params">(Point P,vector&lt;Point&gt; &amp; C)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = C.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">Left</span>(P,C[<span class="number">0</span>],C[n - <span class="number">1</span>]) <span class="keyword">or</span> <span class="built_in">Right</span>(P,C[<span class="number">0</span>],C[<span class="number">1</span>]))<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> l = <span class="number">1</span>, r = n - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (l &lt; r - <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">int</span> m = (l + r) / <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">Left</span>(P, C[<span class="number">0</span>], C[m])) &#123;</span><br><span class="line">			l = m;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			r = m;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">Right</span>(P, C[l], C[r]))<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="三维">三维</h1>
<h2 id="起手式">起手式:</h2>
<p>鸽子biss</p>
<h2 id="最小球覆盖">最小球覆盖</h2>
<p>来自上交红书《ACM国际大学生程序设计竞赛-算法与实现》</p>
<p><strong>下标从0开始</strong></p>
<p>复杂度: <span class="math inline">\(O(n)\)</span></p>
<p>输入:</p>
<p>​ <code>npoint</code> 全局变量, 点的个数</p>
<p>​ <code>pt</code> 全局变量, 点的坐标</p>
<p>调用 <code>smallest_ball()</code></p>
<p>输出:</p>
<p>​ <code>res</code> 全局变量, 球心坐标</p>
<p>​ <code>radius</code> 全局变量, 球的半径</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">double</span> eps = <span class="number">1e-9</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tpoint</span>&#123;</span></span><br><span class="line">	<span class="keyword">double</span> x,y,z;</span><br><span class="line">	<span class="built_in">Tpoint</span>(<span class="keyword">double</span> x = <span class="number">0</span>,<span class="keyword">double</span> y = <span class="number">0</span>,<span class="keyword">double</span> z = <span class="number">0</span>):<span class="built_in">x</span>(x),<span class="built_in">y</span>(y),<span class="built_in">z</span>(z)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> npoint,nouter;</span><br><span class="line">Tpoint pt[maxn],outer[<span class="number">4</span>],res;</span><br><span class="line"><span class="keyword">double</span> radius,tmp;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">dist</span><span class="params">(Tpoint p1,Tpoint p2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">double</span> dx = p1.x - p2.x,dy = p1.y - p2.y,dz = p1.z - p2.z;</span><br><span class="line">	<span class="keyword">return</span> (dx*dx + dy*dy + dz*dz);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">dot</span><span class="params">(Tpoint p1,Tpoint p2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> p1.x*p2.x + p1.y*p2.y + p1.z*p2.z;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ball</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Tpoint q[<span class="number">3</span>];<span class="keyword">double</span> m[<span class="number">3</span>][<span class="number">3</span>], sol[<span class="number">3</span>],L[<span class="number">3</span>],det;</span><br><span class="line">	res.x = res.y = res.z = radius = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in"><span class="keyword">switch</span></span>(nouter)&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>: res = outer[<span class="number">0</span>];<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			res.x = (outer[<span class="number">0</span>].x+outer[<span class="number">1</span>].x)/<span class="number">2</span>;</span><br><span class="line">			res.y = (outer[<span class="number">0</span>].y+outer[<span class="number">1</span>].y)/<span class="number">2</span>;</span><br><span class="line">			res.z = (outer[<span class="number">0</span>].z+outer[<span class="number">1</span>].z)/<span class="number">2</span>;</span><br><span class="line">			radius = <span class="built_in">dist</span>(res,outer[<span class="number">0</span>]);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">2</span>;i++)&#123;</span><br><span class="line">				q[i].x = outer[i+<span class="number">1</span>].x - outer[<span class="number">0</span>].x;</span><br><span class="line">				q[i].y = outer[i+<span class="number">1</span>].y - outer[<span class="number">0</span>].y;</span><br><span class="line">				q[i].z = outer[i+<span class="number">1</span>].z - outer[<span class="number">0</span>].z;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">2</span>;i++)</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; <span class="number">2</span>;j++)m[i][j] = <span class="built_in">dot</span>(q[i],q[j])*<span class="number">2</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">2</span>;i++)sol[i] = <span class="built_in">dot</span>(q[i],q[i]);</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">fabs</span>(det = m[<span class="number">0</span>][<span class="number">0</span>]*m[<span class="number">1</span>][<span class="number">1</span>] - m[<span class="number">0</span>][<span class="number">1</span>]*m[<span class="number">1</span>][<span class="number">0</span>])&lt;eps)<span class="keyword">return</span>;</span><br><span class="line">			L[<span class="number">0</span>] = (sol[<span class="number">0</span>]*m[<span class="number">1</span>][<span class="number">1</span>] - sol[<span class="number">1</span>]*m[<span class="number">0</span>][<span class="number">1</span>])/det;</span><br><span class="line">			L[<span class="number">1</span>] = (sol[<span class="number">1</span>]*m[<span class="number">0</span>][<span class="number">0</span>] - sol[<span class="number">0</span>]*m[<span class="number">1</span>][<span class="number">0</span>])/det;</span><br><span class="line">			res.x = outer[<span class="number">0</span>].x + q[<span class="number">0</span>].x*L[<span class="number">0</span>] + q[<span class="number">1</span>].x*L[<span class="number">1</span>];</span><br><span class="line">			res.y = outer[<span class="number">0</span>].y + q[<span class="number">0</span>].y*L[<span class="number">0</span>] + q[<span class="number">1</span>].y*L[<span class="number">1</span>];</span><br><span class="line">			res.z = outer[<span class="number">0</span>].z + q[<span class="number">0</span>].z*L[<span class="number">0</span>] + q[<span class="number">1</span>].z*L[<span class="number">1</span>];</span><br><span class="line">			radius = <span class="built_in">dist</span>(res,outer[<span class="number">0</span>]);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">3</span>;i++)&#123;</span><br><span class="line">				q[i].x = outer[i+<span class="number">1</span>].x - outer[<span class="number">0</span>].x;</span><br><span class="line">				q[i].y = outer[i+<span class="number">1</span>].y - outer[<span class="number">0</span>].y;</span><br><span class="line">				q[i].z = outer[i+<span class="number">1</span>].z - outer[<span class="number">0</span>].z;</span><br><span class="line">				sol[i] = <span class="built_in">dot</span>(q[i],q[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">3</span>;i++)</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; <span class="number">3</span>;j++)m[i][j] = <span class="built_in">dot</span>(q[i],q[j])*<span class="number">2</span>;</span><br><span class="line">			det = m[<span class="number">0</span>][<span class="number">0</span>] * m[<span class="number">1</span>][<span class="number">1</span>] * m[<span class="number">2</span>][<span class="number">2</span>]</span><br><span class="line">				+ m[<span class="number">0</span>][<span class="number">1</span>] * m[<span class="number">1</span>][<span class="number">2</span>] * m[<span class="number">2</span>][<span class="number">0</span>]</span><br><span class="line">				+ m[<span class="number">0</span>][<span class="number">2</span>] * m[<span class="number">2</span>][<span class="number">1</span>] * m[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">				- m[<span class="number">0</span>][<span class="number">2</span>] * m[<span class="number">1</span>][<span class="number">1</span>] * m[<span class="number">2</span>][<span class="number">0</span>]</span><br><span class="line">				- m[<span class="number">0</span>][<span class="number">1</span>] * m[<span class="number">1</span>][<span class="number">0</span>] * m[<span class="number">2</span>][<span class="number">2</span>]</span><br><span class="line">				- m[<span class="number">0</span>][<span class="number">0</span>] * m[<span class="number">1</span>][<span class="number">2</span>] * m[<span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">fabs</span>(det) &lt; eps)<span class="keyword">return</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; <span class="number">3</span>;j++)&#123;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">3</span>;i++)m[i][j] = sol[i];</span><br><span class="line">				L[j] = (m[<span class="number">0</span>][<span class="number">0</span>] * m[<span class="number">1</span>][<span class="number">1</span>] * m[<span class="number">2</span>][<span class="number">2</span>]</span><br><span class="line">					+ m[<span class="number">0</span>][<span class="number">1</span>] * m[<span class="number">1</span>][<span class="number">2</span>] * m[<span class="number">2</span>][<span class="number">0</span>]</span><br><span class="line">					+ m[<span class="number">0</span>][<span class="number">2</span>] * m[<span class="number">2</span>][<span class="number">1</span>] * m[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">					- m[<span class="number">0</span>][<span class="number">2</span>] * m[<span class="number">1</span>][<span class="number">1</span>] * m[<span class="number">2</span>][<span class="number">0</span>]</span><br><span class="line">					- m[<span class="number">0</span>][<span class="number">1</span>] * m[<span class="number">1</span>][<span class="number">0</span>] * m[<span class="number">2</span>][<span class="number">2</span>]</span><br><span class="line">					- m[<span class="number">0</span>][<span class="number">0</span>] * m[<span class="number">1</span>][<span class="number">2</span>] * m[<span class="number">2</span>][<span class="number">1</span>]</span><br><span class="line">					)/det;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">3</span>;i++)m[i][j] = <span class="built_in">dot</span>(q[i],q[j])*<span class="number">2</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			res = outer[<span class="number">0</span>];</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">3</span>;i++)&#123;</span><br><span class="line">				res.x += q[i].x * L[i];</span><br><span class="line">				res.y += q[i].y * L[i];</span><br><span class="line">				res.z += q[i].z * L[i];</span><br><span class="line">			&#125;</span><br><span class="line">			radius = <span class="built_in">dist</span>(res,outer[<span class="number">0</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">minball</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="built_in">ball</span>();</span><br><span class="line">	<span class="keyword">if</span>(nouter &lt; <span class="number">4</span>)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">dist</span>(res,pt[i]) - radius &gt; eps)&#123;</span><br><span class="line">				outer[nouter] = pt[i];</span><br><span class="line">				++nouter;</span><br><span class="line">				<span class="built_in">minball</span>(i);</span><br><span class="line">				--nouter;</span><br><span class="line">				<span class="keyword">if</span>(i &gt; <span class="number">0</span>)&#123;</span><br><span class="line">					Tpoint Tt = pt[i];</span><br><span class="line">					<span class="built_in">memmove</span>(&amp;pt[<span class="number">1</span>],&amp;pt[<span class="number">0</span>],<span class="built_in"><span class="keyword">sizeof</span></span>(Tpoint)*i);</span><br><span class="line">					pt[<span class="number">0</span>] = Tt;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">smallest_ball</span><span class="params">()</span></span>&#123;</span><br><span class="line">	radius = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; npoint;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">dist</span>(res,pt[i]) - radius &gt; eps)&#123;</span><br><span class="line">			nouter = <span class="number">1</span>;</span><br><span class="line">			outer[<span class="number">0</span>] = pt[i];</span><br><span class="line">			<span class="built_in">minball</span>(i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">sqrt</span>(radius);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	cin &gt;&gt; npoint;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; npoint;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> x,y,z;</span><br><span class="line">		cin &gt;&gt; x &gt;&gt; y &gt;&gt; z;</span><br><span class="line">		pt[i] = <span class="built_in">Tpoint</span>(x,y,z);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%.10lf&quot;</span>,<span class="built_in">smallest_ball</span>());</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2020/05/09/template-graph-theory/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/09/template-graph-theory/" class="post-title-link" itemprop="url">[模板]图论</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-09 15:10:34" itemprop="dateCreated datePublished" datetime="2020-05-09T15:10:34+08:00">2020-05-09</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-16 01:44:15" itemprop="dateModified" datetime="2022-01-16T01:44:15+08:00">2022-01-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A8%A1%E6%9D%BF/" itemprop="url" rel="index"><span itemprop="name">模板</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>[TOC]</p>
<h2 id="建图">建图</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = maxn*<span class="number">2</span>;</span><br><span class="line"><span class="keyword">int</span> head[maxn],pa[maxn];</span><br><span class="line"><span class="keyword">bool</span> vis[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> f,t,next;</span><br><span class="line">	<span class="built_in">Edge</span>(<span class="keyword">int</span> f = <span class="number">0</span>,<span class="keyword">int</span> t = <span class="number">0</span>,<span class="keyword">int</span> next = <span class="number">0</span>):<span class="built_in">f</span>(f),<span class="built_in">t</span>(t),<span class="built_in">next</span>(next)&#123;&#125;	</span><br><span class="line">&#125;edge[maxm];</span><br><span class="line"><span class="keyword">int</span> tcnt,cnt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	edge[cnt] = <span class="built_in">Edge</span>(f,t,head[f]);</span><br><span class="line">	head[f] = cnt++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="最短路">最短路</h1>
<h2 id="spfa">SPFA</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">    queue&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)dis[i] = INF;</span><br><span class="line">    q.<span class="built_in">push</span>(s);</span><br><span class="line">    vis[s] = <span class="number">1</span>;</span><br><span class="line">    dis[s] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        <span class="keyword">int</span> u = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        vis[u] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">            <span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">            <span class="keyword">if</span>(dis[v] &gt; dis[u] + edge[i].w)&#123;</span><br><span class="line">                dis[v] = dis[u] + edge[i].w;</span><br><span class="line">                <span class="keyword">if</span>(!vis[v])&#123;</span><br><span class="line">                    vis[v] = <span class="number">1</span>;</span><br><span class="line">                    q.<span class="built_in">push</span>(v);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="dijkstra">Dijkstra</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">	<span class="keyword">typedef</span> pair &lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; node;</span><br><span class="line">	priority_queue&lt;node,vector&lt;node&gt;,greater&lt;node&gt; &gt;q;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">1</span>;i&lt;=n;i++)dis[i] = INF;</span><br><span class="line">	dis[s] = <span class="number">0</span>;</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(dis[s],s));</span><br><span class="line">	<span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">		<span class="keyword">int</span> u = q.<span class="built_in">top</span>().second;</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">if</span>(vis[u])<span class="keyword">continue</span>;</span><br><span class="line">		vis[u] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">			<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">			<span class="keyword">if</span>(dis[v] &gt; dis[u] + edge[i].w)&#123;</span><br><span class="line">				dis[v] = dis[u] + edge[i].w;</span><br><span class="line">				<span class="keyword">if</span>(!vis[v])&#123;</span><br><span class="line">					q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(dis[v],v));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="网络流">网络流</h1>
<h2 id="最大流">最大流</h2>
<h3 id="edmonds-karp">Edmonds-Karp</h3>
<p>(慎用) <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">10005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = <span class="number">4e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e9</span>;</span><br><span class="line"><span class="keyword">int</span> head[maxn],parent[maxn],approve[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> from,to,next,w,cap,flow;</span><br><span class="line">&#125;edge[maxm];</span><br><span class="line"><span class="keyword">int</span> n,m,start,to,cnt,ans;<span class="comment">//cnt = 0 so we can calculate &quot;backedge&quot; easily</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to,<span class="keyword">int</span> cap,<span class="keyword">int</span> flow)</span></span>&#123;</span><br><span class="line">	edge[cnt].cap = cap;</span><br><span class="line">	edge[cnt].flow = flow;</span><br><span class="line">	edge[cnt].to = to;</span><br><span class="line">	edge[cnt].from = from;</span><br><span class="line">	edge[cnt].next = head[from];</span><br><span class="line">	head[from] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BFS</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	queue&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">	<span class="built_in">memset</span>(approve,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(approve)); </span><br><span class="line">	q.<span class="built_in">push</span>(s);</span><br><span class="line">	approve[s] = INF;</span><br><span class="line">	<span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">		<span class="keyword">int</span> u = q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">			<span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">			<span class="keyword">if</span>(!approve[v] <span class="keyword">and</span> edge[i].cap &gt; edge[i].flow)&#123;</span><br><span class="line">				parent[v] = i;</span><br><span class="line">				approve[v] = <span class="built_in">min</span>(approve[u],edge[i].cap - edge[i].flow);</span><br><span class="line">				q.<span class="built_in">push</span>(v);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(approve[t])<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> approve[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EK</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">int</span> delta = <span class="built_in">BFS</span>(s,t);</span><br><span class="line">		<span class="keyword">if</span>(!delta)<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> u = t;u != s;u = edge[parent[u]].from)&#123;</span><br><span class="line">			<span class="keyword">int</span> curp = parent[u];</span><br><span class="line">			edge[curp].flow += delta;</span><br><span class="line">			edge[curp^<span class="number">1</span>].flow -= delta;</span><br><span class="line">		&#125;</span><br><span class="line">		flow += delta;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="dinic">Dinic</h3>
<p>记得加上容量为0的反向弧=-=</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">addedge</span>(f,t,w,<span class="number">0</span>);</span><br><span class="line"><span class="built_in">addedge</span>(t,f,<span class="number">0</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>注意全局变量<span class="math inline">\(N\)</span>, 代表网络里点的最大编号</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = <span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e9</span>; </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> from,to,next,w,cap,flow;</span><br><span class="line">&#125;edge[maxm];</span><br><span class="line"><span class="keyword">int</span> head[maxn],deep[maxn],vis[maxn],cur[maxn];</span><br><span class="line"><span class="keyword">int</span> N,m,start,to,cnt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to,<span class="keyword">int</span> cap,<span class="keyword">int</span> flow)</span></span>&#123;</span><br><span class="line">	edge[cnt].from = from;</span><br><span class="line">	edge[cnt].to = to;</span><br><span class="line">	edge[cnt].cap = cap;</span><br><span class="line">	edge[cnt].flow = flow;</span><br><span class="line">	edge[cnt].next = head[from];</span><br><span class="line">	head[from] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BFS</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(vis));</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= N;i++)cur[i] = head[i];</span><br><span class="line">	queue&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">	q.<span class="built_in">push</span>(s);</span><br><span class="line">	vis[s] = <span class="number">1</span>;</span><br><span class="line">	deep[s] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">		<span class="keyword">int</span> u = q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">			<span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">			<span class="keyword">if</span>(!vis[v] <span class="keyword">and</span> edge[i].cap &gt; edge[i].flow)&#123;</span><br><span class="line">				vis[v] = <span class="number">1</span>;</span><br><span class="line">				deep[v] = deep[u] + <span class="number">1</span>;</span><br><span class="line">				q.<span class="built_in">push</span>(v);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> vis[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> t,<span class="keyword">int</span> approve)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(u == t <span class="keyword">or</span> approve == <span class="number">0</span>)<span class="keyword">return</span> approve;</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>,delta = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = cur[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		cur[u] = i;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">		<span class="keyword">if</span>(deep[u] + <span class="number">1</span> == deep[v] <span class="built_in"><span class="keyword">and</span></span> (delta = <span class="built_in">DFS</span>(v,t,<span class="built_in">min</span>(approve,edge[i].cap - edge[i].flow))) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">			edge[i].flow += delta;</span><br><span class="line">			edge[i^<span class="number">1</span>].flow -= delta;</span><br><span class="line">			flow += delta;approve -= delta;</span><br><span class="line">			<span class="keyword">if</span>(!approve)<span class="keyword">break</span>; </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">BFS</span>(s,t))&#123;</span><br><span class="line">		flow += <span class="built_in">DFS</span>(s,t,INF);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最小费用最大流">最小费用最大流</h2>
<p>全局变量flow为最大流,cost为最小费用</p>
<p>记得反向边容量为0费用为负=-=</p>
<p><strong>注意使用到了全局变量n</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">10005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = <span class="number">4e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e9</span>;</span><br><span class="line"><span class="keyword">int</span> head[maxn],parent[maxn],approve[maxn],dis[maxn],vis[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> from,to,next,w,cap,flow,cost;</span><br><span class="line">&#125;edge[maxm];</span><br><span class="line"><span class="keyword">int</span> n,m,start,to,cnt,ans,flow,cost;<span class="comment">//cnt = 0 so we can calculate &quot;backedge&quot; easily</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to,<span class="keyword">int</span> cap,<span class="keyword">int</span> flow,<span class="keyword">int</span> cost)</span></span>&#123;</span><br><span class="line">	edge[cnt].cap = cap;</span><br><span class="line">	edge[cnt].cost = cost;</span><br><span class="line">	edge[cnt].flow = flow;</span><br><span class="line">	edge[cnt].to = to;</span><br><span class="line">	edge[cnt].from = from;</span><br><span class="line">	edge[cnt].next = head[from];</span><br><span class="line">	head[from] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> cap,<span class="keyword">int</span> flow,<span class="keyword">int</span> cost)</span></span>&#123;</span><br><span class="line">	<span class="built_in">addedge</span>(f,t,cap,flow,cost);</span><br><span class="line">	<span class="built_in">addedge</span>(t,f,<span class="number">0</span>,<span class="number">0</span>,-cost);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)dis[i] = INF;</span><br><span class="line">	<span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(vis));</span><br><span class="line">	queue&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">	<span class="built_in">memset</span>(approve,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(approve)); </span><br><span class="line">	q.<span class="built_in">push</span>(s);</span><br><span class="line">	approve[s] = INF;</span><br><span class="line">	dis[s] = <span class="number">0</span>;</span><br><span class="line">	vis[s] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">		<span class="keyword">int</span> u = q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		vis[u] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">			<span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">			<span class="keyword">if</span>(dis[v] &gt; dis[u] + edge[i].cost <span class="keyword">and</span> edge[i].cap &gt; edge[i].flow)&#123;</span><br><span class="line">				parent[v] = i;</span><br><span class="line">				approve[v] = <span class="built_in">min</span>(approve[u],edge[i].cap - edge[i].flow);</span><br><span class="line">				dis[v] = dis[u] + edge[i].cost;</span><br><span class="line">				<span class="keyword">if</span>(!vis[v])&#123;</span><br><span class="line">					vis[v] = <span class="number">1</span>;</span><br><span class="line">					q.<span class="built_in">push</span>(v);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> approve[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">EK</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line"><span class="comment">//	int flow = 0;</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">int</span> delta = <span class="built_in">spfa</span>(s,t);</span><br><span class="line">		<span class="keyword">if</span>(!delta)<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> u = t;u != s;u = edge[parent[u]].from)&#123;</span><br><span class="line">			<span class="keyword">int</span> curp = parent[u];</span><br><span class="line">			edge[curp].flow += delta;</span><br><span class="line">			edge[curp^<span class="number">1</span>].flow -= delta;</span><br><span class="line">		&#125;</span><br><span class="line">		flow += delta;</span><br><span class="line">		cost += dis[t]*delta;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="上下界网络流">上下界网络流</h2>
<p>以下设源汇点为<span class="math inline">\(s_1,t_1\)</span>, 超级源汇为<span class="math inline">\(S,T\)</span>, 每条边的上界为<span class="math inline">\(u\)</span>, 下界为<span class="math inline">\(l\)</span></p>
<h3 id="无源无汇上下界可行流">无源无汇上下界可行流</h3>
<p>将原网络拆成两个图: 下界网络(每条边的容量和流量都是<span class="math inline">\(l_i\)</span>, 不用实际建出) 和差网络(每条边的容量为<span class="math inline">\(u_i - l_i\)</span>, 流量为<span class="math inline">\(0\)</span>).</p>
<p>设<span class="math inline">\(pflow[i]\)</span>为第<span class="math inline">\(i\)</span>个点的净流量(即流入量减流出量). 如果<span class="math inline">\(pflow[i] &gt; 0\)</span>, 在差网络上建一条<span class="math inline">\((S,i,pflow[i])\)</span>的边来补偿<span class="math inline">\(i\)</span>点缺失的流出量. 如果<span class="math inline">\(pflow[i] &lt; 0\)</span>, 建一条<span class="math inline">\((i,T,-pflow[i])\)</span>的边. 然后跑从<span class="math inline">\(S\)</span>到<span class="math inline">\(T\)</span>的最大流, 如果<span class="math inline">\(S\)</span>的任一出边或者<span class="math inline">\(T\)</span>的任一入边没有满流则不存在可行流. 否则每条边的可行流为<span class="math inline">\(flow_i + l_i\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line">cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"><span class="keyword">int</span> S = n+<span class="number">1</span>,T = n+<span class="number">2</span>;</span><br><span class="line">N = T+<span class="number">1</span>;</span><br><span class="line"><span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(head));</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line">	<span class="keyword">int</span> f,t,l,u;</span><br><span class="line">	cin &gt;&gt; f &gt;&gt; t &gt;&gt; l &gt;&gt; u;</span><br><span class="line">	pflow[f] -= l,pflow[t] += l;</span><br><span class="line">	lowedge[cnt] = l;</span><br><span class="line">	<span class="built_in">add</span>(f,t,u-l);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">	<span class="keyword">if</span>(pflow[i] &gt; <span class="number">0</span>)<span class="built_in">add</span>(S,i,pflow[i]);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(pflow[i] &lt; <span class="number">0</span>)<span class="built_in">add</span>(i,T,-pflow[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Dinic</span>(S,T);</span><br><span class="line"><span class="keyword">bool</span> ok = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = head[S];~i;i = edge[i].next)&#123;</span><br><span class="line">	<span class="keyword">if</span>(edge[i].cap != edge[i].flow)ok = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; (ok?<span class="string">&quot;YES\n&quot;</span>:<span class="string">&quot;NO&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(ok)&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; m*<span class="number">2</span>;i += <span class="number">2</span>)cout &lt;&lt; edge[i].flow + lowedge[i] &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="有源有汇上下界可行流">有源有汇上下界可行流</h3>
<p>在无源无汇上下界可行流的基础上, 建一条<span class="math inline">\((t_i,s_i,\infin)\)</span>的边. 这条边的流量就是可行流流量</p>
<h3 id="有源有汇上下界最大流">有源有汇上下界最大流</h3>
<p>在有源有汇上下界可行流的基础上:</p>
<p>先跑一次<span class="math inline">\(S\)</span>到<span class="math inline">\(T\)</span>的最大流, 设<span class="math inline">\(flow_1\)</span> = <span class="math inline">\((t_i,s_i,\infin)\)</span>边的流量并判断是否存在可行流. 如果存在就把这条边删掉, 再在残余网络上跑一次从<span class="math inline">\(s_i\)</span>到<span class="math inline">\(t_i\)</span>的最大流<span class="math inline">\(flow_2\)</span>. 答案即为<span class="math inline">\(flow_1 + flow2\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> n,m,s1,t1;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m &gt;&gt; s1 &gt;&gt; t1;</span><br><span class="line">	<span class="keyword">int</span> S = n+<span class="number">1</span>,T = n+<span class="number">2</span>;</span><br><span class="line">	N = T+<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(head));</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> f,t,l,u;</span><br><span class="line">		cin &gt;&gt; f &gt;&gt; t &gt;&gt; l &gt;&gt; u;</span><br><span class="line">		pflow[f] -= l,pflow[t] += l;</span><br><span class="line">		lowedge[cnt] = l;</span><br><span class="line">		<span class="built_in">add</span>(f,t,u-l);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(pflow[i] &gt; <span class="number">0</span>)<span class="built_in">add</span>(S,i,pflow[i]);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(pflow[i] &lt; <span class="number">0</span>)<span class="built_in">add</span>(i,T,-pflow[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">add</span>(t1,s1,INF);</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">Dinic</span>(S,T);</span><br><span class="line">	<span class="keyword">bool</span> ok = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[S];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">if</span>(edge[i].cap != edge[i].flow)ok = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[s1];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">if</span>(edge[i].t == t1)&#123;</span><br><span class="line">			flow += <span class="built_in">abs</span>(edge[i].flow);</span><br><span class="line">			edge[i].flow = edge[i^<span class="number">1</span>].flow = edge[i].cap = edge[i^<span class="number">1</span>].cap = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	flow += <span class="built_in">Dinic</span>(s1,t1);</span><br><span class="line">	<span class="keyword">if</span>(ok)&#123;</span><br><span class="line">		cout &lt;&lt; flow;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;please go home to sleep&quot;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="有源有汇上下界最小流">有源有汇上下界最小流</h3>
<p>同有源有汇上下界最大流, 只是在第二步时跑<span class="math inline">\(t_i\)</span>到<span class="math inline">\(s_i\)</span>的最大流, 答案为<span class="math inline">\(flow_1- flow_2\)</span></p>
<h2 id="常用模型">常用模型</h2>
<h3 id="dag最小覆盖问题">DAG最小覆盖问题</h3>
<p>给定有向图<span class="math inline">\(G=(V,E)\)</span> 且 <span class="math inline">\(n = |V|\)</span>. 设 <span class="math inline">\(P\)</span> 是 <span class="math inline">\(G\)</span> 的一个简单路(顶点不相交)的集合. 如果 <span class="math inline">\(V\)</span> 中每个定点恰好在<span class="math inline">\(P\)</span>的一条路上, 则称<span class="math inline">\(P\)</span>是<span class="math inline">\(G\)</span>的一个路径覆盖. <span class="math inline">\(P\)</span>中路径可以从<span class="math inline">\(V\)</span>的任何一个定点开始, 长度也是任意的, 特别地, 可以为<span class="math inline">\(0\)</span>. <span class="math inline">\(G\)</span>的最小路径覆盖是<span class="math inline">\(G\)</span>所含路径条数最少的路径覆盖.</p>
<p>将原图的点拆为<span class="math inline">\(i\)</span>和<span class="math inline">\(i+n\)</span>. 设超级源<span class="math inline">\(S\)</span>, 超级汇<span class="math inline">\(T\)</span>. <span class="math inline">\(S\)</span>向点<span class="math inline">\(1...n\)</span>连边, 点<span class="math inline">\(1+n...n+n\)</span>向<span class="math inline">\(T\)</span>连边, 若有<span class="math inline">\(&lt;i,j&gt;\in E\)</span>则<span class="math inline">\(i\)</span>向<span class="math inline">\(j+n\)</span>连边. 求出<span class="math inline">\(S\)</span>到<span class="math inline">\(T\)</span>的最大流<span class="math inline">\(f\)</span>, 则<span class="math inline">\(n - f\)</span>为路径条数最少的路径覆盖. 方案可从流量网络中还原.</p>
<p>建图:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> S = <span class="number">2</span>*n+<span class="number">1</span>,T = <span class="number">2</span>*n+<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		<span class="built_in">add</span>(S,i,<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">add</span>(i+n,T,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> f,t;</span><br><span class="line">		cin &gt;&gt; f &gt;&gt; t;</span><br><span class="line">		<span class="built_in">add</span>(f,t+n,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	N = T;</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="built_in">Dinic</span>(S,T);</span><br></pre></td></tr></table></figure>
<p>求方案:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solution</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> nxt[maxn],has[maxn];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)nxt[i] = <span class="number">-1</span>,has[i] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= cnt;i+=<span class="number">2</span>)&#123;</span><br><span class="line">		<span class="keyword">int</span> u = edge[i].f,v = edge[i].t - n;</span><br><span class="line">		<span class="keyword">if</span>(edge[i].flow == <span class="number">1</span> <span class="keyword">and</span> v &gt; <span class="number">1</span> <span class="keyword">and</span> u &lt;= n)&#123;</span><br><span class="line">			nxt[u] = v;</span><br><span class="line">			has[v] = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)<span class="keyword">if</span>(!has[i])&#123;</span><br><span class="line">		cout &lt;&lt; i &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">		<span class="keyword">int</span> u = nxt[i];</span><br><span class="line">		<span class="keyword">while</span>(u != <span class="number">-1</span>)&#123;</span><br><span class="line">			cout &lt;&lt; u &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">			u = nxt[u];</span><br><span class="line">		&#125;</span><br><span class="line">		cout &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="二分图匹配">二分图匹配</h1>
<h2 id="常识性知识">常识性知识</h2>
<ul>
<li><p>所有的树是二分图</p></li>
<li><p>所有的网格图和四边形图是二分图</p></li>
<li><p>设<span class="math inline">\(u,v\)</span>为两个二进制数且<span class="math inline">\(u,v\)</span>只有一位不同. 若图中的所有边的两个顶点<span class="math inline">\(u_i,v_i\)</span>均满足该性质, 则该图是二分图</p></li>
<li><p><strong>最大匹配数</strong>：最大匹配的匹配边的数目</p>
<p><strong>最小点覆盖数</strong>：选取最少的点，使任意一条边至少有一个端点被选择</p>
<p><strong>最大独立数</strong>：选取最多的点，使任意所选两点均不相连</p>
<p><strong>最小路径覆盖数</strong>：对于一个 DAG（有向无环图），选取最少条路径，使得每个顶点属于且仅属于一条路径。路径长可以为 0（即单个点）。</p>
<p>定理1：最大匹配数 = 最小点覆盖数（这是 Konig 定理）</p>
<p>定理2：最大匹配数 = 最大独立数</p>
<p>定理3：最小路径覆盖数 = 顶点数 - 最大匹配数</p></li>
</ul>
<h2 id="二分图最大匹配">二分图最大匹配</h2>
<h3 id="网络流做法">网络流做法</h3>
<p>建立超级源<span class="math inline">\(S\)</span>和超级汇<span class="math inline">\(T\)</span>, 从<span class="math inline">\(S\)</span>向每个左端点连边, 每个右端点向<span class="math inline">\(T\)</span>连边, 端点之间按给出的图连边(仅从左端点向右端点), 边权均为1.</p>
<p><span class="math inline">\(S\)</span>到<span class="math inline">\(T\)</span>的最大流就是最大匹配</p>
<p>用Dinic实现 复杂度<span class="math inline">\(O(\sqrt n m)\)</span></p>
<h3 id="km">KM</h3>
<p>复杂度<span class="math inline">\(O(nm)\)</span></p>
<p><code>match[v]</code>为<span class="math inline">\(v\)</span>的匹配点.</p>
<p>a为左端点点的个数, b为右端点点的个数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">KM</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(vis[v])<span class="keyword">continue</span>;</span><br><span class="line">		vis[v] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(!match[v] <span class="keyword">or</span> <span class="built_in">KM</span>(match[v]))&#123;</span><br><span class="line">			match[v] = u;</span><br><span class="line">			match[u] = v;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> match_cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= a;i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt;= a+b;j++)vis[j] = <span class="number">0</span>;</span><br><span class="line">    match_cnt += <span class="built_in">KM</span>(i);</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; match_cnt;</span><br></pre></td></tr></table></figure>
<h2 id="应用">应用</h2>
<h3 id="二分图最大点独立集">二分图最大点独立集</h3>
<p>个数为顶点数-最大匹配数</p>
<h3 id="二分图博弈">二分图博弈</h3>
<p>考虑如下问题: 有两名玩家<span class="math inline">\(A\)</span>和<span class="math inline">\(B\)</span>, 轮流进行游戏且<span class="math inline">\(A\)</span>先手. 玩家每次可从当前状态转移到相邻的状态, 且已经访问过的状态不能再次访问. 状态可分为两个不相交的集合(建成二分图). 不能操作的玩家输.</p>
<p>概念:</p>
<ul>
<li>完美匹配: 图中所有点均属于最大匹配</li>
<li>必经点: 任意一个最大匹配均包含的点</li>
<li>非必经点: 至少一个最大匹配不包含的点.</li>
</ul>
<p>结论: 如果状态图最大匹配是完美匹配, 则<span class="math inline">\(A\)</span>必败. 否则, 如果游戏从非必经点开始, <span class="math inline">\(A\)</span>必胜. 其他情况<span class="math inline">\(A\)</span>必败.</p>
<p>简要推导: 如果<span class="math inline">\(A\)</span>从必经点开始, 那么<span class="math inline">\(B\)</span>总存在一种策略让自己走非匹配边, 使得<span class="math inline">\(A\)</span>必须走上匹配边, 最后<span class="math inline">\(A\)</span>将无路可走. 而如果<span class="math inline">\(A\)</span>从非必经点开始, 则<span class="math inline">\(A\)</span>一定会走到一个必经点, 转换为<span class="math inline">\(B\)</span>从必经点开始.</p>
<p>至此问题转化为求二分图中的所有非必经点.</p>
<h4 id="方法一-km">方法一: KM</h4>
<p>时间复杂度<span class="math inline">\(O(nm)\)</span>, 适用于比较小的图.</p>
<p>全局变量: <code>bool unne[]</code>. <span class="math inline">\(unne[i] = 1\)</span>表示<span class="math inline">\(i\)</span>为非必经点.</p>
<p>需要先跑一遍KM, 再对每个点<span class="math inline">\(i\)</span>跑<code>unness(i)</code>. <strong>注意特判度为0的点</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> unne[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">unness</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(unne[u])<span class="keyword">return</span>;</span><br><span class="line">	unne[u] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(match[v])<span class="built_in">unness</span>(match[v]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="方法2网络流">方法2:网络流</h4>
<p>这里用Dinic跑. 建图约定: 和超级源相连的点颜色标为<span class="math inline">\(1\)</span>, 和超级汇相连的点颜色标为<span class="math inline">\(0\)</span>. 从<span class="math inline">\(S\)</span>出发走非满流边能到达的和<span class="math inline">\(S\)</span>相邻的点, 以及从<span class="math inline">\(T\)</span>出发走满流边能到达的和<span class="math inline">\(T\)</span>相邻的点均为非必经点. 复杂度<span class="math inline">\(O(\sqrt n m)\)</span></p>
<p>使用时调用<code>cal_unne(S,1)</code>和<code>cal_unne(T,0)</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> unne[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal_unne</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(col[u] == c)unne[u] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(edge[i].cap - edge[i].flow == c <span class="keyword">and</span> !unne[v])<span class="built_in">cal_unne</span>(v,c);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="方法3-判断单个点">方法3: 判断单个点</h4>
<p>假设判断点<span class="math inline">\(s\)</span>. 先建出整个图, 但不连接<span class="math inline">\(S-s\)</span>, <span class="math inline">\(s-T\)</span>. 跑一遍网络流. 再将<span class="math inline">\(S-s,s-T\)</span>连接, 在残量网络里继续跑网络流. 如果流量增加那么<span class="math inline">\(s\)</span>是非必经点.</p>
<h1 id="连通性与环">连通性与环</h1>
<h2 id="割点">割点</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Tarjan</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(dfn[u])<span class="keyword">return</span>;</span><br><span class="line">	dfn[u] = low[u] = dfsclock++;</span><br><span class="line">	<span class="keyword">int</span> child = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">		<span class="keyword">if</span>(!dfn[v])&#123;</span><br><span class="line">			<span class="built_in">Tarjan</span>(v,fa);</span><br><span class="line">			low[u] = <span class="built_in">min</span>(low[v],low[u]);</span><br><span class="line">			<span class="keyword">if</span>(u == fa)child++;</span><br><span class="line">			<span class="keyword">if</span>(low[v] &gt;= dfn[u] <span class="keyword">and</span> u != fa)iscut[u] = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		low[u] = <span class="built_in">min</span>(low[u],dfn[v]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(fa == u <span class="keyword">and</span> child &gt; <span class="number">1</span>)iscut[u] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="scc强连通分量">SCC/强连通分量</h2>
<h3 id="kosaraju">Kosaraju</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> f,t,w,next;</span><br><span class="line">	<span class="built_in">Edge</span>(<span class="keyword">int</span> f = <span class="number">0</span>,<span class="keyword">int</span> t = <span class="number">0</span>,<span class="keyword">int</span> next = <span class="number">0</span>,<span class="keyword">int</span> w = <span class="number">0</span>):<span class="built_in">f</span>(f),<span class="built_in">t</span>(t),<span class="built_in">w</span>(w),<span class="built_in">next</span>(next)&#123;&#125;</span><br><span class="line">&#125;edge[maxm],edgeT[maxm],edgeD[maxm];</span><br><span class="line"><span class="keyword">int</span> head[maxn],headT[maxn],headD[maxn];</span><br><span class="line"><span class="keyword">int</span> sccno[maxn],sccmin[maxn],pointw[maxn];</span><br><span class="line"><span class="keyword">int</span> cnt,cntT,cntD,scccnt;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line">map&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;,<span class="keyword">bool</span>&gt;dup;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;r_topo;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	edge[cnt] = <span class="built_in">Edge</span>(f,t,head[f]);</span><br><span class="line">	head[f] = cnt++;</span><br><span class="line">	edgeT[cntT] = <span class="built_in">Edge</span>(t,f,headT[t]);</span><br><span class="line">	headT[t] = cntT++;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">    edgeD[cntD] = <span class="built_in">Edge</span>(f,t,headD[f],w);</span><br><span class="line">    headD[f] = cntD++;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">DFS1</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(vis[s])<span class="keyword">return</span>;</span><br><span class="line">	vis[s] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[s];~i;i = edge[i].next)<span class="built_in">DFS1</span>(edge[i].t);</span><br><span class="line">	r_topo.<span class="built_in">push_back</span>(s);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS2</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(sccno[s])<span class="keyword">return</span>;</span><br><span class="line">	sccno[s] = scccnt;</span><br><span class="line">	sccmin[scccnt] = <span class="built_in">min</span>(sccmin[scccnt],pointw[s]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = headT[s];~i;i = edgeT[i].next)<span class="built_in">DFS2</span>(edgeT[i].t);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">findscc</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)<span class="built_in">DFS1</span>(i);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = n<span class="number">-1</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!sccno[r_topo[i]])&#123;</span><br><span class="line">			scccnt++;</span><br><span class="line">			<span class="built_in">DFS2</span>(r_topo[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">buildmap</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> u = <span class="number">1</span>;u &lt;= n;u++)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">			<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">			<span class="keyword">if</span>(sccno[u] != sccno[v])&#123;</span><br><span class="line">				<span class="keyword">if</span>(!dup[&#123;sccno[u],sccno[v]&#125;])&#123;</span><br><span class="line">					<span class="built_in">addedge</span>(sccno[u],sccno[v],<span class="number">1</span>);</span><br><span class="line">					dup[&#123;sccno[u],sccno[v]&#125;] = <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="桥">桥</h2>
<p>一种比较好理解的求桥的方法 <strong>(注意无法用来求割顶</strong></p>
<p><span class="math inline">\(dp[u]\)</span>表示跨过<span class="math inline">\(u\)</span>的反向边的数量.如果<span class="math inline">\(dp[u] == 0\)</span>则<span class="math inline">\(&lt;fa,u&gt;\)</span>为桥(<span class="math inline">\(fa\)</span>是<span class="math inline">\(u\)</span>的父亲)</p>
<p>调用时需初始化<span class="math inline">\(dep[root] = 1\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal_bri</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">	dp[u] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(v == fa)<span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">if</span>(!dep[v])&#123;</span><br><span class="line">			dep[v] = dep[u]+<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">Cal_bri</span>(v,u);</span><br><span class="line">			dp[u] += dp[v];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(dep[v] &gt; dep[u])dp[u]--;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(dep[v] &lt; dep[u])&#123;</span><br><span class="line">				dp[u]++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(!dp[u] <span class="keyword">and</span> dep[u] &gt; <span class="number">1</span>)ok = <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h2 id="仙人掌">仙人掌</h2>
<p>(接上文)点仙人掌中求环并缩点</p>
<p><span class="math inline">\(backcnt\)</span>为全局变量,初始化为<span class="math inline">\(n+1\)</span>(点的个数+1)</p>
<p><span class="math inline">\(phash[u]\)</span>返回环的标号,从<span class="math inline">\(n+1\)</span>开始.若不在环内则<span class="math inline">\(phash[u] == u\)</span></p>
<p>调用时初始化<span class="math inline">\(dep[root] = 1\)</span>,注意缩点后需要重新寻找根节点(缩点代码未给出)</p>
<p>原理参见https://codeforces.com/blog/entry/68138 这个东西应该找简单环都可以用(? <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal_bri</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">	dp[u] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">bool</span> ok = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = rhead[u];~i;i = redge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = redge[i].to;</span><br><span class="line">		<span class="keyword">if</span>(v == fa)<span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">if</span>(!dep[v])&#123;</span><br><span class="line">			dep[v] = dep[u]+<span class="number">1</span>;</span><br><span class="line">			<span class="built_in">Cal_bri</span>(v,u);</span><br><span class="line">			dp[u] += dp[v];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(dep[v] &gt; dep[u])dp[u]--;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(dep[v] &lt; dep[u])&#123;</span><br><span class="line">				in[v]++;</span><br><span class="line">				dp[u]++;</span><br><span class="line">				ok = <span class="number">1</span>;</span><br><span class="line">				redge[i].cnt = ++backcnt;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(ok)phash[u] = backcnt;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		phash[u] = u;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = rhead[u];~i;i = redge[i].next)&#123;</span><br><span class="line">			<span class="keyword">int</span> v = redge[i].to;</span><br><span class="line">			<span class="keyword">if</span>(v == fa)<span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span>(phash[v] != v <span class="keyword">and</span> !in[v])&#123;</span><br><span class="line">				phash[u] = phash[v];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="bfs求最小环">BFS求最小环</h2>
<p>见代码=-=可以画个BFS树或者手模感悟一下</p>
<p>记得得枚举1...n的所有起点,所以复杂度是<span class="math inline">\(O(n^2)\)</span> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(dis,<span class="number">-1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(dis));</span><br><span class="line">	dis[s] = <span class="number">0</span>;</span><br><span class="line">	queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; &gt;q;</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(s,<span class="number">0</span>));</span><br><span class="line">	<span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">		<span class="keyword">auto</span> now = q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">int</span> u = now.first,fa = now.second;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">			<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">			<span class="keyword">if</span>(v == fa)<span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span>(dis[v] == <span class="number">-1</span>)&#123;</span><br><span class="line">				dis[v] = dis[u]+<span class="number">1</span>;</span><br><span class="line">				q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(v,u));</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				ans = <span class="built_in">min</span>(ans,dis[v]+dis[u]+<span class="number">1</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="floyd求最小环">Floyd求最小环</h1>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> val[maxn + <span class="number">1</span>][maxn + <span class="number">1</span>];  <span class="comment">// 原图的邻接矩阵</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">floyd</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;n)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> dis[maxn + <span class="number">1</span>][maxn + <span class="number">1</span>];  <span class="comment">// 最短路矩阵</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) dis[i][j] = val[i][j];  <span class="comment">// 初始化最短路矩阵</span></span><br><span class="line">  <span class="keyword">int</span> ans = inf;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= n; ++k) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; k; ++i)</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; i; ++j)</span><br><span class="line">        ans = std::<span class="built_in">min</span>(ans, dis[i][j] + val[i][k] + val[k][j]);  <span class="comment">// 更新答案</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j)</span><br><span class="line">        dis[i][j] = std::<span class="built_in">min</span>(</span><br><span class="line">            dis[i][j], dis[i][k] + dis[k][j]);  <span class="comment">// 正常的 floyd 更新最短路矩阵</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="sat">2-SAT</h1>
<p>参数a,x,b,y代表<span class="math inline">\(x_a\)</span>为x或<span class="math inline">\(x_b\)</span>为y x,y是bool 是的我知道这个变量起的很弱智 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P4782</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = <span class="number">4E6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> from,to,next;</span><br><span class="line">&#125;edge[maxm],edgeT[maxm];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;r_topo;</span><br><span class="line"><span class="keyword">int</span> scc_no[maxn],scc_cnt;</span><br><span class="line"><span class="keyword">bool</span> vis[maxn];</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">1</span>,cntT = <span class="number">1</span>,head[maxn],headT[maxn],n,m,q;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	edge[cnt].from = f;</span><br><span class="line">	edge[cnt].to = t;</span><br><span class="line">	edge[cnt].next = head[f];</span><br><span class="line">	head[f] = cnt++;</span><br><span class="line">	edgeT[cntT].from = t;</span><br><span class="line">	edgeT[cntT].to = f;</span><br><span class="line">	edgeT[cntT].next = headT[t];</span><br><span class="line">	headT[t] = cntT++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS1</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(vis[u])<span class="keyword">return</span>;</span><br><span class="line">	vis[u] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="built_in">DFS1</span>(edge[i].to);</span><br><span class="line">	&#125;</span><br><span class="line">	r_topo.<span class="built_in">push_back</span>(u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS2</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(scc_no[u])<span class="keyword">return</span>;</span><br><span class="line">	scc_no[u] = scc_cnt;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = headT[u];~i;i = edgeT[i].next)<span class="built_in">DFS2</span>(edgeT[i].to);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">findscc</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">2</span>*n;i++)<span class="built_in">DFS1</span>(i);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>*n<span class="number">-1</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!scc_no[r_topo[i]])&#123;</span><br><span class="line">			scc_cnt++;</span><br><span class="line">			<span class="built_in">DFS2</span>(r_topo[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//	freopen(&quot;P4782.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">	<span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(head));</span><br><span class="line">	<span class="built_in">memset</span>(headT,<span class="number">-1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(headT));</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> a,b,x,y;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>,&amp;a,&amp;x,&amp;b,&amp;y);</span><br><span class="line">		<span class="built_in">addedge</span>(a+n*(x&amp;<span class="number">1</span>),b+n*(y^<span class="number">1</span>));</span><br><span class="line">		<span class="built_in">addedge</span>(b+n*(y&amp;<span class="number">1</span>),a+n*(x^<span class="number">1</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">findscc</span>();</span><br><span class="line">	<span class="keyword">bool</span> ok = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)<span class="keyword">if</span>(scc_no[i] == scc_no[i+n])&#123;</span><br><span class="line">		ok = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(!ok)<span class="built_in">printf</span>(<span class="string">&quot;IMPOSSIBLE&quot;</span>);</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;POSSIBLE\n&quot;</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,scc_no[i] &gt; scc_no[i+n]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="弦图">弦图</h1>
<h2 id="定义">定义</h2>
<p>子图: 点集和边集均为原图点集和边集子集的图.</p>
<p>导出子图: 点集为原图点集的子集, 且边集中所有边的两个端点都在导出子图的点集中.</p>
<p>团: 是完全图的子图</p>
<p>单纯点: 设<span class="math inline">\(N(x)\)</span>为所有与<span class="math inline">\(x\)</span>相邻的点的集合, 若<span class="math inline">\(\{x\} + N(x)\)</span>的导出子图是团, 则<span class="math inline">\(x\)</span>是单纯点</p>
<h2 id="完美消除序列">完美消除序列</h2>
<p>此处完美消除序列(Perfect Elimination Ordering)的定义为: 令 <span class="math inline">\(n=|V|\)</span>，完美消除序列 <span class="math inline">\(v_1,v_2,\ldots ,v_n\)</span> 为 <span class="math inline">\(1,2,\ldots ,n\)</span> 的一个排列，满足 <span class="math inline">\(v_i\)</span> 在 <span class="math inline">\(\{v_i,v_{i+1},\ldots ,v_n\}\)</span> 的导出子图中为单纯点.</p>
<p>注意该定义可能与部分论文顺序相反.</p>
<h3 id="最大势算法mcs">最大势算法(MCS)</h3>
<h4 id="优先队列做法">优先队列做法</h4>
<p><strong>已弃用, 有可能RE</strong></p>
<p>复杂度: <span class="math inline">\(O((n+m)\log n)\)</span></p>
<p>输入: <span class="math inline">\(n\)</span>, 点数</p>
<p><span class="math inline">\(head[],edge[],cnt\)</span>, 无向图(全局变量)</p>
<p>使用的全局变量:<span class="math inline">\(vis[]\)</span></p>
<p>输出: <code>vector&lt;int&gt;</code>, 长度为<span class="math inline">\(n\)</span>的完美消除序列.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">MCS</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	vector&lt;<span class="keyword">int</span>&gt;res;</span><br><span class="line">	priority_queue&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; &gt;pq;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		label[i] = vis[i] = <span class="number">0</span>;</span><br><span class="line">		pq.<span class="built_in">push</span>(&#123;<span class="number">0</span>,i&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> step = <span class="number">1</span>;step &lt;= n;step++)&#123;</span><br><span class="line">		<span class="keyword">while</span>(pq.<span class="built_in">size</span>())&#123;</span><br><span class="line">			<span class="keyword">int</span> u = pq.<span class="built_in">top</span>().second;</span><br><span class="line">			pq.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="keyword">if</span>(!vis[u])&#123;</span><br><span class="line">				res.<span class="built_in">push_back</span>(u);</span><br><span class="line">				vis[u] = <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">					<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">					<span class="keyword">if</span>(vis[v])<span class="keyword">continue</span>;</span><br><span class="line">					label[v]++;</span><br><span class="line">					pq.<span class="built_in">push</span>(&#123;label[v],v&#125;);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">reverse</span>(res.<span class="built_in">begin</span>(),res.<span class="built_in">end</span>());</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="链表做法">链表做法</h4>
<p>复杂度<span class="math inline">\(O(n+m)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">MCS</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> best = <span class="number">0</span>;</span><br><span class="line">	vector&lt;<span class="keyword">int</span>&gt;res;</span><br><span class="line">	vector&lt;list&lt;<span class="keyword">int</span>&gt; &gt;<span class="built_in">link</span>(n+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		label[i] = vis[i] = <span class="number">0</span>;</span><br><span class="line">		link[<span class="number">0</span>].<span class="built_in">push_back</span>(i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> step = <span class="number">1</span>;step &lt;= n;step++)&#123;</span><br><span class="line">		<span class="keyword">while</span>(best &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(!link[best].<span class="built_in">size</span>())&#123;</span><br><span class="line">				best--;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">int</span> u = link[best].<span class="built_in">front</span>();</span><br><span class="line">			link[best].<span class="built_in">pop_front</span>();</span><br><span class="line">			<span class="keyword">if</span>(!vis[u])&#123;</span><br><span class="line">				vis[u] = <span class="number">1</span>;</span><br><span class="line">				res.<span class="built_in">push_back</span>(u);</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">					<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">					<span class="keyword">if</span>(!vis[v])&#123;</span><br><span class="line">						label[v]++;</span><br><span class="line">						link[label[v]].<span class="built_in">push_back</span>(v);</span><br><span class="line">						<span class="keyword">if</span>(label[v] &gt; best)best = label[v];</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">reverse</span>(res.<span class="built_in">begin</span>(),res.<span class="built_in">end</span>());</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="判断完美消除序列是否合法">判断完美消除序列是否合法</h3>
<p>根据完美消除序列的定义，设 <span class="math inline">\(v_i\)</span> 在 <span class="math inline">\({v_i,v_{i+1},\ldots , v_n}\)</span> 中相邻的点从小到大为 <span class="math inline">\(\{v_{c_1},v_{c_2},\ldots ,v_{c_k} \}\)</span>，则只需判断 <span class="math inline">\(v_{c_1}\)</span> 与其他点是否直接连通即可</p>
<p>输入:<code>int n</code>-图的点数 <code>vector&lt;int&gt; &amp; peo</code>-完美消除序列</p>
<p>输出: 该序列是否合法</p>
<p>时间复杂度<span class="math inline">\(O(m\log n + n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">chord_check</span><span class="params">(<span class="keyword">int</span> n,vector&lt;<span class="keyword">int</span>&gt; &amp; peo)</span></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">bool</span> mark[maxn];</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> rank[maxn];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)rank[peo[i]] = i,mark[i] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> u:peo)&#123;</span><br><span class="line">		vector&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; &gt;tmp;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">			<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">			<span class="keyword">if</span>(!mark[v])tmp.<span class="built_in">push_back</span>(&#123;rank[v],v&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">sort</span>(tmp.<span class="built_in">begin</span>(),tmp.<span class="built_in">end</span>());</span><br><span class="line">		<span class="keyword">if</span>(tmp.<span class="built_in">size</span>())&#123;</span><br><span class="line">			<span class="keyword">int</span> u = tmp[<span class="number">0</span>].second;</span><br><span class="line">			set&lt;<span class="keyword">int</span>&gt;tmpadj;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">				<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">				tmpadj.<span class="built_in">insert</span>(v);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; (<span class="keyword">int</span>)tmp.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">				<span class="keyword">if</span>(!tmpadj.<span class="built_in">count</span>(tmp[i].second))<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		mark[u] = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="弦图最大独立集最小团覆盖">弦图最大独立集/最小团覆盖</h2>
<p>最大独立集: 从前往后遍历完美消除序列, 每次选取不在独立集且与独立集无邻边的点加入独立集中.</p>
<p>最小团覆盖: 设最大独立集为 <span class="math inline">\(\{v_1,v_2,\ldots ,v_t\}\)</span>, 则团的集合<span class="math inline">\(\{\)</span> <span class="math inline">\(\{v_1+N(v_1)\},\{v_2+N(v_2)\},... ,\{v_t+N(v_t)\}\)</span> <span class="math inline">\(\}\)</span>为图的最小团覆盖. 时间复杂度均为 <span class="math inline">\(O(n+m)\)</span></p>
<h2 id="弦图的色数弦图的团数">弦图的色数/弦图的团数</h2>
<p>一种构造方法：按完美消除序列从后往前依次给每个点染色，给每个点染上可以染的最小颜色。时间复杂度 <span class="math inline">\(O(m+n)\)</span>。</p>
<p>正确性证明：设以上方法使用了 <span class="math inline">\(t\)</span> 种颜色，则 <span class="math inline">\(t\ge \chi(G)\)</span>。由于团上每个点都是不同的颜色，所以 <span class="math inline">\(t=\omega(G)\)</span>，由 <strong>Lemma 1</strong>，<span class="math inline">\(t=\omega(G)\le \chi(G)\)</span>。综上，可得 <span class="math inline">\(t=\chi(G)=\omega(G)\)</span>。</p>
<p>无需染色方案，只需求出弦图的色数/团数时，可以取 <span class="math inline">\(|\{x\}+N(x)|\)</span> 的最大值得到。</p>
<h1 id="树">树</h1>
<h2 id="最小生成树">最小生成树</h2>
<h3 id="结论">结论</h3>
<ul>
<li>同一个图的任意最小生成树上, 每种权值的边的数量是固定的.</li>
<li>切分定理：对于给定图的任意割，横跨两个割集的边中权值严格最小的边必定在最小生成树上</li>
<li>假设权值为<span class="math inline">\(w\)</span>的边需要<span class="math inline">\(k\)</span>条来形成最小生成树且已经加入<span class="math inline">\(k\)</span>条, 那么无论选择了哪些合法的边, 图的联通状态都是相同的</li>
</ul>
<h3 id="prim">Prim</h3>
<p><span class="math inline">\(dis[i]\)</span>表示第<span class="math inline">\(i\)</span>条树边的长度,标号从<span class="math inline">\(2\)</span>到<span class="math inline">\(n\)</span>.</p>
<p><span class="math inline">\(d[i][j]\)</span>为边<span class="math inline">\(&lt;i,j&gt;\)</span>权值</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">prim</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)vis[i] = <span class="number">0</span>,dis[i] = INF;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)<span class="keyword">if</span>(!vis[j])&#123;</span><br><span class="line">			<span class="keyword">if</span>(!x <span class="keyword">or</span> dis[x] &gt; dis[j])x = j;</span><br><span class="line">		&#125;</span><br><span class="line">		vis[x] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)<span class="keyword">if</span>(!vis[j])&#123;</span><br><span class="line">			dis[j] = <span class="built_in">min</span>(dis[j],d[x][j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ll tans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		tans += dis[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="欧拉序">欧拉序</h2>
<h3 id="定义-1">定义</h3>
<p>在dfs整个树的过程中, 第一次访问或回溯时均记录下经过的节点即为欧拉序. 例:</p>
<p><img src="E:\Github\hexo\source\_posts\image-20211109105112159.png" alt="image-20211109105112159" style="zoom:50%;" /></p>
<p>这棵树的欧拉序(根节点为1)为<code>1 2 3 4 3 7 3 2 5 6 5 2 1</code></p>
<p>一棵<span class="math inline">\(n\)</span>个节点的树欧拉序长度为<span class="math inline">\(2n - 1\)</span>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> clk;<span class="comment">//下标指针</span></span><br><span class="line"><span class="keyword">int</span> euler[maxn],dep[maxn],fir[maxn],lst[maxn];<span class="comment">//欧拉序, 深度, 节点第一次(最后一次)在欧拉序中出现的位置</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">	euler[++clk] = u;</span><br><span class="line">	fir[u] = lst[u] = clk;</span><br><span class="line">	dep[u] = dep[fa] + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> v:G[u])&#123;</span><br><span class="line">		<span class="keyword">if</span>(v != fa)&#123;</span><br><span class="line">			<span class="built_in">dfs</span>(v,u);</span><br><span class="line">			euler[++clk] = u;</span><br><span class="line">            lst[u] = clk;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="将树上问题转化为区间问题">将树上问题转化为区间问题</h3>
<p>欧拉序可将一棵树映射为一维的区间. <span class="math inline">\([fir[u],lst[u]]\)</span>之间的欧拉序对应的是以<span class="math inline">\(u\)</span>为根的子树的区间.</p>
<h3 id="求解lca">求解LCA</h3>
<p><span class="math inline">\(O(n\log n)\)</span>预处理, <span class="math inline">\(O(1)\)</span>查询. <span class="math inline">\(u,v\)</span>之间的LCA即为欧拉序<span class="math inline">\([fir[u],fir[v]]\)</span>之间深度最小的点.</p>
<p>ST表中保存的是点的编号, 但按点的深度来比较.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ST_init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	lg[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)ST[i][<span class="number">0</span>] = euler[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; maxn;i++)lg[i] = lg[i&gt;&gt;<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j) &lt;= n;j++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i +(<span class="number">1</span>&lt;&lt;j) - <span class="number">1</span>&lt;= n;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> v1 = ST[i][j - <span class="number">1</span>],v2 = ST[i + (<span class="number">1</span>&lt;&lt;(j - <span class="number">1</span>))][j - <span class="number">1</span>];</span><br><span class="line">		ST[i][j] = dep[v1] &lt; dep[v2]?v1:v2;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(fir[u] &gt; fir[v])<span class="built_in">swap</span>(u,v);</span><br><span class="line">	u = fir[u],v = fir[v];</span><br><span class="line">	<span class="keyword">int</span> k = lg[v-u+<span class="number">1</span>];</span><br><span class="line">	<span class="keyword">int</span> v1 = ST[u][k],v2 = ST[v - (<span class="number">1</span>&lt;&lt;k) + <span class="number">1</span>][k];</span><br><span class="line">	<span class="keyword">return</span> dep[v1] &lt; dep[v2]?v1:v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最近公共祖先lca-倍增">最近公共祖先(LCA)-倍增</h2>
<p>预处理<span class="math inline">\(O(n)\)</span>, 单次查询<span class="math inline">\(O(\log)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> p[maxn][<span class="number">35</span>],dep[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pre</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(u == fa)<span class="keyword">return</span>;</span><br><span class="line">	dep[u] = dep[fa] + <span class="number">1</span>;</span><br><span class="line">	p[u][<span class="number">0</span>] = fa;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;i) &lt;= dep[u];i++)p[u][i] = p[p[u][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)<span class="keyword">if</span>(fa != edge[i].to)<span class="built_in">pre</span>(edge[i].to,u);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(dep[a] &gt; dep[b])<span class="built_in">swap</span>(a,b);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">30</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line">		<span class="keyword">if</span>(dep[a] &lt;= dep[b] - (<span class="number">1</span>&lt;&lt;i))b = p[b][i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(a == b)<span class="keyword">return</span> a;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">30</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line">		<span class="keyword">if</span>(p[a][i] == p[b][i])<span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			a = p[a][i];b = p[b][i];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> p[a][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="重心">重心</h2>
<p><span class="math inline">\(w[u]\)</span>为删去<span class="math inline">\(u\)</span>后剩余连通分量的最大值, <span class="math inline">\(rt\)</span>为树的重心</p>
<p>树最多有两个相邻的重心</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cent</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">	siz[u] = <span class="number">1</span>;</span><br><span class="line">	w[u] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">		<span class="keyword">if</span>(v != fa)&#123;</span><br><span class="line">			<span class="built_in">cent</span>(v,u);</span><br><span class="line">			siz[u] += siz[v];</span><br><span class="line">			w[u] = <span class="built_in">max</span>(w[u],siz[v]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	w[u] = <span class="built_in">max</span>(w[u],n - siz[u]);</span><br><span class="line">	<span class="keyword">if</span>(!rt <span class="keyword">or</span> w[u] &lt; w[rt])rt = u;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="dmst最小树形图有向图最小生成树">DMST/最小树形图/有向图最小生成树</h2>
<p>Edmond's Algorithm. 代码来自<a target="_blank" rel="noopener" href="https://acm.hdu.edu.cn/showproblem.php?pid=6990">HDU6990</a>的官方题解.</p>
<p>输入: es[] = edge(起点, 终点, 权值)</p>
<p>调用solve(顶点数, 边数)</p>
<p>输出: ans[], <code>ans[i]</code>代表以<span class="math inline">\(i\)</span>为根的DMST权值(即<span class="math inline">\(i\)</span>到其它点都有一条路径可达), 若不存在则为<span class="math inline">\(-1\)</span></p>
<p>时间复杂度<span class="math inline">\(O(mlogn)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DMST</span>&#123;</span></span><br><span class="line">    <span class="keyword">const</span> ll inf = <span class="number">4e13</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span> <span class="keyword">int</span> u, v; ll w; &#125; es[maxn];</span><br><span class="line">    <span class="keyword">int</span> ls[maxn], rs[maxn], dis[maxn];</span><br><span class="line">    ll val[maxn], tag[maxn];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x, ll t)</span> </span>&#123; val[x] += t;tag[x] += t; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ls[x]) <span class="built_in">update</span>(ls[x], tag[x]);</span><br><span class="line">        <span class="keyword">if</span> (rs[x]) <span class="built_in">update</span>(rs[x], tag[x]);</span><br><span class="line">        tag[x] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x || !y) <span class="keyword">return</span> x | y;</span><br><span class="line">        <span class="keyword">if</span> (val[x] &gt; val[y]) <span class="built_in">swap</span>(x, y);</span><br><span class="line">        <span class="built_in">push_down</span>(x);</span><br><span class="line">        rs[x] = <span class="built_in">merge</span>(rs[x], y);</span><br><span class="line">        <span class="keyword">if</span> (dis[ls[x]] &lt; dis[rs[x]]) <span class="built_in">swap</span>(ls[x], rs[x]);</span><br><span class="line">        dis[x] = dis[rs[x]] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> top[maxn], fa[maxn], ine[maxn];</span><br><span class="line">    <span class="keyword">int</span> findset[maxn]; <span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> findset[x] ? findset[x] = <span class="built_in">find</span>(findset[x]) : x; &#125;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; ch[maxn];</span><br><span class="line"></span><br><span class="line">    ll ans[maxn];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, ll s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ch[u].<span class="built_in">empty</span>())</span><br><span class="line">            ans[u] = s &gt;= inf ? <span class="number">-1</span> : s;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">for</span> (<span class="keyword">int</span> v : ch[u])</span><br><span class="line">            <span class="built_in">dfs</span>(v, s - val[ine[v]]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">2</span> * n; ++i) top[i] = fa[i] = ine[i] = findset[i] = <span class="number">0</span>, ch[i].<span class="built_in">clear</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) es[++m] = &#123; i % n + <span class="number">1</span>, i, inf &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">            ls[i] = rs[i] = tag[i] = dis[i] = <span class="number">0</span>;</span><br><span class="line">            val[i] = es[i].w;</span><br><span class="line">            top[es[i].v] = <span class="built_in">merge</span>(top[es[i].v], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (top[x]) &#123;</span><br><span class="line">            <span class="keyword">int</span> i = top[x], y = <span class="built_in">find</span>(es[i].u);</span><br><span class="line">            top[x] = <span class="built_in">merge</span>(ls[i], rs[i]);</span><br><span class="line">            <span class="keyword">if</span> (y == x) <span class="keyword">continue</span>;</span><br><span class="line">            ine[x] = i;</span><br><span class="line">            <span class="keyword">if</span> (!ine[es[i].u]) x = y;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">for</span> (<span class="keyword">int</span> z = ++n; x != z; x = <span class="built_in">find</span>(es[ine[x]].u)) &#123;</span><br><span class="line">                fa[x] = findset[<span class="built_in">find</span>(x)] = z;</span><br><span class="line">                ch[z].<span class="built_in">push_back</span>(x);</span><br><span class="line">                <span class="keyword">if</span> (top[x]) <span class="built_in">update</span>(top[x], -val[ine[x]]);</span><br><span class="line">                top[z] = <span class="built_in">merge</span>(top[z], top[x]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ll sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">            sum += val[ine[i]];</span><br><span class="line">        <span class="built_in">dfs</span>(n, sum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;dmst;</span><br></pre></td></tr></table></figure>
<h2 id="点分治">点分治</h2>
<p>具体看lyd的书.这里只放几道例题</p>
<h3 id="例题1-tree">例题1-Tree</h3>
<p>求树上间距小于等于<span class="math inline">\(k\)</span>的点对个数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P4178</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">4e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = <span class="number">4e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> head[maxn],vis[maxn],cnt;</span><br><span class="line"><span class="keyword">int</span> dis[maxn],bal[maxn],siz[maxn];<span class="comment">//权值,平衡因子,子树大小</span></span><br><span class="line"><span class="keyword">int</span> mapp[maxn],par[maxn],occur[maxn],tot;<span class="comment">//树上点的映射,该点属于根的哪颗子树,出现次数,待处理的总数</span></span><br><span class="line"><span class="keyword">int</span> root,n,k,ans;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> f,t,w,next;</span><br><span class="line">	<span class="built_in">Edge</span>(<span class="keyword">int</span> f = <span class="number">0</span>,<span class="keyword">int</span> t = <span class="number">0</span>,<span class="keyword">int</span> w = <span class="number">0</span>,<span class="keyword">int</span> next = <span class="number">0</span>):<span class="built_in">f</span>(f),<span class="built_in">t</span>(t),<span class="built_in">w</span>(w),<span class="built_in">next</span>(next)&#123;&#125;</span><br><span class="line">&#125;edge[maxm];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">	edge[cnt] = <span class="built_in">Edge</span>(f,t,w,head[f]);</span><br><span class="line">	head[f] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> dis[a] &lt; dis[b];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_root</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa,<span class="keyword">int</span> rawsiz)</span></span>&#123;</span><br><span class="line">	siz[u] = <span class="number">1</span>,bal[u] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(vis[v] <span class="keyword">or</span> v == fa)<span class="keyword">continue</span>;</span><br><span class="line">		<span class="built_in">get_root</span>(v,u,rawsiz);</span><br><span class="line">		siz[u] += siz[v];</span><br><span class="line">		bal[u] = <span class="built_in">max</span>(bal[u],siz[v]);</span><br><span class="line">	&#125;</span><br><span class="line">	bal[u] = <span class="built_in">max</span>(bal[u],rawsiz - siz[u]);</span><br><span class="line">	<span class="keyword">if</span>(!root <span class="keyword">or</span> bal[root] &gt; bal[u])root = u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_dis</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa,<span class="keyword">int</span> w,<span class="keyword">int</span> parent)</span></span>&#123;</span><br><span class="line">	mapp[++tot] = u;</span><br><span class="line">	dis[u] = w,par[u] = parent;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(vis[v] <span class="keyword">or</span> v == fa)<span class="keyword">continue</span>;</span><br><span class="line">		<span class="built_in">get_dis</span>(v,u,w + edge[i].w,parent);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">	tot = <span class="number">0</span>;</span><br><span class="line">	mapp[++tot] = u;</span><br><span class="line">	dis[u] = <span class="number">0</span>,par[u] = u;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(vis[v])<span class="keyword">continue</span>;</span><br><span class="line">		<span class="built_in">get_dis</span>(v,u,edge[i].w,v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(mapp+<span class="number">1</span>,mapp+tot+<span class="number">1</span>,cmp);</span><br><span class="line">	<span class="comment">// cout &lt;&lt; tot &lt;&lt; endl;</span></span><br><span class="line">	<span class="keyword">int</span> l = <span class="number">1</span>,r = tot;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= tot;i++)occur[par[mapp[i]]]++;</span><br><span class="line">	<span class="keyword">while</span>(l &lt;= r)&#123;</span><br><span class="line">		<span class="keyword">if</span>(dis[mapp[l]] + dis[mapp[r]] &gt; k)occur[par[mapp[r--]]]--;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			ans += (r - l + <span class="number">1</span> - occur[par[mapp[l]]]);</span><br><span class="line">			occur[par[mapp[l++]]]--;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Divide</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">	vis[u] = <span class="number">1</span>;</span><br><span class="line">	dis[u] = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">Cal</span>(u);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(vis[v])<span class="keyword">continue</span>;</span><br><span class="line">		root = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">get_root</span>(v,<span class="number">-1</span>,siz[v]);</span><br><span class="line">		<span class="built_in">Divide</span>(root);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(head));</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> f,t,w;</span><br><span class="line">		cin &gt;&gt; f &gt;&gt; t &gt;&gt; w;</span><br><span class="line">		<span class="built_in">addedge</span>(f,t,w);</span><br><span class="line">		<span class="built_in">addedge</span>(t,f,w);</span><br><span class="line">	&#125;</span><br><span class="line">	cin &gt;&gt; k;</span><br><span class="line">	<span class="built_in">get_root</span>(<span class="number">1</span>,<span class="number">-1</span>,n);</span><br><span class="line">	<span class="built_in">Divide</span>(root);</span><br><span class="line">	cout &lt;&lt; ans;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="例题2-ioi2011race">例题2-[IOI2011]Race</h3>
<p>给出一棵树,求路径和为k的最短路径长度(边数)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P4149</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = maxn*<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1E9</span>;</span><br><span class="line"><span class="keyword">int</span> head[maxn],vis[maxn],dis[maxn],dep[maxn];</span><br><span class="line"><span class="keyword">int</span> bal[maxn],siz[maxn],par[maxn];</span><br><span class="line"><span class="keyword">int</span> mapp[maxn],mindis[maxn];</span><br><span class="line"><span class="keyword">int</span> cnt,ans,root,n,k,tot;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> f,t,w,next;</span><br><span class="line">	<span class="built_in">Edge</span>(<span class="keyword">int</span> f = <span class="number">0</span>,<span class="keyword">int</span> t = <span class="number">0</span>,<span class="keyword">int</span> w = <span class="number">0</span>,<span class="keyword">int</span> next = <span class="number">0</span>):<span class="built_in">f</span>(f),<span class="built_in">t</span>(t),<span class="built_in">w</span>(w),<span class="built_in">next</span>(next)&#123;&#125;</span><br><span class="line">&#125;edge[maxm];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">	edge[cnt] = <span class="built_in">Edge</span>(f,t,w,head[f]);</span><br><span class="line">	head[f] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> dis[a] &lt; dis[b];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_root</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa,<span class="keyword">int</span> rawsiz)</span></span>&#123;</span><br><span class="line">	siz[u] = <span class="number">1</span>,bal[u] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(vis[v] <span class="keyword">or</span> v == fa)<span class="keyword">continue</span>;</span><br><span class="line">		<span class="built_in">get_root</span>(v,u,rawsiz);</span><br><span class="line">		siz[u] += siz[v];</span><br><span class="line">		bal[u] = <span class="built_in">max</span>(bal[u],siz[v]);</span><br><span class="line">	&#125;</span><br><span class="line">	bal[u] = <span class="built_in">max</span>(bal[u],rawsiz - siz[u]);</span><br><span class="line">	<span class="keyword">if</span>(!root <span class="keyword">or</span> bal[root] &gt; bal[u])root = u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_dis</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa,<span class="keyword">int</span> parent)</span></span>&#123;</span><br><span class="line">	par[u] = parent;</span><br><span class="line">	mapp[++tot] = u;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(vis[v] <span class="keyword">or</span> fa == v)<span class="keyword">continue</span>;</span><br><span class="line">		dis[v] = dis[u] + edge[i].w;</span><br><span class="line">		dep[v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">get_dis</span>(v,u,parent);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">	tot = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> pretot = <span class="number">0</span>;</span><br><span class="line">	dep[u] = dis[u] = <span class="number">0</span>,par[u] = u;</span><br><span class="line">	mindis[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	mapp[++tot] = u;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(vis[v])<span class="keyword">continue</span>;</span><br><span class="line">		pretot = tot;</span><br><span class="line">		dis[v] = edge[i].w;</span><br><span class="line">		dep[v] = <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">get_dis</span>(v,u,v);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = pretot+<span class="number">1</span>;j &lt;= tot;j++)&#123;</span><br><span class="line">			<span class="keyword">int</span> x = mapp[j];</span><br><span class="line">			<span class="keyword">if</span>(k - dis[x] &gt;= <span class="number">0</span>)ans = <span class="built_in">min</span>(ans,mindis[k - dis[x]] + dep[x]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = pretot+<span class="number">1</span>;j &lt;= tot;j++)&#123;</span><br><span class="line">			<span class="keyword">int</span> x = mapp[j];</span><br><span class="line">			<span class="keyword">if</span>(dis[x] &lt; maxn)mindis[dis[x]] = <span class="built_in">min</span>(mindis[dis[x]],dep[x]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= tot;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> j = mapp[i];</span><br><span class="line">		<span class="keyword">if</span>(dis[j] &lt; maxn)mindis[dis[j]] = INF;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Divide</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</span><br><span class="line">	vis[u] = <span class="number">1</span>;</span><br><span class="line">	dis[u] = <span class="number">0</span>;</span><br><span class="line">	dep[u] = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">Cal</span>(u);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(vis[v])<span class="keyword">continue</span>;</span><br><span class="line">		root = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">get_root</span>(v,<span class="number">-1</span>,siz[v]);</span><br><span class="line">		<span class="built_in">Divide</span>(root);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">// freopen(&quot;P4149_1.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">	ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(head));</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; maxn;i++)mindis[i] = INF;</span><br><span class="line">	ans = INF;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; k;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> f,t,w;</span><br><span class="line">		cin &gt;&gt; f &gt;&gt; t &gt;&gt; w;</span><br><span class="line">		f++;t++;</span><br><span class="line">		<span class="built_in">addedge</span>(f,t,w);</span><br><span class="line">		<span class="built_in">addedge</span>(t,f,w);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">get_root</span>(<span class="number">1</span>,<span class="number">-1</span>,n);</span><br><span class="line">	<span class="built_in">Divide</span>(root);</span><br><span class="line">	<span class="keyword">if</span>(ans == INF)ans = <span class="number">-1</span>;</span><br><span class="line">	cout &lt;&lt; ans;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2020/05/09/template-data-structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/09/template-data-structure/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-05-09 14:56:55" itemprop="dateCreated datePublished" datetime="2020-05-09T14:56:55+08:00">2020-05-09</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-08 20:10:54" itemprop="dateModified" datetime="2022-01-08T20:10:54+08:00">2022-01-08</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A8%A1%E6%9D%BF/" itemprop="url" rel="index"><span itemprop="name">模板</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="杂项">杂项</h1>
<h2 id="优化指令">优化指令</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker, <span class="meta-string">&quot;/stack:200000000&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize(<span class="meta-string">&quot;Ofast,unroll-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target(<span class="meta-string">&quot;avx,avx2,sse,sse2&quot;</span>)</span></span><br></pre></td></tr></table></figure>
<p>8e9的暴力, CF上跑了733ms...</p>
<p>适用于常数小的多重循环暴力, 建议热身赛的时候测试下能不能用</p>
<h2 id="重载运算符">重载运算符</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cmp</span>&#123;</span></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">operator</span> <span class="params">()</span><span class="params">(<span class="keyword">const</span> Node &amp; a,<span class="keyword">const</span> Node &amp; b)</span><span class="keyword">const</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (a.v == b.v?a.l &lt; b.l:a.v &lt; b.v);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">set&lt;Node,cmp&gt;odt2;</span><br></pre></td></tr></table></figure>
<h1 id="rmq问题">RMQ问题</h1>
<h2 id="st表">ST表</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">STable</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> ST[<span class="number">50005</span>][<span class="number">20</span>];</span><br><span class="line">	<span class="keyword">bool</span> ismax;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ST_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)ST[i][<span class="number">0</span>] = inital[i];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j) &lt;= n;j++)</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i +(<span class="number">1</span>&lt;&lt;j) - <span class="number">1</span>&lt;= n;i++)&#123;</span><br><span class="line">				<span class="keyword">if</span>(ismax)ST[i][j] = <span class="built_in">max</span>(ST[i][j - <span class="number">1</span>],ST[i + (<span class="number">1</span>&lt;&lt;(j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">				<span class="keyword">else</span> ST[i][j] = <span class="built_in">min</span>(ST[i][j - <span class="number">1</span>],ST[i + (<span class="number">1</span>&lt;&lt;(j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> k = <span class="built_in">log2</span>(r-l+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(ismax)<span class="keyword">return</span> <span class="built_in">max</span>(ST[l][k],ST[r - (<span class="number">1</span>&lt;&lt;k) + <span class="number">1</span>][k]);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">min</span>(ST[l][k],ST[r - (<span class="number">1</span>&lt;&lt;k) + <span class="number">1</span>][k]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="fenwick树">Fenwick树</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> BIT[<span class="number">5000005</span>],n,m;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x&amp;-x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(index &gt; <span class="number">0</span>)&#123;</span><br><span class="line">		tmp += BIT[index];</span><br><span class="line">		index -= <span class="built_in">lowbit</span>(index);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(index &lt;= n)&#123;</span><br><span class="line">		BIT[index] += x;</span><br><span class="line">		index += <span class="built_in">lowbit</span>(index); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="求k小值">求k小值:</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> tans = <span class="number">0</span>,tcnt = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="built_in">log2</span>(n);i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line">		tans += (<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">		<span class="keyword">if</span>(tans &gt;= n <span class="keyword">or</span> tcnt + BIT[tans] &gt;= k)tans -= (<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">		<span class="keyword">else</span> tcnt += BIT[tans];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tans+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>区间修改单点查询见<a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P3368">P3368</a>(懒到爆炸</p>
<h1 id="珂朵莉树">珂朵莉树</h1>
<p>珂朵莉树在<strong>存在区间赋值操作</strong>和<strong>数据随机</strong>的情况下可以维护复杂的区间询问. 复杂度一般为<span class="math inline">\(O(n\log n)\)</span>.</p>
<p>注意如果数据不随机, 但区间赋值操作很多(或者是全部)也可用珂朵莉树维护.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="comment">//节点,表示区间[l,r]的值为v</span></span><br><span class="line">	ll l,r;</span><br><span class="line">	<span class="keyword">mutable</span> ll v;<span class="comment">//必须加mutable, 否则无法修改v</span></span><br><span class="line">	<span class="built_in">Node</span>(ll l,ll r,ll v):<span class="built_in">l</span>(l),<span class="built_in">r</span>(r),<span class="built_in">v</span>(v)&#123;&#125;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node &amp; x) <span class="keyword">const</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> l &lt; x.l;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">set&lt;Node&gt;odt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">split</span><span class="params">(<span class="keyword">int</span> idx)</span></span>&#123;</span><br><span class="line">    <span class="comment">//将区间[l,r] (其中l &lt;= idx &lt;= r)分裂为[l,idx-1]和[idx,r]两个区间并返回[idx,r]区间的迭代器</span></span><br><span class="line">	<span class="keyword">auto</span> it = odt.<span class="built_in">lower_bound</span>(<span class="built_in">Node</span>(idx,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">	<span class="keyword">if</span>(it != odt.<span class="built_in">end</span>() <span class="keyword">and</span> it-&gt;l == idx)<span class="keyword">return</span> it;</span><br><span class="line">	it--;</span><br><span class="line">	<span class="keyword">int</span> l = it-&gt;l,r = it-&gt;r,v = it-&gt;v;</span><br><span class="line">	odt.<span class="built_in">erase</span>(it);</span><br><span class="line">	odt.<span class="built_in">insert</span>(<span class="built_in">Node</span>(l,idx<span class="number">-1</span>,v));</span><br><span class="line">	<span class="keyword">return</span> odt.<span class="built_in">insert</span>(<span class="built_in">Node</span>(idx,r,v)).first;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">assign</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">    <span class="comment">//将[l,r]赋值为v</span></span><br><span class="line">	<span class="keyword">auto</span> end = <span class="built_in">split</span>(r+<span class="number">1</span>),begin = <span class="built_in">split</span>(l);<span class="comment">//必须先r后l,否则会RE</span></span><br><span class="line">	odt.<span class="built_in">erase</span>(begin,end);</span><br><span class="line">	odt.<span class="built_in">insert</span>(<span class="built_in">Node</span>(l,r,v));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>维护各个区间的查询均可暴力. 以区间<span class="math inline">\(k\)</span>小值和区间<span class="math inline">\(n\)</span>次方和为例</p>
<p>区间<span class="math inline">\(k\)</span>小值:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">	<span class="keyword">auto</span> end = <span class="built_in">split</span>(r+<span class="number">1</span>),begin = <span class="built_in">split</span>(l);</span><br><span class="line">	vector&lt;Node&gt;tmp;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> it = begin;it != end;it++)tmp.<span class="built_in">push_back</span>(*it);</span><br><span class="line">	<span class="built_in">sort</span>(tmp.<span class="built_in">begin</span>(),tmp.<span class="built_in">end</span>(),cmp);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> it:tmp)&#123;</span><br><span class="line">		k -= (it.r - it.l + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(k &lt;= <span class="number">0</span>)<span class="keyword">return</span> it.v;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>求<span class="math inline">\(\sum_{i = l}^ra[i]^x \mod p\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">PowSum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">	ll ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">auto</span> end = <span class="built_in">split</span>(r+<span class="number">1</span>),begin = <span class="built_in">split</span>(l);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> it = begin;it != end;it++)&#123;</span><br><span class="line">		ans = (ans + <span class="built_in">Pow</span>(it-&gt;v,x,p)%p*(it-&gt;r - it-&gt;l + <span class="number">1</span>)%p)%p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="线段树">线段树</h1>
<h2 id="单点修改区间查询线性建树">单点修改,区间查询,线性建树</h2>
<p>调用init(n)初始化.传入一个数组建树.</p>
<p>树根标号为0.</p>
<p><strong>下标从0开始</strong></p>
<p><strong>查询操作区间为[L,R).</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="comment">//root idx:0</span></span><br><span class="line">	<span class="comment">//[L,R)</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;sumv;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line">		sumv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;ll&gt; &amp; in,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(lx &lt; (<span class="keyword">int</span>)in.<span class="built_in">size</span>())sumv[x] = in[lx];</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;ll&gt; &amp; in)</span></span>&#123;</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			sumv[x] = v;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(idx &lt; m)<span class="built_in">set</span>(idx,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">set</span>(idx,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">set</span>(idx,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(lx &gt;= l <span class="keyword">and</span> rx &lt;= r)<span class="keyword">return</span> sumv[x];</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll s1 = <span class="built_in">sum</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		ll s2 = <span class="built_in">sum</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="keyword">return</span> s1+s2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sum</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="区间内第一个大于等于x的值的下标">区间内第一个大于等于x的值的下标</h3>
<p><span class="math inline">\(least(L,v)\)</span>返回<span class="math inline">\([L,n)\)</span>里第一个大于等于x的值的下标.如果题目求<span class="math inline">\([L,R]\)</span>的话特判一下下标和R的关系就行.</p>
<p>小于等于与之类似</p>
<p>再次提醒,这种写法的线段树下标从0开始</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">least</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(rx &lt;= l <span class="keyword">or</span> maxv[x] &lt; v)<span class="keyword">return</span> INF;</span><br><span class="line">	<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(maxv[x] &gt;= v)<span class="keyword">return</span> lx;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> INF;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> m = (lx + rx)/<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">int</span> a1 = <span class="built_in">least</span>(l,v,<span class="built_in">ls</span>(x),lx,m),a2 = INF;</span><br><span class="line">	<span class="keyword">if</span>(a1 == INF)a2 = <span class="built_in">least</span>(l,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">min</span>(a1,a2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">least</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">least</span>(l,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第k个1">第k个1</h3>
<p>给出一个0-1数组,求第k个1的下标.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="comment">//return the idx of kth-one</span></span><br><span class="line">	<span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> k = x,l = <span class="number">0</span>,r = size;</span><br><span class="line">	<span class="keyword">while</span>(k)&#123;</span><br><span class="line">		<span class="keyword">if</span>(r - l == <span class="number">1</span>)<span class="keyword">return</span> l;</span><br><span class="line">		<span class="keyword">int</span> lw = sumv[<span class="built_in">ls</span>(u)],rw = sumv[<span class="built_in">rs</span>(u)];</span><br><span class="line">		<span class="keyword">int</span> m = (l+r)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(lw &gt;= k)&#123;</span><br><span class="line">			u = <span class="built_in">ls</span>(u);</span><br><span class="line">			r = m;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			k -= lw;</span><br><span class="line">			u = <span class="built_in">rs</span>(u);</span><br><span class="line">			l = m;</span><br><span class="line">		&#125; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="区间合并操作">区间合并操作</h3>
<p>例:求最大连续子段和.</p>
<p>记<span class="math inline">\(seg_x\)</span>为区间<span class="math inline">\(x\)</span>的最大连续子段和.<span class="math inline">\(pre_x\)</span>为最大前缀和,<span class="math inline">\(suf_x\)</span>为最大后缀和,<span class="math inline">\(sum_x\)</span>为区间之和.</p>
<p>记<span class="math inline">\(ls\)</span>为<span class="math inline">\(x\)</span>的左儿子,<span class="math inline">\(rs\)</span>为<span class="math inline">\(x\)</span>的右儿子.</p>
<p>对于一个区间<span class="math inline">\(x\)</span>,它的<span class="math inline">\(seg\)</span>有三种可能:左子区间的<span class="math inline">\(seg\)</span>,右子区间的<span class="math inline">\(seg\)</span>,两个子区间的公共部分.因此我们有: <span class="math display">\[
seg_x = \max(seg_{ls},seg_{rs},suf_{ls}+pre_{rs})
\]</span> 对于<span class="math inline">\(pre\)</span>和<span class="math inline">\(suf\)</span>我们有: <span class="math display">\[
pre_x = max(pre_{ls},sum_{ls}+pre_{rs})\\
suf_x = max(suf_{rs},sum_{rs}+suf_{ls})
\]</span> 其他区间信息的合并与此基本相同.(本题答案为<span class="math inline">\(seg[0]\)</span>)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="comment">//root idx:0</span></span><br><span class="line">	<span class="comment">//[L,R)</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;sumv,pre,suf,seg;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line">		sumv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		pre.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		suf.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		seg.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			sumv[x] =  suf[x] = pre[x] = seg[x] = v;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(idx &lt; m)<span class="built_in">set</span>(idx,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">set</span>(idx,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">		pre[x] = <span class="built_in">max</span>(pre[<span class="built_in">ls</span>(x)],sumv[<span class="built_in">ls</span>(x)]+pre[<span class="built_in">rs</span>(x)]);</span><br><span class="line">		suf[x] = <span class="built_in">max</span>(suf[<span class="built_in">rs</span>(x)],sumv[<span class="built_in">rs</span>(x)]+suf[<span class="built_in">ls</span>(x)]);</span><br><span class="line">		seg[x] = <span class="built_in">max</span>(&#123;seg[<span class="built_in">ls</span>(x)],seg[<span class="built_in">rs</span>(x)],suf[<span class="built_in">ls</span>(x)]+pre[<span class="built_in">rs</span>(x)]&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">set</span>(idx,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="区间加-单点查询">区间加 单点查询</h2>
<h3 id="差分">差分</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P-3-E </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">4e6</span>+<span class="number">10</span>; </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Fenwick</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	ll BIT[maxn];</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		size = n+<span class="number">1</span>;</span><br><span class="line"><span class="comment">//		BIT.assign(n+1,0);</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> x &amp; -x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">		ll tans = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(d)&#123;</span><br><span class="line">			tans += BIT[d];</span><br><span class="line">			d -= <span class="built_in">lowbit</span>(d); </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> tans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> d,ll v)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(d &lt;= size)&#123;</span><br><span class="line"><span class="comment">//			cout &lt;&lt; d &lt;&lt; endl;</span></span><br><span class="line">			BIT[d] += v;</span><br><span class="line">			d += <span class="built_in">lowbit</span>(d);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">add</span>(l,v);</span><br><span class="line">		<span class="built_in">add</span>(r+<span class="number">1</span>,-v);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;; </span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	Fenwick fen;</span><br><span class="line">	<span class="keyword">int</span> n,m;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	fen.<span class="built_in">init</span>(n);</span><br><span class="line">	<span class="keyword">while</span>(m--)&#123;</span><br><span class="line">		<span class="keyword">int</span> opt,l,r,v;</span><br><span class="line">		cin &gt;&gt; opt;</span><br><span class="line">		<span class="keyword">if</span>(opt == <span class="number">1</span>)&#123;</span><br><span class="line">			cin &gt;&gt; l &gt;&gt; r &gt;&gt; v;</span><br><span class="line">			l++;</span><br><span class="line"><span class="comment">//			r--;</span></span><br><span class="line">			fen.<span class="built_in">add</span>(l,r,v);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			cin &gt;&gt; v;</span><br><span class="line">			v++;</span><br><span class="line">			cout &lt;&lt; fen.<span class="built_in">sum</span>(v)&lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="懒标记">懒标记</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span><span class="comment">//lazy tag,sum</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;addv;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line"><span class="comment">//		sumv.assign(size*2,0);</span></span><br><span class="line">		addv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; in,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			addv[x] = in[lx];</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="built_in">rs</span>(x),rx,m);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; in)</span></span>&#123;</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(lx &gt;= r <span class="keyword">or</span> l &gt;= rx)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			addv[x] += v;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)<span class="keyword">return</span> addv[x];</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(idx &lt; m)<span class="keyword">return</span> addv[x] + <span class="built_in">sum</span>(idx,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> addv[x] + <span class="built_in">sum</span>(idx,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> idx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sum</span>(idx,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="区间修改区间查询">区间修改,区间查询</h2>
<p>维护如下操作:</p>
<p><span class="math inline">\(A \space l \space r \space v\)</span>：对区间<span class="math inline">\([L,R]\)</span>进行操作<span class="math inline">\(A(l,r,v)\)</span></p>
<p><span class="math inline">\(B \space l \space r\)</span>: 查询<span class="math inline">\(B(l,r)\)</span>的值</p>
<p><span class="math inline">\(A,B\)</span>两种操作需要满足结合律;<span class="math inline">\(A\)</span>需要满足交换律(如果不满足则需要懒标记).<span class="math inline">\(A\)</span>与<span class="math inline">\(B\)</span>需满足分配律</p>
<p>形式化地,设<span class="math inline">\(\otimes\)</span>为操作<span class="math inline">\(A\)</span>,<span class="math inline">\(\odot\)</span>为操作<span class="math inline">\(B\)</span>,线段树维护的操作需要满足:</p>
<ol type="1">
<li><p><span class="math display">\[
 A \otimes B\otimes C = A \otimes (B \otimes C)\\
 A \odot B \odot C = A \odot (B \odot C)
 \]</span> { }</p></li>
<li><p><span class="math display">\[
 A \otimes B = B \otimes A
 \]</span></p></li>
<li><p><span class="math display">\[
 (A \otimes C) \odot (B \otimes C) = (A \odot B) \otimes C
 \]</span></p></li>
</ol>
<h3 id="区间加区间最小值">区间加,区间最小值</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> siz = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;addv,minv;</span><br><span class="line">	<span class="keyword">const</span> ll INF = <span class="number">1e18</span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(siz &lt; n)siz *= <span class="number">2</span>;</span><br><span class="line">		minv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0ll</span>);</span><br><span class="line">		addv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0ll</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		minv[x] = <span class="built_in">min</span>(minv[<span class="built_in">ls</span>(x)],minv[<span class="built_in">rs</span>(x)]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)<span class="keyword">return</span>;</span><br><span class="line">		ll &amp; v = addv[x];</span><br><span class="line">		<span class="keyword">if</span>(v)&#123;</span><br><span class="line">			addv[<span class="built_in">ls</span>(x)] += v;addv[<span class="built_in">rs</span>(x)] += v;</span><br><span class="line">			minv[<span class="built_in">ls</span>(x)] += v;</span><br><span class="line">			minv[<span class="built_in">rs</span>(x)] += v;</span><br><span class="line">			v = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			minv[x] += v;</span><br><span class="line">			addv[x] += v;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">Min</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> INF;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			<span class="keyword">return</span> minv[x];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll m1 = <span class="built_in">Min</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		ll m2 = <span class="built_in">Min</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">min</span>(m1,m2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">Min</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Min</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;seg;</span><br></pre></td></tr></table></figure>
<h3 id="区间乘区间求和">区间乘,区间求和</h3>
<p>初始数组均为1.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> n,size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;sumv,mulv;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		sumv[x] = rx - lx;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">build</span>(<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">build</span>(<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="built_in">build</span>(<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)&#123;</span><br><span class="line">			size *= <span class="number">2</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		sumv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0ll</span>);</span><br><span class="line">		mulv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">1ll</span>);</span><br><span class="line">		<span class="built_in">build</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> x,ll v)</span></span>&#123;</span><br><span class="line">		mulv[x] = mulv[x]*v%mod;</span><br><span class="line">		sumv[x] = sumv[x]*v%mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		sumv[x] = (sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)])%mod*mulv[x]%mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			<span class="built_in">apply</span>(x,v);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">mul</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">mul</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">mul</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			<span class="keyword">return</span> sumv[x];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll s1 = <span class="built_in">sum</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		ll s2 = <span class="built_in">sum</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="keyword">return</span> (s1+s2)%mod*mulv[x]%mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sum</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="区间加区间求和">区间加,区间求和</h3>
<p>这个比较特殊,因为<span class="math inline">\((a + x) + (b + x) = (a+b) + 2x\)</span>,所以维护修改操作时应乘上区间长度</p>
<p>同时注意区间长度的判断(sum函数最后一行,在sum里也pushdown就不需要考虑这个问题)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;addv,sumv;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line">		addv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		sumv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">apply</span><span class="params">(<span class="keyword">int</span> x,ll v,<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">		addv[x] += v;</span><br><span class="line">		sumv[x] += v*len;</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)] + addv[x]*(rx-lx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> lx,<span class="keyword">int</span> rx,<span class="keyword">int</span> x,<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(lx &gt;= r <span class="keyword">or</span> l &gt;= rx)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			<span class="built_in">apply</span>(x,v,rx - lx);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">add</span>(lx,m,<span class="built_in">ls</span>(x),l,r,v);</span><br><span class="line">		<span class="built_in">add</span>(m,rx,<span class="built_in">rs</span>(x),l,r,v);</span><br><span class="line">		<span class="built_in">pushup</span>(x,lx,rx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">add</span>(<span class="number">0</span>,size,<span class="number">0</span>,l,r,v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> lx,<span class="keyword">int</span> rx,<span class="keyword">int</span> x,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)<span class="keyword">return</span> sumv[x];</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll s1 = <span class="built_in">sum</span>(lx,m,<span class="built_in">ls</span>(x),l,r);</span><br><span class="line">		ll s2 = <span class="built_in">sum</span>(m,rx,<span class="built_in">rs</span>(x),l,r);</span><br><span class="line">		<span class="keyword">return</span> (s1+s2)+addv[x]*(<span class="built_in">min</span>(r,rx) - <span class="built_in">max</span>(l,lx));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sum</span>(<span class="number">0</span>,size,<span class="number">0</span>,l,r);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;seg;</span><br></pre></td></tr></table></figure>
<h4 id="维护等差数列区间加等差数列单点查询">维护等差数列(区间加等差数列,单点查询)</h4>
<p>​ 由于<span class="math inline">\(A_n = A_{n-1} + d\)</span>， 维护一个差分数列即可.</p>
<ul>
<li><span class="math inline">\(1 \space l \space r \space a \space d\)</span>： 将<span class="math inline">\([L,R]\)</span>加上首项<span class="math inline">\(a\)</span>公差<span class="math inline">\(d\)</span>的等差数列</li>
<li><span class="math inline">\(2\space x\)</span>: 查询位置<span class="math inline">\(x\)</span>的值</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(m--)&#123;</span><br><span class="line">    <span class="keyword">int</span> opt,l,r,a,d;</span><br><span class="line">    cin &gt;&gt; opt &gt;&gt; l;</span><br><span class="line">    <span class="keyword">if</span>(opt == <span class="number">1</span>)&#123;</span><br><span class="line">        cin &gt;&gt; r &gt;&gt; a &gt;&gt; d;</span><br><span class="line">        seg.<span class="built_in">add</span>(l,l,a);</span><br><span class="line">        seg.<span class="built_in">add</span>(r+<span class="number">1</span>,r+<span class="number">1</span>,-a);</span><br><span class="line">        seg.<span class="built_in">add</span>(l+<span class="number">1</span>,r,d);</span><br><span class="line">        seg.<span class="built_in">add</span>(r+<span class="number">1</span>,r+<span class="number">1</span>,-(r-l)*d);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> cout &lt;&lt; seg.<span class="built_in">sum</span>(<span class="number">1</span>,l) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="区间加区间大于x的第一个值">区间加,区间大于x的第一个值</h3>
<p>在线段树上二分即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;addv,maxv;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line">		addv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		maxv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		maxv[x] = <span class="built_in">max</span>(maxv[<span class="built_in">ls</span>(x)],maxv[<span class="built_in">rs</span>(x)]) + addv[x];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			addv[x] += v;</span><br><span class="line">			maxv[x] += v;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">least</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx,ll add)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx &lt;= l <span class="keyword">or</span> maxv[x] + add &lt; v)<span class="keyword">return</span> INF;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(maxv[x] + add &gt;= v)<span class="keyword">return</span> lx;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">return</span> INF;</span><br><span class="line">		&#125;</span><br><span class="line">		add += addv[x];</span><br><span class="line">		<span class="keyword">int</span> m = (lx + rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">int</span> a1 = <span class="built_in">least</span>(l,v,<span class="built_in">ls</span>(x),lx,m,add),a2 = INF;</span><br><span class="line">		<span class="keyword">if</span>(a1 == INF)a2 = <span class="built_in">least</span>(l,v,<span class="built_in">rs</span>(x),m,rx,add);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">min</span>(a1,a2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">least</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">least</span>(l,v,<span class="number">0</span>,<span class="number">0</span>,size,addv[<span class="number">0</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="区间懒标记">区间懒标记</h2>
<p>本节的区间懒标记均表示<strong>当前节点已经更新, 但当前节点的儿子节点未更新</strong></p>
<h3 id="区间赋值-区间最小值">区间赋值 区间最小值</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ll INF = <span class="number">1e10</span>+<span class="number">1</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">int</span> NO_OPT = <span class="number">1E9</span>+<span class="number">10</span>;</span><br><span class="line">	vector&lt;ll&gt;setv,minv;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line">		setv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		minv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">apply</span><span class="params">(ll &amp; a,ll b)</span></span>&#123;</span><br><span class="line">		a = (b == NO_OPT?a:b);	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(setv[x] == NO_OPT)<span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">apply</span>(setv[<span class="built_in">ls</span>(x)],setv[x]);</span><br><span class="line">		<span class="built_in">apply</span>(minv[<span class="built_in">ls</span>(x)],setv[x]);</span><br><span class="line">		<span class="built_in">apply</span>(setv[<span class="built_in">rs</span>(x)],setv[x]);</span><br><span class="line">		<span class="built_in">apply</span>(minv[<span class="built_in">rs</span>(x)],setv[x]);</span><br><span class="line">		setv[x] = NO_OPT; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		minv[x] = <span class="built_in">min</span>(minv[<span class="built_in">ls</span>(x)],minv[<span class="built_in">rs</span>(x)]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x);</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			<span class="built_in">apply</span>(setv[x],v);</span><br><span class="line">			<span class="built_in">apply</span>(minv[x],v);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">Min</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x);</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> INF;</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)<span class="keyword">return</span> minv[x];</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll m1 = <span class="built_in">Min</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		ll m2 = <span class="built_in">Min</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">min</span>(m1,m2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">Min</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Min</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>
<h3 id="区间赋值-区间加">区间赋值 区间加</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;sumv,setv;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">int</span> NO_OPT = INF+<span class="number">1</span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line">		sumv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		setv.<span class="built_in">assign</span>(size*<span class="number">2</span>,NO_OPT);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(ll &amp; a,ll b)</span></span>&#123;</span><br><span class="line">		a = (b == NO_OPT?a:b);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> len = rx - lx;</span><br><span class="line">		<span class="keyword">if</span>(len == <span class="number">1</span> <span class="keyword">or</span> setv[x] == NO_OPT)<span class="keyword">return</span>;</span><br><span class="line">		len /= <span class="number">2</span>;</span><br><span class="line">		<span class="built_in">apply</span>(setv[<span class="built_in">ls</span>(x)],setv[x]);</span><br><span class="line">		<span class="built_in">apply</span>(sumv[<span class="built_in">ls</span>(x)],setv[x]*len);</span><br><span class="line">		<span class="built_in">apply</span>(setv[<span class="built_in">rs</span>(x)],setv[x]);</span><br><span class="line">		<span class="built_in">apply</span>(sumv[<span class="built_in">rs</span>(x)],setv[x]*len);</span><br><span class="line">		setv[x] = NO_OPT;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			setv[x] = v;</span><br><span class="line">			sumv[x] = v*(rx - lx);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			<span class="keyword">return</span> sumv[x];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll s1 = <span class="built_in">sum</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		ll s2 = <span class="built_in">sum</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="keyword">return</span> s1+s2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sum</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="区间赋值-最大连续子段和区间合并">区间赋值 最大连续子段和(区间合并)</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;sumv,setv;</span><br><span class="line">	vector&lt;ll&gt;prev,sufv,segv;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">int</span> NO_OPT = INF+<span class="number">1</span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line">		sumv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		setv.<span class="built_in">assign</span>(size*<span class="number">2</span>,NO_OPT);</span><br><span class="line">		prev.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		sufv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		segv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(ll &amp; a,ll b)</span></span>&#123;</span><br><span class="line">		a = (b == NO_OPT?a:b);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> len = rx - lx;</span><br><span class="line">		<span class="keyword">if</span>(len == <span class="number">1</span> <span class="keyword">or</span> setv[x] == NO_OPT)<span class="keyword">return</span>;</span><br><span class="line">		len /= <span class="number">2</span>;</span><br><span class="line">		<span class="built_in">apply</span>(setv[<span class="built_in">ls</span>(x)],setv[x]);</span><br><span class="line">		<span class="built_in">apply</span>(sumv[<span class="built_in">ls</span>(x)],setv[x]*len);</span><br><span class="line">		<span class="built_in">apply</span>(setv[<span class="built_in">rs</span>(x)],setv[x]);</span><br><span class="line">		<span class="built_in">apply</span>(sumv[<span class="built_in">rs</span>(x)],setv[x]*len);</span><br><span class="line">		<span class="keyword">if</span>(setv[x] != NO_OPT)&#123;</span><br><span class="line">			prev[<span class="built_in">ls</span>(x)] = prev[<span class="built_in">rs</span>(x)] = setv[x]*len;</span><br><span class="line">			sufv[<span class="built_in">ls</span>(x)] = sufv[<span class="built_in">rs</span>(x)] = setv[x]*len;</span><br><span class="line">			segv[<span class="built_in">ls</span>(x)] = segv[<span class="built_in">rs</span>(x)] = setv[x]*len;</span><br><span class="line">		&#125;</span><br><span class="line">		setv[x] = NO_OPT;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">		sufv[x] = <span class="built_in">max</span>(sufv[<span class="built_in">rs</span>(x)],sufv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)]);</span><br><span class="line">		prev[x] = <span class="built_in">max</span>(prev[<span class="built_in">ls</span>(x)],prev[<span class="built_in">rs</span>(x)] + sumv[<span class="built_in">ls</span>(x)]);</span><br><span class="line">		segv[x] = <span class="built_in">max</span>(&#123;segv[<span class="built_in">ls</span>(x)],segv[<span class="built_in">rs</span>(x)],prev[<span class="built_in">rs</span>(x)] + sufv[<span class="built_in">ls</span>(x)]&#125;); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			setv[x] = v;</span><br><span class="line">			sumv[x] = v*(rx - lx);</span><br><span class="line">			<span class="keyword">if</span>(v &gt; <span class="number">0</span>)&#123;</span><br><span class="line">				segv[x] = prev[x] = sufv[x] = v*(rx - lx);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				segv[x] = prev[x] = sufv[x] = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			<span class="keyword">return</span> sumv[x];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll s1 = <span class="built_in">sum</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		ll s2 = <span class="built_in">sum</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="keyword">return</span> s1+s2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sum</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="区间取反-第k个值">区间取反 第k个值</h3>
<p>用sum来维护区间取反,每取反一次有<span class="math inline">\(sum_x = len_x - sum_x\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;sumv;</span><br><span class="line">	vector&lt;<span class="keyword">bool</span>&gt;inv,tag;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line">		sumv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		inv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span> <span class="keyword">or</span> !inv[x])<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">int</span> len = (rx - lx)/<span class="number">2</span>;</span><br><span class="line">		sumv[<span class="built_in">ls</span>(x)] = len - sumv[<span class="built_in">ls</span>(x)];</span><br><span class="line">		sumv[<span class="built_in">rs</span>(x)] = len - sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">		inv[<span class="built_in">ls</span>(x)] = !inv[<span class="built_in">ls</span>(x)];</span><br><span class="line">		inv[<span class="built_in">rs</span>(x)] = !inv[<span class="built_in">rs</span>(x)];</span><br><span class="line">		inv[x] = !inv[x];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Inv</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			inv[x] = !inv[x];</span><br><span class="line">			sumv[x] = (rx - lx) - sumv[x];</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">Inv</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">Inv</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Inv</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="built_in">Inv</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx)<span class="keyword">return</span> INF;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(sumv[x] &gt;= v)<span class="keyword">return</span> lx;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">return</span> INF;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(sumv[<span class="built_in">ls</span>(x)] &gt; v)<span class="keyword">return</span> <span class="built_in">kth</span>(l,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">kth</span>(l,v - sumv[<span class="built_in">ls</span>(x)],<span class="built_in">rs</span>(x),m,rx); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">kth</span>(l,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="多个懒标记的顺序问题">多个懒标记的顺序问题</h2>
<p>待补充.</p>
<h3 id="区间加-区间乘">区间加, 区间乘</h3>
<p>设<span class="math inline">\(addv[]\)</span>为加法懒标记, <span class="math inline">\(mulv[]\)</span>为乘法懒标记. 我们人为规定乘法懒标记优先级大于加法. 即当<span class="math inline">\(sumv[x]\)</span>和<span class="math inline">\(mulv[x]\)</span>同时存在时, 认为<span class="math inline">\(sumv[x] = mulv[x]*sumv[x] + addv[x]\)</span>.</p>
<p>则更新标记时, 加法直接<span class="math inline">\(addv[x] += v\)</span>, 乘法需要同时影响<span class="math inline">\(addv\)</span>和<span class="math inline">\(mulv\)</span>, 将二者同时乘<span class="math inline">\(v\)</span>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> siz = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;mulv,addv,sumv;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(siz &lt; n)siz *= <span class="number">2</span>;</span><br><span class="line">		mulv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">1ll</span>);</span><br><span class="line">		addv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0ll</span>);</span><br><span class="line">		sumv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0ll</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		ll len = (rx - lx)/<span class="number">2</span>;</span><br><span class="line">		ll &amp; av = addv[x],&amp; mv = mulv[x];</span><br><span class="line">		sumv[<span class="built_in">ls</span>(x)] = (sumv[<span class="built_in">ls</span>(x)]*mv % p + av*len%p)%p; </span><br><span class="line">		sumv[<span class="built_in">rs</span>(x)] = (sumv[<span class="built_in">rs</span>(x)]*mv % p + av*len%p)%p; </span><br><span class="line">		mulv[<span class="built_in">ls</span>(x)] = (mulv[<span class="built_in">ls</span>(x)]*mv)%p;</span><br><span class="line">		mulv[<span class="built_in">rs</span>(x)] = (mulv[<span class="built_in">rs</span>(x)]*mv)%p;</span><br><span class="line">		addv[<span class="built_in">ls</span>(x)] = (addv[<span class="built_in">ls</span>(x)]*mv%p + av)%p;<span class="comment">//规定乘法优先级大于加法</span></span><br><span class="line">		addv[<span class="built_in">rs</span>(x)] = (addv[<span class="built_in">rs</span>(x)]*mv%p + av)%p;		</span><br><span class="line">		av = <span class="number">0</span>,mv = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">		sumv[x] %= p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			sumv[x] = (sumv[x] + v*(rx - lx)%p)%p;</span><br><span class="line">			addv[x] += v;</span><br><span class="line">			addv[x] %= p;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		r++;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			sumv[x] = sumv[x]*v%p;</span><br><span class="line">			mulv[x] = (mulv[x]*v)%p;</span><br><span class="line">			addv[x] = (addv[x]*v)%p;<span class="comment">//规定乘法优先级大于加法</span></span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">mul</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">mul</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		r++;</span><br><span class="line">		<span class="built_in">mul</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)<span class="keyword">return</span> sumv[x]%p;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll s1 = <span class="built_in">sum</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		ll s2 = <span class="built_in">sum</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="keyword">return</span> (s1+s2)%p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		r++;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sum</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; in,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(lx &lt; (<span class="keyword">int</span>)in.<span class="built_in">size</span>())sumv[x] = in[lx]%p;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; in)</span></span>&#123;</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;seg;</span><br></pre></td></tr></table></figure>
<h3 id="区间加-区间赋值-区间求和">区间加 区间赋值 区间求和</h3>
<p>规定<span class="math inline">\(setv\)</span>的优先级大于<span class="math inline">\(addv\)</span>, 即<span class="math inline">\(sumv[x] = setv[x] + addv[x]\)</span>. 在<code>add</code>时直接加即可, 但<code>set</code>要先覆盖掉之前的<code>add</code>操作.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;setv,sumv,addv;</span><br><span class="line">	<span class="keyword">const</span> ll NO_OPT = LLONG_MAX; </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt;= n)size *= <span class="number">2</span>;</span><br><span class="line">		setv.<span class="built_in">assign</span>(size*<span class="number">2</span>,NO_OPT);</span><br><span class="line">		sumv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		addv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">int</span> len = (rx - lx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(setv[x] != NO_OPT)&#123;</span><br><span class="line">			addv[<span class="built_in">ls</span>(x)] = addv[<span class="built_in">rs</span>(x)] = <span class="number">0</span>;</span><br><span class="line">			setv[<span class="built_in">ls</span>(x)] = setv[<span class="built_in">rs</span>(x)] = setv[x];</span><br><span class="line">			sumv[<span class="built_in">ls</span>(x)] = sumv[<span class="built_in">rs</span>(x)] = setv[x]*len;</span><br><span class="line">			setv[x] = NO_OPT; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(addv[x])&#123;</span><br><span class="line">			addv[<span class="built_in">ls</span>(x)] += addv[x];</span><br><span class="line">			addv[<span class="built_in">rs</span>(x)] += addv[x];</span><br><span class="line">			sumv[<span class="built_in">ls</span>(x)] += addv[x]*len;</span><br><span class="line">			sumv[<span class="built_in">rs</span>(x)] += addv[x]*len;</span><br><span class="line">			addv[x] = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)] + addv[x]*len;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			setv[x] = v;</span><br><span class="line">			addv[x] = <span class="number">0</span>;</span><br><span class="line">			sumv[x] = v*(rx - lx);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x,rx - lx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			addv[x] += v;</span><br><span class="line">			sumv[x] += v*(rx - lx);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x,rx - lx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			<span class="keyword">return</span> sumv[x];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll s1 = <span class="built_in">sum</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		ll s2 = <span class="built_in">sum</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="keyword">return</span> s1+s2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sum</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>
<h2 id="动态开点">动态开点</h2>
<p>新增一个结构体<code>Node</code>, 存每个节点的左右儿子下标<code>ls rs</code>, 其余与普通线段树一致. 开空间时可以开得尽可能大. 设有<span class="math inline">\(m\)</span>个询问, 区间长度最大值为<span class="math inline">\(n\)</span>, 空间复杂度为<span class="math inline">\(O(m\log n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> ls,rs;</span><br><span class="line">	<span class="built_in">Node</span>()&#123;ls = rs = <span class="number">0</span>;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">void</span> <span class="built_in">init</span>(<span class="keyword">int</span> n)&#123;</span><br><span class="line">	<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;<span class="comment">//此处的n代表了区间的最大范围</span></span><br><span class="line">	setv.<span class="built_in">assign</span>(maxc,NO_OPT);<span class="comment">//注意此处是maxc不是size*2. maxc可以开得尽可能大</span></span><br><span class="line">	minv.<span class="built_in">assign</span>(maxc,<span class="number">0</span>);</span><br><span class="line">	node.<span class="built_in">assign</span>(maxc,<span class="built_in">Node</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> &amp; v = node[x].ls;</span><br><span class="line">	<span class="keyword">return</span> v?v:v = ++cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> &amp; v = node[x].rs;</span><br><span class="line">	<span class="keyword">return</span> v?v:v = ++cnt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="可持久化线段树">可持久化线段树</h2>
<h3 id="可持久化数组">可持久化数组</h3>
<p><code>set(idx = 下标,v = 值,hisver = 要修改的历史版本,curver = 当前历史版本)</code></p>
<p>具体来说, <span class="math inline">\(hisv\)</span>代表了要修改的历史版本所. 修改过后的数组会保存在<span class="math inline">\(curv\)</span>中.</p>
<p><code>get(idx = 下标,Ver = 要查询的历史版本)</code></p>
<p>时空复杂度均为<span class="math inline">\(O(q\log n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> Ls[maxc],Rs[maxc],sumv[maxc];</span><br><span class="line"><span class="keyword">int</span> hisn[maxn],ncnt = <span class="number">0</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">seg</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> Ls[x]?Ls[x]:Ls[x] = ++ncnt;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> Rs[x]?Rs[x]:Rs[x] = ++ncnt;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> v,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			sumv[x] = v;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx + rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(idx &lt; m)&#123;</span><br><span class="line">			Rs[x] = Rs[r]; </span><br><span class="line">			<span class="built_in">set</span>(idx,v,<span class="built_in">ls</span>(r),<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			Ls[x] = Ls[r];</span><br><span class="line">			<span class="built_in">set</span>(idx,v,<span class="built_in">rs</span>(r),<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> v,<span class="keyword">int</span> hisv,<span class="keyword">int</span> curv)</span></span>&#123;</span><br><span class="line">		<span class="built_in">set</span>(idx,v,hisn[hisv],hisn[curv],<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> sumv[x];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(idx &lt; m)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">get</span>(idx,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">get</span>(idx,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> ver)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">get</span>(idx,hisn[ver],<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;seg;</span><br></pre></td></tr></table></figure>
<h3 id="主席树">主席树</h3>
<p>查询静态区间k小值.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> Ls[maxc],Rs[maxc],sumv[maxc],hisn[maxc];<span class="comment">//hisn[版本号] = 对应根节点</span></span><br><span class="line"><span class="keyword">int</span> oriv[maxn];<span class="comment">//离散化前的值</span></span><br><span class="line"><span class="keyword">int</span> univ[maxn];<span class="comment">//离散化后的值</span></span><br><span class="line"><span class="keyword">int</span> raw[maxn];</span><br><span class="line"><span class="keyword">int</span> ncnt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span><span class="comment">//可持久化权值线段树</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> Ls[x]?Ls[x]:Ls[x] = ++ncnt;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> Rs[x]?Rs[x]:Rs[x] = ++ncnt;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> v,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			sumv[x] = sumv[r] + v; </span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(idx &lt; m)&#123;</span><br><span class="line">			Rs[x] = Rs[r];</span><br><span class="line">			<span class="built_in">add</span>(idx,v,<span class="built_in">ls</span>(r),<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			Ls[x] = Ls[r];</span><br><span class="line">			<span class="built_in">add</span>(idx,v,<span class="built_in">rs</span>(r),<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> v,<span class="keyword">int</span> hisv,<span class="keyword">int</span> curv)</span></span>&#123;</span><br><span class="line">		<span class="built_in">add</span>(idx,v,hisn[hisv],hisn[curv],<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> oriv[lx];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">int</span> csum = sumv[<span class="built_in">ls</span>(x)] - sumv[<span class="built_in">ls</span>(r)];</span><br><span class="line">		<span class="keyword">if</span>(k &lt;= csum)<span class="keyword">return</span> <span class="built_in">kth</span>(k,<span class="built_in">ls</span>(r),<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">kth</span>(k - csum,<span class="built_in">rs</span>(r),<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">kth</span>(k,hisn[l<span class="number">-1</span>],hisn[r],<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;seg;</span><br></pre></td></tr></table></figure>
<p>离散化部分:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;hsh;</span><br><span class="line"><span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">	cin &gt;&gt; oriv[i];</span><br><span class="line">	raw[i] = oriv[i];</span><br><span class="line">	hsh[oriv[i]] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> &amp; it:hsh)&#123;it.second = ++tmp;&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">	univ[i] = hsh[oriv[i]];</span><br><span class="line">	hisn[i] = ++ncnt;</span><br><span class="line">	seg.<span class="built_in">add</span>(univ[i],<span class="number">1</span>,i<span class="number">-1</span>,i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)oriv[univ[i]] = raw[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line">	<span class="keyword">int</span> l,r,k;</span><br><span class="line">	cin &gt;&gt; l &gt;&gt; r &gt;&gt; k;</span><br><span class="line">	cout &lt;&lt; seg.<span class="built_in">kth</span>(l,r,k) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="势能线段树segment-tree-beats">势能线段树(Segment Tree Beats)</h2>
<h3 id="part1-区间最值暴力修改">Part1: 区间最值&amp;暴力修改</h3>
<p>https://ac.nowcoder.com/acm/problem/226598</p>
<p>https://codeforces.com/blog/entry/57319</p>
<p>势能线段树则总时间复杂度为O(M×∣0势能时线段树操作时间复杂度∣+N×∣节点势能上限降低至0势能时间复杂度∣+M×∣线段树单次操作影响到的节点数目∣×∣操作额外提供的势能∣)</p>
<p>核心思想: 在能跳出的部分尽量跳出(如区间取min时, <code>maxv[x] &lt;= v</code>即可跳出)</p>
<h4 id="区间取min">区间取min</h4>
<p>给出<span class="math inline">\(n\)</span>个初始值和<span class="math inline">\(m\)</span>个操作:</p>
<p><code>0 l r v</code> 对于$ i $, <span class="math inline">\(A_i = min(A_i,v)\)</span></p>
<p><code>1 l r</code>查询区间<span class="math inline">\([L,R]\)</span>最大值</p>
<p><code>2 l r</code>查询区间<span class="math inline">\([L,R]\)</span>的和</p>
<p>令<span class="math inline">\(maxv[]\)</span>维护最大值, <span class="math inline">\(secv[]\)</span>维护严格次大值, <span class="math inline">\(cntv[]\)</span>维护最大值的个数. 每次区间取<span class="math inline">\(min\)</span>分三种情况:</p>
<ol type="1">
<li><span class="math inline">\(maxv[x] \leq v\)</span>, 直接忽略</li>
<li><span class="math inline">\(secv[x] &lt; v &lt; maxv[x]\)</span>, 将最大值改为<span class="math inline">\(v\)</span>即可.</li>
<li><span class="math inline">\(v \leq secv[x]\)</span>, 无法判断如何修改, 暴力修改其子区间.</li>
</ol>
<p>通过势能分析可得其复杂度为<span class="math inline">\(O(m \log n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sgbt</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> siz = <span class="number">1</span>;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt;maxv,cntv,secv,mintag;<span class="comment">//cntv-区间最大值的数量</span></span><br><span class="line">    vector&lt;ll&gt;sumv;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(siz &lt; n)siz *= <span class="number">2</span>;</span><br><span class="line">        maxv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">        cntv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">        secv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">-1</span>);</span><br><span class="line">        sumv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0ll</span>);</span><br><span class="line">        mintag.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">        <span class="keyword">if</span>(maxv[<span class="built_in">ls</span>(x)] == maxv[<span class="built_in">rs</span>(x)])&#123;</span><br><span class="line">            maxv[x] = maxv[<span class="built_in">ls</span>(x)];</span><br><span class="line">            secv[x] = <span class="built_in">max</span>(secv[<span class="built_in">ls</span>(x)],secv[<span class="built_in">rs</span>(x)]);</span><br><span class="line">            cntv[x] = cntv[<span class="built_in">ls</span>(x)] + cntv[<span class="built_in">rs</span>(x)];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(maxv[<span class="built_in">ls</span>(x)] &gt; maxv[<span class="built_in">rs</span>(x)])&#123;</span><br><span class="line">            maxv[x] = maxv[<span class="built_in">ls</span>(x)],cntv[x] = cntv[<span class="built_in">ls</span>(x)];</span><br><span class="line">            secv[x] = <span class="built_in">max</span>(maxv[<span class="built_in">rs</span>(x)],secv[<span class="built_in">ls</span>(x)]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            maxv[x] = maxv[<span class="built_in">rs</span>(x)],cntv[x] = cntv[<span class="built_in">rs</span>(x)];</span><br><span class="line">            secv[x] = <span class="built_in">max</span>(maxv[<span class="built_in">ls</span>(x)],secv[<span class="built_in">rs</span>(x)]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> &amp; v = mintag[x];</span><br><span class="line">        <span class="keyword">if</span>(v == <span class="number">-1</span>)<span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(maxv[<span class="built_in">ls</span>(x)] &gt; v)&#123;</span><br><span class="line">            sumv[<span class="built_in">ls</span>(x)] += <span class="number">1ll</span>*cntv[<span class="built_in">ls</span>(x)]*(v - maxv[<span class="built_in">ls</span>(x)]);</span><br><span class="line">            maxv[<span class="built_in">ls</span>(x)] = v;</span><br><span class="line">            mintag[<span class="built_in">ls</span>(x)] = v;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(maxv[<span class="built_in">rs</span>(x)] &gt; v)&#123;</span><br><span class="line">            sumv[<span class="built_in">rs</span>(x)] += <span class="number">1ll</span>*cntv[<span class="built_in">rs</span>(x)]*(v - maxv[<span class="built_in">rs</span>(x)]);</span><br><span class="line">            maxv[<span class="built_in">rs</span>(x)] = v;</span><br><span class="line">            mintag[<span class="built_in">rs</span>(x)] = v;</span><br><span class="line">        &#125;</span><br><span class="line">        v = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">smin</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(maxv[x] &lt;= v)<span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">            <span class="keyword">if</span>(secv[x] &lt; v)&#123;</span><br><span class="line">                sumv[x] += <span class="number">1ll</span>*cntv[x]*(v - maxv[x]);</span><br><span class="line">                maxv[x] = v;</span><br><span class="line">                mintag[x] = v;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">        <span class="built_in">smin</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">        <span class="built_in">smin</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">smin</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">        r++;</span><br><span class="line">        <span class="built_in">smin</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Max</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)<span class="keyword">return</span> maxv[x];</span><br><span class="line">        <span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> m1 = <span class="built_in">Max</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">        <span class="keyword">int</span> m2 = <span class="built_in">Max</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(m1,m2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Max</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">        r++;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Max</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x);</span><br><span class="line">        <span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)<span class="keyword">return</span> sumv[x];</span><br><span class="line">        <span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">        ll s1 = <span class="built_in">sum</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">        ll s2 = <span class="built_in">sum</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">        <span class="keyword">return</span> s1+s2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">        r++;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; in,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(lx &lt; (<span class="keyword">int</span>)in.<span class="built_in">size</span>())&#123;</span><br><span class="line">                sumv[x] = maxv[x] = in[lx];</span><br><span class="line">                cntv[x] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">        <span class="built_in">build</span>(in,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">        <span class="built_in">build</span>(in,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; in)</span></span>&#123;</span><br><span class="line">        <span class="built_in">build</span>(in,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="暴力修改维护区间操作单点修改">暴力修改维护区间操作+单点修改</h4>
<p>例题: <a target="_blank" rel="noopener" href="https://codeforces.com/contest/438/problem/D">CF438D - The Child and Sequence</a></p>
<p>区间取模, 区间求和, 单点赋值.</p>
<p>我们定义每个数被取模的最大次数和为线段树的总势能. 容易发现一个数<span class="math inline">\(a\)</span>的势能为<span class="math inline">\(\log a\)</span>, 线段树的总势能为<span class="math inline">\(n \log a\)</span>. 故我们暴力修改最多只需暴力修改<span class="math inline">\(n\log a\)</span>次. 对区间开根号. 总复杂度<span class="math inline">\(O(n \log^2 n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> siz = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">int</span> NO_OPT = INT_MAX;</span><br><span class="line">	vector&lt;ll&gt;sumv,maxv,modv;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(siz &lt; n)siz *= <span class="number">2</span>;</span><br><span class="line">		sumv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		maxv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		<span class="comment">// modv.assign(siz*2,NO_OPT);</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;&#125;</span><br><span class="line">	<span class="comment">// void pushdown(int x,int lx,int rx)&#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// &#125;</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; in,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(lx &lt; (<span class="keyword">int</span>)in.<span class="built_in">size</span>())&#123;</span><br><span class="line">				sumv[x] = in[lx];</span><br><span class="line">				maxv[x] = in[lx];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; in)</span></span>&#123;</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		sumv[x] = (sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)]);</span><br><span class="line">		maxv[x] = <span class="built_in">max</span>(maxv[<span class="built_in">ls</span>(x)],maxv[<span class="built_in">rs</span>(x)]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(idx &gt;= rx <span class="keyword">or</span> lx &gt; idx)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span> <span class="keyword">and</span> lx == idx)&#123;</span><br><span class="line">			maxv[x] = v;</span><br><span class="line">			sumv[x] = v;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">set</span>(idx,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">set</span>(idx,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">set</span>(idx,v,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">mod</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(maxv[x] &lt; p)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r <span class="keyword">and</span> rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			sumv[x] %= p;</span><br><span class="line">			maxv[x] = sumv[x];</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line"> 		&#125;</span><br><span class="line"> 		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line"> 		<span class="built_in">mod</span>(l,r,p,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line"> 		<span class="built_in">mod</span>(l,r,p,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line"> 		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">mod</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">		r++;</span><br><span class="line">		<span class="built_in">mod</span>(l,r,p,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)<span class="keyword">return</span> sumv[x];</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll s1 = <span class="built_in">sum</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		ll s2 = <span class="built_in">sum</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="keyword">return</span> s1+s2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		r++;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sum</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;seg;</span><br></pre></td></tr></table></figure>
<h4 id="暴力修改维护区间操作区间修改">暴力修改维护区间操作+区间修改</h4>
<p>区间开根, 区间加, 区间求和.</p>
<p>定义势能为<span class="math inline">\(C = maxv[x] - minv[x]\)</span>. 当势能为0时说明该段区间所有数均相同, 可将区间开根(或其他类似操作)改为区间赋值.</p>
<p>时间复杂度仍为<span class="math inline">\(O(n\log^2n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> siz = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">const</span> ll NO_OPT = LLONG_MAX;</span><br><span class="line">	vector&lt;ll&gt;maxv,minv,sumv,addv,setv;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(siz &lt; n)siz *= <span class="number">2</span>;</span><br><span class="line">		maxv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0ll</span>);</span><br><span class="line">		minv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0ll</span>);</span><br><span class="line">		sumv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0ll</span>);</span><br><span class="line">		addv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,<span class="number">0ll</span>);</span><br><span class="line">		setv.<span class="built_in">assign</span>(siz*<span class="number">2</span>,NO_OPT);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">1</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">		maxv[x] = <span class="built_in">max</span>(maxv[<span class="built_in">ls</span>(x)],maxv[<span class="built_in">rs</span>(x)]);</span><br><span class="line">		minv[x] = <span class="built_in">min</span>(minv[<span class="built_in">ls</span>(x)],minv[<span class="built_in">rs</span>(x)]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)<span class="keyword">return</span>;</span><br><span class="line">		ll len = (rx - lx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(setv[x] != NO_OPT)&#123;</span><br><span class="line">			ll &amp; v = setv[x];</span><br><span class="line">			sumv[<span class="built_in">ls</span>(x)] = sumv[<span class="built_in">rs</span>(x)] = v*len;</span><br><span class="line">			setv[<span class="built_in">ls</span>(x)] = setv[<span class="built_in">rs</span>(x)] = v;</span><br><span class="line">			maxv[<span class="built_in">ls</span>(x)] = minv[<span class="built_in">ls</span>(x)] = maxv[<span class="built_in">rs</span>(x)] = minv[<span class="built_in">rs</span>(x)] = v;</span><br><span class="line">			addv[<span class="built_in">ls</span>(x)] = addv[<span class="built_in">rs</span>(x)] = <span class="number">0</span>;</span><br><span class="line">			v = NO_OPT;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(addv[x])&#123;</span><br><span class="line">			ll &amp; v = addv[x];</span><br><span class="line">			addv[<span class="built_in">ls</span>(x)] += v;addv[<span class="built_in">rs</span>(x)] += v;</span><br><span class="line">			sumv[<span class="built_in">ls</span>(x)] += v*len;sumv[<span class="built_in">rs</span>(x)] += v*len;</span><br><span class="line">			maxv[<span class="built_in">ls</span>(x)] += v;maxv[<span class="built_in">rs</span>(x)] += v;</span><br><span class="line">			minv[<span class="built_in">ls</span>(x)] += v;minv[<span class="built_in">rs</span>(x)] += v;</span><br><span class="line">			v = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			addv[x] += v;</span><br><span class="line">			minv[x] += v;maxv[x] += v;</span><br><span class="line">			sumv[x] += v*(rx-lx);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v)</span></span>&#123;</span><br><span class="line">		r++;</span><br><span class="line">		<span class="built_in">add</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">sqr</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r <span class="keyword">and</span> maxv[x] == minv[x])&#123;</span><br><span class="line">			setv[x] = <span class="built_in">sqrt</span>(maxv[x]);</span><br><span class="line">			addv[x] = <span class="number">0</span>;</span><br><span class="line">			maxv[x] = minv[x] = setv[x];</span><br><span class="line">			sumv[x] = setv[x]*(rx - lx);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">sqr</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">sqr</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">sqr</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		r++;</span><br><span class="line">		<span class="built_in">sqr</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx &gt; <span class="number">1</span>)<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)<span class="keyword">return</span> sumv[x];</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll s1 = <span class="built_in">sum</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		ll s2 = <span class="built_in">sum</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">		<span class="keyword">return</span> s1+s2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		r++;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sum</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; in,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(lx &lt; (<span class="keyword">int</span>)in.<span class="built_in">size</span>())&#123;</span><br><span class="line">				minv[x] = maxv[x] = sumv[x] = in[lx];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; in)</span></span>&#123;</span><br><span class="line">		<span class="built_in">build</span>(in,<span class="number">0</span>,<span class="number">0</span>,siz);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;seg;</span><br></pre></td></tr></table></figure>
<h3 id="part2-区间历史最值维护">Part2: 区间历史最值维护</h3>
<h2 id="一些例题">一些例题</h2>
<h3 id="a">A</h3>
<p>区间赋值为0或1,求区间内1的子段个数</p>
<p>比如<code>0 1 0 1 1 0 0 1 1 1</code>答案为3</p>
<p>解法:</p>
<p>维护三个数组，<span class="math inline">\(num[x]\)</span>表示<span class="math inline">\(x\)</span>的线段个数</p>
<p><span class="math inline">\(left[x]\)</span>表示<span class="math inline">\(x\)</span>的左端点是否为1,<span class="math inline">\(right[]\)</span>同理.</p>
<p>小细节:pushup时当<code>right[ls(x)] == 1 and left[rs(x)] == 1</code>时,<code>num[x]--</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;ll&gt;sumv,setv,left,right,num;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">int</span> NO_OPT = INT_MAX;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line">		sumv.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		setv.<span class="built_in">assign</span>(size*<span class="number">2</span>,NO_OPT);</span><br><span class="line">		left.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		right.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">		num.<span class="built_in">assign</span>(size*<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(ll &amp; a,ll b)</span></span>&#123;</span><br><span class="line">		a = (b == NO_OPT?a:b);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> len = rx - lx;</span><br><span class="line">		<span class="keyword">if</span>(len == <span class="number">1</span> <span class="keyword">or</span> setv[x] == NO_OPT)<span class="keyword">return</span>;</span><br><span class="line">		len /= <span class="number">2</span>;</span><br><span class="line">		<span class="built_in">apply</span>(setv[<span class="built_in">ls</span>(x)],setv[x]);</span><br><span class="line">		<span class="built_in">apply</span>(sumv[<span class="built_in">ls</span>(x)],setv[x]*len);</span><br><span class="line">		<span class="built_in">apply</span>(setv[<span class="built_in">rs</span>(x)],setv[x]);</span><br><span class="line">		<span class="built_in">apply</span>(sumv[<span class="built_in">rs</span>(x)],setv[x]*len);</span><br><span class="line">		<span class="keyword">if</span>(setv[x])&#123;</span><br><span class="line">			num[<span class="built_in">ls</span>(x)] = num[<span class="built_in">rs</span>(x)] = <span class="number">1</span>;</span><br><span class="line">			left[<span class="built_in">ls</span>(x)] = left[<span class="built_in">rs</span>(x)] = right[<span class="built_in">ls</span>(x)] = right[<span class="built_in">rs</span>(x)] = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			num[<span class="built_in">ls</span>(x)] = num[<span class="built_in">rs</span>(x)] = <span class="number">0</span>;</span><br><span class="line">			left[<span class="built_in">ls</span>(x)] = left[<span class="built_in">rs</span>(x)] = right[<span class="built_in">ls</span>(x)] = right[<span class="built_in">rs</span>(x)] = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		setv[x] = NO_OPT;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		sumv[x] = sumv[<span class="built_in">ls</span>(x)] + sumv[<span class="built_in">rs</span>(x)];</span><br><span class="line">		left[x] = left[<span class="built_in">ls</span>(x)];</span><br><span class="line">		right[x] = right[<span class="built_in">rs</span>(x)];</span><br><span class="line">		num[x] = num[<span class="built_in">ls</span>(x)] + num[<span class="built_in">rs</span>(x)] - ((right[<span class="built_in">ls</span>(x)] <span class="keyword">and</span> left[<span class="built_in">rs</span>(x)])?<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			setv[x] = v;</span><br><span class="line">			sumv[x] = v*(rx - lx);</span><br><span class="line">			<span class="keyword">if</span>(v)&#123;</span><br><span class="line">				num[x] = <span class="number">1</span>;</span><br><span class="line">				left[x] = right[x] = <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				num[x] = <span class="number">0</span>;</span><br><span class="line">				left[x] = right[x] = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="built_in">pushup</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Set</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,ll v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">Set</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			<span class="keyword">return</span> sumv[x];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		ll s1 = <span class="built_in">sum</span>(l,r,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		ll s2 = <span class="built_in">sum</span>(l,r,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="keyword">return</span> s1+s2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">sum</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">sum</span>(l,r,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="b">B</h3>
<p><a target="_blank" rel="noopener" href="https://codeforces.com/edu/course/2/lesson/5/4/practice/contest/280801/problem/E">IOI2014-Walls</a></p>
<p>长度为<span class="math inline">\(n\)</span>的序列初始为空,维护两种操作:</p>
<ol type="1">
<li>Add(L,R,v): 将<span class="math inline">\([L,R]\)</span>中小于<span class="math inline">\(v\)</span>的值改变为<span class="math inline">\(v\)</span></li>
<li>Remove(L,R,v):将<span class="math inline">\([L,R]\)</span>中大于<span class="math inline">\(v\)</span>的值改变为<span class="math inline">\(v\)</span></li>
</ol>
<p>给出<span class="math inline">\(m\)</span>个操作,输出操作全部完成后的序列.</p>
<p><span class="math inline">\(1 \leq n \leq 2\cdot10^6,1 \leq m \leq 5\cdot10^5\)</span></p>
<p>对每个节点维护<span class="math inline">\(upv[]\)</span>和<span class="math inline">\(lowv[]\)</span>,表示该节点值的上限和下限.查询时对每个点做一次单点查询,答案为<span class="math inline">\(lowv[x]\)</span>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segtree</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> size = <span class="number">1</span>;</span><br><span class="line">	vector&lt;<span class="keyword">int</span>&gt;upv,lowv;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(size &lt; n)size *= <span class="number">2</span>;</span><br><span class="line">		upv.<span class="built_in">assign</span>(size*<span class="number">2</span>,NO_OPT);</span><br><span class="line">		lowv.<span class="built_in">assign</span>(size*<span class="number">2</span>,NO_OPT);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ls</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (x&lt;&lt;<span class="number">1</span>)+<span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>(upv[x] != NO_OPT)&#123;</span><br><span class="line">			upv[<span class="built_in">ls</span>(x)] = <span class="built_in">min</span>(upv[x],upv[<span class="built_in">ls</span>(x)]);</span><br><span class="line">			upv[<span class="built_in">rs</span>(x)] = <span class="built_in">min</span>(upv[x],upv[<span class="built_in">rs</span>(x)]);</span><br><span class="line">			<span class="keyword">if</span>(lowv[<span class="built_in">ls</span>(x)] != NO_OPT <span class="keyword">and</span> lowv[<span class="built_in">ls</span>(x)] &gt; upv[x])lowv[<span class="built_in">ls</span>(x)] = upv[x];</span><br><span class="line">			<span class="keyword">if</span>(lowv[<span class="built_in">rs</span>(x)] != NO_OPT <span class="keyword">and</span> lowv[<span class="built_in">rs</span>(x)] &gt; upv[x])lowv[<span class="built_in">rs</span>(x)] = upv[x];</span><br><span class="line">			upv[x] = NO_OPT;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(lowv[x] != NO_OPT)&#123;</span><br><span class="line">			<span class="keyword">if</span>(lowv[<span class="built_in">ls</span>(x)] != NO_OPT)lowv[<span class="built_in">ls</span>(x)] = <span class="built_in">max</span>(lowv[<span class="built_in">ls</span>(x)],lowv[x]);</span><br><span class="line">			<span class="keyword">else</span> lowv[<span class="built_in">ls</span>(x)] = lowv[x];</span><br><span class="line">			<span class="keyword">if</span>(lowv[<span class="built_in">rs</span>(x)] != NO_OPT)lowv[<span class="built_in">rs</span>(x)] = <span class="built_in">max</span>(lowv[<span class="built_in">rs</span>(x)],lowv[x]);</span><br><span class="line">			<span class="keyword">else</span> lowv[<span class="built_in">rs</span>(x)] = lowv[x];</span><br><span class="line">			<span class="keyword">if</span>(upv[<span class="built_in">ls</span>(x)] != NO_OPT <span class="keyword">and</span> upv[<span class="built_in">ls</span>(x)] &lt; lowv[x])upv[<span class="built_in">ls</span>(x)] = lowv[x];</span><br><span class="line">			<span class="keyword">if</span>(upv[<span class="built_in">rs</span>(x)] != NO_OPT <span class="keyword">and</span> upv[<span class="built_in">rs</span>(x)] &lt; lowv[x])upv[<span class="built_in">rs</span>(x)] = lowv[x];</span><br><span class="line">			lowv[x] = NO_OPT;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			upv[x] = <span class="built_in">min</span>(upv[x],v);</span><br><span class="line">			<span class="keyword">if</span>(lowv[x] != NO_OPT <span class="keyword">and</span> lowv[x] &gt; v)lowv[x] = v;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">up</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">up</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">up</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">up</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">low</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(l &gt;= rx <span class="keyword">or</span> lx &gt;= r)<span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(l &lt;= lx <span class="keyword">and</span> rx &lt;= r)&#123;</span><br><span class="line">			<span class="keyword">if</span>(lowv[x] == NO_OPT <span class="keyword">or</span> lowv[x] &lt; v)lowv[x] = v;</span><br><span class="line">			<span class="keyword">if</span>(upv[x] != NO_OPT <span class="keyword">and</span> upv[x] &gt; v)upv[x] = v;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="built_in">low</span>(l,r,v,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="built_in">low</span>(l,r,v,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">low</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line">		<span class="built_in">low</span>(l,r,v,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> idx,<span class="keyword">int</span> x,<span class="keyword">int</span> lx,<span class="keyword">int</span> rx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(idx &gt;= rx)<span class="keyword">return</span> NO_OPT;</span><br><span class="line">		<span class="built_in">pushdown</span>(x,lx,rx);</span><br><span class="line">		<span class="keyword">if</span>(rx - lx == <span class="number">1</span>)<span class="keyword">return</span> lowv[x];</span><br><span class="line">		<span class="keyword">int</span> m = (lx+rx)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(idx &lt; m)<span class="keyword">return</span> <span class="built_in">get</span>(idx,<span class="built_in">ls</span>(x),lx,m);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">get</span>(idx,<span class="built_in">rs</span>(x),m,rx);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> idx)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">get</span>(idx,<span class="number">0</span>,<span class="number">0</span>,size);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">int</span> n,m;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	segtree seg;</span><br><span class="line">	seg.<span class="built_in">init</span>(n+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">while</span>(m--)&#123;</span><br><span class="line">		<span class="keyword">int</span> opt,l,r,v;</span><br><span class="line">		r++;</span><br><span class="line">		cin &gt;&gt; opt &gt;&gt; l &gt;&gt; r &gt;&gt; v;</span><br><span class="line">		r++;</span><br><span class="line">		<span class="keyword">if</span>(opt == <span class="number">1</span>)seg.<span class="built_in">low</span>(l,r,v);</span><br><span class="line">		<span class="keyword">else</span> seg.<span class="built_in">up</span>(l,r,v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> ans = seg.<span class="built_in">get</span>(i);</span><br><span class="line">		cout &lt;&lt; (ans == NO_OPT?<span class="number">0</span>:ans) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="平衡树">平衡树</h1>
<h2 id="treap">Treap</h2>
<hr />
<p>平衡树1-Treap</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">1e9</span> + <span class="number">10</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> cnt,size,v,r;</span><br><span class="line">	Node * ch[<span class="number">2</span>];</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x)</span> <span class="keyword">const</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(x == v)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">return</span> x&lt;v?<span class="number">0</span>:<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">Node</span>()&#123;<span class="comment">//null,plz use newnode(x);</span></span><br><span class="line">		ch[<span class="number">0</span>] = ch[<span class="number">1</span>] = <span class="literal">NULL</span>;</span><br><span class="line">		cnt = size = v = r = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span></span>&#123;</span><br><span class="line">		size = ch[<span class="number">0</span>]-&gt;size +ch[<span class="number">1</span>]-&gt;size + cnt;</span><br><span class="line">	&#125; </span><br><span class="line">&#125;;</span><br><span class="line">Node * null = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line"><span class="function">Node * <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	Node * tmp = <span class="keyword">new</span> <span class="built_in">Node</span>();</span><br><span class="line">	tmp-&gt;ch[<span class="number">0</span>] = tmp-&gt;ch[<span class="number">1</span>] = null;</span><br><span class="line">	tmp-&gt;v = x;</span><br><span class="line">	tmp-&gt;r = <span class="built_in">rand</span>();</span><br><span class="line">	tmp-&gt;size = tmp-&gt;cnt = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Node * <span class="title">find</span><span class="params">(Node * o,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(o != null)&#123;</span><br><span class="line">		<span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(x);</span><br><span class="line">		<span class="keyword">if</span>(d == <span class="number">-1</span>)<span class="keyword">return</span> o;</span><br><span class="line">		<span class="keyword">else</span> o = o-&gt;ch[d];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> null;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node *&amp; o,<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">	Node * k = o-&gt;ch[d^<span class="number">1</span>];</span><br><span class="line">	o-&gt;ch[d^<span class="number">1</span>] = k-&gt;ch[d];</span><br><span class="line">	k-&gt;ch[d] = o;</span><br><span class="line">	o-&gt;<span class="built_in">maintain</span>();k-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">	o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node *&amp; o,<span class="keyword">int</span> x,<span class="keyword">int</span> c)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(o == null)o = <span class="built_in">newnode</span>(x);</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(x);</span><br><span class="line">		<span class="keyword">if</span>(d == <span class="number">-1</span>)o-&gt;cnt+=c;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">insert</span>(o-&gt;ch[d],x,c);</span><br><span class="line">			<span class="keyword">if</span>(o-&gt;ch[d]-&gt;r &gt; o-&gt;r)<span class="built_in">rotate</span>(o,d^<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(Node *&amp; o,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">find</span>(o,x) == null)<span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(x);</span><br><span class="line">	<span class="keyword">if</span>(d == <span class="number">-1</span>)&#123;</span><br><span class="line">		Node * u = o;</span><br><span class="line">		<span class="keyword">if</span>(o-&gt;cnt &gt; <span class="number">1</span>)&#123;</span><br><span class="line">			o-&gt;cnt--;</span><br><span class="line">			o-&gt;size--;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(o-&gt;ch[<span class="number">0</span>] != null <span class="keyword">and</span> o-&gt;ch[<span class="number">1</span>] != null)&#123;</span><br><span class="line">			<span class="keyword">int</span> d2 = o-&gt;ch[<span class="number">0</span>]-&gt;r &gt; o-&gt;ch[<span class="number">1</span>]-&gt;r ?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">			<span class="built_in">rotate</span>(o,d2);</span><br><span class="line">			<span class="built_in">remove</span>(o-&gt;ch[d2],x);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(o-&gt;ch[<span class="number">0</span>] == null)o = o-&gt;ch[<span class="number">1</span>];<span class="keyword">else</span> o = o-&gt;ch[<span class="number">0</span>];</span><br><span class="line">			<span class="keyword">delete</span> u;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">remove</span>(o-&gt;ch[d],x);</span><br><span class="line">	<span class="keyword">if</span>(o != null)o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(Node * o,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">	<span class="comment">//min</span></span><br><span class="line">	<span class="keyword">int</span> k1 = k;</span><br><span class="line">	<span class="keyword">while</span>(o != null)&#123;</span><br><span class="line">		<span class="keyword">int</span> s = o-&gt;ch[<span class="number">0</span>]-&gt;size;</span><br><span class="line">		<span class="keyword">if</span>(k1 &gt; s <span class="keyword">and</span> k1 &lt;= s + o-&gt;cnt)<span class="keyword">return</span> o-&gt;v;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(k1 &lt;= s) o = o-&gt;ch[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			k1 = k1 - s - o-&gt;cnt;</span><br><span class="line">			o = o-&gt;ch[<span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Rank</span><span class="params">(Node * o,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="comment">//比x小的数字个数。若不存在x则返回0</span></span><br><span class="line">	<span class="keyword">int</span> ans_ = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">find</span>(o,x) == null)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(o != null)&#123;</span><br><span class="line">		<span class="keyword">if</span>(o-&gt;v == x)&#123;</span><br><span class="line">			ans_ += <span class="number">1</span> + o-&gt;ch[<span class="number">0</span>]-&gt;size;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(o-&gt;v &gt; x)o = o-&gt;ch[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			ans_ += o-&gt;ch[<span class="number">0</span>]-&gt;size + o-&gt;cnt;</span><br><span class="line">			o = o-&gt;ch[<span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans_;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lower_bound</span><span class="params">(Node * o,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ans_ = -INF;</span><br><span class="line">	<span class="keyword">while</span>(o != null)&#123;</span><br><span class="line">		<span class="keyword">if</span>(ans_ &lt;= o-&gt;v <span class="keyword">and</span> o-&gt;v &lt; x)&#123;</span><br><span class="line">			ans_ = o-&gt;v;</span><br><span class="line">			o = o-&gt;ch[<span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> o = o-&gt;ch[<span class="number">0</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans_;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">upper_bound</span><span class="params">(Node * o,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ans_ = INF;</span><br><span class="line">	<span class="keyword">while</span>(o != null)&#123;</span><br><span class="line">		<span class="keyword">if</span>(x &lt; o-&gt;v <span class="keyword">and</span> o-&gt;v &lt; ans_)&#123;</span><br><span class="line">			ans_ = o-&gt;v;</span><br><span class="line">			o = o-&gt;ch[<span class="number">0</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> o = o-&gt;ch[<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans_;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deltree</span><span class="params">(Node *&amp; o)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(o-&gt;ch[<span class="number">0</span>] != null)<span class="built_in">deltree</span>(o-&gt;ch[<span class="number">0</span>]);</span><br><span class="line">	<span class="keyword">if</span>(o-&gt;ch[<span class="number">1</span>] != null)<span class="built_in">deltree</span>(o-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">delete</span> o;</span><br><span class="line">	o = null;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(Node *&amp; src,Node *&amp; dest)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(src-&gt;ch[<span class="number">0</span>] != null)<span class="built_in">merge</span>(src-&gt;ch[<span class="number">0</span>],dest);</span><br><span class="line">	<span class="keyword">if</span>(src-&gt;ch[<span class="number">1</span>] != null)<span class="built_in">merge</span>(src-&gt;ch[<span class="number">1</span>],dest);</span><br><span class="line">	<span class="built_in">insert</span>(dest,src-&gt;v,src-&gt;cnt);</span><br><span class="line">	<span class="keyword">delete</span> src;</span><br><span class="line">	src = null;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h1 id="字符串">字符串</h1>
<h2 id="读入">读入</h2>
<h3 id="读入一行">读入一行</h3>
<h4 id="getline">getline</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string s;</span><br><span class="line"><span class="built_in">getline</span>(cin,s);</span><br></pre></td></tr></table></figure>
<h3 id="sstream">sstream</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">string s;</span><br><span class="line">stringstream ss;</span><br><span class="line"><span class="keyword">int</span> a, b, c;</span><br><span class="line"><span class="built_in">getline</span>(cin, s);</span><br><span class="line">ss.<span class="built_in">clear</span>();</span><br><span class="line">ss.<span class="built_in">str</span>(s);</span><br><span class="line">ss &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br></pre></td></tr></table></figure>
<h2 id="kmp">KMP</h2>
<p><span class="math inline">\(Next[i]\)</span>表示自<span class="math inline">\(i\)</span>结束(不包括<span class="math inline">\(i\)</span>)的子串中前后缀相同的长度</p>
<p>例如：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">i</th>
<th style="text-align: center;">0</th>
<th style="text-align: center;">1</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">3</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">6</th>
<th style="text-align: center;">7</th>
<th style="text-align: center;">8</th>
<th style="text-align: center;">9</th>
<th style="text-align: center;">10</th>
<th style="text-align: center;">11</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(s[i]\)</span></td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">R</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">C</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">D</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">B</td>
<td style="text-align: center;">R</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">\</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(Next[i]\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">4</td>
</tr>
</tbody>
</table>
<p>可以看出<span class="math inline">\([i - Next[i],i - 1]\)</span>这一段的前后缀是相同的</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> Next[<span class="number">1000010</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getFail</span><span class="params">(string P)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> p_size = P.<span class="built_in">size</span>();</span><br><span class="line">	Next[<span class="number">0</span>] = Next[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; p_size;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> j = Next[i];</span><br><span class="line">		<span class="keyword">while</span>(j <span class="keyword">and</span> P[i] != P[j])j = Next[j];</span><br><span class="line">		Next[i+<span class="number">1</span>] = (P[j] == P[i]?j+<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">KMP</span><span class="params">(string T,string P)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> t_size = T.<span class="built_in">size</span>(),p_size = P.<span class="built_in">size</span>();</span><br><span class="line">	<span class="built_in">getFail</span>(P);</span><br><span class="line">	<span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; t_size;i++)&#123;</span><br><span class="line">		<span class="keyword">while</span>(j <span class="keyword">and</span> P[j] != T[i])j = Next[j];</span><br><span class="line">		<span class="keyword">if</span>(P[j] == T[i])j++;</span><br><span class="line">		<span class="keyword">if</span>(j == p_size)&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,i - p_size + <span class="number">2</span>);</span><br><span class="line">			j = Next[j];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="manacher">Manacher</h2>
<p>最长连续回文子串</p>
<p><span class="math inline">\(len[i] - 1\)</span>表示以i为中心的最长回文串一半的长度(不包括中心)</p>
<p>返回最长连续回文子串的长度</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Manacher</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> len[maxn];</span><br><span class="line">	string raw = <span class="string">&quot;~&quot;</span>;</span><br><span class="line">	<span class="keyword">int</span> ic = <span class="number">0</span>,im = <span class="number">0</span>,ir = <span class="number">0</span>,ans = <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(string s = <span class="string">&quot;&quot;</span>)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; s.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">			raw += <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">			raw += s[i];</span><br><span class="line">		&#125;</span><br><span class="line">		raw += <span class="string">&quot;|!&quot;</span>;</span><br><span class="line"><span class="comment">//		cout &lt;&lt; raw &lt;&lt; endl;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> l = raw.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; l;i++)&#123;</span><br><span class="line">			len[i] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span>(i &lt; ir)&#123;</span><br><span class="line">				im = <span class="number">2</span>*ic-i;</span><br><span class="line">				len[i] = <span class="built_in">min</span>(ir-i,len[im]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">while</span>(raw[i-len[i]] == raw[i+len[i]])len[i]++;</span><br><span class="line">			<span class="keyword">if</span>(i + len[i] &gt; ir)ic = i,ir = i + len[i];</span><br><span class="line">			<span class="keyword">if</span>(len[i] &gt; len[ic])ic = i;</span><br><span class="line">			ans = <span class="built_in">max</span>(len[i],ans);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">char</span> x:raw)cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> ans<span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;yay;</span><br></pre></td></tr></table></figure>
<h2 id="字符串hash-滚动hash">字符串hash (滚动hash)</h2>
<p>​ <span class="math inline">\(H[x]\)</span>为hash值,<span class="math inline">\(xp[d]\)</span>为<span class="math inline">\(x^d\)</span>,<span class="math inline">\(x\)</span>为底数(随便取一个就行),<span class="math inline">\(s\)</span>为字符串.用ull自然溢出来-1s</p>
<p>​ 递推式:<span class="math inline">\(H[i] = H[i-1] \cdot x + (s[i] - &#39;a&#39;)\)</span></p>
<p>​ 查询以<span class="math inline">\(i\)</span>开始长度为<span class="math inline">\(L\)</span>的字符串的hash:$Hash(i,L) = H[i + L - 1] - (H[i-1] xp[L]) $</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ull xp[maxn],H[maxn];</span><br><span class="line"><span class="comment">//预处理x的幂</span></span><br><span class="line">xp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; maxn;i++)xp[i] = xp[i<span class="number">-1</span>]*x; </span><br><span class="line"><span class="comment">//预处理hash</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)H[i] = H[i<span class="number">-1</span>]*x + s[i<span class="number">-1</span>] - <span class="string">&#x27;a&#x27;</span> + <span class="number">1</span>;</span><br><span class="line"><span class="comment">//Hash(i,L)</span></span><br><span class="line"><span class="function">ull <span class="title">Hash</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> L)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> H[x+L<span class="number">-1</span>] - H[x<span class="number">-1</span>]*xp[L];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="后缀数组">后缀数组</h2>
<p><strong>一晚上速成的垃圾内容 需要细致的重构</strong></p>
<p>注意字符串下标均从0开始</p>
<p><span class="math inline">\(sa\)</span>为后缀数组, <code>sa[i]</code>表示将所有后缀排序后第<span class="math inline">\(i\)</span>小的后缀的编号</p>
<p><code>sa[]</code>的示意图:(p为sa, 下标从0开始)</p>
<p><code>lcp[]</code>的下标从1开始</p>
<p><img src="E:\Github\hexo\source\_posts\image-20211017100809132.png" alt="image-20211017100809132" style="zoom:33%;" /></p>
<p><span class="math inline">\(lcp[i]\)</span>为<span class="math inline">\(s[sa[i]...]\)</span>和<span class="math inline">\(s[sa[i-1]...]\)</span>的最长公共前缀长度(等同于lrj蓝书上的<span class="math inline">\(height\)</span></p>
<p><span class="math inline">\(c\)</span>为等价类,迭代结束后<span class="math inline">\(c\)</span>等同于<span class="math inline">\(rank\)</span>,<span class="math inline">\(c[i]\)</span>代表第<span class="math inline">\(i\)</span>个后缀在<span class="math inline">\(sa\)</span>中的下标</p>
<p>调用时通过<span class="math inline">\(SA(string)\)</span>初始化,<span class="math inline">\(cal()\)</span>计算sa,<span class="math inline">\(getlcp\)</span>计算lcp.</p>
<p><span class="math inline">\(LCP(i,j)\)</span>返回后缀i和j的LCP.</p>
<p>注意LCP和ST用的是数组而不是vector</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> a,b;</span><br><span class="line">	<span class="built_in">Node</span>(<span class="keyword">int</span> a = <span class="number">0</span>,<span class="keyword">int</span> b = <span class="number">0</span>):<span class="built_in">a</span>(a),<span class="built_in">b</span>(b)&#123;&#125;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node &amp; x)&#123;</span><br><span class="line">		<span class="keyword">return</span> a == x.a?b &lt; x.b:a &lt; x.a;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;; </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SA</span>&#123;</span></span><br><span class="line">	string s;</span><br><span class="line">	<span class="keyword">int</span> n;</span><br><span class="line">	vector&lt;<span class="keyword">int</span>&gt;sa,c;</span><br><span class="line">	<span class="keyword">int</span> lcp[maxn],ST[maxn][<span class="number">20</span>];</span><br><span class="line">	<span class="built_in">SA</span>(string s = <span class="string">&quot;&quot;</span>):<span class="built_in">s</span>(s)&#123;</span><br><span class="line">		s += <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">		n = s.<span class="built_in">size</span>();</span><br><span class="line">		sa.<span class="built_in">assign</span>(n,<span class="number">0</span>);</span><br><span class="line">		c.<span class="built_in">assign</span>(n,<span class="number">0</span>); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">count_sort</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; sa,vector&lt;<span class="keyword">int</span>&gt; &amp; c)</span></span>&#123;</span><br><span class="line">		vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">pos</span>(n),<span class="built_in">cnt</span>(n),<span class="built_in">sa_new</span>(n);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x:c)cnt[x]++;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)pos[i] = pos[i<span class="number">-1</span>] + cnt[i<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x:sa)&#123;</span><br><span class="line">			<span class="keyword">int</span> d = c[x];</span><br><span class="line">			sa_new[pos[d]] = x;</span><br><span class="line">			pos[d]++;</span><br><span class="line">		&#125;</span><br><span class="line">		sa = sa_new;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//init</span></span><br><span class="line">		&#123;</span><br><span class="line">			vector&lt;Node&gt;<span class="built_in">A</span>(n);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)A[i] = <span class="built_in">Node</span>(s[i],i);</span><br><span class="line">			<span class="built_in">sort</span>(A.<span class="built_in">begin</span>(),A.<span class="built_in">end</span>());</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = A[i].b;</span><br><span class="line">			c[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">				c[sa[i]] = c[sa[i<span class="number">-1</span>]] + (A[i].a != A[i<span class="number">-1</span>].a);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;k) &lt; n)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = (sa[i] - (<span class="number">1</span>&lt;&lt;k) + n)%n;</span><br><span class="line">			<span class="built_in">count_sort</span>(sa,c);</span><br><span class="line">			vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">c_new</span>(n);</span><br><span class="line">			c_new[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">				pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;now = &#123;c[sa[i]],c[(sa[i] + (<span class="number">1</span>&lt;&lt;k)) % n]&#125;;</span><br><span class="line">				pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;prev = &#123;c[sa[i<span class="number">-1</span>]],c[(sa[i<span class="number">-1</span>] + (<span class="number">1</span>&lt;&lt;k)) % n]&#125;;</span><br><span class="line">				c_new[sa[i]] = c_new[sa[i<span class="number">-1</span>]] + (now != prev);</span><br><span class="line">			&#125;</span><br><span class="line">			k++;</span><br><span class="line">			c = c_new;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ST_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)ST[i][<span class="number">0</span>] = lcp[i];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j) &lt;= n;j++)</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i + (<span class="number">1</span>&lt;&lt;j) <span class="number">-1</span> &lt;= n;i++)</span><br><span class="line">				ST[i][j] = <span class="built_in">min</span>(ST[i][j - <span class="number">1</span>],ST[i + (<span class="number">1</span>&lt;&lt;(j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">LCP</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</span><br><span class="line">		L = c[L],R = c[R];</span><br><span class="line">		<span class="keyword">if</span>(L &gt; R)<span class="built_in">swap</span>(L,R);</span><br><span class="line">		L++;</span><br><span class="line">		<span class="keyword">int</span> k = <span class="built_in">log2</span>(R - L + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">min</span>(ST[L][k],ST[R - (<span class="number">1</span>&lt;&lt;k) + <span class="number">1</span>][k]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">getlcp</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n<span class="number">-1</span>;i++)&#123;</span><br><span class="line">			<span class="keyword">int</span> j = sa[c[i] - <span class="number">1</span>];</span><br><span class="line">			<span class="keyword">while</span>(s[i+k] == s[j+k])k++;</span><br><span class="line">			lcp[c[i]] = k;</span><br><span class="line">			<span class="keyword">if</span>(k)k--;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">ST_init</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,sa[i]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,lcp[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">lower_bound</span><span class="params">(string x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> k = x.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">int</span> L = <span class="number">0</span>,R = n,M;</span><br><span class="line">		<span class="keyword">while</span>(L &lt; R)&#123;</span><br><span class="line">			M = (L+R)/<span class="number">2</span>;</span><br><span class="line">			string u = s.<span class="built_in">substr</span>(sa[M],k);</span><br><span class="line">			<span class="keyword">if</span>(u &gt;= x)R = M;</span><br><span class="line">			<span class="keyword">else</span> L = M+<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> L;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">upper_bound</span><span class="params">(string x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> k = x.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">int</span> L = <span class="number">0</span>,R = n,M;</span><br><span class="line">		<span class="keyword">while</span>(L &lt; R)&#123;</span><br><span class="line">			M = (L+R)/<span class="number">2</span>;</span><br><span class="line">			string u = s.<span class="built_in">substr</span>(sa[M],k);</span><br><span class="line">			<span class="keyword">if</span>(u &lt;= x)L = M+<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">else</span> R = M;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> L;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">(string x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">upper_bound</span>(x) - <span class="built_in">lower_bound</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>附上个不用vector的,留着给POJ这种0202年还不兹磁C++11的OJ用(注意下标依旧从0开始)</p>
<p><strong>如果T了的话把pair改成自己写的结构体.pair排序很慢</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> sa[maxn],pos[maxn],cnt[maxn],sa_new[maxn],c[maxn],c_new[maxn];</span><br><span class="line">pair&lt;<span class="keyword">char</span>,<span class="keyword">int</span>&gt;A[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SA</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//init</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)A[i] = &#123;s[i],i&#125;;</span><br><span class="line">		<span class="built_in">sort</span>(A,A+n);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = A[i].second;</span><br><span class="line">		c[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">			c[sa[i]] = c[sa[i<span class="number">-1</span>]] + (A[i].first != A[i<span class="number">-1</span>].first);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;k) &lt; n)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = (sa[i] - (<span class="number">1</span>&lt;&lt;k) + n)%n;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)cnt[i] = pos[i] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)cnt[c[i]]++;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)pos[i] = pos[i<span class="number">-1</span>] + cnt[i<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa_new[pos[c[sa[i]]]++] = sa[i];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = sa_new[i];</span><br><span class="line">		c_new[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">			c_new[sa[i]] = c_new[sa[i<span class="number">-1</span>]] + (c[sa[i]] != c[sa[i<span class="number">-1</span>]] <span class="keyword">or</span> c[(sa[i] + (<span class="number">1</span>&lt;&lt;k)) % n] != c[(sa[i<span class="number">-1</span>] + (<span class="number">1</span>&lt;&lt;k)) % n]);</span><br><span class="line">		&#125;</span><br><span class="line">		k++;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)c[i] = c_new[i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="应用">应用</h3>
<h4 id="循环拼接">循环拼接</h4>
<p>对字符串<span class="math inline">\(s\)</span>的每个循环节进行排序</p>
<p>例如 <code>s = "abacba"</code></p>
<p>即为对<code>"abacba","bacbaa","acbaab","cbaaba","baabac","aabacb"</code>进行排序</p>
<p>解法:将字符串本身拼接在其后面, 求<span class="math inline">\(s+s\)</span>的后缀数组即可.</p>
<h4 id="在线模式匹配">在线模式匹配</h4>
<p>每个字符串均为某些字符串的后缀的前缀. 假设模式串为<span class="math inline">\(t\)</span>, 长度为<span class="math inline">\(|t|\)</span>, 那么我们只需根据后缀数组在文本串<span class="math inline">\(s\)</span>中找到长度为<span class="math inline">\(|k|\)</span>的后缀的前缀, 二分即可</p>
<p>每次查找复杂度:<span class="math inline">\(O(|t|logn)\)</span></p>
<p>文本串为<span class="math inline">\(s\)</span>, 模式串为<span class="math inline">\(t\)</span>.调用<code>check(t)</code>即可.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">check</span><span class="params">(string x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k = x.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">int</span> L = <span class="number">0</span>,R = n,M;</span><br><span class="line">    <span class="keyword">while</span>(L &lt;= R)&#123;</span><br><span class="line">        M = (L+R)/<span class="number">2</span>;</span><br><span class="line">        string u = s.<span class="built_in">substr</span>(sa[M],k);</span><br><span class="line">        <span class="keyword">if</span>(u == x)<span class="keyword">return</span> sa[M];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(u &lt; x)L = M+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> R = M<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="统计字符串t在s中出现次数可重叠">统计字符串t在s中出现次数(可重叠)</h4>
<p>思想同上.二分出上下界即可</p>
<p>代码见模板部分的<code>count()</code></p>
<h4 id="从字符串首尾取字符-使新串字典序最小">从字符串首尾取字符, 使新串字典序最小</h4>
<p>当首尾字符不等时,显然取最小的最优.</p>
<p>当首尾字符相等时,需要判断由<span class="math inline">\(L\)</span>开始的子串和由<span class="math inline">\(R\)</span>开始的反子串的字典序大小,并取其中小的那个.</p>
<p>暴力求最坏需要<span class="math inline">\(O(n)\)</span>, 而后缀数组可以做到<span class="math inline">\(O(1)\)</span>判断. 我们在<span class="math inline">\(s\)</span>后加上一个<span class="math inline">\(s\)</span>中未出现的字符,再将<span class="math inline">\(s\)</span>反转之后的<span class="math inline">\(s&#39;\)</span>拼在其后.对新的<span class="math inline">\(s|s&#39;\)</span>求后缀数组.</p>
<p>由<span class="math inline">\(L\)</span>开始的子串排名为<span class="math inline">\(rank[L]\)</span>, 由<span class="math inline">\(R\)</span>开始的反子串排名为<span class="math inline">\(rank[N - 2 - R]\)</span>. (<span class="math inline">\(N\)</span>为<span class="math inline">\(s|s&#39;\)</span>的长度. -2是因为我们在两个串中间拼接了一个特殊字符)</p>
<p>例题:[USACO07DEC]Best Cow Line G</p>
<p>输入一个整数<span class="math inline">\(n\)</span>,接下来<span class="math inline">\(n\)</span>行每行一个字符.</p>
<p>输出从字符串首尾取字符, 能得到的最小字典序的新串.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P2870</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> s[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SA</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> n;</span><br><span class="line">	vector&lt;<span class="keyword">int</span>&gt;sa,c;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">count_sort</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; sa,vector&lt;<span class="keyword">int</span>&gt; &amp; c)</span></span>&#123;</span><br><span class="line">		vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">pos</span>(n),<span class="built_in">cnt</span>(n),<span class="built_in">sa_new</span>(n);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x:c)cnt[x]++;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)pos[i] = pos[i<span class="number">-1</span>] + cnt[i<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x:sa)&#123;</span><br><span class="line">			<span class="keyword">int</span> d = c[x];</span><br><span class="line">			sa_new[pos[d]] = x;</span><br><span class="line">			pos[d]++;</span><br><span class="line">		&#125;</span><br><span class="line">		sa = sa_new;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa.<span class="built_in">push_back</span>(<span class="number">0</span>),c.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">		<span class="comment">//init</span></span><br><span class="line">		&#123;</span><br><span class="line">			vector&lt;pair&lt;<span class="keyword">char</span>,<span class="keyword">int</span>&gt; &gt;<span class="built_in">A</span>(n);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)A[i] = &#123;s[i],i&#125;;</span><br><span class="line">			<span class="built_in">sort</span>(A.<span class="built_in">begin</span>(),A.<span class="built_in">end</span>());</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = A[i].second;</span><br><span class="line">			c[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">				c[sa[i]] = c[sa[i<span class="number">-1</span>]] + (A[i].first != A[i<span class="number">-1</span>].first);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;k) &lt; n)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = (sa[i] - (<span class="number">1</span>&lt;&lt;k) + n)%n;</span><br><span class="line">			<span class="built_in">count_sort</span>(sa,c);</span><br><span class="line">			vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">c_new</span>(n);</span><br><span class="line">			c_new[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">				pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;now = &#123;c[sa[i]],c[(sa[i] + (<span class="number">1</span>&lt;&lt;k)) % n]&#125;;</span><br><span class="line">				pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;prev = &#123;c[sa[i<span class="number">-1</span>]],c[(sa[i<span class="number">-1</span>] + (<span class="number">1</span>&lt;&lt;k)) % n]&#125;;</span><br><span class="line">				c_new[sa[i]] = c_new[sa[i<span class="number">-1</span>]] + (now != prev);</span><br><span class="line">			&#125;</span><br><span class="line">			k++;</span><br><span class="line">			c = c_new;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,sa[i]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n,N;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)cin &gt;&gt; s[i];</span><br><span class="line">	s[n] = <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">	<span class="keyword">int</span> idx = n+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = n<span class="number">-1</span>;i &gt;= <span class="number">0</span>;i--)s[idx++] = s[i];</span><br><span class="line">	N = <span class="number">2</span>*(n+<span class="number">1</span>);</span><br><span class="line">	SA yay;</span><br><span class="line">	yay.n = N;</span><br><span class="line">	yay.<span class="built_in">cal</span>();</span><br><span class="line">	<span class="keyword">int</span> L = <span class="number">0</span>,R = n<span class="number">-1</span>,cnt = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(L &lt;= R)&#123;</span><br><span class="line">		<span class="keyword">if</span>(yay.c[L] &lt; yay.c[N - <span class="number">2</span> - R])cout &lt;&lt; s[L++];</span><br><span class="line">		<span class="keyword">else</span> cout &lt;&lt; s[R--];</span><br><span class="line">		cnt++;</span><br><span class="line">		<span class="keyword">if</span>(cnt%<span class="number">80</span> == <span class="number">0</span>)cout &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="lcp的应用">LCP的应用</h3>
<h4 id="最长公共子串">最长公共子串</h4>
<p>给出两个字符串<span class="math inline">\(s,t\)</span>, 求它们的最长公共连续子串.</p>
<p>我们在<span class="math inline">\(s\)</span>和<span class="math inline">\(t\)</span>之间拼接一个未出现的特殊字符, 然后求LCP.将后缀分为两类:从<span class="math inline">\(s\)</span>开始的后缀和从<span class="math inline">\(t\)</span>开始的.显然答案为<span class="math inline">\(\max\{LCP[i]\},i与i-1为不同类\)</span></p>
<p>代码:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P-5-B </span></span><br><span class="line"><span class="comment">//SA</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> a,b;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SA</span>&#123;</span></span><br><span class="line">	string s;</span><br><span class="line">	<span class="keyword">int</span> n;</span><br><span class="line">	vector&lt;<span class="keyword">int</span>&gt;sa,c;</span><br><span class="line">	<span class="keyword">int</span> lcp[maxn],ST[maxn][<span class="number">20</span>];</span><br><span class="line">	<span class="built_in">SA</span>(string s = <span class="string">&quot;&quot;</span>):<span class="built_in">s</span>(s)&#123;</span><br><span class="line">		s += <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">		n = s.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa.<span class="built_in">push_back</span>(<span class="number">0</span>),c.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">count_sort</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; sa,vector&lt;<span class="keyword">int</span>&gt; &amp; c)</span></span>&#123;</span><br><span class="line">		vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">pos</span>(n),<span class="built_in">cnt</span>(n),<span class="built_in">sa_new</span>(n);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x:c)cnt[x]++;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)pos[i] = pos[i<span class="number">-1</span>] + cnt[i<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x:sa)&#123;</span><br><span class="line">			<span class="keyword">int</span> d = c[x];</span><br><span class="line">			sa_new[pos[d]] = x;</span><br><span class="line">			pos[d]++;</span><br><span class="line">		&#125;</span><br><span class="line">		sa = sa_new;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//init</span></span><br><span class="line">		&#123;</span><br><span class="line">			vector&lt;pair&lt;<span class="keyword">char</span>,<span class="keyword">int</span>&gt; &gt;<span class="built_in">A</span>(n);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)A[i] = &#123;s[i],i&#125;;</span><br><span class="line">			<span class="built_in">sort</span>(A.<span class="built_in">begin</span>(),A.<span class="built_in">end</span>());</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = A[i].second;</span><br><span class="line">			c[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">				c[sa[i]] = c[sa[i<span class="number">-1</span>]] + (A[i].first != A[i<span class="number">-1</span>].first);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;k) &lt; n)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = (sa[i] - (<span class="number">1</span>&lt;&lt;k) + n)%n;</span><br><span class="line">			<span class="built_in">count_sort</span>(sa,c);</span><br><span class="line">			vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">c_new</span>(n);</span><br><span class="line">			c_new[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">				pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;now = &#123;c[sa[i]],c[(sa[i] + (<span class="number">1</span>&lt;&lt;k)) % n]&#125;;</span><br><span class="line">				pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;prev = &#123;c[sa[i<span class="number">-1</span>]],c[(sa[i<span class="number">-1</span>] + (<span class="number">1</span>&lt;&lt;k)) % n]&#125;;</span><br><span class="line">				c_new[sa[i]] = c_new[sa[i<span class="number">-1</span>]] + (now != prev);</span><br><span class="line">			&#125;</span><br><span class="line">			k++;</span><br><span class="line">			c = c_new;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ST_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)ST[i][<span class="number">0</span>] = lcp[i];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j) &lt;= n;j++)</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i + (<span class="number">1</span>&lt;&lt;j) <span class="number">-1</span> &lt;= n;i++)</span><br><span class="line">				ST[i][j] = <span class="built_in">min</span>(ST[i][j - <span class="number">1</span>],ST[i + (<span class="number">1</span>&lt;&lt;(j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">LCP</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</span><br><span class="line">		L = c[L],R = c[R];</span><br><span class="line">		<span class="keyword">if</span>(L &gt; R)<span class="built_in">swap</span>(L,R);</span><br><span class="line">		L++;</span><br><span class="line">		<span class="keyword">int</span> k = <span class="built_in">log2</span>(R - L + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">min</span>(ST[L][k],ST[R - (<span class="number">1</span>&lt;&lt;k) + <span class="number">1</span>][k]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">getlcp</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n<span class="number">-1</span>;i++)&#123;</span><br><span class="line">			<span class="keyword">int</span> j = sa[c[i] - <span class="number">1</span>];</span><br><span class="line">			<span class="keyword">while</span>(s[i+k] == s[j+k])k++;</span><br><span class="line">			lcp[c[i]] = k;</span><br><span class="line">			<span class="keyword">if</span>(k)k--;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">ST_init</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> idx = <span class="number">0</span>,len = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">			<span class="keyword">int</span> now = n - <span class="number">1</span> - sa[i],pre = n - <span class="number">1</span> - sa[i<span class="number">-1</span>];</span><br><span class="line">			<span class="keyword">if</span>((pre &gt; b <span class="keyword">and</span> now &lt;= b) <span class="built_in"><span class="keyword">or</span></span> (pre &lt;= b <span class="keyword">and</span> now &gt; b))&#123;</span><br><span class="line">				<span class="keyword">if</span>(len &lt; lcp[i])&#123;</span><br><span class="line">					idx = sa[i];len = lcp[i];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		cout &lt;&lt; s.<span class="built_in">substr</span>(idx,len);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">lower_bound</span><span class="params">(string x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> k = x.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">int</span> L = <span class="number">0</span>,R = n,M;</span><br><span class="line">		<span class="keyword">while</span>(L &lt; R)&#123;</span><br><span class="line">			M = (L+R)/<span class="number">2</span>;</span><br><span class="line">			string u = s.<span class="built_in">substr</span>(sa[M],k);</span><br><span class="line">			<span class="keyword">if</span>(u &gt;= x)R = M;</span><br><span class="line">			<span class="keyword">else</span> L = M+<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> L;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">upper_bound</span><span class="params">(string x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> k = x.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">int</span> L = <span class="number">0</span>,R = n,M;</span><br><span class="line">		<span class="keyword">while</span>(L &lt; R)&#123;</span><br><span class="line">			M = (L+R)/<span class="number">2</span>;</span><br><span class="line">			string u = s.<span class="built_in">substr</span>(sa[M],k);</span><br><span class="line">			<span class="keyword">if</span>(u &lt;= x)L = M+<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">else</span> R = M;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> L;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">(string x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">upper_bound</span>(x) - <span class="built_in">lower_bound</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	string s,t;</span><br><span class="line">	cin &gt;&gt; s &gt;&gt; t;</span><br><span class="line">	a = s.<span class="built_in">size</span>(),b = t.<span class="built_in">size</span>();</span><br><span class="line">	s = s+<span class="string">&#x27;#&#x27;</span>+t;</span><br><span class="line">	<span class="function">SA <span class="title">yay</span><span class="params">(s)</span></span>;</span><br><span class="line">	yay.<span class="built_in">cal</span>();</span><br><span class="line">	yay.<span class="built_in">getlcp</span>();</span><br><span class="line">	yay.<span class="built_in">output</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="两子串最长公共前缀">两子串最长公共前缀</h4>
<p><span class="math display">\[
LCP(sa[i],sa[j]) = min\{lcp[i+1],...,lcp[j]\}
\]</span></p>
<p>于是就转化成了RMQ问题.</p>
<p>具体代码见模板中的<code>LCP()</code></p>
<h4 id="比较一个字符中两子串的关系">比较一个字符中两子串的关系</h4>
<p>设需要比较<span class="math inline">\(A = s[a...b]\)</span>和<span class="math inline">\(B = s[c...d]\)</span>的关系.</p>
<p>若<span class="math inline">\(lcp(a,c) \ge \min(|A|,|B|)\)</span>,则<span class="math inline">\(A &lt; B\)</span>等价于<span class="math inline">\(|A| &lt; |B|\)</span></p>
<p>否则, <span class="math inline">\(A &lt; B\)</span>等价于<span class="math inline">\(rank[a] &lt; rank[b]\)</span></p>
<h4 id="不同子串的数目">不同子串的数目</h4>
<p><span class="math display">\[
\frac{n(n+1)}{2} - \sum_{i = 1}^n lcp[i]
\]</span></p>
<p>怎么推的忘了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ll ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">    ans += n - sa[i] - <span class="number">1</span> - lcp[i];</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; ans;</span><br></pre></td></tr></table></figure>
<h4 id="出现至少k次的子串的最大长度">出现至少k次的子串的最大长度</h4>
<p>首先<span class="math inline">\(lcp[i]\)</span>表示<span class="math inline">\(sa[i]\)</span>和<span class="math inline">\(sa[i-1]\)</span>的最大公共长度</p>
<p>那么相邻的<span class="math inline">\(k-1\)</span>个<span class="math inline">\(lcp\)</span>的最小值就是该子串出现<span class="math inline">\(k\)</span>次的最大公共长度.</p>
<p>所以我们求出相邻<span class="math inline">\(k-1\)</span>个<span class="math inline">\(lcp\)</span>的最小值, 再求这些最小值的最大值就是答案</p>
<p>可以用单调队列或者单调栈在<span class="math inline">\(O(n)\)</span>时间内解决.</p>
<p>例题: [USACO06DEC]Milk Patterns G</p>
<p>输入第一行为<span class="math inline">\(n,k\)</span> <span class="math inline">\(n\)</span>为字符串长度,<span class="math inline">\(k\)</span>为出现至少<span class="math inline">\(k\)</span>次</p>
<p>下面的<span class="math inline">\(n\)</span>行每行一个数字.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P2852 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">4e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> n,s[maxn];</span><br><span class="line"><span class="keyword">int</span> sa[maxn],pos[maxn],cnt[maxn],sa_new[maxn],c[maxn],c_new[maxn],lcp[maxn];</span><br><span class="line">pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;A[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SA</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)A[i] = &#123;s[i],i&#125;;</span><br><span class="line">	<span class="built_in">sort</span>(A,A+n);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = A[i].second;</span><br><span class="line">	c[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">		c[sa[i]] = c[sa[i<span class="number">-1</span>]] + (A[i].first != A[i<span class="number">-1</span>].first);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;k) &lt; n)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = (sa[i] - (<span class="number">1</span>&lt;&lt;k) + n)%n;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)cnt[i] = pos[i] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)cnt[c[i]]++;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)pos[i] = pos[i<span class="number">-1</span>] + cnt[i<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa_new[pos[c[sa[i]]]++] = sa[i];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = sa_new[i];</span><br><span class="line">		c_new[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">			c_new[sa[i]] = c_new[sa[i<span class="number">-1</span>]] + (c[sa[i]] != c[sa[i<span class="number">-1</span>]] <span class="keyword">or</span> c[(sa[i] + (<span class="number">1</span>&lt;&lt;k)) % n] != c[(sa[i<span class="number">-1</span>] + (<span class="number">1</span>&lt;&lt;k)) % n]);</span><br><span class="line">		&#125;</span><br><span class="line">		k++;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)c[i] = c_new[i];</span><br><span class="line">	&#125;</span><br><span class="line">	k = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n<span class="number">-1</span>;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> j = sa[c[i] - <span class="number">1</span>];</span><br><span class="line">		<span class="keyword">while</span>(s[i+k] == s[j+k])k++;</span><br><span class="line">		lcp[c[i]] = k;</span><br><span class="line">		<span class="keyword">if</span>(k)k--;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> w,idx;</span><br><span class="line">	<span class="built_in">Node</span>(<span class="keyword">int</span> w = <span class="number">0</span>,<span class="keyword">int</span> idx = <span class="number">0</span>):<span class="built_in">w</span>(w),<span class="built_in">idx</span>(idx)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">deque&lt;Node&gt;qmin;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> K;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;K);</span><br><span class="line">	K--;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;s[i]);</span><br><span class="line">	s[n] = <span class="number">-1</span>;</span><br><span class="line">	n++;</span><br><span class="line">	<span class="built_in">SA</span>();</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">		Node u = <span class="built_in">Node</span>(lcp[i],i);</span><br><span class="line">		<span class="keyword">while</span>(qmin.<span class="built_in">size</span>() <span class="keyword">and</span> qmin.<span class="built_in">back</span>().w &gt; u.w)qmin.<span class="built_in">pop_back</span>();</span><br><span class="line">		qmin.<span class="built_in">push_back</span>(u);</span><br><span class="line">		<span class="keyword">while</span>(qmin.<span class="built_in">size</span>() <span class="keyword">and</span> qmin.<span class="built_in">front</span>().idx &lt; i - K + <span class="number">1</span>)qmin.<span class="built_in">pop_front</span>();</span><br><span class="line">		<span class="keyword">if</span>(i &gt;= K)ans = <span class="built_in">max</span>(ans,qmin.<span class="built_in">front</span>().w);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="trie">Trie</h2>
<p>待补充.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Trie</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> siz = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> nxt[maxn][<span class="number">30</span>];</span><br><span class="line">	<span class="keyword">int</span> vis[maxn];</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">		siz = <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">memset</span>(nxt,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(nxt));</span><br><span class="line">		<span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(vis));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(string s)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x:s)&#123;</span><br><span class="line">			<span class="keyword">int</span> c = x - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">			<span class="keyword">if</span>(!nxt[u][c])&#123;</span><br><span class="line">				nxt[u][c] = siz++;</span><br><span class="line">			&#125;</span><br><span class="line">			u = nxt[u][c];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(string s)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> u = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x:s)&#123;</span><br><span class="line">			<span class="keyword">int</span> c = x - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">			<span class="keyword">if</span>(!nxt[u][c])&#123;</span><br><span class="line">				cout &lt;&lt; <span class="string">&quot;WRONG\n&quot;</span>;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			u = nxt[u][c];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(vis[u])cout &lt;&lt; <span class="string">&quot;REPEAT\n&quot;</span>;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			cout &lt;&lt; <span class="string">&quot;OK\n&quot;</span>;</span><br><span class="line">			vis[u] = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;trie;</span><br></pre></td></tr></table></figure>
<h1 id="暴力就完事了">暴力就完事了</h1>
<h2 id="分块">分块</h2>
<p>因为分块细节很多,这里只放几道例题.</p>
<h3 id="区间加法单点查询">区间加法,单点查询</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//LOJ6277 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">5e4</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SIZ = <span class="number">256</span>;</span><br><span class="line">vector&lt;ll&gt;block[maxn];</span><br><span class="line"><span class="keyword">int</span> bnt[maxn];</span><br><span class="line">ll add[maxn],raw[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> w)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(bnt[L] == bnt[R])&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = L;i &lt;= R;i++)raw[i] += w;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = L;i &lt;= bnt[L]*SIZ;i++)raw[i] += w;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = (bnt[R]<span class="number">-1</span>)*SIZ+<span class="number">1</span>;i &lt;= R;i++)raw[i] += w;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = bnt[L]+<span class="number">1</span>;i &lt; bnt[R];i++)add[i] += w;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> raw[x] + add[(x<span class="number">-1</span>)/SIZ+<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; maxn;i++)bnt[i] = (i<span class="number">-1</span>)/SIZ+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> n;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)cin &gt;&gt; raw[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> o,l,r,w;</span><br><span class="line">		cin &gt;&gt; o &gt;&gt; l &gt;&gt; r &gt;&gt; w;</span><br><span class="line">		<span class="keyword">if</span>(o)cout &lt;&lt; <span class="built_in">query</span>(r) &lt;&lt; endl;</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">update</span>(l,r,w);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="动态逆序对">动态逆序对</h3>
<p>现在给出 1到n 的一个排列，按照某种顺序依次删除 m 个元素，你的任务是在每次删除一个元素<strong>之前</strong>统计整个序列的逆序对数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P3157 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SIZ = <span class="number">1024</span>;</span><br><span class="line"><span class="keyword">int</span> bnt[maxn],raw[maxn],A[maxn];</span><br><span class="line"><span class="keyword">int</span> BIT[maxn],n,m,maxb;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;Block[maxn];</span><br><span class="line">ll ans = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> b&amp;-b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index,<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(index &lt;= n)&#123;</span><br><span class="line">		BIT[index] += d;</span><br><span class="line">		index += <span class="built_in">lowbit</span>(index);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> t_ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(index)&#123;</span><br><span class="line">		t_ans += BIT[index];</span><br><span class="line">		index -= <span class="built_in">lowbit</span>(index);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> t_ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;raw[i]);</span><br><span class="line">		bnt[i] = (i<span class="number">-1</span>)/SIZ+<span class="number">1</span>;</span><br><span class="line">		A[raw[i]] = i;</span><br><span class="line">		Block[bnt[i]].<span class="built_in">push_back</span>(raw[i]);</span><br><span class="line">		ans += (i<span class="number">-1</span>-<span class="built_in">sum</span>(raw[i]));</span><br><span class="line">		<span class="built_in">add</span>(raw[i],<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	maxb = (n<span class="number">-1</span>)/SIZ+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= maxb;i++)<span class="built_in">sort</span>(Block[i].<span class="built_in">begin</span>(),Block[i].<span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> b = (A[x]<span class="number">-1</span>)/SIZ+<span class="number">1</span>,k = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; b;i++)k += (Block[i].<span class="built_in">size</span>() - (<span class="built_in">lower_bound</span>(Block[i].<span class="built_in">begin</span>(),Block[i].<span class="built_in">end</span>(),x) - Block[i].<span class="built_in">begin</span>()));</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = b+<span class="number">1</span>;i &lt;= maxb;i++)k += <span class="built_in">lower_bound</span>(Block[i].<span class="built_in">begin</span>(),Block[i].<span class="built_in">end</span>(),x) - Block[i].<span class="built_in">begin</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = (b<span class="number">-1</span>)*SIZ+<span class="number">1</span>;i &lt; A[x];i++)<span class="keyword">if</span>(raw[i] <span class="keyword">and</span> raw[i] &gt; x)k++;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = A[x];i &lt;= b*SIZ;i++)<span class="keyword">if</span>(raw[i] <span class="keyword">and</span> raw[i] &lt; x)k++;</span><br><span class="line">	<span class="keyword">return</span> k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">del</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> b = (A[x]<span class="number">-1</span>)/SIZ+<span class="number">1</span>;</span><br><span class="line">	raw[A[x]] = <span class="number">0</span>;</span><br><span class="line">	A[x] = <span class="number">0</span>; </span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> it = Block[b].<span class="built_in">begin</span>();it != Block[b].<span class="built_in">end</span>();it++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(*it == x)&#123;</span><br><span class="line">			Block[b].<span class="built_in">erase</span>(it);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">init</span>();</span><br><span class="line">	<span class="keyword">while</span>(m--)&#123;</span><br><span class="line">		<span class="keyword">int</span> x;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;x);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">		ans -= <span class="built_in">query</span>(x);</span><br><span class="line">		<span class="built_in">del</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="莫队">莫队</h2>
<h3 id="基础莫队小b的询问luogu-p2709">基础莫队(小B的询问,Luogu P2709)</h3>
<p>求<span class="math inline">\(\sum_{i = 1}^kc_{i}^2\)</span></p>
<p><span class="math inline">\(c_i\)</span>为<span class="math inline">\(i\)</span>在<span class="math inline">\([L,R]\)</span>的出现次数</p>
<p>块大小取<span class="math inline">\(\sqrt{n}\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P2709</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SIZ = <span class="number">512</span>;</span><br><span class="line">ll cnt[maxn],res[maxn],raw[maxn],ans;</span><br><span class="line"><span class="keyword">int</span> n,m,k;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> L,R,idx;</span><br><span class="line">	<span class="built_in">Node</span>(<span class="keyword">int</span> L = <span class="number">0</span>,<span class="keyword">int</span> R = <span class="number">0</span>,<span class="keyword">int</span> idx = <span class="number">0</span>):<span class="built_in">L</span>(L),<span class="built_in">R</span>(R),<span class="built_in">idx</span>(idx)&#123;&#125;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node &amp; x)<span class="keyword">const</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>((L<span class="number">-1</span>)/SIZ != (x.L<span class="number">-1</span>)/SIZ)<span class="keyword">return</span> (L<span class="number">-1</span>) &lt; (x.L<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> R &lt; x.R;	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;query[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> v = raw[pos];</span><br><span class="line">	<span class="keyword">if</span>(x == <span class="number">1</span>)ans += cnt[v]*<span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span> ans += <span class="number">1</span> - cnt[v]*<span class="number">2</span>;</span><br><span class="line">	cnt[v] += x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)cin &gt;&gt; raw[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> L,R;</span><br><span class="line">		cin &gt;&gt; L &gt;&gt; R;</span><br><span class="line">		query[i] = <span class="built_in">Node</span>(L,R,i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(query+<span class="number">1</span>,query+m+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">int</span> l = <span class="number">1</span>,r = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line">		<span class="keyword">while</span>(l &gt; query[i].L)<span class="built_in">update</span>(--l,<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">while</span>(r &lt; query[i].R)<span class="built_in">update</span>(++r,<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">while</span>(l &lt; query[i].L)<span class="built_in">update</span>(l++,<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">while</span>(r &gt; query[i].R)<span class="built_in">update</span>(r--,<span class="number">-1</span>);</span><br><span class="line">		res[query[i].idx] = ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)cout &lt;&lt; res[i] &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>奇偶排序优化:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node &amp; x)<span class="keyword">const</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>((l<span class="number">-1</span>)/SIZ != (x.l<span class="number">-1</span>)/SIZ)<span class="keyword">return</span> l &lt; x.l;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(((l<span class="number">-1</span>)/SIZ+<span class="number">1</span>)%<span class="number">2</span>)<span class="keyword">return</span> r &lt; x.r;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> r &gt; x.r; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="带修莫队">带修莫队</h3>
<p>分块大小取<span class="math inline">\(n^{\frac{2}{3}}\)</span></p>
<p>询问存当前区间(<span class="math inline">\(l,r\)</span>)和修改的时间(<span class="math inline">\(t\)</span>), 排序分别以<span class="math inline">\(l,r,t\)</span>为关键字.</p>
<p>修改时如果当前时间比询问时间小就暴力修改，否则暴力回退</p>
<p>注意: <strong>只有修改的位置在当前区间内才更新答案，但无论如何都要进行修改</strong></p>
<p>例题:P1903 [国家集训队]数颜色 / 维护队列</p>
<p>1、 Q L R代表询问你从第L支画笔到第R支画笔中共有几种不同颜色的画笔。</p>
<p>2、 R P Col 把第P支画笔替换为颜色Col。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//P1903-Mo </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> SIZ = <span class="number">2607</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">4e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> raw[maxn],cnt[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> l,r,idx,t,ans;</span><br><span class="line">	<span class="keyword">int</span> v;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Query &amp; x) <span class="keyword">const</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>((l<span class="number">-1</span>)/SIZ != (x.l<span class="number">-1</span>)/SIZ)<span class="keyword">return</span> l &lt; x.l;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>((r<span class="number">-1</span>)/SIZ != (x.r<span class="number">-1</span>)/SIZ)&#123;</span><br><span class="line">			<span class="keyword">if</span>(((l<span class="number">-1</span>)/SIZ)%<span class="number">2</span>)<span class="keyword">return</span> r &lt; x.r;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">return</span> r &gt; x.r;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> t &lt; x.t;	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">Query</span>(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> idx,<span class="keyword">int</span> t):<span class="built_in">l</span>(l),<span class="built_in">r</span>(r),<span class="built_in">idx</span>(idx),<span class="built_in">t</span>(t)&#123;&#125;</span><br><span class="line">	<span class="built_in">Query</span>(<span class="keyword">int</span> idx = <span class="number">0</span>,<span class="keyword">int</span> v = <span class="number">0</span>):<span class="built_in">idx</span>(idx),<span class="built_in">v</span>(v)&#123;&#125;</span><br><span class="line">&#125;query[maxn],op[maxn];</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!cnt[x])ans++;</span><br><span class="line">	cnt[x]++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="number">1</span> == cnt[x])ans--;</span><br><span class="line">	cnt[x]--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> tim,<span class="keyword">int</span> qidx)</span></span>&#123;</span><br><span class="line">	<span class="comment">//opt :1,re 0,add</span></span><br><span class="line">	<span class="keyword">int</span> l = query[qidx].l,r = query[qidx].r,x = op[tim].idx;</span><br><span class="line">	<span class="keyword">if</span>(l &lt;= x <span class="keyword">and</span> x &lt;= r)&#123;</span><br><span class="line">		<span class="built_in">del</span>(raw[x]);</span><br><span class="line">		<span class="built_in">add</span>(op[tim].v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">swap</span>(raw[x],op[tim].v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n,m;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;raw[i]);</span><br><span class="line">	<span class="keyword">int</span> ocnt = <span class="number">0</span>,qcnt = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i= <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line">		string opt;</span><br><span class="line">		<span class="keyword">int</span> l,r;</span><br><span class="line">		cin &gt;&gt; opt;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;l,&amp;r);</span><br><span class="line">		<span class="keyword">if</span>(opt == <span class="string">&quot;Q&quot;</span>)&#123;</span><br><span class="line">			qcnt++;</span><br><span class="line">			query[qcnt] = <span class="built_in">Query</span>(l,r,qcnt,ocnt);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> op[++ocnt] = <span class="built_in">Query</span>(l,r);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(query+<span class="number">1</span>,query+qcnt+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">int</span> l = <span class="number">1</span>,r = <span class="number">0</span>,now = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= qcnt;i++)&#123;</span><br><span class="line">		<span class="keyword">while</span>(l &lt; query[i].l)<span class="built_in">del</span>(raw[l++]);</span><br><span class="line">		<span class="keyword">while</span>(l &gt; query[i].l)<span class="built_in">add</span>(raw[--l]);</span><br><span class="line">		<span class="keyword">while</span>(r &gt; query[i].r)<span class="built_in">del</span>(raw[r--]);</span><br><span class="line">		<span class="keyword">while</span>(r &lt; query[i].r)<span class="built_in">add</span>(raw[++r]);</span><br><span class="line">		<span class="keyword">while</span>(now &lt; query[i].t)<span class="built_in">change</span>(++now,i);</span><br><span class="line">		<span class="keyword">while</span>(now &gt; query[i].t)<span class="built_in">change</span>(now--,i);</span><br><span class="line">		query[i].ans = ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">auto</span> cmp = [](Query a,Query b) -&gt; <span class="keyword">bool</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a.idx &lt; b.idx;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="built_in">sort</span>(query+<span class="number">1</span>,query+qcnt+<span class="number">1</span>,cmp);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= qcnt;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,query[i].ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="树上莫队">树上莫队</h3>
<h4 id="分块方式">分块方式</h4>
<p>将树分为大小在<span class="math inline">\([B,3B)\)</span>之间的块, 其中<span class="math inline">\(pa[i]\)</span>表示第<span class="math inline">\(i\)</span>个点所属的块编号, <span class="math inline">\(pivot[i]\)</span>表示<span class="math inline">\(i\)</span>号块对应的关键点. 关键点是满足<strong>该块内任意一点到关键点的简单路径上的所有点都在块内</strong>的点</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> pa[maxn],pivot[maxn],acnt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> siz = s.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = head[u];~i;i = edge[i].next)&#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].t;</span><br><span class="line">		<span class="keyword">if</span>(v == fa)<span class="keyword">continue</span>;</span><br><span class="line">		<span class="built_in">dfs</span>(v,u);</span><br><span class="line">		<span class="keyword">if</span>((<span class="keyword">int</span>)s.<span class="built_in">size</span>() - siz &gt;= B)&#123;</span><br><span class="line">			pivot[++acnt] = u;</span><br><span class="line">			<span class="keyword">while</span>((<span class="keyword">int</span>)s.<span class="built_in">size</span>() &gt; siz)&#123;</span><br><span class="line">				pa[s.<span class="built_in">top</span>()] = acnt;</span><br><span class="line">				s.<span class="built_in">pop</span>();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	s.<span class="built_in">push</span>(u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="其他">其他</h1>
<h2 id="并查集">并查集</h2>
<p>路径压缩,无按秩合并 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> father[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)father[i] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">findset</span><span class="params">(<span class="keyword">int</span> e)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> father[e] == e?e:father[e] = <span class="built_in">findset</span>(father[e]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">un</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">	father[<span class="built_in">findset</span>(x)] = <span class="built_in">findset</span>(y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>路径压缩, 按秩合并</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> fa[maxn],siz[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">findset</span><span class="params">(<span class="keyword">int</span> e)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> fa[e] == e?e:fa[e] = <span class="built_in">findset</span>(fa[e]); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">un</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">	a = <span class="built_in">findset</span>(a),b = <span class="built_in">findset</span>(b);</span><br><span class="line">	<span class="keyword">if</span>(siz[a] &gt; siz[b])<span class="built_in">swap</span>(a,b);</span><br><span class="line">	siz[b] += siz[a];</span><br><span class="line">	<span class="comment">// fa[a] = fa[b];</span></span><br><span class="line">	fa[a] = b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">findset</span>(a) == <span class="built_in">findset</span>(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="带权并查集">带权并查集</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> fa[maxn],siz[maxn],maxv[maxn],minv[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">findset</span><span class="params">(<span class="keyword">int</span> e)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> fa[e] == e?e:fa[e] = <span class="built_in">findset</span>(fa[e]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">findset</span>(a) == <span class="built_in">findset</span>(b);</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">un</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">check</span>(a,b))<span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> &amp; v = fa[<span class="built_in">findset</span>(a)],u = <span class="built_in">findset</span>(b);</span><br><span class="line">	siz[u] += siz[v];</span><br><span class="line">	maxv[u] = <span class="built_in">max</span>(maxv[u],maxv[v]);</span><br><span class="line">	minv[u] = <span class="built_in">min</span>(minv[u],minv[v]);</span><br><span class="line">	v = u;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<h2 id="二分">二分</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lower_bound</span><span class="params">(<span class="keyword">int</span> &amp; A,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> L = <span class="number">0</span>,R = n,M;</span><br><span class="line">	<span class="keyword">while</span>(L &lt; R)&#123;</span><br><span class="line">		M = (L+R)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(A[M] &gt;= x)R = M;</span><br><span class="line">		<span class="keyword">else</span> L = M+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">upper_bound</span><span class="params">(<span class="keyword">int</span> &amp; A,<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> L = <span class="number">0</span>,R = n,M;</span><br><span class="line">	<span class="keyword">while</span>(L &lt; R)&#123;</span><br><span class="line">		M = (L+R)/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span>(A[M] &lt;= x)L = M+<span class="number">1</span>;<span class="comment">//区别在此</span></span><br><span class="line">		<span class="keyword">else</span> R = M;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="单调队列">单调队列</h2>
<p>保证双端队列里的值单调即可.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">	Node u = <span class="built_in">Node</span>(raw[i],i);</span><br><span class="line">	<span class="keyword">while</span>(qmin.<span class="built_in">size</span>() <span class="keyword">and</span> qmin.<span class="built_in">back</span>().w &gt; u.w)qmin.<span class="built_in">pop_back</span>();</span><br><span class="line">	qmin.<span class="built_in">push_back</span>(u);</span><br><span class="line">	<span class="keyword">while</span>(qmin.<span class="built_in">size</span>() <span class="keyword">and</span> qmin.<span class="built_in">front</span>().idx &lt; i - k + <span class="number">1</span>)qmin.<span class="built_in">pop_front</span>();</span><br><span class="line">	<span class="keyword">if</span>(i &gt;= k)cout &lt;&lt; qmin.<span class="built_in">front</span>().w &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LinkinPony</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","cdn":"//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
