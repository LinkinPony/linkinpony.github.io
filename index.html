<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"linkinpony.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="I always love dashie">
<meta property="og:url" content="http://linkinpony.github.io/index.html">
<meta property="og:site_name" content="I always love dashie">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="LinkinPony">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://linkinpony.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>I always love dashie</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">I always love dashie</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">LinkinPony</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/LinkinPony" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;LinkinPony" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://codeforces.com/profile/LinkinPony" title="CodeForces → https:&#x2F;&#x2F;codeforces.com&#x2F;profile&#x2F;LinkinPony" rel="noopener" target="_blank"><i class="code fa-fw"></i>CodeForces</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://acker.fun/" title="https:&#x2F;&#x2F;acker.fun&#x2F;" rel="noopener" target="_blank">Acker</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://kmguan-528.github.io/" title="https:&#x2F;&#x2F;kmguan-528.github.io&#x2F;" rel="noopener" target="_blank">KMGuan</a>
        </li>
    </ul>
  </div>

          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2023/01/26/MIT-18-06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/26/MIT-18-06/" class="post-title-link" itemprop="url">MIT-18.06</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-01-26 13:53:54" itemprop="dateCreated datePublished" datetime="2023-01-26T13:53:54+08:00">2023-01-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2023-01-30 09:04:42" itemprop="dateModified" datetime="2023-01-30T09:04:42+08:00">2023-01-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="lec-4-a-lu">Lec 4 A = LU</h2>
<p><span class="math display">\[
(AB)^{-1} = B^{-1}A^{-1} \\
(A^{T})^{-1} = (A^{-1})^{T}\\
\]</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2023/01/06/GAMES-202/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/06/GAMES-202/" class="post-title-link" itemprop="url">GAMES-202</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-01-06 16:38:50" itemprop="dateCreated datePublished" datetime="2023-01-06T16:38:50+08:00">2023-01-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2023-01-18 10:46:23" itemprop="dateModified" datetime="2023-01-18T10:46:23+08:00">2023-01-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="导论">导论</h1>
<h2 id="graphics-hardware-pipeline">Graphics (Hardware) Pipeline</h2>
<figure>
<img src="/.io//image-20230106184441259.png" alt="image-20230106184441259"><figcaption aria-hidden="true">image-20230106184441259</figcaption>
</figure>
<h2 id="opengl">OpenGL</h2>
<p><img src="/.io//image-20230118102300199.png" alt="image-20230118102300199" style="zoom:67%;"></p>
<h3 id="a.-place-objectsmodels">A. Place objects/models</h3>
<p><img src="/.io//image-20230118102922245.png" alt="image-20230118102922245" style="zoom:67%;"></p>
<h3 id="b.-set-up-an-easel">B. Set up an easel</h3>
<p><img src="/.io//image-20230118103116098.png" alt="image-20230118103116098" style="zoom:67%;"></p>
<h3 id="c.-attach-a-canvas-to-the-ease">C. Attach a canvas to the ease</h3>
<p><img src="/.io//image-20230118103323789.png" alt="image-20230118103323789" style="zoom:67%;"></p>
<h3 id="d.-paint-to-the-canvas">D. Paint to the canvas</h3>
<p><img src="/.io//image-20230118104037026.png" alt="image-20230118104037026" style="zoom:67%;"></p>
<p><img src="/.io//image-20230118104438290.png" alt="image-20230118104438290" style="zoom:67%;"></p>
<p><img src="/.io//image-20230118104618634.png" alt="image-20230118104618634" style="zoom:67%;"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2023/01/05/MIT-18-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/05/MIT-18-01/" class="post-title-link" itemprop="url">MIT 18.01 单变量微积分</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-01-05 16:48:45" itemprop="dateCreated datePublished" datetime="2023-01-05T16:48:45+08:00">2023-01-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2023-02-01 10:27:59" itemprop="dateModified" datetime="2023-02-01T10:27:59+08:00">2023-02-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="常用公式">常用公式</h1>
<h2 id="三角函数">三角函数</h2>
<p><span class="math display">\[
\sin^2x + \cos ^ 2 x = 1\\
\]</span></p>
<h2 id="求导">求导</h2>
<h3 id="三角函数求导">三角函数求导</h3>
<p><span class="math display">\[
\sin&#39;x = \cos x\\
\cos&#39;x = - \sin x\\
\tan&#39;x = \frac{1}{\cos^2x} = \sec^2x\\
\arctan&#39; x = \frac{1}{1+x^2}\\
\]</span></p>
<h3 id="指数函数和对数函数">指数函数和对数函数</h3>
<p><span class="math display">\[
\frac{\text d}{\text d x}\ln x = \frac{1}{x}\\
\frac{\text d}{\text d x}e^x = e^x\\
\frac{\text d}{\text dx}a^x = \ln a \cdot a^x\\
\frac{\text d}{\text d x} \ln u = \frac{1}{u}\frac{\text d u}{\text d x}
\]</span></p>
<h1 id="导数derivative">导数（derivative)</h1>
<h2 id="lecture1-导数的几何解释">Lecture1: 导数的几何解释</h2>
<p><img src="/.io//image-20230105165932729.png" alt="image-20230105165932729" style="zoom:67%;"></p>
<p>如图, <span class="math inline">\(P\)</span>点的导数便是过<span class="math inline">\(P\)</span>点的切线(tangent line)的斜率, 记作<span class="math inline">\(f&#39;(P)\)</span>.</p>
<p>什么样子的线是切线? 我们先看由点<span class="math inline">\(PQ\)</span>构成的割线(secant line). 当<span class="math inline">\(PQ\)</span>两点的距离趋于<span class="math inline">\(0\)</span>时, 割线与切线便无限接近.</p>
<p><img src="/.io//image-20230106095142833.png" alt="image-20230106095142833" style="zoom:67%;"></p>
<p>如图. 可得 <span class="math display">\[
f&#39;(x) = \lim_{\Delta x \to 0} \frac{f(x_0 + \Delta x) - f(x_0)}{\Delta x}
\]</span></p>
<h3 id="一些符号">一些符号</h3>
<p><img src="/.io//image-20230106102935887.png" alt="image-20230106102935887" style="zoom:67%;"></p>
<p>导数(牛顿记法): <span class="math inline">\(f&#39;\)</span></p>
<p>导数(莱布尼兹记法): <span class="math inline">\(\frac{\text df}{\text dx},\frac{\text dy}{\text d x},\frac{\text d}{\text dx}f,\frac{\text d}{\text dx}y\)</span></p>
<p>一个有用的公式(推导见手写笔记): <span class="math display">\[
\frac{\text d}{\text d x}x^n = n \cdot x^{n-1}
\]</span></p>
<h2 id="lecture2-极限-连续性和三角函数的极限">Lecture2: 极限, 连续性和三角函数的极限</h2>
<p><img src="/.io//image-20230106105337764.png" alt="image-20230106105337764" style="zoom:67%;"></p>
<p>我们用<span class="math inline">\(\frac{\Delta y}{\Delta x}\)</span>来计量某个函数在一段时间内的平均变化率. 当<span class="math inline">\(\Delta x \to 0\)</span>时, 这便变成了瞬时变化率.</p>
<p><img src="/.io//image-20230106110147320.png" alt="image-20230106110147320" style="zoom:50%;"></p>
<p><img src="/.io//image-20230106110459943.png" alt="image-20230106110459943" style="zoom:67%;"></p>
<p><img src="/.io//image-20230106110512348.png" alt="image-20230106110512348" style="zoom:50%;"></p>
<h3 id="limits-and-continuity">Limits and Continuity</h3>
<p>简单的极限可以直接带入运算:</p>
<p><img src="/.io//image-20230106111047720.png" alt="image-20230106111047720" style="zoom: 67%;"></p>
<p>但是对于 <span class="math display">\[
\lim_{\Delta x \to 0}\frac{\Delta f}{\Delta x}
\]</span> 它不是一个简单极限. 因为我们不能将<span class="math inline">\(\Delta x = 0\)</span>代入运算, 这样永远会得到<span class="math inline">\(\frac{0}{0}\)</span>. <strong>注意</strong>: <span class="math display">\[
\lim_{x \to x_0}
\]</span> 暗示了<span class="math inline">\(x \neq x_0\)</span>.</p>
<h4 id="左右极限left-and-right-limt">左右极限(Left and Right Limt)</h4>
<p>我们用以下两个记号来表示左极限和右极限: <span class="math display">\[
\lim_{x\to x_0^-} (左极限, 此时x &lt; x_0)\\
\lim_{x\to x_0^+} (右极限, 此时x &gt; x_0)\\
\]</span></p>
<h3 id="连续性continuity">连续性(Continuity)</h3>
<p>我们称<span class="math inline">\(f(x)\)</span>在<span class="math inline">\(x_0\)</span>连续, 当且仅当 <span class="math display">\[
\lim_{x \to x_0}f(x) = f(x_0)
\]</span> 这意味着:</p>
<ol type="1">
<li><span class="math inline">\(f(x)\)</span>在点<span class="math inline">\(x_0\)</span>的极限必须存在, 且左右极限相等</li>
<li><span class="math inline">\(f(x_0)\)</span>是有定义的</li>
<li><span class="math inline">\(\lim_{x\to x_0}f(x)\)</span>与<span class="math inline">\(f(x_0)\)</span>相等</li>
</ol>
<p><img src="/.io//image-20230106142515063.png" alt="image-20230106142515063" style="zoom:50%;"></p>
<p>如图, <span class="math inline">\(\lim_{x \to 0^+}f(x) = 1\)</span>, 但是<span class="math inline">\(f(0) = 0\)</span>. 因此该函数在点<span class="math inline">\(0\)</span>不连续.</p>
<p>以下是不连续的几种情况:</p>
<ol type="1">
<li>Removable Discontinuity</li>
</ol>
<p><img src="/.io//image-20230106143147259.png" alt="image-20230106143147259" style="zoom:50%;"></p>
<p>该点的左右极限存在且相等, 但与该点的函数值不等(或该点的函数值未定义)</p>
<ol start="2" type="1">
<li>Jump Discontinuity</li>
</ol>
<p>​ <img src="/.io//image-20230106142937484.png" alt="image-20230106142937484" style="zoom:50%;"></p>
<p>左右极限均存在, 但不相等.</p>
<ol start="3" type="1">
<li>Infinite Discontinuity</li>
</ol>
<p><img src="/.io//image-20230106143422550.png" alt="image-20230106143422550" style="zoom:50%;"></p>
<p><span class="math inline">\(x = 0\)</span>时, 左极限为负无穷, 右极限为正无穷.</p>
<ol start="4" type="1">
<li>Other (ugly) discontinuities</li>
</ol>
<p><img src="/.io//image-20230106144002234.png" alt="image-20230106144002234" style="zoom:50%;"></p>
<h3 id="导数的图像picturing-the-derivative">导数的图像(Picturing the derivative)</h3>
<p><img src="/.io//image-20230106144101961.png" alt="image-20230106144101961" style="zoom:50%;"></p>
<p>注意导数的图像和原函数的图像没有什么相关性. 而且对一个奇函数求导, 它的导数一定是一个偶函数.</p>
<h3 id="定理-可导必连续theorem-differentiable-implies-continuous">定理: 可导必连续(Theorem: Differentiable Implies Continuous)</h3>
<p><span class="math display">\[
如果f在x_0处可导, 那么f必定在x_0处连续.
\]</span></p>
<p><img src="/.io//image-20230106150417303.png" alt="image-20230106150417303" style="zoom: 80%;"></p>
<h2 id="lecture-3-导数的四则运算及三角函数">Lecture 3: 导数的四则运算及三角函数</h2>
<h3 id="求导公式derivative-formulas">求导公式(Derivative Formulas)</h3>
<p><img src="/.io//image-20230106153822818.png" alt="image-20230106153822818" style="zoom:67%;"></p>
<h3 id="特殊求导公式">特殊求导公式</h3>
<p><span class="math display">\[
\lim_{\theta \to 0}\frac{\sin\theta}{\theta} = 1\\
\lim_{\theta\to0}\frac{1 - cos\theta}{\theta} = 0
\]</span></p>
<p>证明:</p>
<p><img src="/.io//image-20230106160612420.png" alt="image-20230106160612420" style="zoom:67%;"></p>
<p><img src="/.io//image-20230106160652701.png" alt="image-20230106160652701" style="zoom:67%;"></p>
<h4 id="sin-cos">sin, cos</h4>
<p><span class="math display">\[
\frac{\text d}{\text d x}\sin x = \cos x\\
\frac{\text d}{\text d x}\cos x = -\sin x\\
\]</span></p>
<p>推导过程:</p>
<p><img src="/.io//image-20230106154306445.png" alt="image-20230106154306445" style="zoom:67%;"></p>
<h3 id="一般求导公式">一般求导公式</h3>
<ul>
<li><p>加法法则 <span class="math display">\[
  (u+v)&#39; = u&#39; + v&#39;
  \]</span></p></li>
<li><p>乘积法则</p></li>
</ul>
<p><span class="math display">\[
(uv)&#39; = u&#39;v + uv&#39;
\]</span></p>
<ul>
<li><p>除法法则(quotient rule) <span class="math display">\[
  (\frac{u}{v})&#39; = \frac{u&#39;v - uv&#39;}{v^2}(v \neq 0)
  \]</span></p></li>
<li><p>证明: 加法法则</p>
<p><img src="/.io//image-20230111103645235.png" alt="image-20230111103645235" style="zoom:67%;"></p></li>
<li><p>证明: 乘法法则</p></li>
</ul>
<p><img src="/.io//image-20230111103618880.png" alt="image-20230111103618880" style="zoom:67%;"></p>
<p><img src="/.io//image-20230111105348577.png" alt="image-20230111105348577" style="zoom:67%;"></p>
<p>几何上的理解: <span class="math inline">\((uv)&#39; \cdot \Delta x = (u + \Delta u)(v + \Delta v) - uv\)</span>, 即图中粉色, 白色, 黄色部分之和. 又因为<span class="math inline">\(\Delta u \cdot \Delta v \approx 0\)</span>, 所以有 <span class="math display">\[
(uv)&#39; \approx \frac{u \Delta v + v \Delta u}{\Delta x} \\
= uv’ +u&#39;v
\]</span></p>
<ul>
<li>证明: 除法法则</li>
</ul>
<p><img src="/.io//image-20230111111834201.png" alt="image-20230111111834201" style="zoom:67%;"></p>
<h2 id="lecture-4链式法则和高阶导数">Lecture 4:链式法则和高阶导数</h2>
<h3 id="链式法则chain-rule">链式法则(Chain Rule)</h3>
<p><span class="math display">\[
\frac{\text{d}y}{\text{d}t} = \frac{\text{d} y}{\text{d}x} \cdot \frac{\text{d}x}{\text{d}t}
\]</span></p>
<p><img src="/.io//image-20230115092644053.png" alt="image-20230115092644053" style="zoom:67%;"></p>
<p><img src="/.io//image-20230115092735531.png" alt="image-20230115092735531" style="zoom: 67%;"></p>
<h3 id="高阶导数higher-derivatives">高阶导数(Higher Derivatives)</h3>
<p><img src="/.io//image-20230115093300221.png" alt="image-20230115093300221" style="zoom:67%;"></p>
<h2 id="lecture-5-隐函数微分及逆函数导数">Lecture 5 隐函数微分及逆函数导数</h2>
<h3 id="隐函数微分implicit-differentiation">隐函数微分(Implicit Differentiation)</h3>
<p>有些函数(例如<span class="math inline">\(x^2 + y^2 = 1\)</span>)不具有明显的<span class="math inline">\(y = f(x)\)</span>形式, 但是能通过变形得到(本例可得<span class="math inline">\(y = \sqrt{1 - x^2}\)</span>). 这样的函数称为隐函数. 对隐函数求导, 可在方程两边同时对<span class="math inline">\(x\)</span>求导, 得到一个包含<span class="math inline">\(\frac{\text{d}y}{\text{d}x}\)</span>的式子, 再求解<span class="math inline">\(\frac{\text{d}y}{\text{d}x}\)</span>即可.</p>
<p><img src="/.io//image-20230115095829432.png" alt="image-20230115095829432" style="zoom:67%;"></p>
<p><img src="/.io//image-20230115095838093.png" alt="image-20230115095838093" style="zoom:67%;"></p>
<p><img src="/.io//image-20230115100903420.png" alt="image-20230115100903420" style="zoom:67%;"></p>
<h3 id="反函数inverse-function">反函数(Inverse Function)</h3>
<p>若<span class="math inline">\(y = f(x),g(x) = y\)</span>, 则<span class="math inline">\(g\)</span>是<span class="math inline">\(f\)</span>的反函数, 记作<span class="math inline">\(f^{-1}\)</span>. 函数和它的反函数关于<span class="math inline">\(y = x\)</span>对称.</p>
<p><img src="/.io//image-20230115104051068.png" alt="image-20230115104051068" style="zoom:67%;"></p>
<p><img src="/.io//image-20230115101543407.png" alt="image-20230115101543407" style="zoom:67%;"></p>
<p><img src="/.io//image-20230115103931577.png" alt="image-20230115103931577" style="zoom:67%;"></p>
<p><img src="/.io//image-20230115103954784.png" alt="image-20230115103954784" style="zoom:50%;"></p>
<p><img src="/.io//image-20230115104005007.png" alt="image-20230115104005007" style="zoom:67%;"></p>
<p><img src="/.io//image-20230115104013455.png" alt="image-20230115104013455" style="zoom:67%;"></p>
<h2 id="lecture-6-指数函数与对数函数对数微分双曲线函数">Lecture 6 指数函数与对数函数，对数微分，双曲线函数</h2>
<h3 id="指数函数对数函数和自然对数">指数函数，对数函数和自然对数</h3>
<p>见课程pdf和手写笔记</p>
<p>### 对数微分(Logarithmic Differentiation)</p>
<p><img src="/.io//image-20230118095423689.png" alt="image-20230118095423689" style="zoom:67%;"></p>
<p><img src="/.io//image-20230118095433488.png" alt="image-20230118095433488" style="zoom:67%;"></p>
<p><img src="/.io//image-20230118101022744.png" alt="image-20230118101022744" style="zoom:67%;"></p>
<p><img src="/.io//image-20230118101033927.png" alt="image-20230118101033927" style="zoom:67%;"></p>
<figure>
<img src="/.io//image-20230118101203685.png" alt="image-20230118101203685"><figcaption aria-hidden="true">image-20230118101203685</figcaption>
</figure>
<h2 id="lecture-7-连续性和第一次考试复习">Lecture 7 连续性和第一次考试复习</h2>
<h3 id="导数伪装的极限">导数伪装的极限</h3>
<p>(普林斯顿微积分读本修订版，人民邮电出版社，ISBN: 978-7-115-43559-0, P101)</p>
<h2 id="leture-9-线性和二阶近似">Leture 9 线性和二阶近似</h2>
<h3 id="线性近似linear-approximation">线性近似(Linear Approximation)</h3>
<p><span class="math display">\[
f(x) \approx f(x_0) + f&#39;(x_0)(x - x_0)
\]</span> <img src="/.io//image-20230130153834142.png" alt="image-20230130153834142" style="zoom:67%;"></p>
<p><img src="/.io//image-20230130154812720.png" alt="image-20230130154812720" style="zoom: 67%;"></p>
<p>注意上表近似符号左边和右边的函数. 如果<span class="math inline">\(f(x_0) + f&#39;(x)(x - x_0)\)</span>比<span class="math inline">\(f(x)\)</span>更容易计算, 便可以用线性近似来加速计算.</p>
<p><img src="/.io//image-20230130162129715.png" alt="image-20230130162129715" style="zoom:67%;"></p>
<p><img src="/.io//image-20230130162139973.png" alt="image-20230130162139973" style="zoom:67%;"></p>
<h3 id="二阶近似quadratic-approximations">二阶近似(Quadratic Approximations)</h3>
<p>一阶(线性)近似可能精度不够, 这时便需要二阶或更高阶的近似. <span class="math display">\[
f(x) \approx f(x_0) + f&#39;(x_0)(x - x_0) + \frac{f&#39;&#39;(x_0)}{2}(x-x_0)^2
\]</span></p>
<p>关于为什么二阶导的系数是<span class="math inline">\(\frac{1}{2}\)</span>:</p>
<figure>
<img src="/.io//image-20230201094512497.png" alt="image-20230201094512497"><figcaption aria-hidden="true">image-20230201094512497</figcaption>
</figure>
<p>可以看出, 二阶近似的效果更好:</p>
<p><img src="/.io//image-20230130163838707.png" alt="image-20230130163838707" style="zoom:67%;"></p>
<p>基础的结论:</p>
<p><img src="/.io//image-20230201094623798.png" alt="image-20230201094623798" style="zoom:67%;"></p>
<p><img src="/.io//image-20230201100855010.png" alt="image-20230201100855010" style="zoom:67%;"></p>
<h2 id="lecture-10-曲线构图">Lecture 10: 曲线构图</h2>
<p>Lecture 10: Curve Sketching</p>
<p>利用<span class="math inline">\(f&#39;\)</span>和<span class="math inline">\(f&#39;&#39;\)</span>的符号来画出<span class="math inline">\(f\)</span>的近似图像</p>
<ul>
<li><span class="math inline">\(f&#39; &gt; 0\)</span>, <span class="math inline">\(f\)</span>递增. 反之亦然</li>
<li><span class="math inline">\(f&#39;&#39; &gt; 0\)</span>, <span class="math inline">\(f&#39;\)</span>递增, 反之亦然</li>
</ul>
<p>画图的一般步骤:</p>
<p><img src="/.io//image-20230201101459064.png" alt="image-20230201101459064" style="zoom:67%;"></p>
<p>当<span class="math inline">\(f&#39;(x_0) = 0\)</span>时, 点<span class="math inline">\(x_0\)</span>称为驻点(临界点, critical points).</p>
<p>当<span class="math inline">\(f&#39;&#39;(x_0) = 0\)</span>时, 点<span class="math inline">\(x_0\)</span>称为拐点(inflection point).</p>
<p><img src="/.io//image-20230201101611151.png" alt="image-20230201101611151" style="zoom:67%;"></p>
<p><img src="/.io//image-20230201101621823.png" alt="image-20230201101621823" style="zoom:67%;"></p>
<figure>
<img src="/.io//image-20230201101928665.png" alt="image-20230201101928665"><figcaption aria-hidden="true">image-20230201101928665</figcaption>
</figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2022/08/23/template-math/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/23/template-math/" class="post-title-link" itemprop="url">[模板]数学</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-23 09:44:17" itemprop="dateCreated datePublished" datetime="2022-08-23T09:44:17+08:00">2022-08-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-09-10 19:56:39" itemprop="dateModified" datetime="2022-09-10T19:56:39+08:00">2022-09-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A8%A1%E6%9D%BF/" itemprop="url" rel="index"><span itemprop="name">模板</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>[TOC]</p>
<hr />
<p><strong>答案不取模，亲人两行泪</strong></p>
<p>212370440130137957</p>
<p>(↑这是一个很大的质数)</p>
<p>19260817</p>
<p>(↑这是一颗很大的子弹)</p>
<p><strong>判断同余时用</strong><span class="math inline">\((a - b) \mod m== 0\)</span></p>
<p>cout不使用科学计数法输出，设置精度: <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cout.<span class="built_in">setf</span>(ios::fixed,ios::floatfield);</span><br><span class="line">cout.<span class="built_in">precision</span>(<span class="number">2</span>); </span><br></pre></td></tr></table></figure></p>
<table style="width:6%;">
<colgroup>
<col style="width: 5%" />
</colgroup>
<tbody>
<tr class="odd">
<td># 杂项</td>
</tr>
<tr class="even">
<td>## 神秘结论</td>
</tr>
<tr class="odd">
<td><span class="math display">\[
\sum_{i = 1}^n (d(i))^2 \ll n \log^3 n (d为因子个数)
\]</span></td>
</tr>
<tr class="even">
<td>## 大整数</td>
</tr>
<tr class="odd">
<td>(我也不知道从哪copy)的</td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">bign</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> d[maxn], len;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">clean</span><span class="params">()</span> </span>&#123; <span class="keyword">while</span>(len &gt; <span class="number">1</span> &amp;&amp; !d[len<span class="number">-1</span>]) len--; &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">bign</span>() 			&#123; <span class="built_in">memset</span>(d, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(d)); len = <span class="number">1</span>; &#125;</span><br><span class="line">    <span class="built_in">bign</span>(<span class="keyword">int</span> num) 	&#123; *<span class="keyword">this</span> = num; &#125; </span><br><span class="line">	<span class="built_in">bign</span>(<span class="keyword">char</span>* num) &#123; *<span class="keyword">this</span> = num; &#125;</span><br><span class="line">    bign <span class="keyword">operator</span> = (<span class="keyword">const</span> <span class="keyword">char</span>* num)&#123;</span><br><span class="line">        <span class="built_in">memset</span>(d, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(d)); len = <span class="built_in">strlen</span>(num);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) d[i] = num[len<span class="number">-1</span>-i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        <span class="built_in">clean</span>();</span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    bign <span class="keyword">operator</span> = (<span class="keyword">int</span> num)&#123;</span><br><span class="line">        <span class="keyword">char</span> s[<span class="number">20</span>]; <span class="built_in">sprintf</span>(s, <span class="string">&quot;%d&quot;</span>, num);</span><br><span class="line">        *<span class="keyword">this</span> = s;</span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    bign <span class="keyword">operator</span> + (<span class="keyword">const</span> bign&amp; b)&#123;</span><br><span class="line">        bign c = *<span class="keyword">this</span>; <span class="keyword">int</span> i;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; b.len; i++)&#123;</span><br><span class="line">        	c.d[i] += b.d[i];</span><br><span class="line">        	<span class="keyword">if</span> (c.d[i] &gt; <span class="number">9</span>) c.d[i]%=<span class="number">10</span>, c.d[i+<span class="number">1</span>]++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (c.d[i] &gt; <span class="number">9</span>) c.d[i++]%=<span class="number">10</span>, c.d[i]++;</span><br><span class="line">		c.len = <span class="built_in">max</span>(len, b.len);</span><br><span class="line">		<span class="keyword">if</span> (c.d[i] &amp;&amp; c.len &lt;= i) c.len = i+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    bign <span class="keyword">operator</span> - (<span class="keyword">const</span> bign&amp; b)&#123;</span><br><span class="line">        bign c = *<span class="keyword">this</span>; <span class="keyword">int</span> i;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; b.len; i++)&#123;</span><br><span class="line">        	c.d[i] -= b.d[i];</span><br><span class="line">        	<span class="keyword">if</span> (c.d[i] &lt; <span class="number">0</span>) c.d[i]+=<span class="number">10</span>, c.d[i+<span class="number">1</span>]--;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (c.d[i] &lt; <span class="number">0</span>) c.d[i++]+=<span class="number">10</span>, c.d[i]--;</span><br><span class="line">		c.<span class="built_in">clean</span>();</span><br><span class="line">		<span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    bign <span class="keyword">operator</span> * (<span class="keyword">const</span> bign&amp; b)<span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i, j; bign c; c.len = len + b.len; </span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; b.len; j++) <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; len; i++) </span><br><span class="line">			c.d[i+j] += d[i] * b.d[j];</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; c.len<span class="number">-1</span>; i++)</span><br><span class="line">            c.d[i+<span class="number">1</span>] += c.d[i]/<span class="number">10</span>, c.d[i] %= <span class="number">10</span>;</span><br><span class="line">        c.<span class="built_in">clean</span>();</span><br><span class="line">		<span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    bign <span class="keyword">operator</span> / (<span class="keyword">const</span> bign&amp; b)&#123;</span><br><span class="line">    	<span class="keyword">int</span> i, j;</span><br><span class="line">		bign c = *<span class="keyword">this</span>, a = <span class="number">0</span>;</span><br><span class="line">    	<span class="keyword">for</span> (i = len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    	&#123;</span><br><span class="line">    		a = a*<span class="number">10</span> + d[i];</span><br><span class="line">    		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) <span class="keyword">if</span> (a &lt; b*(j+<span class="number">1</span>)) <span class="keyword">break</span>;</span><br><span class="line">    		c.d[i] = j;</span><br><span class="line">    		a = a - b*j;</span><br><span class="line">    	&#125;</span><br><span class="line">    	c.<span class="built_in">clean</span>();</span><br><span class="line">    	<span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    bign <span class="keyword">operator</span> % (<span class="keyword">const</span> bign&amp; b)&#123;</span><br><span class="line">    	<span class="keyword">int</span> i, j;</span><br><span class="line">		bign a = <span class="number">0</span>;</span><br><span class="line">    	<span class="keyword">for</span> (i = len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    	&#123;</span><br><span class="line">    		a = a*<span class="number">10</span> + d[i];</span><br><span class="line">    		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) <span class="keyword">if</span> (a &lt; b*(j+<span class="number">1</span>)) <span class="keyword">break</span>;</span><br><span class="line">    		a = a - b*j;</span><br><span class="line">    	&#125;</span><br><span class="line">    	<span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">	bign <span class="keyword">operator</span> += (<span class="keyword">const</span> bign&amp; b)&#123;</span><br><span class="line">        *<span class="keyword">this</span> = *<span class="keyword">this</span> + b;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> bign&amp; b) <span class="keyword">const</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(len != b.len) <span class="keyword">return</span> len &lt; b.len;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = len<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">            <span class="keyword">if</span>(d[i] != b.d[i]) <span class="keyword">return</span> d[i] &lt; b.d[i];</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &gt;(<span class="keyword">const</span> bign&amp; b) <span class="keyword">const</span>&#123;<span class="keyword">return</span> b &lt; *<span class="keyword">this</span>;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;=(<span class="keyword">const</span> bign&amp; b) <span class="keyword">const</span>&#123;<span class="keyword">return</span> !(b &lt; *<span class="keyword">this</span>);&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&gt;=(<span class="keyword">const</span> bign&amp; b) <span class="keyword">const</span>&#123;<span class="keyword">return</span> !(*<span class="keyword">this</span> &lt; b);&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>!=(<span class="keyword">const</span> bign&amp; b) <span class="keyword">const</span>&#123;<span class="keyword">return</span> b &lt; *<span class="keyword">this</span> || *<span class="keyword">this</span> &lt; b;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> bign&amp; b) <span class="keyword">const</span>&#123;<span class="keyword">return</span> !(b &lt; *<span class="keyword">this</span>) &amp;&amp; !(b &gt; *<span class="keyword">this</span>);&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function">string <span class="title">str</span><span class="params">()</span> <span class="keyword">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">char</span> s[maxn]=&#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) s[len<span class="number">-1</span>-i] = d[i]+<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">istream&amp; <span class="keyword">operator</span> &gt;&gt; (istream&amp; in, bign&amp; x)</span><br><span class="line">&#123;</span><br><span class="line">    string s;</span><br><span class="line">    in &gt;&gt; s;</span><br><span class="line">    x = s.<span class="built_in">c_str</span>();</span><br><span class="line">    <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">ostream&amp; <span class="keyword">operator</span> &lt;&lt; (ostream&amp; out, <span class="keyword">const</span> bign&amp; x)</span><br><span class="line">&#123;</span><br><span class="line">    out &lt;&lt; x.<span class="built_in">str</span>();</span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>使用例:</td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">bign <span class="title">GCD</span><span class="params">(bign a,bign b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// cout&lt;&lt;&quot;@@@ &quot;&lt;&lt;a&lt;&lt;endl&lt;&lt;&quot;### &quot;&lt;&lt;b&lt;&lt;endl;;</span></span><br><span class="line">	bign k=<span class="number">0</span>,c;</span><br><span class="line">	<span class="keyword">while</span>(b&gt;k)</span><br><span class="line">	&#123;</span><br><span class="line">		c=a%b;</span><br><span class="line">		a=b;</span><br><span class="line">		b=c;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> T;</span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">110</span>];</span><br><span class="line">vector &lt;bign&gt; prime;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetPrime</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">long</span> <span class="keyword">long</span> i=<span class="number">2</span>;;i+=<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> flag=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">long</span> <span class="keyword">long</span> j=<span class="number">2</span>;j&lt;i;j+=<span class="number">1</span>)</span><br><span class="line">			<span class="keyword">if</span>(i%j==<span class="number">0</span>) flag=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(flag)</span><br><span class="line">		&#123;</span><br><span class="line">			bign k=i;</span><br><span class="line">			prime.<span class="built_in">push_back</span>(k);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>((<span class="keyword">int</span>)prime.<span class="built_in">size</span>()&gt;<span class="number">100</span>) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cin&gt;&gt;T;</span><br><span class="line">	<span class="built_in">GetPrime</span>();</span><br><span class="line">	<span class="keyword">while</span>(T--)</span><br><span class="line">	&#123;</span><br><span class="line">		bign n;</span><br><span class="line">		cin&gt;&gt;n;</span><br><span class="line">		bign a=<span class="number">1</span>,b=<span class="number">1</span>,k=<span class="number">1</span>,sum=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">int</span> pos=<span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(sum*prime[i]&lt;=n) sum=sum*prime[i],pos=i;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=pos;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			</span><br><span class="line">			b=b*prime[i];</span><br><span class="line">			a=a*(prime[i]+k);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// cout&lt;&lt;&quot;@@@ &quot;&lt;&lt;s&lt;&lt;endl;</span></span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		bign s=<span class="built_in">GCD</span>(a,b);</span><br><span class="line">		b=b/s,a=a/s;</span><br><span class="line">		cout&lt;&lt;b&lt;&lt;<span class="string">&quot;/&quot;</span>&lt;&lt;a&lt;&lt;endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>## 随机数发生器</td>
</tr>
<tr class="even">
<td>注意不要用Windows下的<span class="math inline">\(rand()\)</span></td>
</tr>
<tr class="odd">
<td><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mt19937 Rand(seed);</span><br><span class="line">mt19937 Rand(chrono::steady_clock::now().time_since_epoch().count());//cf最好用这个防止被hack</span><br><span class="line">Rand();//返回一个随机数</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="even">
<td>### 均匀分布</td>
</tr>
<tr class="odd">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 包含random头文件</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;random&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//定义均匀分布对象，均匀分布区间（a,b)为(-10，10)</span></span><br><span class="line">	std::uniform_int_distribution&lt;<span class="keyword">int</span>&gt; uid&#123; <span class="number">-10</span>,<span class="number">10</span> &#125;;</span><br><span class="line">	<span class="comment">//均匀分布区间(a,b)</span></span><br><span class="line">	std::cout &lt;&lt; uid.<span class="built_in">a</span>() &lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt; uid.<span class="built_in">b</span>() &lt;&lt; std::endl;</span><br><span class="line">	<span class="comment">//定义随机数种子</span></span><br><span class="line">	std::random_device rd;</span><br><span class="line">	<span class="comment">//定义默认随机数生成器</span></span><br><span class="line">	std::default_random_engine dre&#123; <span class="built_in">rd</span>() &#125;;</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;五个随机数如下&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">		std::cout &lt;&lt; <span class="built_in">uid</span>(dre) &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="even">
<td>## 计时</td>
</tr>
<tr class="odd">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">clock_t</span> start = <span class="built_in">clock</span>();</span><br><span class="line"><span class="comment">// do something...</span></span><br><span class="line"><span class="keyword">clock_t</span> end   = <span class="built_in">clock</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;花费了&quot;</span> &lt;&lt; (<span class="keyword">double</span>)(end - start) / CLOCKS_PER_SEC &lt;&lt; <span class="string">&quot;秒&quot;</span> &lt;&lt; endl;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="even">
<td># 数论</td>
</tr>
<tr class="odd">
<td>## 同余式</td>
</tr>
<tr class="even">
<td>同余属于等价关系, 满足自反、对称、传递三大关系 <span class="math display">\[
\begin{align}
a \equiv a \pmod m\\
a \equiv b \pmod m \iff b \equiv a \pmod m\\
a \equiv b \pmod m \and b \equiv c \pmod m \Rightarrow a \equiv c \pmod m
\end{align}
\]</span> 加、减、乘与一般运算一致. 若<span class="math inline">\(a \equiv b \pmod m\)</span>且<span class="math inline">\(c \equiv d \pmod m\)</span>, 则有 <span class="math display">\[
a+c \equiv b+d \pmod m\\
a-c \equiv b-d \pmod m\\
a*c \equiv b*d \pmod m
\]</span> <strong>除法比较特殊</strong>. 若<span class="math inline">\(ac \equiv bc \pmod m\)</span>, 则 <span class="math display">\[
a \equiv b \pmod{\frac{m}{\gcd(c,m)}}
\]</span></td>
</tr>
<tr class="odd">
<td>其它性质:</td>
</tr>
<tr class="even">
<td><span class="math display">\[
\begin{align}
ax \equiv 0 \pmod p \iff x \equiv 0 \pmod{\frac{p}{\gcd(p,a)}}
\end{align}\\
x \% b == 0 \and \frac{x}{b} \equiv 0 \pmod p \iff x \equiv 0 \pmod{bm}\\
a \equiv b \pmod m \iff a^n \equiv b^n \pmod m\\
a \equiv b \pmod m \and n|m \Rightarrow a \equiv b \pmod n
\]</span></td>
</tr>
<tr class="odd">
<td>## 快速幂</td>
</tr>
<tr class="even">
<td>计算<span class="math inline">\(x^d \mod p\)</span></td>
</tr>
<tr class="odd">
<td>注意<span class="math inline">\(a^b % p = ((a % p)^b) % p\)</span></td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">Pow</span><span class="params">(ll x,ll d)</span></span>&#123;</span><br><span class="line">	ll tans = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(d == <span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>%p;</span><br><span class="line">    x %= p;</span><br><span class="line">	ll a = <span class="built_in">Pow</span>(x,d/<span class="number">2</span>);</span><br><span class="line">	tans = a*a%p;</span><br><span class="line">	<span class="keyword">if</span>(d%<span class="number">2</span>)tans = tans*x%p; </span><br><span class="line">	<span class="keyword">return</span> tans%p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">gcd</span><span class="params">(LL a,LL b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(b)</span><br><span class="line">    &#123;</span><br><span class="line">        LL tmp=b;</span><br><span class="line">        b=a%b;</span><br><span class="line">        a=tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>## 一次不定方程</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\sum_{i = 1}^n a_i \cdot x_i = c\)</span>有整数解当且仅当<span class="math inline">\(\gcd(a_1,a_2,...,a_n) | c\)</span></td>
</tr>
<tr class="odd">
<td>## GCD &amp; exGCD</td>
</tr>
<tr class="even">
<td>x,y,d为全局变量.求x和y使得 <span class="math inline">\(ax + by = d\)</span> 且 <span class="math inline">\(|x| + |y|\)</span>最小.</td>
</tr>
<tr class="odd">
<td>其中 <span class="math inline">\(d = gcd(a,b)\)</span></td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll a,ll b)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> b?<span class="built_in">gcd</span>(b,a%b):a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gcd</span><span class="params">(ll a,ll b,ll &amp; d,ll &amp; x,ll &amp; y)</span></span>&#123;</span><br><span class="line">	<span class="comment">//notice d = gcd(a,b)</span></span><br><span class="line">	<span class="keyword">if</span>(!b)d = a,x = <span class="number">1</span>,y = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">gcd</span>(b,a%b,d,y,x);</span><br><span class="line">		y -= x*(a/b);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>## 逆元</td>
</tr>
<tr class="even">
<td>返回模p下a的逆.不存在则返回-1.</td>
</tr>
<tr class="odd">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">inv</span><span class="params">(ll a,ll p)</span></span>&#123;</span><br><span class="line">	ll d,x,y;</span><br><span class="line">	<span class="built_in">gcd</span>(a,p,d,x,y);</span><br><span class="line">	<span class="keyword">return</span> d == <span class="number">1</span>?(x+p)%p:<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> ### 线性筛逆元:</td>
</tr>
<tr class="even">
<td>返回模p下1...n的逆.保存在invs里</td>
</tr>
<tr class="odd">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_inv</span><span class="params">()</span></span>&#123;</span><br><span class="line">	inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; maxn;i++)&#123;</span><br><span class="line">		inv[i] = (ll)(p - p/i)*inv[p%i]%p;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="even">
<td>## a,b不互质时</td>
</tr>
<tr class="odd">
<td><span class="math display">\[
\frac{a}{b} \mod m = \frac{a \mod (mb)}{b}
\]</span></td>
</tr>
<tr class="even">
<td>证: <span class="math display">\[
\begin{align}
&amp;\frac{a}{b} = km + x (x &lt; m)\\
\Rightarrow \space &amp;a =kbm + bx\\
\Rightarrow \space &amp;a \mod (bm) = bx\\
\Rightarrow \space &amp;\frac{a \mod (bm)}{b} = x\\
\Rightarrow \space &amp;\frac{a \mod (bm)}{b} = \frac{a}{b} \mod m
\end{align}
\]</span></td>
</tr>
<tr class="odd">
<td>## 中国剩余定理(CRT)</td>
</tr>
<tr class="even">
<td>求同余方程组 <span class="math display">\[
\begin{cases} x &amp;\equiv a_1 \pmod {m_1} \\ x &amp;\equiv a_2 \pmod {m_2} \\ &amp;\vdots \\ x &amp;\equiv a_k \pmod {m_k} \\ \end{cases}
\]</span> 在<span class="math inline">\([0,\prod_{i = 1}^nm_i])\)</span>中的解. 要求任意<span class="math inline">\(m_i\)</span>两两互质</td>
</tr>
<tr class="odd">
<td>输入: <code>int n</code> 方程组个数, <code>ll a[] ll m[]</code>,方程组的参数和模数</td>
</tr>
<tr class="even">
<td>复杂度:<span class="math inline">\(O(nlogM)\)</span>, 其中<span class="math inline">\(M\)</span>与<span class="math inline">\(m_i\)</span>同阶</td>
</tr>
<tr class="odd">
<td>输出: 方程组在<span class="math inline">\([0,\prod_{i = 1}^nm_i])\)</span>中的解.</td>
</tr>
<tr class="even">
<td>前置: 逆元</td>
</tr>
<tr class="odd">
<td>调用 <code>CRT(n,a,m)</code></td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">CRT</span><span class="params">(<span class="keyword">int</span> n,ll * a,ll * m)</span></span>&#123;</span><br><span class="line">	ll M = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)M *= m[i];</span><br><span class="line">	ll ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		ll mt = M/m[i];</span><br><span class="line">		ll ret = <span class="built_in">inv</span>(mt,m[i]);</span><br><span class="line">		ans = (ans + a[i]*mt%M*ret%M)%M;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (ans + M)%M;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>## Eratosthenes筛</td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">prime</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!n_prime[i])&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = i*<span class="number">2</span>;j &lt;= n;j += i)n_prime[j] = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	n_prime[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>## 线性筛</td>
</tr>
<tr class="even">
<td><strong>筛素因子时记得直接去掉最后一个素因子, 否则复杂度不对</strong></td>
</tr>
<tr class="odd">
<td>### 线性筛素数</td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> not_p[maxn];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;prime;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">euler_sieve</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	not_p[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!not_p[i])&#123;</span><br><span class="line">			prime.<span class="built_in">push_back</span>(i);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> p:prime)&#123;</span><br><span class="line">			<span class="keyword">if</span>((ll)p*i &gt;= n)<span class="keyword">break</span>;</span><br><span class="line">			not_p[p*i] = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(i%p == <span class="number">0</span>)<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>### 线性筛<span class="math inline">\(\varphi\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\varphi(n)\)</span>: 小于等于<span class="math inline">\(n\)</span>的正整数中与<span class="math inline">\(n\)</span>互质的数个数</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\varphi\)</span>的一些性质(以下<span class="math inline">\(p\)</span>代表素数) <span class="math display">\[
\varphi(p) = p-1\\
如果i \% p == 0, \varphi(i*p) = \varphi(i)*p\\
否则\varphi(i*p) = \varphi(i)*(p-1)
\]</span></td>
</tr>
<tr class="even">
<td>phi[n]为<span class="math inline">\(\varphi(n)\)</span>,prime里存的素数</td>
</tr>
<tr class="odd">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> phi[maxn];</span><br><span class="line"><span class="keyword">bool</span> not_p[maxn];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;prime;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">eular_sieve</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	not_p[<span class="number">1</span>] = phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!not_p[i])&#123;</span><br><span class="line">			phi[i] = i<span class="number">-1</span>;</span><br><span class="line">			prime.<span class="built_in">push_back</span>(i);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> p:prime)&#123;</span><br><span class="line">			<span class="keyword">if</span>((ll)p*i &gt;= n)<span class="keyword">break</span>;</span><br><span class="line">			not_p[p*i] = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(i%p)phi[i*p] = phi[i]*(p<span class="number">-1</span>);</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				phi[i*p] = phi[i]*p;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="even">
<td>### 线性筛<span class="math inline">\(\mu\)</span></td>
</tr>
<tr class="odd">
<td><span class="math display">\[
\mu(n)= \begin{cases} 1&amp;n=1\\ 0&amp;n\text{ 含有平方因子}\\ (-1)^k&amp;k\text{ 为 }n\text{ 的本质不同质因子个数}\\ \end{cases}
\]</span></td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> phi[maxn],mu[maxn];</span><br><span class="line"><span class="keyword">bool</span> not_p[maxn];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;prime;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sieve_mu</span><span class="params">()</span></span>&#123;</span><br><span class="line">	not_p[<span class="number">1</span>] = mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; maxn;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!not_p[i])&#123;</span><br><span class="line">			mu[i] = <span class="number">-1</span>;</span><br><span class="line">			prime.<span class="built_in">push_back</span>(i);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> p:prime)&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">ll</span>(p)*i &gt;= maxn)<span class="keyword">break</span>;</span><br><span class="line">			not_p[p*i] = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(i%p)mu[i*p] = -mu[i];</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				mu[i*p] = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>## 杜教筛</td>
</tr>
<tr class="even">
<td>详细请见杜教筛笔记.</td>
</tr>
<tr class="odd">
<td>杜教筛快速筛<span class="math inline">\(\varphi\)</span>和<span class="math inline">\(\mu\)</span>的前缀和.<span class="math inline">\(maxn = n^{\frac{2}{3}}\)</span>时复杂度为<span class="math inline">\(O(n^{\frac{2}{3}})\)</span></td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1664510</span>;</span><br><span class="line"><span class="keyword">bool</span> not_p[maxn];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;prime;</span><br><span class="line">ll mu[maxn],phi[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sieve</span><span class="params">()</span></span>&#123;</span><br><span class="line">	phi[<span class="number">1</span>] = mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt; maxn;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!not_p[i])&#123;</span><br><span class="line">			mu[i] = <span class="number">-1</span>;</span><br><span class="line">			phi[i] = i<span class="number">-1</span>;</span><br><span class="line">			prime.<span class="built_in">push_back</span>(i);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> p:prime)&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="number">1LL</span>*p*i &gt;= maxn)<span class="keyword">break</span>;</span><br><span class="line">			not_p[i*p] = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(i%p)&#123;</span><br><span class="line">				phi[i*p] = phi[i]*(p<span class="number">-1</span>);</span><br><span class="line">				mu[i*p] = -mu[i];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				phi[i*p] = phi[i]*p;</span><br><span class="line">				mu[i*p] = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line"> 		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; maxn;i++)mu[i] += mu[i<span class="number">-1</span>],phi[i] += phi[i<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br><span class="line">map&lt;<span class="keyword">int</span>,ll&gt;Mu,Phi;</span><br><span class="line"><span class="function">ll <span class="title">du_mu</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x &lt; maxn)<span class="keyword">return</span> mu[x];</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(Mu[x])<span class="keyword">return</span> Mu[x];</span><br><span class="line">	ll tans = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> l = <span class="number">2</span>,r = <span class="number">0</span>;l &lt;= x;l = r+<span class="number">1</span>)&#123;</span><br><span class="line">		r = x/(x/l);</span><br><span class="line">		tans -= <span class="number">1LL</span>*(r - l + <span class="number">1</span>)*<span class="built_in">du_mu</span>(x/l);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> Mu[x] = tans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">du_phi</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x &lt; maxn)<span class="keyword">return</span> phi[x];</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(Phi[x])<span class="keyword">return</span> Phi[x];</span><br><span class="line">	ll tans = <span class="number">1LL</span>*x*(x+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> l = <span class="number">2</span>,r = <span class="number">0</span>;l &lt;= x;l = r+<span class="number">1</span>)&#123;</span><br><span class="line">		r = x/(x/l);</span><br><span class="line">		tans -= <span class="number">1LL</span>*(r-l+<span class="number">1</span>)*<span class="built_in">du_phi</span>(x/l);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> Phi[x] = tans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>## 欧拉函数<span class="math inline">\(φ(x)\)</span></td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">cal_phi</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> m = (ll)<span class="built_in">sqrt</span>(x+<span class="number">0.5</span>);</span><br><span class="line">	ll tans = x;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= m;i++)<span class="keyword">if</span>(!(x%i))&#123;</span><br><span class="line">		tans = tans/i*(i<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">while</span>(!(x%i))x /= i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(x &gt; <span class="number">1</span>)tans = tans / x * (x<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>### 线性筛<span class="math inline">\(φ(x)\)</span></td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sieve_phi</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)<span class="keyword">if</span>(!phi[i])</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = i;j &lt;= n;j += i)&#123;</span><br><span class="line">			<span class="keyword">if</span>(!phi[j])phi[j] = j;</span><br><span class="line">			phi[j] = phi[j]/i * (i<span class="number">-1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>## 有理数取模</td>
</tr>
<tr class="even">
<td>求<span class="math inline">\(a/b\)</span> % <span class="math inline">\(p\)</span> （p为质数)</td>
</tr>
<tr class="odd">
<td>由费马小定理<span class="math inline">\(b^{p-1} ≡ 1 \pmod p\)</span> 可得 <span class="math inline">\(b^{p-2} ≡ b^{-1} \pmod p\)</span></td>
</tr>
<tr class="even">
<td>故只需求<span class="math inline">\(a*b^{p-2} \bmod p\)</span></td>
</tr>
<tr class="odd">
<td>a,b过大则先膜一下</td>
</tr>
<tr class="even">
<td>## 欧拉定理</td>
</tr>
<tr class="odd">
<td>若<span class="math inline">\(a,p\)</span>互质,则有</td>
</tr>
<tr class="even">
<td><span class="math inline">\(a^{φ(p)} ≡ 1 \pmod p\)</span></td>
</tr>
<tr class="odd">
<td>### 扩展欧拉定理(无需a,p互质)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(b ≥ φ(p)\)</span>时:</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(a^b ≡ a^{b \space \bmod \space φ(p) +φ(p)} \pmod p\)</span></td>
</tr>
<tr class="even">
<td>例题: 给出<span class="math inline">\(w_1,w_2,..w_n\)</span>和<span class="math inline">\(q\)</span>组询问<span class="math inline">\(l \space r\)</span>. 求<span class="math inline">\(w_l^{w_{l+1}^{...^{w_r}}} \pmod p\)</span>​的值</td>
</tr>
<tr class="odd">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CF906D </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll maxn = <span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line">ll raw[maxn],n,mod;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> r1aw[maxn];</span><br><span class="line">map&lt;ll,ll&gt;vis;</span><br><span class="line"><span class="function">ll <span class="title">phi</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	ll m = (ll)<span class="built_in">sqrt</span>(x+<span class="number">0.5</span>);</span><br><span class="line">	ll tans = x;</span><br><span class="line">	<span class="keyword">for</span>(ll i = <span class="number">2</span>;i &lt;= m;i++)<span class="keyword">if</span>(!(x%i))&#123;</span><br><span class="line">		tans = tans/i*(i<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">while</span>(!(x%i))x /= i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(x &gt; <span class="number">1</span>)tans = tans / x * (x<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Pow</span><span class="params">(ll x,ll d,ll p)</span></span>&#123;</span><br><span class="line">	ll tans = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(d == <span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>%p;</span><br><span class="line">    x %= p;</span><br><span class="line">	ll a = <span class="built_in">Pow</span>(x,d/<span class="number">2</span>,p);</span><br><span class="line">	tans = a*a%p;</span><br><span class="line">	<span class="keyword">if</span>(d%<span class="number">2</span>)tans = tans*x%p; </span><br><span class="line">	<span class="keyword">return</span> tans%p;</span><br><span class="line">&#125;</span><br><span class="line">ll w[maxn],p0[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) <span class="keyword">return</span> <span class="built_in">min</span>(w[l],w[l]%p0[k]+p0[k]);</span><br><span class="line">	<span class="keyword">if</span> (p0[k]==<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> c=<span class="built_in">cal</span>(l+<span class="number">1</span>,r,k+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span> (w[l]==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		ll v=<span class="built_in">Pow</span>(w[l],c,p0[k]);</span><br><span class="line">		ll d=<span class="number">1ll</span>&lt;&lt;<span class="number">60</span>,e=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; c;i++) &#123; d/=w[l]; e*=w[l]; <span class="keyword">if</span> (d==<span class="number">0</span>) <span class="keyword">break</span>; &#125;</span><br><span class="line">		<span class="keyword">if</span> (d==<span class="number">0</span>) <span class="keyword">return</span> v+p0[k]; <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">min</span>(e,e%p0[k]+p0[k]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">int</span> n;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; mod;</span><br><span class="line">	<span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">	p0[idx] = mod;</span><br><span class="line">	<span class="keyword">while</span>(p0[idx] != <span class="number">1</span>)&#123;p0[idx+<span class="number">1</span>] = <span class="built_in">phi</span>(p0[idx]);idx++;&#125;</span><br><span class="line">	<span class="keyword">for</span>(ll i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		cin &gt;&gt; w[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> q;</span><br><span class="line">	cin &gt;&gt; q;</span><br><span class="line">	<span class="keyword">while</span>(q--)&#123;</span><br><span class="line">		<span class="keyword">int</span> l,r;</span><br><span class="line">		cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">		cout &lt;&lt; <span class="built_in">cal</span>(l,r,<span class="number">0</span>)%mod &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="even">
<td>## 原根</td>
</tr>
<tr class="odd">
<td><code>proot(p)</code> 返回素数p的原根</td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="keyword">int</span>&gt;pri;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">g_test</span><span class="params">(ll g,ll p)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll x:pri)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">Pow</span>(g,(p<span class="number">-1</span>)/x,p) == <span class="number">1</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">proot</span><span class="params">(ll p)</span></span>&#123;</span><br><span class="line">	ll tmp = p<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(ll i = <span class="number">2</span>;i &lt;= tmp/i;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(tmp%i == <span class="number">0</span>)&#123;</span><br><span class="line">			pri.<span class="built_in">push_back</span>(i);</span><br><span class="line">			<span class="keyword">while</span>(tmp%i == <span class="number">0</span>)tmp /= i;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(tmp != <span class="number">1</span>)pri.<span class="built_in">push_back</span>(tmp);</span><br><span class="line">	ll g = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">g_test</span>(g,p))<span class="keyword">return</span> g;</span><br><span class="line">		g++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>## 离散对数(BSGS)</td>
</tr>
<tr class="even">
<td>### 原版</td>
</tr>
<tr class="odd">
<td>只支持模数为<span class="math inline">\(p\)</span>的情况.</td>
</tr>
<tr class="even">
<td><code>bsgs(ll a,ll b,ll p)</code>返回最小的<span class="math inline">\(x\)</span>使得<span class="math inline">\(a^x \equiv b\pmod{p}\)</span>, 不存在则返回<span class="math inline">\(-1\)</span>. 要求<span class="math inline">\(p\)</span>为素数. 时间复杂度<span class="math inline">\(O(\sqrt p \cdot \log(\sqrt{p}))\)</span></td>
</tr>
<tr class="odd">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bsgs</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">	map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;f;</span><br><span class="line">	<span class="keyword">int</span> m = <span class="built_in">ceil</span>(<span class="built_in">sqrt</span>(p));</span><br><span class="line">	b %= p;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line">		b = <span class="number">1ll</span>*b*a%p;</span><br><span class="line">		f[b] = i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> v = <span class="built_in">Pow</span>(a,m,p);</span><br><span class="line">	b = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= m;i++)&#123;</span><br><span class="line">		b = <span class="number">1ll</span>*b*v%p;</span><br><span class="line">		<span class="keyword">if</span>(f.<span class="built_in">count</span>(b))<span class="keyword">return</span> (<span class="number">1ll</span>*i*m - f[b] + p)%p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="even">
<td>求最小的正整数<span class="math inline">\(n\)</span>使得<span class="math inline">\(a^n \equiv 1 \pmod m\)</span></td>
</tr>
<tr class="odd">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ord</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> m)</span></span>&#123;</span><br><span class="line">	a %= m;</span><br><span class="line">	<span class="keyword">if</span>(__gcd(a,m) != <span class="number">1</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">int</span> sq = <span class="built_in">sqrt</span>(m)+<span class="number">1</span>;</span><br><span class="line">	map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;mp;</span><br><span class="line">	ll s = a;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= sq;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!mp.<span class="built_in">count</span>(s))mp[s] = i;</span><br><span class="line">		s = s*a%m;</span><br><span class="line">	&#125;</span><br><span class="line">	ll g = <span class="built_in">inv</span>(<span class="built_in">Pow</span>(a,sq,m),m),x = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>;k &lt;= m/sq;k++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(mp.<span class="built_in">count</span>(x))<span class="keyword">return</span> sq*k + mp[x];</span><br><span class="line">		x = x*g%m;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="even">
<td>### 扩展版</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(p\)</span>可以是任意模数. 前置:<code>bsgs exgcd inv</code></td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">exbsgs</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(b == <span class="number">1</span> <span class="keyword">or</span> p == <span class="number">1</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> g = __gcd(a,p),k = <span class="number">0</span>,na = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(g &gt; <span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(b%g != <span class="number">0</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		k++;</span><br><span class="line">		b /= g;p /= g;na = na*(a/g)%p;</span><br><span class="line">		<span class="keyword">if</span>(na == b)<span class="keyword">return</span> k;</span><br><span class="line">		g = __gcd(a,p);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> f = <span class="built_in">bsgs</span>(a,b*<span class="built_in">inv</span>(na,p)%p,p);</span><br><span class="line">	<span class="keyword">if</span>(f == <span class="number">-1</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">return</span> f+k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>## 拉格朗日插值</td>
</tr>
<tr class="even">
<td>px,py为点坐标,p为模数,k是L(k)那个k inv为逆元</td>
</tr>
<tr class="odd">
<td>返回L(k)</td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">lagrange</span><span class="params">(ll n,ll k)</span></span>&#123;</span><br><span class="line">	ll tans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		ll f = <span class="number">1</span>,g = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)<span class="keyword">if</span>(i != j)&#123;</span><br><span class="line">			f = f*(k - px[j]+p)%p;</span><br><span class="line">			g = g*(px[i] - px[j]+p)%p;</span><br><span class="line">		&#125;</span><br><span class="line">		ll lota = py[i]*f%p*<span class="built_in">inv</span>(g,p)%p;</span><br><span class="line">		tans = (tans+lota)%p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tans; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>### 线性求<span class="math inline">\(\sum_{i = 0}^{n}i^k\)</span></td>
</tr>
<tr class="even">
<td>(返回L(k)的值,多项式次数为n.按需更改yi的值,复杂度<span class="math inline">\(O(k)\)</span>)</td>
</tr>
<tr class="odd">
<td>(注意求<span class="math inline">\(\sum_{i = 0}^{n}i^k\)</span>需要调用line_lagrange(k+2,n) )</td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">line_lagrange</span><span class="params">(ll n,ll k)</span></span>&#123;</span><br><span class="line">	ll tans = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">get_inv</span>();</span><br><span class="line">	pre[<span class="number">0</span>] = suf[n+<span class="number">1</span>] = ifac[<span class="number">0</span>] =  <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		pre[i] = pre[i<span class="number">-1</span>]*(k-i)%mod;</span><br><span class="line">		ifac[i] = ifac[i<span class="number">-1</span>]*invs[i]%mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = n;i &gt;= <span class="number">0</span>;i--)suf[i] = suf[i+<span class="number">1</span>]*(k-i)%mod;</span><br><span class="line">	ll yi = <span class="number">0</span>; </span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		yi = (yi+<span class="built_in">pow_mod</span>(i,n<span class="number">-2</span>))%mod;</span><br><span class="line">		ll a = pre[i<span class="number">-1</span>]*suf[i+<span class="number">1</span>]%mod*yi%mod*ifac[i<span class="number">-1</span>]%mod*ifac[n-i]%mod;</span><br><span class="line">		<span class="keyword">if</span>((n-i)%<span class="number">2</span>)a = mod-a; </span><br><span class="line">		tans = (tans+a+mod)%mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
<tr class="odd">
<td>## 卢卡斯定理</td>
</tr>
<tr class="even">
<td>Lucas(n,m) = C(n%p,m%p)*Lucas(n/p,m/p)%p</td>
</tr>
<tr class="odd">
<td>p需为素数,fac[]为预处理的阶乘,时间复杂度大约是<span class="math inline">\(O(p + mlogm)\)</span>(预处理需要<span class="math inline">\(O(p)\)</span>)</td>
</tr>
<tr class="even">
<td><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">C</span><span class="params">(ll n,ll m)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(m &gt; n)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> (fac[n]*<span class="built_in">Pow</span>(fac[m],p<span class="number">-2</span>)%p*<span class="built_in">Pow</span>(fac[n-m],p<span class="number">-2</span>)%p)%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">Lucas</span><span class="params">(ll n,ll m)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!m)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">C</span>(n%p,m%p)*<span class="built_in">Lucas</span>(n/p,m/p)%p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></td>
</tr>
</tbody>
</table>
<h2 id="线性基">线性基</h2>
<p>maxbit取值域位数</p>
<p>insert返回0则说明现有基可以表示x</p>
<p>qmax返回异或最大值</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LinerBasis</span>&#123;</span></span><br><span class="line">	ll base[maxbit+<span class="number">4</span>];</span><br><span class="line">	<span class="keyword">bool</span> vis[maxbit+<span class="number">4</span>];</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">insert</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = maxbit;~i;i--)&#123;</span><br><span class="line">			<span class="keyword">if</span>(x&amp;(<span class="number">1LL</span>&lt;&lt;i))&#123;</span><br><span class="line">				<span class="keyword">if</span>(!base[i])&#123;</span><br><span class="line">					base[i] = x;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> x ^= base[i];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">qmax</span><span class="params">()</span></span>&#123;</span><br><span class="line">		ll ans = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = maxbit;~i;i--)ans = <span class="built_in">max</span>(ans,ans^base[i]);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;yay;</span><br></pre></td></tr></table></figure>
<h2 id="杜教bm快速求模意义下线性递推式">杜教BM(快速求模意义下线性递推式)</h2>
<p>设<span class="math inline">\(n\)</span>为输入项数, 复杂度<span class="math inline">\(O(n^2\log n)\)</span>. 对于<span class="math inline">\(k\)</span>阶递推式(例如斐波那契数列为2阶递推式)至少需要前<span class="math inline">\(2k\)</span>项</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i,a,n) for (int i=a;i&lt;n;i++)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SZ(x) ((ll)(x).size())</span></span><br><span class="line"><span class="keyword">typedef</span> vector&lt;ll&gt; VI;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;ll, ll&gt; PII;</span><br><span class="line"><span class="keyword">const</span> ll mod = <span class="number">1000000007</span>;</span><br><span class="line"><span class="function">ll <span class="title">powmod</span><span class="params">(ll a, ll b)</span> </span>&#123; ll res = <span class="number">1</span>; a %= mod; <span class="built_in">assert</span>(b &gt;= <span class="number">0</span>); <span class="keyword">for</span> (; b; b &gt;&gt;= <span class="number">1</span>) &#123; <span class="keyword">if</span> (b &amp; <span class="number">1</span>)res = res * a % mod; a = a * a % mod; &#125;<span class="keyword">return</span> res; &#125;</span><br><span class="line"><span class="comment">// head</span></span><br><span class="line"> </span><br><span class="line">ll _, n;</span><br><span class="line"><span class="keyword">namespace</span> linear_seq &#123;</span><br><span class="line">    <span class="keyword">const</span> ll N = <span class="number">10010</span>;</span><br><span class="line">    ll res[N], base[N], _c[N], _md[N];</span><br><span class="line"> </span><br><span class="line">    vector&lt;ll&gt; Md;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">mul</span><span class="params">(ll* a, ll* b, ll k)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, k + k) _c[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, k) <span class="keyword">if</span> (a[i]) <span class="built_in">rep</span>(j, <span class="number">0</span>, k) _c[i + j] = (_c[i + j] + a[i] * b[j]) % mod;</span><br><span class="line">        <span class="keyword">for</span> (ll i = k + k - <span class="number">1</span>; i &gt;= k; i--) <span class="keyword">if</span> (_c[i])</span><br><span class="line">            <span class="built_in">rep</span>(j, <span class="number">0</span>, <span class="built_in">SZ</span>(Md)) _c[i - k + Md[j]] = (_c[i - k + Md[j]] - _c[i] * _md[Md[j]]) % mod;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, k) a[i] = _c[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">solve</span><span class="params">(ll n, VI a, VI b)</span> </span>&#123; <span class="comment">// a 系数 b 初值 b[n+1]=a[0]*b[n]+...</span></span><br><span class="line"><span class="comment">//        printf(&quot;%d\n&quot;,SZ(b));</span></span><br><span class="line">        ll ans = <span class="number">0</span>, pnt = <span class="number">0</span>;</span><br><span class="line">        ll k = <span class="built_in">SZ</span>(a);</span><br><span class="line">        <span class="built_in">assert</span>(<span class="built_in">SZ</span>(a) == <span class="built_in">SZ</span>(b));</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, k) _md[k - <span class="number">1</span> - i] = -a[i]; _md[k] = <span class="number">1</span>;</span><br><span class="line">        Md.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, k) <span class="keyword">if</span> (_md[i] != <span class="number">0</span>) Md.<span class="built_in">push_back</span>(i);</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, k) res[i] = base[i] = <span class="number">0</span>;</span><br><span class="line">        res[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> ((<span class="number">1ll</span> &lt;&lt; pnt) &lt;= n) pnt++;</span><br><span class="line">        <span class="keyword">for</span> (ll p = pnt; p &gt;= <span class="number">0</span>; p--) &#123;</span><br><span class="line">            <span class="built_in">mul</span>(res, res, k);</span><br><span class="line">            <span class="keyword">if</span> ((n &gt;&gt; p) &amp; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (ll i = k - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) res[i + <span class="number">1</span>] = res[i]; res[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">                <span class="built_in">rep</span>(j, <span class="number">0</span>, <span class="built_in">SZ</span>(Md)) res[Md[j]] = (res[Md[j]] - res[k] * _md[Md[j]]) % mod;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, k) ans = (ans + res[i] * b[i]) % mod;</span><br><span class="line">        <span class="keyword">if</span> (ans &lt; <span class="number">0</span>) ans += mod;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">VI <span class="title">BM</span><span class="params">(VI s)</span> </span>&#123;</span><br><span class="line">        <span class="function">VI <span class="title">C</span><span class="params">(<span class="number">1</span>, <span class="number">1</span>)</span>, <span class="title">B</span><span class="params">(<span class="number">1</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line">        ll L = <span class="number">0</span>, m = <span class="number">1</span>, b = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">rep</span>(n, <span class="number">0</span>, <span class="built_in">SZ</span>(s)) &#123;</span><br><span class="line">            ll d = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">rep</span>(i, <span class="number">0</span>, L + <span class="number">1</span>) d = (d + (ll)C[i] * s[n - i]) % mod;</span><br><span class="line">            <span class="keyword">if</span> (d == <span class="number">0</span>) ++m;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">2</span> * L &lt;= n) &#123;</span><br><span class="line">                VI T = C;</span><br><span class="line">                ll c = mod - d * <span class="built_in">powmod</span>(b, mod - <span class="number">2</span>) % mod;</span><br><span class="line">                <span class="keyword">while</span> (<span class="built_in">SZ</span>(C) &lt; <span class="built_in">SZ</span>(B) + m) C.<span class="built_in">pb</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="built_in">rep</span>(i, <span class="number">0</span>, <span class="built_in">SZ</span>(B)) C[i + m] = (C[i + m] + c * B[i]) % mod;</span><br><span class="line">                L = n + <span class="number">1</span> - L; B = T; b = d; m = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                ll c = mod - d * <span class="built_in">powmod</span>(b, mod - <span class="number">2</span>) % mod;</span><br><span class="line">                <span class="keyword">while</span> (<span class="built_in">SZ</span>(C) &lt; <span class="built_in">SZ</span>(B) + m) C.<span class="built_in">pb</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="built_in">rep</span>(i, <span class="number">0</span>, <span class="built_in">SZ</span>(B)) C[i + m] = (C[i + m] + c * B[i]) % mod;</span><br><span class="line">                ++m;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> C;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ll <span class="title">gao</span><span class="params">(VI a, ll n)</span> </span>&#123;</span><br><span class="line">        VI c = <span class="built_in">BM</span>(a);</span><br><span class="line">        c.<span class="built_in">erase</span>(c.<span class="built_in">begin</span>());</span><br><span class="line">        <span class="built_in">rep</span>(i, <span class="number">0</span>, <span class="built_in">SZ</span>(c)) c[i] = (mod - c[i]) % mod;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">solve</span>(n, c, <span class="built_in">VI</span>(a.<span class="built_in">begin</span>(), a.<span class="built_in">begin</span>() + <span class="built_in">SZ</span>(c)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;n)) &#123;</span><br><span class="line">        vector&lt;ll&gt;v;</span><br><span class="line">        v.<span class="built_in">push_back</span>(<span class="number">1</span>);<span class="comment">/*前几项*/</span>v.<span class="built_in">push_back</span>(<span class="number">5</span>);v.<span class="built_in">push_back</span>(<span class="number">15</span>);</span><br><span class="line">        v.<span class="built_in">push_back</span>(<span class="number">35</span>);v.<span class="built_in">push_back</span>(<span class="number">70</span>);v.<span class="built_in">push_back</span>(<span class="number">126</span>);</span><br><span class="line">        v.<span class="built_in">push_back</span>(<span class="number">210</span>);v.<span class="built_in">push_back</span>(<span class="number">330</span>);v.<span class="built_in">push_back</span>(<span class="number">495</span>);v.<span class="built_in">push_back</span>(<span class="number">715</span>);</span><br><span class="line">        v.<span class="built_in">push_back</span>(<span class="number">1001</span>);</span><br><span class="line">        <span class="comment">//输入n ,输出第n项的值  一般大于10项即可出答案，越多越好</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, linear_seq::<span class="built_in">gao</span>(v, n - <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="特殊计数序列">特殊计数序列</h1>
<h2 id="第二类stirling数">第二类Stirling数</h2>
<p>第二类Stirling数<span class="math inline">\(S(n,m)\)</span>计数的是把<span class="math inline">\(n\)</span>个元素的集合划分到<span class="math inline">\(m\)</span>个不可区分的盒子中且没有空盒子的划分个数.</p>
<p><span class="math inline">\(S(n,n) = 1\)</span>, <span class="math inline">\(S(n,0) = 0\space(n &gt; 0)\)</span></p>
<p>递推式: <span class="math inline">\(S(n,m) = m \cdot S(n-1,m) + S(n-1,m-1)\)</span></p>
<h3 id="求第n行">求第n行</h3>
<p><span class="math display">\[
S(n,m) = \sum_{i = 0}^m \frac{i^n}{i!}\cdot\frac{(-1)^{m-i}}{(m-i)!}
\]</span> 用NTT求解即可. <code>finv[i]</code>为<span class="math inline">\(i!\)</span>的逆元, 需要<strong>线性</strong>预处理出来. <code>mul()</code>见NTT板子. 时间复杂度<span class="math inline">\(O(n \log n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Poly <span class="title">Stirling_row</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="function">Poly <span class="title">A</span><span class="params">(n+<span class="number">1</span>)</span>,<span class="title">B</span><span class="params">(n+<span class="number">1</span>)</span></span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		A[i] = <span class="number">1ll</span>*<span class="built_in">Pow</span>(i,n)*finv[i]%p;</span><br><span class="line">		B[i] = ( ( <span class="number">1ll</span> * ((n-i)%<span class="number">2</span>?<span class="number">-1</span>:<span class="number">1</span>) * finv[n-i] )%p+p)%p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">reverse</span>(B.<span class="built_in">begin</span>(),B.<span class="built_in">end</span>());</span><br><span class="line">	<span class="keyword">auto</span> tans = <span class="built_in">mul</span>(A,B);</span><br><span class="line">	tans.<span class="built_in">resize</span>(n+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="求第k列">求第k列</h3>
<p><span class="math display">\[
\sum_{n = k}^{\infin}S(n,k) \cdot \frac{x^n}{n!} = \frac{(e^x - 1)^k}{k!}
\]</span></p>
<p>因而有 <span class="math display">\[
S(n,k) = \frac{n!}{k!}\cdot[n](e^x - 1)^k
\]</span> 多项式快速幂即可. 时间复杂度<span class="math inline">\(O(n \log n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Poly <span class="title">Stirling_Col</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">	<span class="function">Poly <span class="title">A</span><span class="params">(n+<span class="number">1</span>)</span></span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)A[i] = finv[i];</span><br><span class="line">	A = <span class="built_in">powP</span>(A,k,k);</span><br><span class="line">	A.<span class="built_in">resize</span>(n+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)A[i] = <span class="number">1ll</span>*A[i]*finv[k]%p*fac[i]%p;</span><br><span class="line">		<span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="bell数">Bell数</h2>
<p>Bell数(<span class="math inline">\(B(n)\)</span>)计数的是将一个有<span class="math inline">\(n\)</span>个元素的集合划分成任意个非空子集的方案数. 显然有<span class="math inline">\(B(n) = \sum_{i = 1}^n S(n,i)\)</span></p>
<p>前10个Bell数为<code>1 2 5 15 52 203 877 4140 21147 115975</code> <span class="math display">\[
B(n) = [n]e^{e^x - 1}
\]</span> 多项式指数函数即可. 时间复杂度<span class="math inline">\(O(n\log n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Poly <span class="title">Bell</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="function">Poly <span class="title">A</span><span class="params">(n+<span class="number">1</span>)</span></span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)A[i] = finv[i];</span><br><span class="line">	A = <span class="built_in">expP</span>(A);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)A[i] = <span class="number">1ll</span>*A[i]*fac[i]%p;</span><br><span class="line">	<span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="博弈论">博弈论</h1>
<h2 id="威佐夫游戏">威佐夫游戏</h2>
<p>两人轮流取两堆筹码，其中取法有两种：取走一堆中任意个筹码，或从两堆中取走相同数目的筹码。取完所有筹码的一方获胜。</p>
<p>(1为先手胜)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(n1&gt;n2)  <span class="built_in">swap</span>(n1,n2);</span><br><span class="line">temp=<span class="built_in">floor</span>((n2-n1)*(<span class="number">1</span>+<span class="built_in">sqrt</span>(<span class="number">5.0</span>))/<span class="number">2.0</span>);</span><br><span class="line"><span class="keyword">if</span>(temp==n1) cout&lt;&lt;<span class="string">&quot;0&quot;</span>&lt;&lt;endl;</span><br><span class="line"><span class="keyword">else</span> cout&lt;&lt;<span class="string">&quot;1&quot;</span>&lt;&lt;endl;</span><br></pre></td></tr></table></figure>
<h1 id="矩阵">矩阵</h1>
<h2 id="定义快速幂">定义&amp;快速幂</h2>
<p><strong>注意：vector版的矩阵会比数组慢起码2倍，时间吃紧的时候慎用</strong></p>
<p>数组版:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FOR(i,a,b) for(int i = a;i &lt;= b;i++)</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span>&#123;</span></span><br><span class="line">	ll A[maxn][maxn];</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">initer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)A[i][j] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)A[i][i] = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	Matrix <span class="keyword">operator</span> * (<span class="keyword">const</span> Matrix &amp; a)&#123;</span><br><span class="line">		Matrix res;</span><br><span class="line">		<span class="built_in">memset</span>(res.A,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(res.A));</span><br><span class="line">		<span class="built_in">FOR</span>(k,<span class="number">1</span>,n)</span><br><span class="line">			<span class="built_in">FOR</span>(i,<span class="number">1</span>,n)</span><br><span class="line">				<span class="built_in">FOR</span>(j,<span class="number">1</span>,n)&#123;</span><br><span class="line">					res.A[i][j] = (res.A[i][j] + (A[i][k]*a.A[k][j]));</span><br><span class="line">					<span class="keyword">if</span>(res.A[i][j] &gt; MOD2)res.A[i][j] -= MOD2;</span><br><span class="line">				&#125;</span><br><span class="line">		<span class="built_in">FOR</span>(i,<span class="number">1</span>,n)</span><br><span class="line">			<span class="built_in">FOR</span>(j,<span class="number">1</span>,n)res.A[i][j] %= MOD;</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>vector版:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> vector&lt;vector&lt;<span class="keyword">int</span>&gt; &gt; Matrix;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Minit</span><span class="params">(Matrix &amp; a)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = a.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; n;j++)a[i][j] = (i == j);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Matrix <span class="keyword">operator</span> * (<span class="keyword">const</span> Matrix &amp; a,<span class="keyword">const</span> Matrix &amp; b)&#123;<span class="comment">//需保证a的列数等于b的行数且两个矩阵都不为空</span></span><br><span class="line">	<span class="keyword">int</span> n = a.<span class="built_in">size</span>(),m = b.<span class="built_in">size</span>(),r = b[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">	<span class="function">Matrix <span class="title">res</span><span class="params">(n,vector&lt;<span class="keyword">int</span>&gt;(m))</span></span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>;k &lt; m;k++)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; r;j++)&#123;</span><br><span class="line">				res[i][j] = (res[i][j] + (<span class="number">1ll</span>*a[i][k]*b[k][j])%MOD)%MOD;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Matrix <span class="title">matrixPow</span><span class="params">(Matrix x,ll d)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = x.<span class="built_in">size</span>();</span><br><span class="line">	<span class="function">Matrix <span class="title">ans</span><span class="params">(n,vector&lt;<span class="keyword">int</span>&gt;(n))</span></span>;</span><br><span class="line">	<span class="built_in">Minit</span>(ans);</span><br><span class="line">	<span class="keyword">while</span>(d)&#123;</span><br><span class="line">		<span class="keyword">if</span>(d&amp;<span class="number">1</span>)ans = ans*x;</span><br><span class="line">		x = x*x;</span><br><span class="line">		d /= <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="置换矩阵">置换矩阵</h2>
<p>每一行每一列有且仅有一个<span class="math inline">\(1\)</span>, 其余元素为<span class="math inline">\(0\)</span>的矩阵为置换矩阵.</p>
<p>置换矩阵的逆是它的转置.</p>
<h2 id="循环矩阵">循环矩阵</h2>
<p>除第一行外, 其余每行都是上一行循环右移一格的矩阵是循环矩阵. 循环矩阵的乘积仍是循环矩阵.</p>
<p>因此只需保存和计算循环矩阵的第一行, 两个循环矩阵相乘复杂度为<span class="math inline">\(O(n^2)\)</span></p>
<figure>
<img src="E:\Github\hexo\source_posts\image-20210924200136207.png" alt="image-20210924200136207" /><figcaption aria-hidden="true">image-20210924200136207</figcaption>
</figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> vector&lt;<span class="keyword">int</span>&gt; cirMatrix;<span class="comment">//循环矩阵只需保存第一行</span></span><br><span class="line"><span class="function">Matrix <span class="title">buildCirMatrix</span><span class="params">(<span class="keyword">const</span> cirMatrix &amp; a)</span></span>&#123;<span class="comment">//构建循环矩阵,此处为右移</span></span><br><span class="line">	<span class="keyword">int</span> n = a.<span class="built_in">size</span>();</span><br><span class="line">	<span class="function">Matrix <span class="title">res</span><span class="params">(n,vector&lt;<span class="keyword">int</span>&gt;(n))</span></span>;</span><br><span class="line">	res[<span class="number">0</span>] = a;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">		res[i][<span class="number">0</span>] = res[i<span class="number">-1</span>][n<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt; n;j++)res[i][j] = res[i<span class="number">-1</span>][j<span class="number">-1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">cirMatrix <span class="keyword">operator</span> * (<span class="keyword">const</span> cirMatrix &amp; a,<span class="keyword">const</span> cirMatrix &amp; b)&#123;</span><br><span class="line">	Matrix A = <span class="built_in">Matrix</span>(<span class="number">1</span>,a);</span><br><span class="line">	Matrix B = <span class="built_in">buildCirMatrix</span>(b);</span><br><span class="line">	<span class="keyword">return</span> (A*B)[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">cirMatrix <span class="title">matrixPow</span><span class="params">(cirMatrix x,ll d)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = x.<span class="built_in">size</span>();</span><br><span class="line">	<span class="function">cirMatrix <span class="title">ans</span><span class="params">(n)</span></span>;</span><br><span class="line">	ans[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(d)&#123;</span><br><span class="line">		<span class="keyword">if</span>(d&amp;<span class="number">1</span>)ans = ans*x;</span><br><span class="line">		x = x*x;</span><br><span class="line">		d /= <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="高斯消元">高斯消元</h2>
<p>输入一个<span class="math inline">\(n\)</span>行<span class="math inline">\(n+1\)</span>列的矩阵,其中<span class="math inline">\(A[i][n]\)</span>代表等式右边第<span class="math inline">\(i\)</span>个值. 复杂度<span class="math inline">\(O(n^3)\)</span></p>
<p><code>gauss(矩阵,n)</code>返回1有解, 返回0无解</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">gauss</span><span class="params">(vector&lt;vector&lt;ld&gt; &gt; &amp; A,<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> r = i;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = i+<span class="number">1</span>;j &lt; n;j++)<span class="keyword">if</span>(<span class="built_in">fabs</span>(A[j][i]) &gt; <span class="built_in">fabs</span>(A[r][i]))r = j;</span><br><span class="line">		<span class="keyword">if</span>(r != i)<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; n+<span class="number">1</span>;j++)<span class="built_in">swap</span>(A[i][j],A[r][j]);</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">fabs</span>(A[i][i]) &lt;= eps)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = n;j &gt;= i;j--)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> k = i+<span class="number">1</span>;k &lt; n;k++)&#123;<span class="comment">//提高精度</span></span><br><span class="line">				A[k][j] -= A[k][i]/A[i][i]*A[i][j];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = n<span class="number">-1</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = i+<span class="number">1</span>;j &lt; n;j++)A[i][n] -= A[j][n]*A[i][j];</span><br><span class="line">		A[i][n] /= A[i][i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="异或方程组">异或方程组</h3>
<p>时间复杂度<span class="math inline">\(O(\frac{n^3}{w})\)</span>, <span class="math inline">\(w = 32或64\)</span>, 取决于评测机位数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxb = <span class="number">1005</span>;</span><br><span class="line">vector&lt;bitset&lt;maxb&gt; &gt; <span class="built_in">a</span>(m,bitset&lt;maxb&gt;());</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">xorRank</span><span class="params">(vector&lt;bitset&lt;maxb&gt; &gt; &amp; a,<span class="keyword">int</span> n,<span class="keyword">int</span> m)</span></span>&#123;</span><br><span class="line">	<span class="comment">//n个未知数, m个方程</span></span><br><span class="line">	<span class="keyword">int</span> mr = <span class="number">-1</span>,i = <span class="number">0</span>,j = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(i &lt; m <span class="keyword">and</span> j &lt; n)&#123;</span><br><span class="line">		<span class="keyword">int</span> r = i;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> k = i;k &lt; m;k++)<span class="keyword">if</span>(a[k][j])&#123;r = k;<span class="keyword">break</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span>(a[r].<span class="built_in">test</span>(j))&#123;</span><br><span class="line">			mr = <span class="built_in">max</span>(mr,r);</span><br><span class="line">			<span class="keyword">if</span>(r != i)<span class="built_in">swap</span>(a[r],a[i]);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> u = i+<span class="number">1</span>;u &lt; m;u++)<span class="keyword">if</span>(a[u].<span class="built_in">test</span>(j))a[u] ^= a[i];</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//else return 0; //某一行全为0, 说明有多解</span></span><br><span class="line">		j++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> k = m<span class="number">-1</span>;k &gt;= <span class="number">0</span>;k--)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = k+<span class="number">1</span>;j &lt; m;j++)a[k][m<span class="number">-1</span>] = (a[k][m<span class="number">-1</span>] ^ (a[j][m<span class="number">-1</span>] &amp; a[k][j]));</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">return</span> i;<span class="comment">//返回该矩阵的秩</span></span><br><span class="line">	<span class="comment">//return mr+1;//返回最少使用了几个方程组来得到解</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="行列式">行列式</h2>
<h3 id="浮点数版">浮点数版</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ld eps = <span class="number">1e-9</span>;</span><br><span class="line"><span class="function">ld <span class="title">caldet</span><span class="params">(vector&lt;vector&lt;ld&gt; &gt; &amp; a,<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	ld det = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> k = i;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = i+<span class="number">1</span>;j &lt; n;j++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">fabs</span>(a[j][i]) &gt; <span class="built_in">fabs</span>(a[k][i]))k = j;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">fabs</span>(a[k][i]) &lt; eps)&#123;</span><br><span class="line">			det = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">swap</span>(a[i],a[k]);</span><br><span class="line">		<span class="keyword">if</span>(i != k)det = -det;</span><br><span class="line">		det *= a[i][i];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = i+<span class="number">1</span>;j &lt; n;j++)a[i][j] /= a[i][i];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; n;j++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(j != i <span class="keyword">and</span> <span class="built_in">fabs</span>(a[j][i]) &gt; eps)&#123;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> k = i+<span class="number">1</span>;k &lt; n;k++)&#123;</span><br><span class="line">					a[j][k] -= a[i][k] * a[j][i];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> det;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="整数版">整数版</h3>
<p>输入一个vector矩阵, 输出行列式模<span class="math inline">\(p\)</span>的值. 均摊复杂度<span class="math inline">\(O(n^3 + n^2\log n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">caldet</span><span class="params">(vector&lt;vector&lt;<span class="keyword">int</span>&gt; &gt; &amp; a,<span class="keyword">int</span> n,<span class="keyword">int</span> p)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> det = <span class="number">1</span>,w = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = i+<span class="number">1</span>;j &lt; n;j++)&#123;</span><br><span class="line">			<span class="keyword">while</span>(a[i][i])&#123;</span><br><span class="line">				<span class="keyword">int</span> div = a[j][i]/a[i][i];</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> k = i;k &lt; n;k++)&#123;</span><br><span class="line">					a[j][k] = (a[j][k] - <span class="number">1ll</span>*div*a[i][k]%p + p)%p;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="built_in">swap</span>(a[i],a[j]);w = -w;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">swap</span>(a[i],a[j]);w = -w;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)det = <span class="number">1ll</span>*a[i][i]*det % p;</span><br><span class="line">	det = (<span class="number">1ll</span>*w*det + p)%p;</span><br><span class="line">	<span class="keyword">return</span> det;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="kirchhoff-矩阵树定理">Kirchhoff 矩阵树定理</h2>
<p>矩阵树定理用于求解图的生成树个数. 来源: https://oi-wiki.org/graph/matrix-tree/</p>
<p>设<span class="math inline">\(t(G)\)</span>为图<span class="math inline">\(G\)</span>的全部生成树边权积的和(当边权为1时即为全部生成树的个数)</p>
<p>即 <span class="math display">\[
t(G) = \sum_{T \in G} \prod_{e \in T}w_e
\]</span> 其中<span class="math inline">\(T\)</span>代表图<span class="math inline">\(G\)</span>的生成树, <span class="math inline">\(e\)</span>为生成树上的边，<span class="math inline">\(w_e\)</span>为边的权值.</p>
<p>以下所讨论的图允许重边但不允许自环(去掉自环即可).</p>
<h3 id="无向图形式-行列式">无向图形式-行列式</h3>
<p>设<span class="math inline">\(D\)</span>为无向图<span class="math inline">\(G\)</span>的度数矩阵, <span class="math inline">\(A\)</span>为无向图的邻接矩阵. <span class="math inline">\(deg(x)\)</span>为点<span class="math inline">\(x\)</span>的度数.</p>
<p>则<span class="math inline">\(D[i][i] = deg(i) \cdot[i == j]\)</span>, <span class="math inline">\(A[i][j] = |i与j间的连边权值之和|\)</span></p>
<p>设<span class="math inline">\(Laplace\)</span>矩阵<span class="math inline">\(L = D - A\)</span>. <span class="math inline">\(L_r\)</span>为<span class="math inline">\(L\)</span>的<span class="math inline">\(n-1\)</span>阶主子式(即将矩阵<span class="math inline">\(L\)</span>去掉第<span class="math inline">\(r\)</span>行第<span class="math inline">\(r\)</span>)列.</p>
<p>则对任意的<span class="math inline">\(r\)</span>, <span class="math inline">\(L_r\)</span>的行列式为该无向图的生成树个数. 即<span class="math inline">\(t(G) = det(L_r)\)</span></p>
<h3 id="无向图形式-特征值">无向图形式-特征值</h3>
<p>若<span class="math inline">\(\lambda_1,\lambda_2,...,\lambda_{n-1}\)</span>为<span class="math inline">\(L\)</span>的<span class="math inline">\(n-1\)</span>个非负特征值, 则有 <span class="math display">\[
t(G) = \frac{1}{n}\prod_{i = 1}^{n-1}\lambda_i
\]</span></p>
<h3 id="有向图形式">有向图形式</h3>
<p>有向图的生成树分两种: 根向, 所有边均由儿子指向父亲; 叶向, 所有边均由父亲指向儿子.</p>
<p>设<span class="math inline">\(D^{out}\)</span>为有向图<span class="math inline">\(G\)</span>的出度矩阵, <span class="math inline">\(D^{in}\)</span>为有向图<span class="math inline">\(G\)</span>的入度矩阵, 两者与无向图形式相同.</p>
<p><span class="math inline">\(A\)</span>为有向图邻接矩阵, <span class="math inline">\(A[i][j] = |i指向j的边数|\)</span></p>
<p>设入度Laplace矩阵<span class="math inline">\(L^{in} = D^{in} - A\)</span>, 出度Laplace矩阵为<span class="math inline">\(L^{out} = D^{out} - A\)</span></p>
<p>则以<span class="math inline">\(k\)</span>为根的叶向生成树个数为<span class="math inline">\(t^{leaf}(G,k) = det(L_k^{in})\)</span>, 根向生成树个数为<span class="math inline">\(t^{root}(G,k) =det(L_k^{out})\)</span>.</p>
<p>若要求所有生成树, 枚举<span class="math inline">\(k\)</span>并求和即可.</p>
<h3 id="带权形式">带权形式</h3>
<p>对有向图无向图均适用. 将带权边转化为无权的重边, 重边次数为边权即可.</p>
<h3 id="best定理">BEST定理</h3>
<p>通过图中所有边恰好一次且行遍所有顶点的回路称为欧拉回路.</p>
<p>具有欧拉回路的无向图或有向图称为欧拉图.</p>
<p>设 <span class="math inline">\(G\)</span> 是有向欧拉图，那么 <span class="math inline">\(G\)</span> 的不同欧拉回路总数 <span class="math inline">\(ec(G)\)</span> 是 <span class="math display">\[
ec(G) = t^{root}(G,k)\prod_{v\in V}(\deg (v) - 1)! 
\]</span></p>
<p>注意，对欧拉图 <span class="math inline">\(G\)</span> 的任意两个节点 <span class="math inline">\(k, k&#39;\)</span>，都有 <span class="math inline">\(t^{root}(G,k)=t^{root}(G,k&#39;)\)</span>，且欧拉图 <span class="math inline">\(G\)</span> 的所有节点的入度和出度相等。</p>
<h2 id="一些例题">一些例题</h2>
<h3 id="加速递推式">加速递推式</h3>
<p>以<span class="math inline">\(Fibonacci\)</span>为例:</p>
<p><span class="math inline">\(f(1) = f(2) = 1,f(n) = f(n-1) + f(n-2),(n \geq 10^9)\)</span>,求<span class="math inline">\(f(n)\)</span></p>
<p>设 <span class="math display">\[
F_i = 
\begin{bmatrix}
    f_{i+1}\\
    f_i
\end{bmatrix},
F_0 = 
\begin{bmatrix}
 f_1\\
 f_0
\end{bmatrix}
\]</span> 且<span class="math inline">\(F_i = A^i \cdot F_0\)</span></p>
<p>则有 <span class="math display">\[
A = 
\begin{bmatrix}
1 &amp; 1\\
1 &amp; 0
\end{bmatrix}
\]</span> 一般地, 对于递推式<span class="math inline">\(f(i) = \sum_{i = 1}^{k}a_i \cdot f(i-k)\)</span></p>
<p>有: <span class="math display">\[
F_i = 
\begin{bmatrix}
f(i+k-1)\\
f(i+k-2)\\
...\\
f(i)
\end{bmatrix},
A = \begin{bmatrix}
a_1 &amp; a_2 &amp; a_3 &amp; ... &amp; a_k\\
1 &amp; 0 &amp; 0&amp; \cdots &amp; 0\\
0 &amp; 1 &amp; 0 &amp; \cdots &amp; 0\\
0 &amp; 0 &amp; 1 &amp; \cdots &amp; 0\\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
0 &amp; 0 &amp; \cdots &amp; 1 &amp; 0
\end{bmatrix}
\]</span> 且<span class="math inline">\(F_n = A^n \cdot F_0\)</span></p>
<h3 id="求包含严格k条边的方案数最短路">求包含严格k条边的方案数/最短路</h3>
<p>1.无权图求从<span class="math inline">\(i\)</span>到<span class="math inline">\(j\)</span>经过<span class="math inline">\(k\)</span>条边的方案数:求邻接矩阵的<span class="math inline">\(k\)</span>次幂即可</p>
<p>2.有向图求包含<span class="math inline">\(k\)</span>条边的最短路:求邻接矩阵的<span class="math inline">\(k\)</span>次幂,<strong>把普通矩阵乘法改为Floyd</strong></p>
<h1 id="分数规划">0-1分数规划</h1>
<p>给出数列<span class="math inline">\(\{a_i\},\{b_i\}\)</span>,求一组<span class="math inline">\(w_i \in \{0,1\}\)</span>, 使得 <span class="math display">\[
\frac{\sum_{i = 1}^na_i \cdot w_i}{\sum_{i = 1}^nb_i \cdot w_i}
\]</span> 最大或最小</p>
<p>或给出<span class="math inline">\(n\)</span>个物品,每个物品有两个权值<span class="math inline">\(a_i\)</span>和<span class="math inline">\(b_i\)</span>, 选择任意个物品使得<span class="math inline">\(\frac{\sum a_i}{\sum b_i}\)</span>最大</p>
<h2 id="二分法">二分法</h2>
<p><span class="math display">\[
\frac{\sum_{i = 1}^na_i \cdot w_i}{\sum_{i = 1}^nb_i \cdot w_i} \ge M \Leftrightarrow \sum_{i = 1}^n w_i \cdot (a_i - M\cdot b_i) \ge 0
\]</span></p>
<p>因此只需判断$_{i = 1}^n w_i (a_i - Mb_i) <span class="math inline">\(的最大值是否非负即可对\)</span>M$二分.</p>
<h2 id="dinkelbach-算法迭代法">Dinkelbach 算法(迭代法)</h2>
<p>将上一轮的答案作为输入进行迭代.注意此时答案应为<span class="math inline">\(\frac{\sum_{i = 1}^na_i}{\sum_{i = 1}^nb_i}\)</span>, 而不是变形后的式子.</p>
<h2 id="例题">例题</h2>
<h3 id="poj2728desert-king">[POJ2728]Desert King</h3>
<p>给出<span class="math inline">\(n \leq 10^3\)</span>个点的横纵坐标和高度, 两点间距离为欧几里得距离, 价值为高度之差绝对值. 所有点构成一个完全图. 求一棵生成树使得</p>
<p>距离/价值比最小.</p>
<h4 id="二分法-1">二分法</h4>
<p>此题是有一定限制的0-1分数规划(所选的"物品"构成一棵生成树). 直接求边权为<span class="math inline">\(w_i \cdot (a_i - M\cdot b_i)\)</span>的最小生成树, 判断是否有解即可二分.</p>
<p>由于是完全图, 采用不加优化的Prim求解.</p>
<p>复杂度大概是<span class="math inline">\(O(n^2 \log((R - L)*2^{-eps}))\)</span></p>
<p>由于二分法较慢, 本题需要猜一个答案上界(100)才能通过=-=</p>
<p>用时<code>2610ms</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//POJ2728</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> ld;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> ld INF = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> ld eps = <span class="number">1e-5</span>;</span><br><span class="line">ld G[maxn][maxn],dis[maxn];</span><br><span class="line"><span class="keyword">int</span> x[maxn],y[maxn],h[maxn],n;</span><br><span class="line">ld w[maxn][maxn];</span><br><span class="line"><span class="keyword">bool</span> vis[maxn];</span><br><span class="line"><span class="function">ld <span class="title">Dis</span><span class="params">(<span class="keyword">int</span> idx1,<span class="keyword">int</span> idx2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">sqrt</span>((x[idx1] - x[idx2])*(x[idx1] - x[idx2])+(y[idx1] - y[idx2])*(y[idx1] - y[idx2]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">prim</span><span class="params">(ld M)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)vis[i] = <span class="number">0</span>,dis[i] = INF;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)<span class="keyword">if</span>(!vis[j])&#123;</span><br><span class="line">			<span class="keyword">if</span>(!x <span class="keyword">or</span> dis[x] &gt; dis[j])x = j;</span><br><span class="line">		&#125;</span><br><span class="line">		vis[x] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)<span class="keyword">if</span>(!vis[j])&#123;</span><br><span class="line">			dis[j] = <span class="built_in">min</span>(dis[j],w[j][x] - M*G[j][x]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	ld tans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)tans += dis[i];</span><br><span class="line">	<span class="keyword">return</span> tans &gt;= <span class="number">0.0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n) == <span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!n)<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x[i],&amp;y[i],&amp;h[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)&#123;</span><br><span class="line">				G[i][j] = <span class="built_in">Dis</span>(i,j);</span><br><span class="line">				w[i][j] = <span class="built_in">abs</span>(h[i] - h[j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		ld M = <span class="number">0</span>,L = <span class="number">0</span>,R = <span class="number">100</span>;</span><br><span class="line">		<span class="keyword">while</span>(R - L &gt;= eps)&#123;</span><br><span class="line">			M = (L+R)/<span class="number">2</span>;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">prim</span>(M))L = M;</span><br><span class="line">			<span class="keyword">else</span> R = M;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%.3f\n&quot;</span>,L);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="迭代法">迭代法</h4>
<p>求生成树时仍按边权<span class="math inline">\(w_i \cdot (a_i - M\cdot b_i)\)</span>来计算. 但统计答案则计算<span class="math inline">\(\frac{\sum_{i = 1}^na_i}{\sum_{i = 1}^nb_i}\)</span></p>
<p>跑的飞快(<code>250ms</code>)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//POJ2728</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> ld;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> ld INF = <span class="number">1e9</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> ld eps = <span class="number">1e-5</span>;</span><br><span class="line">ld G[maxn][maxn],dis[maxn];</span><br><span class="line"><span class="keyword">int</span> x[maxn],y[maxn],h[maxn],to[maxn],n;</span><br><span class="line">ld w[maxn][maxn];</span><br><span class="line"><span class="keyword">bool</span> vis[maxn];</span><br><span class="line"><span class="function">ld <span class="title">Dis</span><span class="params">(<span class="keyword">int</span> idx1,<span class="keyword">int</span> idx2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">sqrt</span>((x[idx1] - x[idx2])*(x[idx1] - x[idx2])+(y[idx1] - y[idx2])*(y[idx1] - y[idx2]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ld <span class="title">prim</span><span class="params">(ld M)</span></span>&#123;</span><br><span class="line">	ld up = <span class="number">0</span>,down = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= n;i++)vis[i] = <span class="number">0</span>,dis[i] = INF,to[i] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">		<span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)<span class="keyword">if</span>(!vis[j])&#123;</span><br><span class="line">			<span class="keyword">if</span>(!x <span class="keyword">or</span> dis[x] &gt; dis[j])x = j;</span><br><span class="line">		&#125;</span><br><span class="line">		vis[x] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)<span class="keyword">if</span>(!vis[j])&#123;</span><br><span class="line">			<span class="keyword">if</span>(dis[j] &gt; w[x][j] - M*G[x][j])dis[j] = w[x][j] - M*G[x][j],to[j] = x;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		up += w[i][to[i]];</span><br><span class="line">		down += G[i][to[i]];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> up/down;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n) == <span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!n)<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;x[i],&amp;y[i],&amp;h[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;j &lt;= n;j++)&#123;</span><br><span class="line">				G[i][j] = <span class="built_in">Dis</span>(i,j);</span><br><span class="line">				w[i][j] = <span class="built_in">abs</span>(h[i] - h[j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		ld ans = <span class="number">0</span>,lans = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">fabs</span>(lans - ans) &gt; eps)&#123;</span><br><span class="line">			lans = ans;</span><br><span class="line">			ans = <span class="built_in">prim</span>(ans);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%.3f\n&quot;</span>,ans);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="多项式">多项式</h1>
<h2 id="fft">FFT</h2>
<p>复数类操作:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">complex&lt;<span class="keyword">double</span>&gt;m;</span><br><span class="line">m.<span class="built_in">real</span>();m.<span class="built_in">imag</span>();<span class="comment">//获取实部虚部的值</span></span><br><span class="line">m.<span class="built_in">real</span>(<span class="number">114</span>);m.<span class="built_in">imag</span>(<span class="number">514</span>);<span class="comment">//为实部虚部赋值</span></span><br></pre></td></tr></table></figure>
<p>包括手写复数类, DFT与IDFT, 多项式乘法.</p>
<ul>
<li><p>复数类: <span class="math inline">\(x\)</span>为实部, <span class="math inline">\(y\)</span>为虚部</p></li>
<li><p><code>FFT(Comp * A,int siz,int type)</code></p>
<p>A: 复数数组, 全局变量, 为待求解的多项式</p>
<p>siz: 多项式长度. 需保证为2的次方</p>
<p>type: 1为DFT, -1为IDFT</p></li>
<li><p><code>Poly mul(Poly A,Poly B)</code></p>
<p>多项式乘法. 输入两个多项式<span class="math inline">\(A,B\)</span>, 长度分别为<span class="math inline">\(n,m\)</span>(也就是<span class="math inline">\(n-1,m-1\)</span>阶). 返回一个长度<span class="math inline">\(n - m + 1\)</span>的多项式, 为<span class="math inline">\(A,B\)</span>的乘积.</p>
<p><code>Poly</code>为<code>vector&lt;int&gt;</code>.</p></li>
</ul>
<p><strong>!!!切记在点值表示法下相乘时, 两个IDFT的长度必须相同!!!</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> ld;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;<span class="keyword">int</span>&gt; Poly;</span><br><span class="line"><span class="keyword">const</span> ld PI = <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"><span class="keyword">int</span> rev[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Comp</span>&#123;</span></span><br><span class="line">    <span class="keyword">double</span> x, y;</span><br><span class="line">    <span class="built_in">Comp</span> (<span class="keyword">double</span> x = <span class="number">0</span>, <span class="keyword">double</span> y = <span class="number">0</span>):<span class="built_in">x</span>(x),<span class="built_in">y</span>(y)&#123;&#125;</span><br><span class="line">    Comp <span class="keyword">operator</span> * (Comp B)&#123;</span><br><span class="line">   		<span class="keyword">return</span> <span class="built_in">Comp</span>(x*B.x - y*B.y,x*B.y + y*B.x);</span><br><span class="line">	&#125;</span><br><span class="line">	Comp <span class="keyword">operator</span> + (Comp B)&#123;</span><br><span class="line">	    <span class="keyword">return</span> <span class="built_in">Comp</span>(x + B.x,y + B.y);</span><br><span class="line">	&#125;</span><br><span class="line">	Comp <span class="keyword">operator</span> - (Comp B)&#123;</span><br><span class="line">	    <span class="keyword">return</span> <span class="built_in">Comp</span>(x - B.x,y - B.y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Comp F1[maxn],F2[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FFT</span><span class="params">(Comp * A,<span class="keyword">int</span> siz,<span class="keyword">int</span> type)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = siz;</span><br><span class="line">	<span class="keyword">int</span> S = <span class="built_in">log2</span>(n);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)rev[i] = (rev[i&gt;&gt;<span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (S - <span class="number">1</span>));</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)<span class="keyword">if</span>(i &lt; rev[i])<span class="built_in">swap</span>(A[i],A[rev[i]]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i *= <span class="number">2</span>)&#123;</span><br><span class="line">		<span class="function">Comp <span class="title">Wn</span><span class="params">(cos(PI/i),type*sin(PI/i))</span></span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; n;j += i*<span class="number">2</span>)&#123;</span><br><span class="line">			<span class="function">Comp <span class="title">W</span><span class="params">(<span class="number">1</span>,<span class="number">0</span>)</span></span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>;k &lt; i;k++)&#123;</span><br><span class="line">				Comp facx = A[j+k],facy = W*A[j+k+i];</span><br><span class="line">				A[j+k] = facx + facy;</span><br><span class="line">				A[j+k+i] = facx - facy;</span><br><span class="line">				W = W*Wn;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">if</span>(type == <span class="number">-1</span>)<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)A[i].x = (<span class="keyword">int</span>)((A[i].x/n + <span class="number">0.5</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Poly <span class="title">mul</span><span class="params">(Poly A,Poly B)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = A.<span class="built_in">size</span>(),m = B.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">int</span> siz = n + m - <span class="number">1</span>;</span><br><span class="line">	<span class="function">Poly <span class="title">C</span><span class="params">(siz)</span></span>;</span><br><span class="line">	<span class="keyword">if</span>(siz &lt; <span class="number">64</span>)&#123;<span class="comment">//小于等于64项直接暴力算</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; m;j++)C[i+j] = (C[i+j] + <span class="number">1LL</span>*A[i]*B[j]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> C;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> fsiz = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(fsiz &lt;= siz)fsiz *= <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; fsiz;i++)F1[i] = F2[i] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)F1[i] = A[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; m;i++)F2[i] = B[i];</span><br><span class="line">	<span class="built_in">FFT</span>(F1,fsiz,<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">FFT</span>(F2,fsiz,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; fsiz;i++)F1[i] = F1[i]*F2[i];</span><br><span class="line">	<span class="built_in">FFT</span>(F1,fsiz,<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; siz;i++)&#123;</span><br><span class="line">		C[i] = ((ll)F1[i].x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="卷积">卷积</h3>
<p><span class="math display">\[
C[i] = \sum_{j = 0}^iA[j]B[i-j]
\]</span></p>
<p>卷积等同于多项式乘积</p>
<h2 id="ntt">NTT</h2>
<p>从OI-wiki抄来的, 用法和上面的FFT一致. 记得自己手写一遍</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">6e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> p = <span class="number">998244353</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Pow</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> tans = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(d == <span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>%p;</span><br><span class="line">	<span class="keyword">int</span> a = <span class="built_in">Pow</span>(x,d/<span class="number">2</span>);</span><br><span class="line">	tans = <span class="number">1ll</span>*a*a%p;</span><br><span class="line">	<span class="keyword">if</span>(d%<span class="number">2</span>)tans = <span class="number">1ll</span>*tans*x%p; </span><br><span class="line">	<span class="keyword">return</span> tans%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">typedef</span> vector&lt;<span class="keyword">int</span>&gt; Poly;</span><br><span class="line"><span class="keyword">int</span> F1[maxn],F2[maxn];</span><br><span class="line"><span class="keyword">int</span> rev[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">NTT</span><span class="params">(<span class="keyword">int</span> * A,<span class="keyword">int</span> lim,<span class="keyword">int</span> opt)</span> </span>&#123;</span><br><span class="line"> 	<span class="keyword">int</span> i, j, k, m, gn, g, tmp;</span><br><span class="line"> 	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lim; ++i)rev[i] = (i &amp; <span class="number">1</span>)*(lim &gt;&gt; <span class="number">1</span>) + (rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>);</span><br><span class="line"> 	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; lim; ++i)<span class="keyword">if</span> (rev[i] &lt; i) <span class="built_in">swap</span>(A[i], A[rev[i]]);</span><br><span class="line"> 	<span class="keyword">for</span>(m = <span class="number">2</span>; m &lt;= lim; m &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">	    k = m &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	    gn = <span class="built_in">Pow</span>(<span class="number">3</span>,(p - <span class="number">1</span>) / m);</span><br><span class="line">	    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; lim; i += m) &#123;</span><br><span class="line">	    	g = <span class="number">1</span>;</span><br><span class="line">	    	<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; k; ++j, g = <span class="number">1ll</span> * g * gn % p) &#123;</span><br><span class="line">	    	    tmp = <span class="number">1ll</span> * A[i + j + k] * g % p;</span><br><span class="line">	    	    A[i + j + k] = (A[i + j] - tmp + p) % p;</span><br><span class="line">	     	 	A[i + j] = (A[i + j] + tmp) % p;</span><br><span class="line">	    	&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(opt == <span class="number">-1</span>)&#123;</span><br><span class="line">    	<span class="built_in">reverse</span>(A+<span class="number">1</span>,A+lim);</span><br><span class="line">    	<span class="keyword">int</span> inv = <span class="built_in">Pow</span>(lim,p<span class="number">-2</span>);</span><br><span class="line">    	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; lim; ++i) A[i] = <span class="number">1ll</span> * A[i] * inv % p;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Poly <span class="title">mul</span><span class="params">(Poly A,Poly B)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = A.<span class="built_in">size</span>(),m = B.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">int</span> siz = n + m - <span class="number">1</span>;</span><br><span class="line">	<span class="function">Poly <span class="title">C</span><span class="params">(siz)</span></span>;</span><br><span class="line">	<span class="keyword">if</span>(siz &lt; <span class="number">64</span>)&#123;<span class="comment">//小于等于64项直接暴力算</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; m;j++)C[i+j] = (C[i+j] + <span class="number">1LL</span>*A[i]*B[j]%p)%p;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> C;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> fsiz = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(fsiz &lt;= siz)fsiz *= <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; fsiz;i++)F1[i] = F2[i] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)F1[i] = A[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; m;i++)F2[i] = B[i];</span><br><span class="line">	<span class="built_in">NTT</span>(F1,fsiz,<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">NTT</span>(F2,fsiz,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; fsiz;i++)F1[i] = <span class="number">1ll</span>*F1[i]*F2[i]%p;</span><br><span class="line">	<span class="built_in">NTT</span>(F1,fsiz,<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; siz;i++)&#123;</span><br><span class="line">		C[i] = F1[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与FFT的区别在点值表示法相乘时, NTT需要取模. 另外注意原根需与模数对应</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; (<span class="keyword">int</span>)A.<span class="built_in">size</span>();i++)A[i] = <span class="number">1ll</span>*A[i]*B[i]%p;</span><br></pre></td></tr></table></figure>
<h2 id="分治fftntt">分治FFT/NTT</h2>
<p>设有<span class="math inline">\(n\)</span>个多项式, 第<span class="math inline">\(i\)</span>个为<span class="math inline">\(Func[i]\)</span></p>
<p>就嗯分治完事了. 时间复杂度<span class="math inline">\(O(n\log^2 n)\)</span>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;Poly&gt;Func;</span><br><span class="line"><span class="function">Poly <span class="title">cal</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(R - <span class="number">1</span> == L)<span class="keyword">return</span> Func[L];</span><br><span class="line">	<span class="keyword">int</span> M = (L+R)/<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">mul</span>(<span class="built_in">cal</span>(L,M),<span class="built_in">cal</span>(M,R));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="求逆">求逆</h2>
<p>板子来源: <a target="_blank" rel="noopener" href="https://blog.orzsiyuan.com/archives/Polynomial-Inversion/">Siyuan -「算法笔记」多项式求逆</a></p>
<p>调用<code>invP(Poly A)</code>,返回模<span class="math inline">\(x^n\)</span>意义下<span class="math inline">\(A\)</span>的逆. 其中<span class="math inline">\(A\)</span>是一个<span class="math inline">\(n-1\)</span>次多项式(实际上是一个长度为<span class="math inline">\(n\)</span>的<code>vector&lt;int&gt;</code>)</p>
<p>时间复杂度: <span class="math inline">\(O(nlogn)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> P[maxn],Q[maxn];</span><br><span class="line"><span class="function">Poly <span class="title">invP</span><span class="params">(Poly A)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = A.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">int</span> siz = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(siz &lt; n)siz *= <span class="number">2</span>;</span><br><span class="line">	A.<span class="built_in">resize</span>(siz);</span><br><span class="line">	<span class="function">Poly <span class="title">I</span><span class="params">(siz)</span></span>;</span><br><span class="line">	I[<span class="number">0</span>] = <span class="built_in">Pow</span>(A[<span class="number">0</span>],p<span class="number">-2</span>);<span class="comment">//inv(A[0]);</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> h = <span class="number">2</span>;h &lt;= siz;h *= <span class="number">2</span>)&#123;</span><br><span class="line">		<span class="keyword">int</span> H = h*<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= H;i++)P[i] = Q[i] = <span class="number">0</span>;<span class="comment">//重要,必须清空</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; h;i++)P[i] = A[i],Q[i] = I[i];</span><br><span class="line">		<span class="built_in">NTT</span>(P,H,<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">NTT</span>(Q,H,<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; H;i++)&#123;</span><br><span class="line">			P[i] = <span class="number">1ll</span>*Q[i]*(<span class="number">2</span> - <span class="number">1ll</span>*P[i]*Q[i]%p + p)%p;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">NTT</span>(P,H,<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; h;i++)I[i] = P[i];</span><br><span class="line">	&#125;</span><br><span class="line">	I.<span class="built_in">resize</span>(n);</span><br><span class="line">	<span class="keyword">return</span> I;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="求导-积分">求导, 积分</h2>
<p>derP求导, intP积分, 复杂度均为<span class="math inline">\(O(n)\)</span>. 其中积分需要先预处理逆元<code>inv[]</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Poly <span class="title">derP</span><span class="params">(Poly A,<span class="keyword">bool</span> samelen = <span class="number">1</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = A.<span class="built_in">size</span>();</span><br><span class="line">	<span class="function">Poly <span class="title">D</span><span class="params">(n<span class="number">-1</span>)</span></span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)D[i<span class="number">-1</span>] = <span class="number">1ll</span>*i*A[i]%p;</span><br><span class="line">	<span class="keyword">if</span>(samelen)D.<span class="built_in">resize</span>(n);</span><br><span class="line">	<span class="keyword">return</span> D;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Poly <span class="title">intP</span><span class="params">(Poly A,<span class="keyword">bool</span> samelen = <span class="number">1</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = A.<span class="built_in">size</span>();</span><br><span class="line">	<span class="function">Poly <span class="title">ans</span><span class="params">(n+<span class="number">1</span>)</span></span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)ans[i] = <span class="number">1ll</span>*inv[i]*A[i<span class="number">-1</span>]%p;</span><br><span class="line">	<span class="keyword">if</span>(samelen)ans.<span class="built_in">resize</span>(n);</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="取对数">取对数</h2>
<p>输入<span class="math inline">\(A(x)\)</span>, 求<span class="math inline">\(B(x) \equiv ln(A(x)) \pmod {x^n}\)</span>. 两边同时求导得: <span class="math display">\[
B&#39;(x) = \frac{A&#39;(x)}{A(x)}\text dx
\]</span> 再积分: <span class="math display">\[
B(x) = ln(A(x)) = \int B&#39;(x)\text dx = \int\frac{A&#39;(x)}{A(x)}\text dx
\]</span> 需要求逆,求导和积分, 需保证<span class="math inline">\(A[0] = 1\)</span>. 复杂度<span class="math inline">\(O(n\log n)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Poly <span class="title">lnP</span><span class="params">(Poly A)</span></span>&#123;</span><br><span class="line">	Poly tans = <span class="built_in">intP</span>(<span class="built_in">mul</span>(<span class="built_in">derP</span>(A),<span class="built_in">invP</span>(A)));</span><br><span class="line">	tans.<span class="built_in">resize</span>((<span class="keyword">int</span>)A.<span class="built_in">size</span>());</span><br><span class="line">	<span class="keyword">return</span> tans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="指数函数">指数函数</h2>
<p>前置: 求<span class="math inline">\(\ln\)</span></p>
<p>和求逆基本相同, 返回<span class="math inline">\(e^{A(x)}\)</span>. 复杂度<span class="math inline">\(O(nlogn)\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Poly <span class="title">expP</span><span class="params">(Poly A)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = A.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">int</span> siz = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(siz &lt; n)siz *= <span class="number">2</span>;</span><br><span class="line">	A.<span class="built_in">resize</span>(siz);</span><br><span class="line">	<span class="function">Poly <span class="title">E</span><span class="params">(siz)</span></span>;</span><br><span class="line">	E[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> h = <span class="number">2</span>;h &lt;= siz;h *= <span class="number">2</span>)&#123;</span><br><span class="line">		<span class="function">Poly <span class="title">B</span><span class="params">(h)</span>,<span class="title">C</span><span class="params">(h)</span></span>;;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; h;i++)B[i] = C[i] = E[i];</span><br><span class="line">		B = <span class="built_in">lnP</span>(B);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; h;i++)B[i] = (<span class="number">1ll</span>*-B[i] + A[i] + <span class="number">2ll</span>*p)%p;</span><br><span class="line">		B[<span class="number">0</span>] = (B[<span class="number">0</span>] + <span class="number">1</span>)%p;</span><br><span class="line">		B = <span class="built_in">mul</span>(B,C);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; h;i++)E[i] = B[i];</span><br><span class="line">	&#125;</span><br><span class="line">	E.<span class="built_in">resize</span>(n);</span><br><span class="line">	<span class="keyword">return</span> E;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="快速幂">快速幂</h2>
<p>求<span class="math inline">\(A(x)^k\)</span>, 显然有<span class="math inline">\(A(x)^k = e^{k\cdot ln(A(x))}\)</span></p>
<p>保证<span class="math inline">\(A[0] = 1\)</span>时:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Poly <span class="title">powP</span><span class="params">(Poly A,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">	A = <span class="built_in">lnP</span>(A);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; (<span class="keyword">int</span>)A.<span class="built_in">size</span>();i++)A[i] = <span class="number">1ll</span>*A[i]*k%p;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">expP</span>(A);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="math inline">\(A[0] \neq 1\)</span>时:</p>
<p>首先判断是否有<span class="math inline">\(k \ge n\)</span>且<span class="math inline">\(A[0] == 0\)</span>. 若是, 则返回一个全为<span class="math inline">\(0\)</span>的多项式. <strong>注意, 必须在取模前判断大小, 且下面的模板没有包含这部分内容</strong></p>
<p>然后对指数取模, 若输入的指数<span class="math inline">\(k &gt; p\)</span>, 则令<code>k1 = k % p</code>, <code>k2 = k % (p - 1)</code> (即<span class="math inline">\(k2\)</span>对<span class="math inline">\(\varphi(p)\)</span>取模)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Poly <span class="title">powP</span><span class="params">(Poly A,<span class="keyword">int</span> k1,<span class="keyword">int</span> k2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = A.<span class="built_in">size</span>(),d = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(d &lt; n <span class="keyword">and</span> !A[d])d++;</span><br><span class="line">	<span class="keyword">if</span>(<span class="number">1ll</span>*d*k1 &gt;= n)<span class="keyword">return</span> <span class="built_in">Poly</span>(n);</span><br><span class="line">	A.<span class="built_in">erase</span>(A.<span class="built_in">begin</span>(),A.<span class="built_in">begin</span>()+d);</span><br><span class="line">	<span class="keyword">int</span> k = <span class="built_in">Pow</span>(A[<span class="number">0</span>],p<span class="number">-2</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; (<span class="keyword">int</span>)A.<span class="built_in">size</span>();i++)A[i] = <span class="number">1ll</span>*A[i]*k%p;</span><br><span class="line">	A = <span class="built_in">powP</span>(A,k1);</span><br><span class="line">	A.<span class="built_in">resize</span>(n);</span><br><span class="line">	k = <span class="built_in">Pow</span>(k,p - <span class="number">1</span> - k2);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; (<span class="keyword">int</span>)A.<span class="built_in">size</span>();i++)A[i] = <span class="number">1ll</span>*A[i]*k%p;</span><br><span class="line">	d *= k1;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = n<span class="number">-1</span>;i &gt;= <span class="number">0</span>;i--)&#123;</span><br><span class="line">		A[i] = (i &gt;= d?A[i-d]:<span class="number">0</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="高阶差分前缀和">高阶差分/前缀和</h2>
<p>求<span class="math inline">\(A[]\)</span>的<span class="math inline">\(k\)</span>阶差分/前缀和. 设<span class="math inline">\(A\)</span>的OGF: <span class="math inline">\(F(x) = \sum_{i = 0}^{\infin}A_ix^i\)</span></p>
<p>显然前缀和是<span class="math inline">\(F(x)\cdot\sum_{i=0}^{\infin}x^i = F(x)\cdot \frac{1}{1-x}\)</span>, 差分是<span class="math inline">\(F(x)\cdot(1-x)\)</span></p>
<p>那么<span class="math inline">\(k\)</span>阶前缀和是<span class="math inline">\(F(x)\cdot (\frac{1}{1-x})^k\)</span>, 差分是<span class="math inline">\(F(x)\cdot(1-x)^k\)</span>. 复杂度为<span class="math inline">\(O(nlogk)\)</span>, 但常数巨大且很不好写.</p>
<p>另有结论:</p>
<p>前缀和<span class="math inline">\(F(x)\cdot\sum_{i = 0}^nC_{k+i-1}^ix^i\)</span></p>
<p>差分<span class="math inline">\(F(x)\cdot\sum_{i=0}^n(-1)^iC_n^ix^i\)</span></p>
<p>复杂度<span class="math inline">\(O(n\log n)\)</span>. 使用前先预处理逆元.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Poly <span class="title">presumP</span><span class="params">(Poly A,ll k)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = A.<span class="built_in">size</span>();</span><br><span class="line">	<span class="function">Poly <span class="title">G</span><span class="params">(n)</span></span>;</span><br><span class="line">	G[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)G[i] = G[i<span class="number">-1</span>]*(k+i<span class="number">-1</span>)%p*inv[i]%p;</span><br><span class="line">	A = <span class="built_in">mul</span>(A,G);</span><br><span class="line">	<span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Poly <span class="title">diffP</span><span class="params">(Poly A,ll k)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = A.<span class="built_in">size</span>();</span><br><span class="line">	<span class="function">Poly <span class="title">G</span><span class="params">(n)</span></span>;</span><br><span class="line">	G[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)G[i] = (G[i<span class="number">-1</span>]*(<span class="number">-1</span>) + p)%p*(k-i+<span class="number">1</span>)%p*inv[i]%p;	</span><br><span class="line">	A = <span class="built_in">mul</span>(A,G);</span><br><span class="line">	<span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="前缀和与差分">前缀和与差分</h1>
<h3 id="区间加多项式">区间加多项式</h3>
<p>给出<span class="math inline">\(f(x)\)</span>和<span class="math inline">\([L,R]\)</span>, 对<span class="math inline">\(a[L...R]\)</span>分别加上<span class="math inline">\(f(1),f(2),...,f(R-L+1)\)</span>.</p>
<p>结论: <span class="math inline">\(k\)</span>阶多项式的<span class="math inline">\(k+1\)</span>阶差分余项为常数. 对<span class="math inline">\(k+1\)</span>阶差分后的余项做<span class="math inline">\(k+1\)</span>次前缀和即可还原原多项式.</p>
<p>为了维护该操作, 我们先对原数组做<span class="math inline">\(k+1\)</span>阶差分, 然后算出<span class="math inline">\(f(1),...,f(k+1)\)</span>的<span class="math inline">\(k+1\)</span>阶差分. 此后可以按一般的差分来维护.</p>
<p>细节见代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> d[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">diff</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp;a,<span class="keyword">int</span> cnt)</span></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(cnt--)<span class="keyword">for</span>(<span class="keyword">int</span> i = (<span class="keyword">int</span>)a.<span class="built_in">size</span>() - <span class="number">1</span>;i &gt; <span class="number">0</span>;i--)&#123;a[i] -=a[i<span class="number">-1</span>];<span class="keyword">if</span>(a[i] &lt; <span class="number">0</span>)a[i] += p;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pre</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp;a,<span class="keyword">int</span> cnt)</span></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(cnt--)<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; (<span class="keyword">int</span>)a.<span class="built_in">size</span>();i++)a[i] = (a[i] + a[i<span class="number">-1</span>])%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">f</span><span class="params">(ll x,vector&lt;ll&gt;fac)</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">0</span>,times = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(ll v:fac)&#123;</span><br><span class="line">		res = (res + v*times%p)%p;</span><br><span class="line">		times = times*x%p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">g</span><span class="params">(ll x,vector&lt;ll&gt;fac,ll len)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (-<span class="built_in">f</span>(x+len,fac) + p)%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	cout.<span class="built_in">setf</span>(ios::fixed,ios::floatfield);</span><br><span class="line">	cout.<span class="built_in">precision</span>(<span class="number">12</span>);	 </span><br><span class="line">	<span class="keyword">int</span> n,m,q;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m &gt;&gt; q;</span><br><span class="line">	vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">a</span>(n+<span class="number">100</span>);</span><br><span class="line">	<span class="keyword">int</span> num = <span class="number">6</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)cin &gt;&gt; a[i];</span><br><span class="line">	<span class="built_in">diff</span>(a,num);</span><br><span class="line">	<span class="keyword">while</span>(m--)&#123;</span><br><span class="line">		<span class="keyword">int</span> l,r,k;</span><br><span class="line">		cin &gt;&gt; l &gt;&gt; r &gt;&gt; k;</span><br><span class="line">		l--,r--;</span><br><span class="line">		vector&lt;ll&gt;<span class="built_in">fac</span>(k+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = k;i &gt;= <span class="number">0</span>;i--)cin &gt;&gt; fac[i];</span><br><span class="line">		vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">add</span>(<span class="number">10</span>+<span class="number">1</span>),<span class="built_in">sub</span>(<span class="number">10</span>+<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= <span class="number">10</span>;i++)add[i] = <span class="built_in">f</span>(i+<span class="number">1</span>,fac),sub[i] = <span class="built_in">g</span>(i+<span class="number">1</span>,fac,r - l + <span class="number">1</span>);</span><br><span class="line">		<span class="built_in">diff</span>(add,num);</span><br><span class="line">		<span class="built_in">diff</span>(sub,num);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;= <span class="number">10</span>;i++)a[i+l] += add[i],a[i+r+<span class="number">1</span>] += sub[i],a[i+l] %= p,a[i+r+<span class="number">1</span>] %= p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">pre</span>(a,num+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">while</span>(q--)&#123;</span><br><span class="line">		<span class="keyword">int</span> l,r;</span><br><span class="line">		cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">		l--,r--;</span><br><span class="line">		ll ans = (a[r] - (l?a[l<span class="number">-1</span>]:<span class="number">0</span>) + p)%p;</span><br><span class="line">		cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="组合数学">组合数学</h1>
<h2 id="杂乱的结论">杂乱的结论</h2>
<h3 id="长度为n-可选1m的本质不同序列个数">长度为n, 可选[1,m]的本质不同序列个数</h3>
<p>(本质不同即将序列排序后两个序列不相同) <span class="math display">\[
C_{n+m-1}^{m-1}
\]</span></p>
<h3 id="递推组合数">递推组合数</h3>
<p><span class="math display">\[
C_n^0 = 1\\
C_n^i = C_n^{i-1}\cdot \frac{n-i+1}{i}\\
C_{n+i-1}^i = C_{n+i-2}^{i-1}\cdot \frac{n+i-1}{i}
\]</span></p>
<h3 id="常用公式">常用公式</h3>
<p>$$ <span class="math display">\[\begin{align}

\sum_{i = 0}^n C_n^i &amp;= 2^n\\

\sum_{i = 0}^n C_n^i \cdot x^i &amp;= (x+1)^n(二项式定理)\\

\sum_{i = 0,i += 2}^n C_n^i &amp;= 2^{n-1}\\

\sum_{i=1}^nC_n^i \cdot i &amp;= n \cdot 2^{n-1}\\

\sum_{i = 0}^r C_m^i \cdot C_n^{r - i} &amp;= C_{n+m}^r\\

\sum_{i = 0}^n (C_n^i)^2 = C_{2n}^n\\


\end{align}\]</span> $$</p>
<h4 id="常用结论">常用结论</h4>
<p><span class="math display">\[
\sum_{i = 1}^ni*m^{n-i} *C(n,i) = n(m+1)^{n-1}
\]</span></p>
<h1 id="生成函数">生成函数</h1>
<h2 id="ogf">OGF</h2>
<p><span class="math display">\[
f(x) = \sum_{i = 0}^{\infin}h_ix^i
\]</span></p>
<h3 id="常用公式-1">常用公式</h3>
<ul>
<li>Part1</li>
</ul>
<p><span class="math display">\[
\begin{align}
\sum_{i=0}^nx^i &amp;= \frac{1-x^{n+1}}{1-x} (等比数列求和)\\
\sum_{i=0}^\infin x^i &amp;= \frac{1}{1-x}\\
\sum_{i = 0}^\infin x^{c\cdot i} &amp;= \frac{1}{1 - x^c}\\
\sum_{i = 0}^{\infin}(i+1)\cdot x^i &amp;= (\frac{1}{1-x})^2
\end{align}
\]</span></p>
<ul>
<li>Part2 <span class="math display">\[
  \frac{1}{(1-x)^n} = \sum_{i = 0}^\infin C_{n+i-1}^{i-1}x^i\\
  \frac{1}{(1-x)^{n+1}} = \sum_{i = 0}^\infin C_{n+i}^i x^i
  \]</span></li>
</ul>
<h2 id="egf">EGF</h2>
<p><span class="math display">\[
g(x) = \sum_{i=0}^{\infin}h_x\cdot\frac{x^i}{i!}
\]</span></p>
<h3 id="常用公式-2">常用公式</h3>
<p><span class="math display">\[
\begin{align}
\sum_{i = 0}^{\infin}\frac{x^i}{i!} &amp; = e^x\\
\sum_{i = 0}^{\infin} (-1)^i \frac{x^i}{i!} &amp; = e^{-x} \\
\sum_{i = 0,i +=2}^{\infin}\frac{x^i}{i!} &amp;= \frac{e^x + e^{-x}}{2}\\
\sum_{i = 1,i += 2}^{\infin}\frac{x^i}{i!} &amp; = \frac{e^x - e^{-z}}{2}\\
\sum_{i = 1}^{\infin}(-1)^{i+1} \frac{x^i}{i} &amp; = \ln{(1+x)}
\end{align}
\]</span></p>
<h1 id="反演">反演</h1>
<h2 id="整除分块">整除分块</h2>
<p>设<span class="math inline">\(f(x) = \lfloor \frac{k}{x} \rfloor\)</span></p>
<p><span class="math inline">\(f(x)\)</span>分布呈块状,对于任意一个<span class="math inline">\(i\)</span>,有最大的<span class="math inline">\(j = \lfloor \frac{k}{\lfloor \frac{k}{i} \rfloor} \rfloor\)</span>,使得<span class="math inline">\(f(i) == f(i+1) == ... = f(j)\)</span></p>
<p>对于类似<span class="math inline">\(\sum_{i = 1}^{n}\lfloor \frac{k}{i} \rfloor\)</span>的式子,可分块在<span class="math inline">\(O(\sqrt{n})\)</span>时间内计算完毕</p>
<p>代码:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> l = <span class="number">1</span>;l &lt;= n;l = r+<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(k/l)r = <span class="built_in">min</span>(n,k/(k/l));</span><br><span class="line">		<span class="keyword">else</span> r = n;</span><br><span class="line">		ans += (r-l+<span class="number">1</span>)*(k/l);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>对于向上取整, 有 <span class="math display">\[
\lceil \frac{k}{x} \rceil = \lfloor \frac{k - 1}{x}\rfloor + 1
\]</span></p>
<h2 id="狄利克雷dirichlet卷积">狄利克雷(Dirichlet)卷积</h2>
<h3 id="定义">定义</h3>
<p>设<span class="math inline">\(f,g\)</span>为两个数论函数,其狄利克雷卷积<span class="math inline">\(f*g\)</span>为: <span class="math display">\[
f \ast g(n) = \sum_{d|n}f(d)g(\frac{n}{d})
\]</span></p>
<h3 id="常用式子">常用式子</h3>
$$
<span class="math display">\[\begin{aligned}

\varepsilon=\mu \ast 1&amp;\iff\varepsilon(n)=\sum_{d\mid n}\mu(d)\\
d=1 \ast 1&amp;\iff d(n)=\sum_{d\mid n}1\\
\sigma=\text{id} \ast 1&amp;\iff\sigma(n)=\sum_{d\mid n}d\\
\varphi=\mu \ast \text{id}&amp;\iff\varphi(n)=\sum_{d\mid n}d\cdot\mu(\frac{n}{d}) \\


\end{aligned}\]</span>
<p>$$</p>
<h2 id="常用结论-1">常用结论</h2>
<p><span class="math display">\[
\sum_{d|n}^n\varphi(d) = n
\]</span></p>
<p><span class="math display">\[
[\gcd(i,j) == 1] = \epsilon(\gcd(i,j) = \sum_{d|\gcd(i,j)}\mu(d)
\]</span></p>
<h2 id="套路题">套路题</h2>
<h2 id="sum_i1ngcdin"><span class="math inline">\(\sum_{i=1}^ngcd(i,n)\)</span></h2>
<p><span class="math display">\[
\begin{align}
&amp;\sum_{i=1}^n\gcd(i,n)\\
&amp;=\sum_{d|n}d\sum_{i=1}^n[\gcd(i,n)==d]\\
&amp;=\sum_{d|n}d\sum_{i=1}^{\frac{n}{d}}[\gcd(i,n)==1]\\
&amp;=\sum_{d|n}d\cdotφ(\frac{n}{d})
\end{align}
\]</span></p>
<h2 id="sum_i-1nsum_j1ngcdij"><span class="math inline">\(\sum_{i = 1}^n\sum_{j=1}^n\gcd(i,j)\)</span></h2>
<p><span class="math display">\[
\begin{align}
&amp;\sum_{i = 1}^n\sum_{j=1}^n\gcd(i,j)\\
&amp;= \sum_{d=1}^nd\sum_{i=1}^n\sum_{j=1}^n[gcd(i,j) == d]\\
&amp;=\sum_{d=1}^nd\sum_{i=1}^{\frac{n}{d}}\sum_{j=1}^{\frac{n}{d}}[gcd(i,j)==1]\\
&amp;=\sum_{d=1}^nd(2\cdot\sum_{i=1}^{\frac{n}{d}}\varphi(i) - 1)
\end{align}
\]</span></p>
<p>关于最后一步,我们设<span class="math inline">\(f(x) = \sum_{i=1}^{n}\sum_{j=1}^{n}[gcd(i,j)==1]\)</span></p>
<p>手画一下,容易看出<span class="math inline">\(f(x) = 2\cdot\sum_{i=1}^n\varphi(i) - 1\)</span></p>
<p>另一种做法:</p>
<p>我们知道<span class="math inline">\(\varphi\)</span>有这么一个性质,<span class="math inline">\(\sum_{d|n}^{n}\varphi(d) = n\)</span></p>
<p>也就是<span class="math inline">\(\sum_{d|\gcd(i,j)}^{n}\varphi(d) = \gcd(i,j)\)</span></p>
<p>那么: <span class="math display">\[
\begin{align}
&amp;\sum_{i = 1}^n\sum_{j = 1}^n\gcd(i,j)\\
&amp;=\sum_{i=1}^n\sum_{j=1}^n\sum_{d|\gcd(i,j)}\varphi(d)\\
&amp;=\sum_{d = 1}^n\varphi(d)\sum_{i=1}^n[d|i]\sum_{j=1}^n[d|j]\\
&amp;=\sum_{d = 1}^n\varphi(d)\cdot\lfloor\frac{n}{d}\rfloor\lfloor\frac{m}{d}\rfloor
\end{align}
\]</span> 少处理个前缀和=-=而且我感觉这个做法更好理解</p>
<p>例题:洛谷P2398</p>
<h2 id="sum_i-1nsum_ji1ngcdij"><span class="math inline">\(\sum_{i = 1}^{n}\sum_{j=i+1}^{n}\gcd(i,j)\)</span></h2>
<p>和上面那个基本一样 <span class="math display">\[
\begin{align}
&amp;\sum_{i = 1}^n\sum_{j=i+1}^n\gcd(i,j)\\
&amp;= \sum_{d=1}^nd\sum_{i=1}^n\sum_{j=i+1}^n[gcd(i,j) == d]\\
&amp;=\sum_{d=1}^nd\sum_{i=1}^{\frac{n}{d}}\sum_{j=i+1}^{\frac{n}{d}}[gcd(i,j)==1]\\
&amp;=\sum_{d=1}^nd(\sum_{i=1}^{\frac{n}{d}}\varphi(i) - 1)
\end{align}
\]</span> (最后一步的化简和上一题大同小异,手画一下就有了)</p>
<h2 id="sum_i1nsum_i1mgcdij-1"><span class="math inline">\(\sum_{i=1}^{n}\sum_{i=1}^{m}[\gcd(i,j) == 1]\)</span></h2>
<p>前置知识: <span class="math display">\[
\epsilon(n)=\sum_{d|n}\mu(d)= \begin{cases} 1&amp;n=1\\ 
0&amp;otherwise 
\end{cases}
\]</span></p>
<p>开始愉快地推式子: <span class="math display">\[
\begin{align}
&amp;\sum_{i=1}^{n}\sum_{i=1}^{m}[\gcd(i,j) == 1] \\
&amp;=\sum_{i=1}^{n}\sum_{i=1}^{m}\epsilon(\gcd(i,j))\\
&amp;=\sum_{i=1}^{n}\sum_{i=1}^{m}\sum_{d|gcd(i,j)}\mu(d)\\
&amp;=\sum_{d = 1}^{\min(n,m)}\mu(d)\sum_{i = 1}^n[d|i]\sum_{j = 1}^{m}[d|j]\\
&amp;=\sum_{d=1}^{\min(n,m)}\mu(d)\lfloor \frac{n}{d}\rfloor \lfloor \frac{m}{d} \rfloor
\end{align}
\]</span> 同理,我们有: <span class="math display">\[
\sum_{i = 1}^n\sum_{j = 1}^n\sum_{k = 1}^n [\gcd(i,j,k) == 1] = \sum_{d = 1}^n \mu(d)(\lfloor \frac{n}{d}\rfloor)^3
\]</span></p>
<h1 id="杂项">杂项</h1>
<h2 id="小学数学">小学数学</h2>
<p><span class="math display">\[
\sum a_i \cdot b_j = \frac{\sum a_i^2 - \sum b_j^2}{2}
\]</span></p>
<p>因为<span class="math inline">\((a+b)^2 = a^2 + b^2 + 2ab\)</span></p>
<p><span class="math display">\[
\sum_{i = 1}^n i = \frac{n \cdot(n+1)}{2}\\
\sum_{i = 1}^n i^2  = \frac{n \cdot (n+1) \cdot(2n + 1)}{6}\\
\sum_{i = 1}^n i^3 = (\frac{n \cdot (n+1)}{2})^2
\]</span></p>
<h2 id="杂乱的知识点">杂乱的知识点</h2>
<ul>
<li><p><span class="math display">\[
  \lfloor \frac{a}{bc} \rfloor = \lfloor \frac{\lfloor \frac{a}{b} \rfloor}{c} \rfloor
  \]</span></p></li>
<li><p><span class="math display">\[
  a +b = a\oplus b + 2\cdot a \&amp;b = a|b + a \&amp;b
  \]</span></p></li>
<li><p>设<span class="math inline">\(c(n)\)</span>为第<span class="math inline">\(n\)</span>个Catalan数, 则有<span class="math inline">\(\sum_{k = 0}^{n-1}c(k)\cdot c(n-1-k) = c(n)\)</span></p></li>
<li><p>区间加平方和(范围<span class="math inline">\([l,n]\)</span>)可通过差分进行. 设差分数组为<span class="math inline">\(d\)</span>, 每次对<span class="math inline">\([l,n]\)</span>加平方和的操作转换为<code>d[l]++,d[l+1]++</code>, 然后求d的3阶前缀和即可单点查询.</p></li>
<li><p>对于一个<span class="math inline">\(n\)</span>个点的竞赛图(有向完全图), 不经过重复边的最长路最大为<span class="math inline">\((n为偶数): \frac{n\cdot (n-1)}{2} - \frac{n}{2} + 1\)</span>;<span class="math inline">\((n为奇数):\frac{n\cdot (n-1)}{2}\)</span>; 最小为<span class="math inline">\(n-1\)</span></p></li>
</ul>
<h2 id="图兰定理">图兰定理</h2>
<p>对于一个有 <span class="math inline">\(n\)</span>个点的无向图，若其中不存在三个点的环，则边数不超过 <span class="math inline">\(n^2/4\)</span></p>
<h2 id="pick定理">Pick定理</h2>
<p>给定一个顶点均为整点(坐标为整数的点)的简单多边形,其面积<span class="math inline">\(A\)</span>和内部格点数<span class="math inline">\(I\)</span>,边上格点数<span class="math inline">\(B\)</span>的关系是: <span class="math inline">\(A = I+B/2 - 1\)</span></p>
<h2 id="cayley公式">Cayley公式</h2>
<p>一个有<span class="math inline">\(n\)</span>个节点的完全图有<span class="math inline">\(n^{n-2}\)</span>种不同的生成树</p>
<h2 id="polya定理1">Polya定理1</h2>
<pre><code>-仅旋转,染色数和顶点数均为n.欧拉函数优化(抄自Lskkkno1的题解qwq)</code></pre>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">polya</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">	ll tans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i*i &lt;= n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(n%i)<span class="keyword">continue</span>;</span><br><span class="line">		tans += (<span class="built_in">cal_phi</span>(n/i)*<span class="built_in">pow_mod</span>(n,i<span class="number">-1</span>))%MOD;</span><br><span class="line">		<span class="keyword">if</span>(i*i != n)tans += <span class="built_in">cal_phi</span>(i)*<span class="built_in">pow_mod</span>(n,n/i<span class="number">-1</span>)%MOD;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tans%MOD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
C_k^k +C_{k+1}^k +...+C_{n}^k（n &gt; k)
\]</span></p>
<h2 id="某些数列">某些数列</h2>
<p>对于数列<span class="math inline">\(\{1,2,2,3,3,3,4,4,4,4,...\}\)</span>(数<span class="math inline">\(i\)</span>出现了<span class="math inline">\(i\)</span>)次, 有通项公式 <span class="math display">\[
a_n = \frac{1+2\sqrt{2n}}{2}
\]</span></p>
<p><span class="math display">\[
\sum_{i = 1}^\infin i \cdot \frac{1}{a^i}
\]</span></p>
<p>海伦公式</p>
<p><span class="math inline">\(a,b,c\)</span>为三角形边长, <span class="math inline">\(s = \frac{a+b+c}{2}\)</span></p>
<p>三角形面积为<span class="math inline">\(S = \sqrt{s(s-a)(s-b)(s-c)}\)</span></p>
<h2 id="组合数奇偶性">组合数奇偶性</h2>
<p>对于<span class="math inline">\(C_n^k\)</span>, 如果<span class="math inline">\(n\&amp;k == k\)</span>为奇数, 否则偶数.(按位and)</p>
<h2 id="生成2进制恰好包含k位的下一个数">生成2进制恰好包含k位的下一个数</h2>
<p>若<span class="math inline">\(x\)</span>里有<span class="math inline">\(k\)</span>个1, 则<code>gen_next(x)</code>为包含<span class="math inline">\(k\)</span>个1的下一位数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gen_next</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> b = x &amp; -x;</span><br><span class="line">	<span class="keyword">int</span> t = x + b;</span><br><span class="line">	<span class="keyword">int</span> c = t &amp; -t;</span><br><span class="line">	<span class="keyword">int</span> m = (c/b &gt;&gt; <span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> t | m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="求区间nm内不含平方因子的数">求区间[n,m]内不含平方因子的数</h2>
<p>筛掉<span class="math inline">\(p^2\)</span>即可. <span class="math inline">\(p\)</span>是素数且<span class="math inline">\(p \in [n,m]\)</span></p>
<h2 id="等比数列">等比数列</h2>
<p><span class="math inline">\(a\)</span>为首项, <span class="math inline">\(q\)</span>为公比</p>
<p><span class="math display">\[
求和:S_n = a \cdot \frac{1-q^n}{1-q} (q \ne 1)
\]</span></p>
<p><span class="math display">\[
求积:P_n = a^n \cdot q^{\frac{n(n-1)}{2}}
\]</span></p>
<h2 id="大素数分解">大素数分解</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> prime_fac &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> S = <span class="number">8</span>; <span class="comment">// 随机算法判定次数，8~10 就够了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 龟速乘</span></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">mult_mod</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a, <span class="keyword">long</span> <span class="keyword">long</span> b, <span class="keyword">long</span> <span class="keyword">long</span> c)</span> </span>&#123;</span><br><span class="line">        a %= c, b %= c;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> tmp = a;</span><br><span class="line">        <span class="keyword">while</span> (b) &#123;</span><br><span class="line">            <span class="keyword">if</span> (b &amp; <span class="number">1</span>) &#123;</span><br><span class="line">                ret += tmp;</span><br><span class="line">                <span class="keyword">if</span> (ret &gt; c) ret -= c;</span><br><span class="line">            &#125;</span><br><span class="line">            tmp &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (tmp &gt; c) tmp -= c;</span><br><span class="line">            b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 快速幂</span></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">qow_mod</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a, <span class="keyword">long</span> <span class="keyword">long</span> n, <span class="keyword">long</span> <span class="keyword">long</span> _mod)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> temp = a % _mod;</span><br><span class="line">        <span class="keyword">while</span> (n) &#123;</span><br><span class="line">            <span class="keyword">if</span> (n &amp; <span class="number">1</span>) ret = <span class="built_in">mult_mod</span>(ret, temp, _mod);</span><br><span class="line">            temp = <span class="built_in">mult_mod</span>(temp, temp, _mod);</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是合数返回true，不一定是合数返回false</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a, <span class="keyword">long</span> <span class="keyword">long</span> n, <span class="keyword">long</span> <span class="keyword">long</span> x, <span class="keyword">long</span> <span class="keyword">long</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="built_in">qow_mod</span>(a, x, n);</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> last = ret;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= t; i++) &#123;</span><br><span class="line">            ret = <span class="built_in">mult_mod</span>(ret, ret, n);</span><br><span class="line">            <span class="keyword">if</span> (ret == <span class="number">1</span> &amp;&amp; last != <span class="number">1</span> &amp;&amp; last != n - <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            last = ret;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ret != <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 是素数返回true，不是返回false</span></span><br><span class="line">    <span class="function">mt19937 <span class="title">rng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">Miller_Rabin</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> ((n &amp; <span class="number">1</span>) == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> x = n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> t = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((x &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123; x &gt;&gt;= <span class="number">1</span>; t++; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; S; i++) &#123;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> a = <span class="built_in">rng</span>() % (n - <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">check</span>(a, n, x, t))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> factor[<span class="number">100</span>];<span class="comment">// 存质因数</span></span><br><span class="line">    <span class="keyword">int</span> tol; <span class="comment">// 质因数的个数，0~tol-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">gcd</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a, <span class="keyword">long</span> <span class="keyword">long</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> t;</span><br><span class="line">        <span class="keyword">while</span> (b) &#123;</span><br><span class="line">            t = a;</span><br><span class="line">            a = b;</span><br><span class="line">            b = t % b;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (a &gt;= <span class="number">0</span>) <span class="keyword">return</span> a;</span><br><span class="line">        <span class="keyword">return</span> -a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">pollard_rho</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> x, <span class="keyword">long</span> <span class="keyword">long</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> i = <span class="number">1</span>, k = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> x0 = <span class="built_in">rng</span>() % (x - <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> y = x0;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            i++;</span><br><span class="line">            x0 = (<span class="built_in">mult_mod</span>(x0, x0, x) + c) % x;</span><br><span class="line">            <span class="keyword">long</span> <span class="keyword">long</span> d = <span class="built_in">gcd</span>(y - x0, x);</span><br><span class="line">            <span class="keyword">if</span> (d != <span class="number">1</span> &amp;&amp; d != x) <span class="keyword">return</span> d;</span><br><span class="line">            <span class="keyword">if</span> (y == x0) <span class="keyword">return</span> x;</span><br><span class="line">            <span class="keyword">if</span> (i == k) &#123; y = x0; k += k; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 对n质因数分解，存入factor，k一般设置为107左右</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">findfac</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> n, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Miller_Rabin</span>(n)) &#123;</span><br><span class="line">            factor[tol++] = n;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> p = n;</span><br><span class="line">        <span class="keyword">int</span> c = k;</span><br><span class="line">        <span class="keyword">while</span> (p &gt;= n) p = <span class="built_in">pollard_rho</span>(p, c--);</span><br><span class="line">        <span class="built_in">findfac</span>(p, k);</span><br><span class="line">        <span class="built_in">findfac</span>(n / p, k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">fac</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> n)</span> </span>&#123;</span><br><span class="line">        tol = <span class="number">0</span>;</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt;ret;</span><br><span class="line">        <span class="built_in">findfac</span>(n, <span class="number">107</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tol; i++)ret.<span class="built_in">push_back</span>(factor[i]);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="子集">子集</h2>
<h3 id="子集的和与积">子集的和与积</h3>
<ul>
<li><p>对于集合<span class="math inline">\(S = \{a_i\}，i = 1...n\)</span>, 其全部子集中元素和的和为<span class="math inline">\(2^{n-1}\cdot \sum_{i = 1}^na_i\)</span></p></li>
<li><p>其全部子集中元素积的和为<span class="math inline">\(\prod_{i = 1}^n(a_i + 1)\)</span></p></li>
<li><p>从中选出大小为<span class="math inline">\(k\)</span>的全部子集, 元素积的和可用OGF求解, 即 <span class="math display">\[
  \sum_{S&#39; \in S \and |S&#39;| = k}\space \prod_{p_i\in S&#39;}p_i = [k] \prod_{i = 1}^n (1+a_i)
  \]</span> NTT分治即可.</p></li>
</ul>
<h3 id="枚举子集">枚举子集</h3>
<ol type="1">
<li><p>给定集合<span class="math inline">\(m\)</span>, 枚举它的全部子集:</p>
<p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> S = m;S &gt;= <span class="number">0</span>;S = (S<span class="number">-1</span>)&amp;m)</span><br></pre></td></tr></table></figure></p></li>
<li><p>枚举大小为<span class="math inline">\(n\)</span>的全部集合<span class="math inline">\(m\)</span>, 且对于每个<span class="math inline">\(m\)</span>, 枚举其全部子集<span class="math inline">\(S\)</span>. 时间复杂度<span class="math inline">\(O(3^n)\)</span>:</p>
<p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> m = <span class="number">0</span>;m &lt; (<span class="number">1</span>&lt;&lt;n);m++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> S = m;S &gt;= <span class="number">0</span>; S = (S<span class="number">-1</span>)&amp;m)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="子集和高维前缀和">子集和/高维前缀和</h3>
<p>求解如下问题:</p>
<p>子集和: <span class="math display">\[
f[S] = \sum_{T \in S}f[T]
\]</span> 超集和: <span class="math display">\[
f[T] = \sum_{T\in S}f[S]
\]</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; (<span class="number">1</span> &lt;&lt; n); j++)</span><br><span class="line">        <span class="keyword">if</span>(j &amp; (<span class="number">1</span> &lt;&lt; i))&#123;</span><br><span class="line">            f[j] += f[j ^ (<span class="number">1</span> &lt;&lt; i)];<span class="comment">//子集和</span></span><br><span class="line">			<span class="comment">//或f[j ^ (1 &lt;&lt; i)] += f[j];</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>时间复杂度<span class="math inline">\(O(n \cdot 2^n)\)</span></p>
<h2 id="求双阶乘的最后64位">求双阶乘的最后64位</h2>
<p>跑起来很快, 大概是<span class="math inline">\(O(log^2(n))\)</span>级别 <span class="math display">\[
(2n - 1)!! = \prod_{i = 1,i += 2}^{2n-1}i
\]</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lld;</span><br><span class="line">lld C[<span class="number">64</span>][<span class="number">64</span>], jc[<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">poly</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    lld x[<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">poly</span>() &#123; <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) x[i] = <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="built_in">poly</span>(lld c1, lld c0) : <span class="built_in">poly</span>() &#123; x[<span class="number">1</span>] = c1, x[<span class="number">0</span>] = c0; &#125;</span><br><span class="line">    <span class="function">lld <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">int</span> k)</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> x[k]; &#125;</span><br><span class="line">    <span class="function">lld &amp;<span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123; <span class="keyword">return</span> x[k]; &#125;</span><br><span class="line"></span><br><span class="line">    poly <span class="keyword">operator</span>*(<span class="keyword">const</span> poly &amp;b) <span class="keyword">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        poly c;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= i; j++)</span><br><span class="line">                <span class="built_in">c</span>(i) += x[j] * <span class="built_in">b</span>(i-j);</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">poly <span class="title">moveto</span><span class="params">(lld n)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        poly ans;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = jc[<span class="number">0</span>] = <span class="number">1</span>; i &lt; <span class="number">64</span>; i++)</span><br><span class="line">            jc[i] = jc[i<span class="number">-1</span>] * n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; <span class="number">64</span>; j++)</span><br><span class="line">                <span class="built_in">ans</span>(i) += x[j] * jc[j-i] * C[j][i];</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">map&lt;lld, poly&gt; cache;</span><br><span class="line"></span><br><span class="line"><span class="function">poly <span class="title">solve</span><span class="params">(lld n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cache.<span class="built_in">count</span>(n)) <span class="keyword">return</span> cache[n];</span><br><span class="line">    poly half = <span class="built_in">solve</span>(n / <span class="number">2</span>);</span><br><span class="line">    half = half * half.<span class="built_in">moveto</span>(n / <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> (n &amp; <span class="number">1</span>) half = half * <span class="built_in">poly</span>(<span class="number">2</span>, n*<span class="number">2</span><span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">return</span> cache[n] = half;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">poly <span class="title">Px</span><span class="params">(<span class="number">0</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line">    cache[<span class="number">0</span>] = Px;</span><br><span class="line"></span><br><span class="line">    C[<span class="number">0</span>][<span class="number">0</span>] = C[<span class="number">1</span>][<span class="number">0</span>] = C[<span class="number">1</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">2</span>; n &lt; <span class="number">64</span>; n++)</span><br><span class="line">    &#123;</span><br><span class="line">        C[n][<span class="number">0</span>] = C[n][n] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> m = <span class="number">1</span>; m &lt; n; m++)</span><br><span class="line">            C[n][m] = C[n<span class="number">-1</span>][m<span class="number">-1</span>] + C[n<span class="number">-1</span>][m];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">int</span> T; lld n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (T--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;n);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%llu\n&quot;</span>, <span class="built_in">solve</span>(n)(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
\sum_{i = 1}^n \sum_{c \in{cnt} \and c &lt; t[i]}\frac{(n - i)!}{(\prod_{c&#39; \in cnt \and c&#39; \neq c}c&#39;!) \cdot (c-1)!}
\]</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2022/08/22/solution-CF1715E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/22/solution-CF1715E/" class="post-title-link" itemprop="url">solution-CF1715E</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-08-22 20:32:56 / Modified: 20:36:21" itemprop="dateCreated datePublished" datetime="2022-08-22T20:32:56+08:00">2022-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="题意">题意</h2>
<h2 id="做法">做法</h2>
<p>斜率优化可以解决如下问题:</p>
<p>给出一组直线<span class="math inline">\(y_i = k_i x_ + b_i\)</span>. 对于任意<span class="math inline">\(x\)</span>, 求<span class="math inline">\(y_i\)</span>的极大/极小值.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2022/05/29/GAMES104-homework-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/05/29/GAMES104-homework-2/" class="post-title-link" itemprop="url">[GAMES104]-作业2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-05-29 07:50:50 / Modified: 17:05:30" itemprop="dateCreated datePublished" datetime="2022-05-29T07:50:50+08:00">2022-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/GAMES104/" itemprop="url" rel="index"><span itemprop="name">GAMES104</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>因为一直要赶一堆莫名其妙的ddl和考试 task3没做 日后再补_(:з」∠)_</p>
<h2 id="color-grading与lut">Color Grading与LUT</h2>
<p>调色是增强画面表现力的一种很有效的手段. 本次作业我们处理的颜色在sRGB空间内, 红、绿、蓝三个颜色分别用一个<span class="math inline">\([0,1]\)</span>的实数来表示. 将三原色分别用一个坐标轴来表示, 便构成了如图所示的色彩空间(图片来自<a target="_blank" rel="noopener" href="https://defold.com/tutorials/grading/">defold.com</a>):</p>
<p><img src="https://defold.com/tutorials/images/grading/color_cube.png" alt="color cube" style="zoom:33%;" /></p>
<p>在进行调色时, 我们对渲染结果的每个像素进行处理, 根据像素原本的RGB值将其映射到一个新的色彩空间. 这种映射一般采用LUT(look up table)图来进行. LUT有1D和3D之分, Pilot Engine使用的是3D的LUT, 它看上去像这个样子:</p>
<p><img src="E:\Github\Pilot_Homework2\engine\asset\texture\lut\color_grading_LUT.jpg" /></p>
<p>这张图片的长为<span class="math inline">\(1024\)</span>个像素, 宽为<span class="math inline">\(32\)</span>个像素, 可以看出它由<span class="math inline">\(32\)</span>个小色块组成. 将这些小方块自上而下拼接在一起, 便组成了一个<span class="math inline">\(32 \times 32 \times 32\)</span>的色彩空间. 我们需要做的便是根据每个像素的RGB分量找到它在这张图上对应的像素. 具体来说, 原像素的<span class="math inline">\(G\)</span>分量指示了新像素在LUT上的纵坐标, <span class="math inline">\(B\)</span>分量指示了新像素所属的色块编号, <span class="math inline">\(R\)</span>分量指示了新像素在某个色块内部的横坐标.</p>
<h2 id="编写shader">编写Shader</h2>
<p>我们需要编写的Shader文件是<code>color_grading.frag</code>, 可以在<code>\engine\shader\glsl\</code>中找到.</p>
<p>这个shader已经提供了原像素的颜色<code>in_color</code>和LUT的2D采样器<code>color_grading_lut_texture_sampler</code>. 我们需要根据原像素的颜色计算出调色后的颜色并将其赋值给<code>out_color</code>作为输出.</p>
<p>在计算前, 需要获取像素的颜色值:</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">highp</span> <span class="type">vec4</span> color = subpassLoad(in_color).rgba;</span><br></pre></td></tr></table></figure>
<p>颜色值是一个四维向量, 四个维度分别代表R、G、B和alpha, 均为<span class="math inline">\([0,1]\)</span>的实数.</p>
<p>在计算出坐标后, 需要从LUT上获取对应的颜色:</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">highp</span> <span class="type">vec4</span> color_sampled = <span class="built_in">texture</span>(color_grading_lut_texture_sampler, uv);</span><br></pre></td></tr></table></figure>
<p>其中<code>color_grading_lut_texture_sampler</code>已经提供, <code>uv</code>是一个二维向量, <span class="math inline">\(u\)</span>代表横坐标, <span class="math inline">\(v\)</span>代表纵坐标, 坐标原点在图片的左上角, <span class="math inline">\(x\)</span>轴方向向右, <span class="math inline">\(y\)</span>轴方向向下. <span class="math inline">\(u,v\)</span>也是<span class="math inline">\([0,1]\)</span>上的实数.</p>
<p>我们还需要获取LUT的长宽:</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">highp</span> <span class="type">ivec2</span> lut_tex_size = <span class="built_in">textureSize</span>(color_grading_lut_texture_sampler, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>有了如上函数, 不难计算出每个像素在LUT上的对应位置. 设<span class="math inline">\(C\)</span>是LUT的宽, <span class="math inline">\(R,G,B\)</span>分别为像素的原颜色分量, 则有: <span class="math display">\[
u = \frac{\lfloor B \cdot C \rfloor + R}{C}\\
v = G
\]</span> 为了提高准确度和防止越界, 可以在LUT的边界上各留出0.5个像素, 将RGB值映射到<span class="math inline">\(C-1\)</span>个像素中去. 具体细节见代码:</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 310 es</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#extension GL_GOOGLE_include_directive : enable</span></span><br><span class="line"><span class="comment">//#extension GL_KHR_vulkan_glsl : enable</span></span><br><span class="line"><span class="meta">#include &quot;constants.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(input_attachment_index = <span class="number">0</span>, set = <span class="number">0</span>, <span class="keyword">binding</span> = <span class="number">0</span>) <span class="keyword">uniform</span> <span class="keyword">highp</span> subpassInput in_color;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(set = <span class="number">0</span>, <span class="keyword">binding</span> = <span class="number">1</span>) <span class="keyword">uniform</span> <span class="type">sampler2D</span> color_grading_lut_texture_sampler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">out</span> <span class="keyword">highp</span> <span class="type">vec4</span> out_color;</span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">highp</span> <span class="type">ivec2</span> lut_tex_size = <span class="built_in">textureSize</span>(color_grading_lut_texture_sampler, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">highp</span> <span class="type">float</span> COLORS       = <span class="type">float</span>(lut_tex_size.y);<span class="comment">//LUT的每一维的颜色数量</span></span><br><span class="line">    <span class="keyword">highp</span> <span class="type">vec4</span>  color        = subpassLoad(in_color).rgba;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">highp</span> <span class="type">float</span> max_color = COLORS - <span class="number">1.0</span>;<span class="comment">//允许使用的最大元素</span></span><br><span class="line">    <span class="keyword">highp</span> <span class="type">float</span> half_pix_u = <span class="number">0.5</span> / <span class="type">float</span>(lut_tex_size.x);<span class="comment">//预留出半个像素</span></span><br><span class="line">    <span class="keyword">highp</span> <span class="type">float</span> half_pix_v = <span class="number">0.5</span> / <span class="type">float</span>(lut_tex_size.y);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">highp</span> <span class="type">float</span> part = <span class="built_in">floor</span>(color.b * max_color);<span class="comment">//根据B计算出该像素所属的色块编号</span></span><br><span class="line">    <span class="keyword">highp</span> <span class="type">float</span> threshold = max_color / COLORS;<span class="comment">//现在只有COLORS-1个颜色可用</span></span><br><span class="line">    <span class="keyword">highp</span> <span class="type">float</span> u = (half_pix_u + threshold * color.r + part) / COLORS;</span><br><span class="line">    <span class="keyword">highp</span> <span class="type">float</span> v = (half_pix_v + threshold * color.g);</span><br><span class="line">    <span class="comment">//预留出0.5像素的边界.例如假设COLORS = 32,在G = 0时v = 0.5/32,G = 1时v = 31.5/32</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">highp</span> <span class="type">vec2</span> uv = <span class="type">vec2</span>(u,v);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">highp</span> <span class="type">vec4</span> color_sampled = <span class="built_in">texture</span>(color_grading_lut_texture_sampler, uv);</span><br><span class="line"></span><br><span class="line">    out_color =  color_sampled;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="效果展示与自定义lut">效果展示与自定义LUT</h2>
<p>在<code>\engine\asset\texture\lut</code>中存放着不同的LUT. 通过修改<code>\engine\asset\global\rendering.global.json</code>中<code>"color_grading_map"</code>项可以替换不同的LUT.</p>
<p>在不进行调色时的效果是这样的:</p>
<figure>
<img src="E:\Github\hexo\source_posts\GAMES104-homework-2.assets\image-20220529161702147.png" alt="image-20220529161702147" /><figcaption aria-hidden="true">image-20220529161702147</figcaption>
</figure>
<p>调色后的效果:</p>
<figure>
<img src="E:\Github\hexo\source_posts\GAMES104-homework-2.assets\image-20220529162809564.png" alt="image-20220529162809564" /><figcaption aria-hidden="true">image-20220529162809564</figcaption>
</figure>
<p>要创建自定义的LUT, 只需在GIMP或者PhotoShop等工具编辑原始LUT图像(可以附一张截图方便观察调色效果).</p>
<p>负片效果的LUT:</p>
<p><img src="E:\Github\Pilot_Homework2\engine\asset\texture\lut\LUT32_Invert.png" /></p>
<figure>
<img src="E:\Github\hexo\source_posts\GAMES104-homework-2.assets\image-20220529165605604.png" alt="image-20220529165605604" /><figcaption aria-hidden="true">image-20220529165605604</figcaption>
</figure>
<p>偏冷色调(好像太绿了):</p>
<p><img src="E:\Github\Pilot_Homework2\engine\asset\texture\lut\LUT32_qwq.png" /></p>
<figure>
<img src="E:\Github\hexo\source_posts\GAMES104-homework-2.assets\image-20220529165831153.png" alt="image-20220529165831153" /><figcaption aria-hidden="true">image-20220529165831153</figcaption>
</figure>
<p>PS:调色后会出现看上去很奇怪的色块, 目前还不知道如何解决</p>
<p><img src="E:\Github\hexo\source\_posts\GAMES104-homework-2.assets\image-20220529165922432.png" alt="image-20220529165922432" style="zoom:33%;" /></p>
<p><img src="E:\Github\hexo\source\_posts\GAMES104-homework-2.assets\image-20220529165936292.png" alt="image-20220529165936292" style="zoom:33%;" /></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2022/04/30/demo-render/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/04/30/demo-render/" class="post-title-link" itemprop="url">[笔记]从0开始搓一个简单的render</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-04-30 11:39:36" itemprop="dateCreated datePublished" datetime="2022-04-30T11:39:36+08:00">2022-04-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-06-30 20:53:54" itemprop="dateModified" datetime="2022-06-30T20:53:54+08:00">2022-06-30</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">图形学</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文的主要内容是对Dmitry V. Sokolov的<a target="_blank" rel="noopener" href="https://github.com/ssloy/tinyrenderer">tinyrender</a>课程的记录和补充.</p>
<h1 id="step-0环境搭建">Step 0：环境搭建</h1>
<p>我们需要<code>tgaimage.h</code>来操作TGA文件, <code>model.h</code>来操作模型. 头文件和实现可以在这里找到:</p>
<p>https://github.com/ssloy/tinyrenderer/tree/f6fecb7ad493264ecd15e230411bfb1cca539a12</p>
<p>可以用如下代码来测试:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;tgaimage.h&quot;</span></span></span><br><span class="line"><span class="keyword">const</span> TGAColor white = <span class="built_in">TGAColor</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line"><span class="keyword">const</span> TGAColor red   = <span class="built_in">TGAColor</span>(<span class="number">255</span>, <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">255</span>);</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span>&#123;</span><br><span class="line">        <span class="function">TGAImage <span class="title">image</span><span class="params">(<span class="number">100</span>, <span class="number">100</span>, TGAImage::RGB)</span></span>;</span><br><span class="line">        image.<span class="built_in">set</span>(<span class="number">52</span>, <span class="number">41</span>, red);</span><br><span class="line">        image.<span class="built_in">flip_vertically</span>(); <span class="comment">// i want to have the origin at the left bottom corner of the image</span></span><br><span class="line">        image.<span class="built_in">write_tga_file</span>(<span class="string">&quot;output.tga&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到一个有红点的TGA文件:</p>
<p><img src="demo-render.assets\image-20220430115033896.png" alt="image-20220430115033896" style="zoom:25%;" /></p>
<h1 id="step-1画一条直线">Step 1：画一条直线</h1>
<h2 id="朴素算法">朴素算法</h2>
<p>我们需要在二维位图上画一条从<span class="math inline">\((x_0,y_0)\)</span>到<span class="math inline">\((x_1,y_1)\)</span>的直线.</p>
<p>直线的两点式为: <span class="math display">\[
\frac{y - y_0}{y_1 - y_0} = \frac{x - x_0}{x_1 - x_0}
\]</span> 因而对任一点<span class="math inline">\(x\)</span>, 有 <span class="math display">\[
y = \frac{x - x_0}{x_1 - x_0} \cdot(y_1 - y_0) + y_0
\]</span> 我们只要枚举<span class="math inline">\(x\)</span>, 计算出每个<span class="math inline">\(x\)</span>对应的<span class="math inline">\(y\)</span>即可画出直线. 需要注意的是, 这个算法默认<span class="math inline">\((x_1,y_1)\)</span>在<span class="math inline">\((x_0,y_0)\)</span>的右上方, 并且绘制时需要枚举<span class="math inline">\(\Delta x,\Delta y\)</span>中较大的一方以保证线段不会断开.</p>
<p>代码如下:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Drawer::Line</span><span class="params">(<span class="keyword">int</span> x0, <span class="keyword">int</span> y0, <span class="keyword">int</span> x1, <span class="keyword">int</span> y1, TGAColor color)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> flip = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">abs</span>(x0 - x1) &lt; <span class="built_in">abs</span>(y0 - y1))&#123;</span><br><span class="line">        flip = <span class="number">1</span>;</span><br><span class="line">        std::<span class="built_in">swap</span>(x0,y0),std::<span class="built_in">swap</span>(x1,y1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x0 &gt; x1)&#123;</span><br><span class="line">        std::<span class="built_in">swap</span>(x0,x1),std::<span class="built_in">swap</span>(y0,y1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> x = x0;x &lt;= x1;x++)&#123;</span><br><span class="line">        <span class="keyword">double</span> t = (<span class="keyword">double</span>)(x - x0)/(x1 - x0);</span><br><span class="line">        <span class="keyword">int</span> y = t * (y1 - y0) + y0;</span><br><span class="line">        <span class="keyword">if</span>(!flip)<span class="built_in">set</span>(x,y,color);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">set</span>(y,x,color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="bresenham直线算法">Bresenham直线算法</h2>
<p>朴素算法已经能够满足绘图需要, 但是使用了浮点乘法除法, 效率很低.</p>
<p>我们设直线的斜率<span class="math inline">\(k = \frac{y_1 - y_0}{x_1 - x_0}\)</span>, 有 <span class="math display">\[
y = (x - x_0) \cdot k + y_0
\]</span> 我们假设当前画笔所在位置的是<span class="math inline">\((x,y_c)\)</span>, 误差为<span class="math inline">\(E = y- y_c\)</span>. 当<span class="math inline">\(x\)</span>加<span class="math inline">\(1\)</span>时, <span class="math inline">\(E\)</span>增加<span class="math inline">\(k\)</span>. 当<span class="math inline">\(E \ge \frac{1}{2}\)</span>时, 我们需要将<span class="math inline">\(y_c\)</span>加或减<span class="math inline">\(1\)</span>同时<span class="math inline">\(E\)</span>减去<span class="math inline">\(1\)</span>. 这样便避免了每次都要进行的浮点除法运算.</p>
<p>具体来说, 我们只需将不等式的两边乘上<span class="math inline">\(2 \cdot (x_1 - x_0)\)</span>即可. 此时误差每次增加<span class="math inline">\(2 \cdot (y_1 - y_0)\)</span>. 当<span class="math inline">\(E \ge (x_1 - x_0)\)</span>时需要将<span class="math inline">\(y_c\)</span>加或减<span class="math inline">\(1\)</span>同时<span class="math inline">\(E\)</span>减去<span class="math inline">\(2 \cdot (x_1 - x_0)\)</span>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Drawer::Line</span><span class="params">(<span class="keyword">int</span> x0, <span class="keyword">int</span> y0, <span class="keyword">int</span> x1, <span class="keyword">int</span> y1, TGAColor color)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> flip = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">abs</span>(x0 - x1) &lt; <span class="built_in">abs</span>(y0 - y1))&#123;</span><br><span class="line">        flip = <span class="number">1</span>;</span><br><span class="line">        std::<span class="built_in">swap</span>(x0,y0),std::<span class="built_in">swap</span>(x1,y1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x0 &gt; x1)&#123;</span><br><span class="line">        std::<span class="built_in">swap</span>(x0,x1),std::<span class="built_in">swap</span>(y0,y1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> dx = x1 - x0,dy = y1 - y0;</span><br><span class="line">    <span class="keyword">int</span> e = <span class="number">0</span>,de = <span class="number">2</span>*<span class="built_in">abs</span>(dy);</span><br><span class="line">    <span class="keyword">int</span> y = y0;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> x = x0;x &lt;= x1;x++)&#123;</span><br><span class="line">        e += de;</span><br><span class="line">        <span class="keyword">if</span>(e &gt;= dx) &#123;</span><br><span class="line">            e -= dx*<span class="number">2</span>;</span><br><span class="line">            y += (dy &gt; <span class="number">0</span>?<span class="number">1</span>:<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!flip)<span class="built_in">set</span>(x,y,color);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">set</span>(y,x,color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="step-2画一个三角形">Step 2：画一个三角形</h1>
<h2 id="扫描线法">扫描线法</h2>
<p>我们先用一种十分古老的方法来画一个三角形: 用水平或者竖直的线一行一行地绘制.</p>
<p>在绘制前, 先对三角形的三个顶点按横坐标递增进行排序, 然后标号为<span class="math inline">\(P_0,P_1,P_2\)</span>(以下默认左下角为坐标原点). 同时将边<span class="math inline">\(P_0P_1\)</span>标为<span class="math inline">\(L_0\)</span>, <span class="math inline">\(P_1P_2\)</span>标为<span class="math inline">\(L_1\)</span>, <span class="math inline">\(P_2P_3\)</span>标为<span class="math inline">\(L_2\)</span>, 如图:</p>
<p><img src="demo-render.assets\image-20220501154945120.png" alt="image-20220501154945120" style="zoom:50%;" /></p>
<p>标号后的三角形可按<span class="math inline">\(x = x_1\)</span>​这条直线分割成两部分. 对两部分分别进行绘制即可. 注意处理一下斜率不存在时的细节.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Drawer::Triangle</span><span class="params">(Vec2i t0, Vec2i t1, Vec2i t2, TGAColor color)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x0,y0,x1,y1,x2,y2;</span><br><span class="line">    std::vector&lt;std::pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; &gt;top = &#123;&#123;t0.u,t0.v&#125;,&#123;t1.u,t1.v&#125;,&#123;t2.u,t2.v&#125;&#125;;</span><br><span class="line">    std::<span class="built_in">sort</span>(top.<span class="built_in">begin</span>(),top.<span class="built_in">end</span>());</span><br><span class="line">    std::<span class="built_in">tie</span>(x0,y0) = top[<span class="number">0</span>];</span><br><span class="line">    std::<span class="built_in">tie</span>(x1,y1) = top[<span class="number">1</span>];</span><br><span class="line">    std::<span class="built_in">tie</span>(x2,y2) = top[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> mx = std::<span class="built_in">max</span>(x1,x2);</span><br><span class="line">    <span class="keyword">double</span> k0 = (<span class="keyword">double</span>)(y1 - y0)/(x1 == x0?<span class="number">1</span>:x1 - x0);</span><br><span class="line">    <span class="keyword">double</span> k1 = (<span class="keyword">double</span>)(y2 - y1)/(x2 == x1?<span class="number">1</span>:x2 - x1);</span><br><span class="line">    <span class="keyword">double</span> k2 = (<span class="keyword">double</span>)(y2 - y0)/(x2 == x0?<span class="number">1</span>:x2 - x0);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> x = x0;x &lt;= x2;x++)&#123;</span><br><span class="line">        <span class="keyword">int</span> yc2 = (x - x0) * k2 + y0;</span><br><span class="line">        <span class="keyword">if</span>(x &lt;= x1)&#123;</span><br><span class="line">            <span class="keyword">int</span> yc0 = (x - x0) * k0 + y0;</span><br><span class="line">            <span class="built_in">Line</span>(x,yc0,x,yc2,color);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> yc1 = (x - x1) * k1 + y1;</span><br><span class="line">            <span class="built_in">Line</span>(x,yc1,x,yc2,color);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="重心坐标系">重心坐标系</h2>
<h3 id="一般定义">一般定义</h3>
<p>设<span class="math inline">\(V_1,...,V_n\)</span>是<span class="math inline">\(n\)</span>维向量空间<span class="math inline">\(V\)</span>中<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Simplex">单纯形</a>的顶点, 对于<span class="math inline">\(V\)</span>中任意一点<span class="math inline">\(P\)</span>, 有 <span class="math display">\[
(\sum_{i = 1}^n \lambda_i)\cdot P = \sum_{i = 1}^n \lambda_i \cdot V_i
\]</span> 则系数<span class="math inline">\(\lambda_1,...,\lambda_n\)</span>称为<span class="math inline">\(P\)</span>关于<span class="math inline">\(V_1,...V_n\)</span>的重心坐标. 一般规定<span class="math inline">\(\sum_{i = 1}^n \lambda_i = 1\)</span>, 此时称为<strong>正规化</strong>的重心坐标. 以下讨论的重心坐标均为正规化的.</p>
<h3 id="二维平面中的重心坐标系">二维平面中的重心坐标系</h3>
<h4 id="定义">定义</h4>
<p>二维平面上, 单纯形为三角形. 假设给出一三角形<span class="math inline">\(\Delta ABC\)</span>和三角形所在平面上的一点<span class="math inline">\(P\)</span>, 则<span class="math inline">\(P\)</span>可被如下重心坐标表示: <span class="math display">\[
P = \alpha A + \beta B + \gamma C
\]</span> 考虑<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/144360079">下图(来源见链接)</a>:</p>
<p><img src="https://pic2.zhimg.com/80/v2-34f542500eb2b8b4679dc351609398ad_720w.jpg" alt="img" style="zoom: 50%;" /></p>
<p>将<span class="math inline">\(\vec{AB},\vec{AC}\)</span>作为坐标系, 可以得到 <span class="math display">\[
\begin{align}
P =&amp; A + \beta(\vec{AB}) + \gamma(\vec{AC})\\
=&amp; A + \beta(B - A) + \gamma(C - A)\\
=&amp; (1 - \beta - \gamma)A + \beta B + \gamma C
\end{align}
\]</span> 这样便可以从坐标系的角度来解释重心坐标, 同时能得到 <span class="math display">\[
\alpha = 1 - \beta - \gamma
\]</span></p>
<h4 id="求解解方程组">求解:解方程组</h4>
<p>将点带入重心坐标的定义, 可以得到: <span class="math display">\[
\left \{
\begin{array}{cccc} 
   x_p = (1 - \beta - \gamma) x_a + \beta x_b + \gamma x_c \\
   y_p = (1 - \beta - \gamma) y_a + \beta y_b + \gamma y_c
\end{array}
\right.
\]</span> 提取出<span class="math inline">\(\beta \space \gamma\)</span>: <span class="math display">\[
\left \{
\begin{array}{cccc}
x_p - x_a = \beta(x_b - x_a) + \gamma (x_c - x_a)\\
y_p - y_a = \beta(y_b - y_a) + \gamma (y_c - y_a)
\end{array}
\right.
\]</span> 转化为矩阵形式: <span class="math display">\[
\left[
\begin{array}{}
    x_b - x_a &amp; x_c - x_a\\
    y_b - y_a &amp; y_c - y_a
\end{array}
\right]
\left[
\begin{array}{}
\beta \\
\gamma
\end{array}
\right]
=
\left[
\begin{array}{}
x_p - x_a\\
y_p - y_a
\end{array}
\right]
\]</span> 这样便可求解出<span class="math inline">\(\beta \space \gamma\)</span>进而求出<span class="math inline">\(\alpha\)</span></p>
<h4 id="求解向量叉积">求解:向量叉积</h4>
<p>把坐标系的表达式变换一下: <span class="math display">\[
\beta \vec{AB} + \gamma \vec{AC} + \vec{PA} = 0
\]</span> 拆开后: <span class="math display">\[
\left \{
\begin{array}{cccc} 
\beta\vec{AB}_x + \gamma \vec{AC}_x + \vec{PA}_x = 0\\
\beta\vec{AB}_y + \gamma \vec{AC}_y + \vec{PA}_y = 0
\end{array}
\right.
\]</span> 转化为矩阵形式: <span class="math display">\[
\left[
\begin{array}{}
\beta &amp; \gamma &amp; 1
\end{array}
\right]
\left[
\begin{array}{}
\vec{AB}_x\\
\vec{AC}_x\\
\vec{PA}_x
\end{array}
\right] = 0\\
\left[
\begin{array}{}
\beta &amp; \gamma &amp; 1
\end{array}
\right]
\left[
\begin{array}{}
\vec{AB}_y\\
\vec{AC}_y\\
\vec{PA}_y
\end{array}
\right] = 0\\
\]</span> 从几何意义考虑, 这相当于<span class="math inline">\([\beta ,\gamma,1]\)</span>这个向量和后两个向量分别垂直. 因而我们求出后两个向量的叉积(假设结果为<span class="math inline">\([x,y,z]\)</span>), 则<span class="math inline">\([\frac{x}{z}, \frac{y}{z},1]\)</span>等于<span class="math inline">\([\beta,\gamma,1]\)</span>​.</p>
<p>需要注意<span class="math inline">\(z = 0\)</span>的特殊情况, 根据叉乘的定义, 此时有<span class="math inline">\(\vec{AB}_x \cdot \vec{AC}_y - \vec{AB}_y \cdot \vec{AC}_x = 0\)</span>, 即<span class="math inline">\(\vec{AB} \cdot \vec{AC} = 0\)</span>, 说明<span class="math inline">\(ABC\)</span>三点共线. 这时返回一个任意的负重心坐标即可.</p>
<h4 id="求解三角形面积">求解:三角形面积</h4>
<p><img src="demo-render.assets\image-20220502193646986.png" alt="image-20220502193646986" style="zoom:50%;" /></p>
<p>如图, 假设三角形面积分别为<span class="math inline">\(S_A,S_B,S_C\)</span>. 则 <span class="math display">\[
\alpha = \frac{S_A}{S_A+S_B+S_C}\\
\beta = \frac{S_B}{S_A+S_B+S_C}\\
\gamma = \frac{S_C}{S_A+S_B+S_C}
\]</span></p>
<h3 id="应用">应用</h3>
<p>重心坐标有很多应用, 在这里我们能用到的结论是: 若<span class="math inline">\(\alpha,\beta,\gamma\)</span>均大于<span class="math inline">\(0\)</span>, 则点<span class="math inline">\(P\)</span>在三角形<span class="math inline">\(\Delta ABC\)</span>的内部; 若<span class="math inline">\(\alpha,\beta,\gamma\)</span>有一个等于<span class="math inline">\(0\)</span>, 则点<span class="math inline">\(P\)</span>在三角形的边上; 若<span class="math inline">\(\alpha,\beta,\gamma\)</span>有两个等于<span class="math inline">\(0\)</span>, 则点<span class="math inline">\(P\)</span>在三角形的顶点上.</p>
<p>在绘图时, 用一个最小的矩形包围住三角形, 再枚举并判断每个点是否在三角形内部即可. 下面的代码采用了向量叉积法:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Vec3f <span class="title">Drawer::Barycentric</span><span class="params">(<span class="keyword">const</span> Vec2i (&amp;vertex)[<span class="number">3</span>],<span class="keyword">const</span> Vec2i &amp; P)</span></span>&#123;</span><br><span class="line">    Vec3f result =  <span class="comment">//cal cross</span></span><br><span class="line">            <span class="built_in">Vec3f</span>(vertex[<span class="number">1</span>].x - vertex[<span class="number">0</span>].x,vertex[<span class="number">2</span>].x - vertex[<span class="number">0</span>].x,vertex[<span class="number">0</span>].x - P.x) ^</span><br><span class="line">            <span class="built_in">Vec3f</span>(vertex[<span class="number">1</span>].y - vertex[<span class="number">0</span>].y,vertex[<span class="number">2</span>].y - vertex[<span class="number">0</span>].y,vertex[<span class="number">0</span>].y - P.y);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">fabs</span>(result.z) &lt; <span class="number">1</span>)<span class="keyword">return</span> <span class="built_in">Vec3f</span>(<span class="number">-1</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    result.x /= result.z,result.y /= result.z;</span><br><span class="line">    <span class="keyword">return</span> &#123;(<span class="keyword">float</span>)<span class="number">1.0</span> - result.x - result.y,result.x,result.y&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Drawer::Triangle</span><span class="params">(<span class="keyword">const</span> Vec2i (&amp;vertex)[<span class="number">3</span>],<span class="keyword">const</span> TGAColor &amp; color)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> lx = std::<span class="built_in">max</span>(std::<span class="built_in">min</span>(&#123;vertex[<span class="number">0</span>].x,vertex[<span class="number">1</span>].x,vertex[<span class="number">2</span>].x&#125;),<span class="number">0</span>),rx = std::<span class="built_in">min</span>(std::<span class="built_in">max</span>(&#123;vertex[<span class="number">0</span>].x,vertex[<span class="number">1</span>].x,vertex[<span class="number">2</span>].x&#125;),<span class="built_in">get_width</span>()<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">int</span> ly = std::<span class="built_in">max</span>(std::<span class="built_in">min</span>(&#123;vertex[<span class="number">0</span>].y,vertex[<span class="number">1</span>].y,vertex[<span class="number">2</span>].y&#125;),<span class="number">0</span>),ry = std::<span class="built_in">min</span>(std::<span class="built_in">max</span>(&#123;vertex[<span class="number">0</span>].y,vertex[<span class="number">1</span>].y,vertex[<span class="number">2</span>].y,&#125;),<span class="built_in">get_height</span>()<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> x = lx;x &lt;= rx;x++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> y = ly;y &lt;= ry;y++)&#123;</span><br><span class="line">            Vec3f bary = <span class="built_in">Barycentric</span>(vertex,<span class="built_in">Vec2i</span>(x,y));</span><br><span class="line">            <span class="keyword">bool</span> out = (bary.x &lt; <span class="number">0</span> <span class="keyword">or</span> bary.y &lt; <span class="number">0</span> <span class="keyword">or</span> bary.z &lt; <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span>(!out)<span class="built_in">set</span>(x,y,color);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<a target="_blank" rel="noopener" href="https://github.com/ssloy/tinyrenderer/tree/024ad4619b824f9179c86dc144145e2b8b155f52">tinyrender提供的模型</a>来测试一下我们的三角形绘制程序(先给每个面一个随机颜色):</p>
<p><img src="demo-render.assets\image-20220502215053686.png" alt="image-20220502215053686" style="zoom:25%;" /></p>
<p>加上一点阴影并剔除背面的三角形:</p>
<p><img src="demo-render.assets\image-20220502215757516.png" alt="image-20220502215757516" style="zoom:25%;" /></p>
<h1 id="step-3-z-buffer">Step 3 ：z-buffer</h1>
<p>现在我们需要考虑剔除掉不能被我们看见的像素(Step 2通过Back-face culling剔除了一些面, 但是仍然不正确, 例如嘴部整个消失了). z-buffer的思想是维护一个像素点在待渲染平面上的一个距离buffer, 每次用离相机更近的点来剔除已经存在的点. z-buffer的实现非常简单, 下面主要讨论如何求每个点距相机的距离.</p>
<p>首先考虑一维的情形. 假设我们要绘制从<span class="math inline">\(A(x_0,y_0)\)</span>到<span class="math inline">\(B(x_1,y_1)\)</span>的一条线段, 当前绘制到点<span class="math inline">\(P(x,y)\)</span>, 摄像机的视角与<span class="math inline">\(y\)</span>轴的反方向相同:</p>
<p><img src="demo-render.assets\image-20220503101100866.png" alt="image-20220503101100866" style="zoom:50%;" /></p>
<p>在绘制时我们要通过<span class="math inline">\(x\)</span>坐标计算出<span class="math inline">\(y\)</span>来. 不难得到 <span class="math display">\[
\frac{y - y_0}{y1 - y_0} = \frac{x - x_0}{x_1 - x_0}
\]</span> 我们设<span class="math inline">\(\beta = \frac{x - x_0}{x_1 - x_0}\)</span>, 则有 <span class="math display">\[
y = (1 - \beta)y_0 + \beta y_1
\]</span> 是不是很熟悉? <span class="math inline">\(\alpha = 1 - \beta\)</span>和<span class="math inline">\(\beta\)</span>就是<span class="math inline">\(P\)</span>关于线段<span class="math inline">\(AB\)</span>的重心坐标(一维单纯形是线段). 我们将其推广到二维, 便能求出三角形每个点距离相机的距离<span class="math inline">\(z\)</span>: <span class="math display">\[
z = \alpha z_0+ \beta z_1 + \gamma z_2
\]</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Drawer::Triangle</span><span class="params">(<span class="keyword">const</span> Vec3i (&amp;vertex)[<span class="number">3</span>],<span class="keyword">const</span> TGAColor &amp; color,<span class="keyword">double</span> * zbuffer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">-1e-6</span>;<span class="comment">//防止三角形接合处有未绘制的点</span></span><br><span class="line">    <span class="keyword">int</span> lx = std::<span class="built_in">max</span>(std::<span class="built_in">min</span>(&#123;vertex[<span class="number">0</span>].x,vertex[<span class="number">1</span>].x,vertex[<span class="number">2</span>].x&#125;),<span class="number">0</span>),rx = std::<span class="built_in">min</span>(std::<span class="built_in">max</span>(&#123;vertex[<span class="number">0</span>].x,vertex[<span class="number">1</span>].x,vertex[<span class="number">2</span>].x&#125;),<span class="built_in">get_width</span>()<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">int</span> ly = std::<span class="built_in">max</span>(std::<span class="built_in">min</span>(&#123;vertex[<span class="number">0</span>].y,vertex[<span class="number">1</span>].y,vertex[<span class="number">2</span>].y&#125;),<span class="number">0</span>),ry = std::<span class="built_in">min</span>(std::<span class="built_in">max</span>(&#123;vertex[<span class="number">0</span>].y,vertex[<span class="number">1</span>].y,vertex[<span class="number">2</span>].y,&#125;),<span class="built_in">get_height</span>()<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> x = lx;x &lt;= rx;x++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> y = ly;y &lt;= ry;y++)&#123;</span><br><span class="line">            Vec3f bary = <span class="built_in">Barycentric</span>(vertex,<span class="built_in">Vec2i</span>(x,y));</span><br><span class="line">            <span class="keyword">if</span>(bary.x &lt; eps <span class="keyword">or</span> bary.y &lt; eps <span class="keyword">or</span> bary.z &lt; eps)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> idx = x + y * <span class="built_in">get_width</span>();</span><br><span class="line">            <span class="keyword">double</span> z = bary.x * vertex[<span class="number">0</span>].z + bary.y * vertex[<span class="number">1</span>].z + bary.z * vertex[<span class="number">2</span>].z;</span><br><span class="line">            <span class="keyword">if</span>(zbuffer[idx] &lt; z)&#123;</span><br><span class="line">                zbuffer[idx] = z;</span><br><span class="line">                <span class="built_in">set</span>(x,y,color);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下:</p>
<p><img src="demo-render.assets\image-20220503104500854.png" alt="image-20220503104500854" style="zoom: 25%;" /></p>
<h1 id="step-4-透视投影wip">Step 4: 透视投影(WIP)</h1>
<p>这一部分tinyrender讲得很含糊而且不直观, 所以直接按照GAMES101的内容去实现. 本节只讲述实现. obj文件格式可以在https://en.wikipedia.org/wiki/Wavefront_.obj_file找到.</p>
<p>透视投影的实现似乎有问题, 先鸽了</p>
<h1 id="step-5相机">Step 5:相机</h1>
<p>写的不是很满意, 也鸽了</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2022/03/18/solution-CF1642F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/18/solution-CF1642F/" class="post-title-link" itemprop="url">[题解]CF1642F - Two Arrays</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-03-18 11:57:47 / Modified: 19:39:21" itemprop="dateCreated datePublished" datetime="2022-03-18T11:57:47+08:00">2022-03-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>感觉这场F比E简单多了= =</p>
<h2 id="题意">题意</h2>
<p>给出一个<span class="math inline">\(n \times m\)</span>的数组 <span class="math inline">\((1 \leq n \leq 10^5,1 \leq m \leq 5)\)</span>. 数组的每一行元素均互不相同, 且每一行有一个权值<span class="math inline">\(w\)</span> <span class="math inline">\((1 \leq w \leq 10^9)\)</span>.</p>
<p>你需要找出不同的两行, 使得这两行在不存在重复元素的同时权值最小. 输出权值, 无解输出<code>-1</code>.</p>
<h2 id="题解">题解</h2>
<p>暴力做需要<span class="math inline">\(O(n^2m)\)</span>.</p>
<p>将行按权值排序, 把每一个元素对应的行用bitset存下来, 0代表非法1代表合法. 再在枚举每行的时候找到第一个不冲突的行更新答案就可以做到<span class="math inline">\(O(\frac{n^2m}{w})\)</span>, 其中<span class="math inline">\(w = 32\)</span>或<span class="math inline">\(64\)</span>​. 但是这样需要<span class="math inline">\(O(\frac{n^2m}{8})\)</span>的空间, 会MLE.</p>
<p>考虑分块. 设块大小为<span class="math inline">\(B\)</span>, 将每个元素按出现次数分类:</p>
<ul>
<li>出现次数大于<span class="math inline">\(B\)</span>, 这部分元素用bitset存下来, 在枚举每行时使用按位与来更新, 时间复杂度<span class="math inline">\(O(\frac{n^2m}{Bw})\)</span>, 空间复杂度<span class="math inline">\(O(\frac{n^2m}{8B})\)</span>.</li>
<li>出现次数小于<span class="math inline">\(B\)</span>, 这部分元素在枚举每行时直接更新, 时间复杂度<span class="math inline">\(O(B^2)\)</span>, 空间复杂度<span class="math inline">\(O(n)\)</span>.</li>
</ul>
<p>(感觉复杂度算的很不对劲啊- - 反正能过)</p>
<p>然后B选一个差不多的大小比如<span class="math inline">\(\sqrt{nm}\)</span>就能过了.</p>
<h2 id="代码">代码</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ALL(x) (x).begin(),(x).end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PRINT(___) for(auto ____:(___))&#123;cout &lt;&lt; ____ &lt;&lt; <span class="meta-string">&quot; &quot;</span>;&#125;cout &lt;&lt; endl;</span></span><br><span class="line"><span class="function">mt19937 <span class="title">Rand</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="function">ll <span class="title">Pow</span><span class="params">(ll x,ll d,ll p)</span></span>&#123;ll ta=<span class="number">1</span>;<span class="keyword">if</span>(d==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>%p;x %= p;ll a=<span class="built_in">Pow</span>(x,d/<span class="number">2</span>,p);ta=a*a%p;<span class="keyword">if</span>(d%<span class="number">2</span>)ta=ta*x%p;<span class="keyword">return</span> ta%p;&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span>+<span class="number">10</span>;<span class="comment">//CHANGE IT!</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = maxn*<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> p = <span class="number">1e9</span>+<span class="number">7</span>;<span class="comment">//CHANGE IT!</span></span><br><span class="line"><span class="keyword">int</span> raw[maxn],mp[maxn * <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxb = <span class="number">708</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxc = <span class="number">100006</span>;</span><br><span class="line">bitset&lt;maxc&gt;b[maxb + <span class="number">10</span>];</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;ban[maxn * <span class="number">5</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">	vector&lt;<span class="keyword">int</span>&gt;r;</span><br><span class="line">	<span class="keyword">int</span> w;</span><br><span class="line">	<span class="built_in">Node</span>(vector&lt;<span class="keyword">int</span>&gt; r = &#123;&#125;,<span class="keyword">int</span> w = <span class="number">0</span>):<span class="built_in">r</span>(r),<span class="built_in">w</span>(w)&#123;&#125;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node &amp; x)<span class="keyword">const</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> w &lt; x.w;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;node[maxn];</span><br><span class="line"><span class="keyword">int</span> cnt[maxn * <span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	cout.<span class="built_in">setf</span>(ios::fixed,ios::floatfield);</span><br><span class="line">	cout.<span class="built_in">precision</span>(<span class="number">12</span>);	 </span><br><span class="line">	<span class="keyword">int</span> n,m;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;hsh;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">r</span>(m);</span><br><span class="line">		<span class="keyword">int</span> w;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; m;j++)&#123;</span><br><span class="line">			cin &gt;&gt; r[j];</span><br><span class="line">			hsh[r[j]]++;</span><br><span class="line">		&#125;</span><br><span class="line">		cin &gt;&gt; w;</span><br><span class="line">		node[i] = <span class="built_in">Node</span>(r,w);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> tmp = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> &amp; it:hsh)&#123;</span><br><span class="line">		cnt[tmp] = it.second;</span><br><span class="line">		it.second = tmp++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(node+<span class="number">1</span>,node+n+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="number">2e9</span> + <span class="number">10</span>,idx = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; m;j++)&#123;</span><br><span class="line">			<span class="keyword">int</span> &amp; v = node[i].r[j];</span><br><span class="line">			v = hsh[v];</span><br><span class="line">			<span class="keyword">if</span>(cnt[v] &gt; maxb)&#123;</span><br><span class="line">				<span class="keyword">if</span>(!mp[v])&#123;</span><br><span class="line">					b[idx].<span class="built_in">set</span>();</span><br><span class="line">					mp[v] = idx++;</span><br><span class="line">				&#125;</span><br><span class="line">				b[mp[v]].<span class="built_in">reset</span>(i);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> ban[v].<span class="built_in">push_back</span>(i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line">		bitset&lt;maxc&gt;vai;</span><br><span class="line">		vai.<span class="built_in">set</span>();</span><br><span class="line">		vai.<span class="built_in">reset</span>(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; m;j++)&#123;</span><br><span class="line">			<span class="keyword">int</span> v = node[i].r[j];</span><br><span class="line">			<span class="keyword">if</span>(cnt[v] &gt; maxb)&#123;</span><br><span class="line">				vai &amp;= b[mp[v]];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> x:ban[v])vai.<span class="built_in">reset</span>(x);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> x = vai._Find_first();</span><br><span class="line">		<span class="keyword">if</span>(x &lt;= n)ans = <span class="built_in">min</span>(ans,node[i].w + node[x].w);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(ans == <span class="number">2e9</span>+<span class="number">10</span>)ans = <span class="number">-1</span>;</span><br><span class="line">	cout &lt;&lt; ans;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2022/03/11/solution-Gym103495-H/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/11/solution-Gym103495-H/" class="post-title-link" itemprop="url">[题解]Gym103495-H Reverse the String</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-11 10:46:33" itemprop="dateCreated datePublished" datetime="2022-03-11T10:46:33+08:00">2022-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-03-18 11:56:22" itemprop="dateModified" datetime="2022-03-18T11:56:22+08:00">2022-03-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%A2%98%E8%A7%A3/" itemprop="url" rel="index"><span itemprop="name">题解</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>中规中矩的字符串题.</p>
<h2 id="题意">题意</h2>
<p>给出一个字符串<span class="math inline">\(s\)</span>, 你可以选取<span class="math inline">\(s\)</span>的任意子串将其翻转得到<span class="math inline">\(s&#39;\)</span>, 该操作最多进行一次. 求字典序最小的<span class="math inline">\(s&#39;\)</span>.</p>
<p><span class="math inline">\(|s| \leq 10^5, \sum |s| \leq 1.5 \cdot 10 ^ 6\)</span></p>
<h2 id="题解">题解</h2>
<p>以下字符串的下标均从<span class="math inline">\(0\)</span>开始. <span class="math inline">\(lcp(s,t)\)</span>代表<span class="math inline">\(s\)</span>和<span class="math inline">\(t\)</span>的最长公共前缀. <span class="math inline">\(rev(s)\)</span>表示将<span class="math inline">\(s\)</span>翻转后的字符串.</p>
<h3 id="part-1优化做法">part 1：优化做法</h3>
<p>设<span class="math inline">\(n = |s|\)</span>, 朴素的暴力需要至少<span class="math inline">\(O(n^2)\)</span>​来枚举翻转子串的两个端点<span class="math inline">\(L,R\)</span>. 我们需要想办法固定住其中的一个端点.</p>
<p>首先尝试放开限制, 把翻转变成任意排列. 这样将<span class="math inline">\(s\)</span>排序后得到的<span class="math inline">\(s&#39;\)</span>一定是最优的. 记这样的<span class="math inline">\(s&#39;\)</span>为<span class="math inline">\(t\)</span>.</p>
<p>回到原题, 容易看出, <span class="math inline">\(s\)</span>和<span class="math inline">\(t\)</span>的最长公共前缀部分无论我们如何操作都不可能再让字典序变小, 而在这之后的部分是有可能减小字典序的. 且因为字典序的性质(比较第一个不相同的字符), 我们必须尝试让<span class="math inline">\(s&#39;\)</span>和<span class="math inline">\(t\)</span>不同的第一个字符最小. 因此<span class="math inline">\(L = lcp(s,t)\)</span>.</p>
<h3 id="part-2快速比较两字符串大小">part 2：快速比较两字符串大小</h3>
<p>设当前的最优答案为<span class="math inline">\(ans\)</span>, 在固定了<span class="math inline">\(L\)</span>之后, 只需<span class="math inline">\(O(n)\)</span>枚举<span class="math inline">\(R\)</span>, 并快速比较<span class="math inline">\(ans\)</span>和<span class="math inline">\(s&#39;\)</span>的大小即可. 这里可以用<span class="math inline">\(lcp\)</span>来比较两个字符串的大小.</p>
<p>设需要比较<span class="math inline">\(A = s[a...b]\)</span>和<span class="math inline">\(B = s[c...d]\)</span>的关系. 若<span class="math inline">\(lcp(a,c) \ge \min(|A|,|B|)\)</span>,则<span class="math inline">\(A &lt; B\)</span>等价于<span class="math inline">\(|A| &lt; |B|\)</span> 否则, <span class="math inline">\(A &lt; B\)</span>等价于<span class="math inline">\(rank[a] &lt; rank[c]\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">CompString</span><span class="params">(<span class="keyword">int</span> s1,<span class="keyword">int</span> len1,<span class="keyword">int</span> s2,<span class="keyword">int</span> len2)</span></span>&#123;</span><br><span class="line">    	<span class="comment">//s:子串起始位置 len:子串长度</span></span><br><span class="line">		<span class="keyword">int</span> tlcp = (s1 == s2?<span class="built_in">min</span>(len1,len2):<span class="built_in">LCP</span>(s1,s2));</span><br><span class="line">		<span class="keyword">if</span>(tlcp &gt;= <span class="built_in">min</span>(len1,len2))&#123;</span><br><span class="line">			<span class="keyword">return</span> len1 &lt; len2?<span class="number">-1</span>:(len1 == len2?<span class="number">0</span>:<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> c[s1] &lt; c[s2]?<span class="number">-1</span>:(c[s1] == c[s2]?<span class="number">0</span>:<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>注意: 可以只用<span class="math inline">\(lcp\)</span>来比较字符串大小(这样就可以用hash等方法来求<span class="math inline">\(lcp\)</span>而不用写SA). 只要把上面的第6行替换为</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> s[s1 + tlcp] &lt; s[s2 + tlcp]?<span class="number">-1</span>:(s[s1 + tlcp] == s[s2 + tlcp]?<span class="number">0</span>:<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>即可.</p>
<h3 id="part-3-细节部分">part 3 ：细节部分</h3>
<p>首先将整个翻转后的<span class="math inline">\(s\)</span>拼接在原字符串后, 中间用特殊字符隔开, 例如<code>u = s + "$" + rev(s)</code>. 再使用后缀数组处理<span class="math inline">\(u\)</span>. 这样在原串中位置为<span class="math inline">\(i\)</span>的字符, 在反串中的位置就是<span class="math inline">\(2*n - i\)</span>.</p>
<p>假设当前枚举到<span class="math inline">\(R\)</span>, 最优答案为<span class="math inline">\(R&#39;\)</span>, 如下图:</p>
<p><img src="https://raw.githubusercontent.com/LinkinPony/hexo_pic_bed/master/img/image-20220318113847339.png" alt="image-20220318113847339" style="zoom:33%;" /></p>
<p>我们需要比较的是<span class="math inline">\(s[L,R&#39;-1] + rev(s[R&#39;,R])\)</span>和<span class="math inline">\(rev(s[L,R])\)</span>的大小, 如果后者更小则更新答案. 为了方便比较, 可以将每段字符划分成AB两段:</p>
<p><img src="https://raw.githubusercontent.com/LinkinPony/hexo_pic_bed/master/img/image-20220318114006215.png" alt="image-20220318114006215" style="zoom:33%;" /></p>
<p>现在需要比较的就是<span class="math inline">\(rev(A_1) + B_1\)</span>和<span class="math inline">\(rev(A_2) + rev(B_2)\)</span>的大小. 由于A, B长度分别相等, 可以用part2的方法分别比较<span class="math inline">\(rev(A_1)\)</span>与<span class="math inline">\(rev(A_2)\)</span>, <span class="math inline">\(B_1\)</span>与<span class="math inline">\(rev(B_2)\)</span>的大小</p>
<p>每段的(起始位置,长度)可以通过简单推导得到:</p>
<p><span class="math inline">\(rev(A_1)\)</span>: <span class="math inline">\((2*n - R&#39;,R&#39; - L + 1)\)</span></p>
<p><span class="math inline">\(rev(A2)\)</span>: <span class="math inline">\((2*n - R,R - L + 1)\)</span></p>
<p><span class="math inline">\(B_1\)</span>: <span class="math inline">\((R&#39; + 1,i - R&#39;)\)</span></p>
<p><span class="math inline">\(rev(B_2)\)</span>: <span class="math inline">\((2*n - R + R&#39; - L + 1,i - R&#39;)\)</span></p>
<p>其他细节见代码. 时间复杂度<span class="math inline">\(O(n \log n)\)</span>. jls好像有<span class="math inline">\(O(n)\)</span>做法, 有没有好哥哥教教QAQ</p>
<h2 id="代码">代码</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC optimize(<span class="meta-string">&quot;Ofast,unroll-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> GCC target(<span class="meta-string">&quot;avx,avx2,sse,sse2&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> endl <span class="meta-string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="function">mt19937 <span class="title">Rand</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e5</span>+<span class="number">10</span>;<span class="comment">//CHANGE IT!</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = maxn*<span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> p = <span class="number">1e9</span>+<span class="number">7</span>;<span class="comment">//CHANGE IT!</span></span><br><span class="line"><span class="function">ll <span class="title">Pow</span><span class="params">(ll x,ll d,ll p)</span></span>&#123;ll ta=<span class="number">1</span>;<span class="keyword">if</span>(d==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>%p;x %= p;ll a=<span class="built_in">Pow</span>(x,d/<span class="number">2</span>,p);ta=a*a%p;<span class="keyword">if</span>(d%<span class="number">2</span>)ta=ta*x%p;<span class="keyword">return</span> ta%p;&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> a,b;</span><br><span class="line">	<span class="built_in">Node</span>(<span class="keyword">int</span> a = <span class="number">0</span>,<span class="keyword">int</span> b = <span class="number">0</span>):<span class="built_in">a</span>(a),<span class="built_in">b</span>(b)&#123;&#125;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node &amp; x)&#123;</span><br><span class="line">		<span class="keyword">return</span> a == x.a?b &lt; x.b:a &lt; x.a;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;; </span><br><span class="line"><span class="keyword">int</span> lcp[maxn],ST[maxn][<span class="number">20</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SA</span>&#123;</span></span><br><span class="line">	string s;</span><br><span class="line">	<span class="keyword">int</span> n;</span><br><span class="line">	vector&lt;<span class="keyword">int</span>&gt;sa,c;</span><br><span class="line">	<span class="built_in">SA</span>(string s = <span class="string">&quot;&quot;</span>):<span class="built_in">s</span>(s)&#123;</span><br><span class="line">		sa.<span class="built_in">clear</span>(),c.<span class="built_in">clear</span>();</span><br><span class="line">		s += <span class="string">&#x27;$&#x27;</span>;</span><br><span class="line">		n = s.<span class="built_in">size</span>();</span><br><span class="line">		sa.<span class="built_in">assign</span>(n,<span class="number">0</span>);</span><br><span class="line">		c.<span class="built_in">assign</span>(n,<span class="number">0</span>); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">count_sort</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; &amp; sa,vector&lt;<span class="keyword">int</span>&gt; &amp; c)</span></span>&#123;</span><br><span class="line">		vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">pos</span>(n),<span class="built_in">cnt</span>(n),<span class="built_in">sa_new</span>(n);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x:c)cnt[x]++;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)pos[i] = pos[i<span class="number">-1</span>] + cnt[i<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x:sa)&#123;</span><br><span class="line">			<span class="keyword">int</span> d = c[x];</span><br><span class="line">			sa_new[pos[d]] = x;</span><br><span class="line">			pos[d]++;</span><br><span class="line">		&#125;</span><br><span class="line">		sa = sa_new;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//init</span></span><br><span class="line">		&#123;</span><br><span class="line">			vector&lt;Node&gt;<span class="built_in">A</span>(n);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)A[i] = <span class="built_in">Node</span>(s[i],i);</span><br><span class="line">			<span class="built_in">sort</span>(A.<span class="built_in">begin</span>(),A.<span class="built_in">end</span>());</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = A[i].b;</span><br><span class="line">			c[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">				c[sa[i]] = c[sa[i<span class="number">-1</span>]] + (A[i].a != A[i<span class="number">-1</span>].a);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>((<span class="number">1</span>&lt;&lt;k) &lt; n)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)sa[i] = (sa[i] - (<span class="number">1</span>&lt;&lt;k) + n)%n;</span><br><span class="line">			<span class="built_in">count_sort</span>(sa,c);</span><br><span class="line">			vector&lt;<span class="keyword">int</span>&gt;<span class="built_in">c_new</span>(n);</span><br><span class="line">			c_new[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;i++)&#123;</span><br><span class="line">				pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;now = &#123;c[sa[i]],c[(sa[i] + (<span class="number">1</span>&lt;&lt;k)) % n]&#125;;</span><br><span class="line">				pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;prev = &#123;c[sa[i<span class="number">-1</span>]],c[(sa[i<span class="number">-1</span>] + (<span class="number">1</span>&lt;&lt;k)) % n]&#125;;</span><br><span class="line">				c_new[sa[i]] = c_new[sa[i<span class="number">-1</span>]] + (now != prev);</span><br><span class="line">			&#125;</span><br><span class="line">			k++;</span><br><span class="line">			c = c_new;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">ST_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n;i++)ST[i][<span class="number">0</span>] = lcp[i];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j) &lt;= n;j++)</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i + (<span class="number">1</span>&lt;&lt;j) <span class="number">-1</span> &lt;= n;i++)</span><br><span class="line">				ST[i][j] = <span class="built_in">min</span>(ST[i][j - <span class="number">1</span>],ST[i + (<span class="number">1</span>&lt;&lt;(j - <span class="number">1</span>))][j - <span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">LCP</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</span><br><span class="line">		L = c[L],R = c[R];</span><br><span class="line">		<span class="keyword">if</span>(L &gt; R)<span class="built_in">swap</span>(L,R);</span><br><span class="line">		L++;</span><br><span class="line">		<span class="keyword">int</span> k = <span class="built_in">log2</span>(R - L + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">min</span>(ST[L][k],ST[R - (<span class="number">1</span>&lt;&lt;k) + <span class="number">1</span>][k]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">getlcp</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n<span class="number">-1</span>;i++)&#123;</span><br><span class="line">			<span class="keyword">int</span> j = sa[c[i] - <span class="number">1</span>];</span><br><span class="line">			<span class="keyword">while</span>(s[i+k] == s[j+k])k++;</span><br><span class="line">			lcp[c[i]] = k;</span><br><span class="line">			<span class="keyword">if</span>(k)k--;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">ST_init</span>();</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">CompString</span><span class="params">(<span class="keyword">int</span> s1,<span class="keyword">int</span> len1,<span class="keyword">int</span> s2,<span class="keyword">int</span> len2)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> tlcp = (s1 == s2?<span class="built_in">min</span>(len1,len2):<span class="built_in">LCP</span>(s1,s2));</span><br><span class="line">		<span class="keyword">if</span>(tlcp &gt;= <span class="built_in">min</span>(len1,len2))&#123;</span><br><span class="line">			<span class="keyword">return</span> len1 &lt; len2?<span class="number">-1</span>:(len1 == len2?<span class="number">0</span>:<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> s[s1 + tlcp] &lt; s[s2 + tlcp]?<span class="number">-1</span>:(s[s1 + tlcp] == s[s2 + tlcp]?<span class="number">0</span>:<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;sa;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	cout.<span class="built_in">setf</span>(ios::fixed,ios::floatfield);</span><br><span class="line">	cout.<span class="built_in">precision</span>(<span class="number">12</span>);	 </span><br><span class="line">	<span class="keyword">int</span> __;</span><br><span class="line">	cin &gt;&gt; __;</span><br><span class="line">	<span class="keyword">while</span>(__--)&#123;</span><br><span class="line">		string s;</span><br><span class="line">		cin &gt;&gt; s;</span><br><span class="line">		string u = s;</span><br><span class="line">		<span class="built_in">sort</span>(u.<span class="built_in">begin</span>(),u.<span class="built_in">end</span>());</span><br><span class="line">		<span class="keyword">int</span> L = <span class="number">-1</span>;</span><br><span class="line">		<span class="keyword">int</span> n = s.<span class="built_in">size</span>();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; n;i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(s[i] != u[i])&#123;</span><br><span class="line">				L = i;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(L == <span class="number">-1</span>)&#123;</span><br><span class="line">			cout &lt;&lt; s &lt;&lt; endl;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		u = s;</span><br><span class="line">		<span class="built_in">reverse</span>(u.<span class="built_in">begin</span>(),u.<span class="built_in">end</span>());</span><br><span class="line">		s = s + <span class="string">&quot;$&quot;</span> + u;</span><br><span class="line">		sa = <span class="built_in">SA</span>(s);</span><br><span class="line">		sa.<span class="built_in">cal</span>();</span><br><span class="line">		sa.<span class="built_in">getlcp</span>();</span><br><span class="line">		<span class="keyword">int</span> R = L;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = L;i &lt; n;i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(sa.<span class="built_in">CompString</span>(L,i - L + <span class="number">1</span>,<span class="number">2</span>*n - i,i - L + <span class="number">1</span>) &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">				<span class="keyword">int</span> x = sa.<span class="built_in">CompString</span>(<span class="number">2</span>*n - R,R - L + <span class="number">1</span>,<span class="number">2</span>*n - i,R - L + <span class="number">1</span>);</span><br><span class="line">				<span class="keyword">if</span>(x &gt; <span class="number">0</span>)&#123;</span><br><span class="line">					R = i;					</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(x == <span class="number">0</span> <span class="keyword">and</span> sa.<span class="built_in">CompString</span>(R + <span class="number">1</span>,i - R,<span class="number">2</span>*n - i + R - L + <span class="number">1</span>,i - R) &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">					R = i;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">reverse</span>(u.<span class="built_in">begin</span>(),u.<span class="built_in">end</span>());</span><br><span class="line">		<span class="built_in">reverse</span>(u.<span class="built_in">begin</span>() + L,u.<span class="built_in">begin</span>() + R + <span class="number">1</span>);</span><br><span class="line">		cout &lt;&lt; u &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://linkinpony.github.io/2022/01/22/solution-CF1625E1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="LinkinPony">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="I always love dashie">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/22/solution-CF1625E1/" class="post-title-link" itemprop="url">solution-CF1625E1</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-22 11:41:15" itemprop="dateCreated datePublished" datetime="2022-01-22T11:41:15+08:00">2022-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LinkinPony</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","cdn":"//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
